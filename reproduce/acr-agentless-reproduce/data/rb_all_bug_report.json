{
    "aya-rs__aya-774": "cant' use LruHashMap in userspace\nthe userspace HashMap try_from impl\r\n\r\n```rust\r\nimpl<'a, V: Pod, K: Pod> TryFrom<&'a mut Map> for HashMap<&'a mut MapData, V, K> {\r\n    type Error = MapError;\r\n\r\n    fn try_from(map: &'a mut Map) -> Result<HashMap<&'a mut MapData, V, K>, MapError> {\r\n        match map {\r\n            Map::HashMap(m) => {\r\n                HashMap::new(m)\r\n            }\r\n            _ => Err(MapError::InvalidMapType { map_type: map.map_type() }),\r\n        }\r\n    }\r\n}\r\nimpl<V: Pod, K: Pod> TryFrom<Map> for HashMap<MapData, V, K> {\r\n    type Error = MapError;\r\n\r\n    fn try_from(map: Map) -> Result<HashMap<MapData, V, K>, MapError> {\r\n        match map {\r\n            Map::HashMap(m) => HashMap::new(m),\r\n            _ => Err(MapError::InvalidMapType { map_type: map.map_type() }),\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nthe expanded codes show HashMap only can from bpf hashmap, but not lru hashmap, I remember HashMap can try_from a LruHashMap at previous commit\r\n\r\nthe latest commit 5c86b7e is broken\n",
    "aya-rs__aya-656": "Kernel version detection is broken on WSL\nUsing aya from with the yesterday's commit fails with\r\n```\r\nthread 'main' panicked at 'called `Result::unwrap()` on an `Err` value: ParseError(Parse(\"90.1\", \"patch\"))', /home/debian/.cargo/git/checkouts/aya-c55fbc69175ac116/242d8c3/aya/src/maps/mod.rs:504:55\r\n```\r\n\r\nwhen running on Windows/WSL2 Debian 12.\r\n\r\n`uname -r` for this system:\r\n```\r\n5.15.90.1-microsoft-standard-WSL2\r\n```\r\n\r\nLooks like the reworked kernel version detection from a couple of days ago doesn't work with this string.\n",
    "aya-rs__aya-897": "Error: error parsing BPF object: invalid program section `cgroup_skb`\n**My program code\uff1a\r\n```\r\n#[cgroup_skb]\r\npub fn cg01(ctx: SkBuffContext) -> i32 {\r\n    match try_cg02(ctx) {\r\n        Ok(ret) => ret,\r\n        Err(ret) => ret,\r\n    }\r\n}\r\nfn try_cg01(ctx: SkBuffContext) -> Result<i32, i32> {\r\n    info!(&ctx, \"received a packet\");\r\n    Ok(0)\r\n}**\r\n==========================================================\r\n**cargo xtask build-ebpf   -->  Compilation passed**\r\n\r\n**cargo xtask run  --> Failed to run `sudo -E target/debug/cg01` invalid program section `cgroup_skb`**\r\n```\n",
    "aya-rs__aya-431": "API for updating maps with large Pod\nAlthough Rust is memory safe, it does not have any stack overflow protection. The default Rust stack is 2MB which is plenty for most applications. However, when dealing with Pod with large arrays embedded, it's possible to overflow the user space Rust stack.\r\n\r\nHere's an example:\r\n\r\n```rust\r\n#[derive(Clone, Copy)]\r\npub struct Data {\r\n    arr: [u8; 2 << 10 << 10],\r\n}\r\n```\r\n\r\nNow, in order to prevent this, we need to `Box` the struct. However, since `Box` can't be `Copy`. So such structs are unable to implement `aya::Pod`.\n",
    "aya-rs__aya-90": "bpf(2) fails with invalid argument when creating .bss map\nI wanted to test out a simple example of using .data, .rodata, and .bss maps in Aya. It seems that .data and .rodata work just fine, but creating the .bss map always seems to fail with an invalid argument error. Inspecting the strace dump (shown below), the offending part of the bpf_attr struct appears to be an incorrect map value size of 0.\r\n\r\nHere is my minimal reproduction aya-bpf code:\r\n```rust\r\n#![no_std]\r\n#![no_main]\r\n\r\n#[used]\r\nstatic TEST_RODATA: i32 = 0;\r\n#[used]\r\nstatic mut TEST_DATA: i32 = 1;\r\n#[used]\r\nstatic mut TEST_BSS: i32 = 0;\r\n```\r\n\r\nRelevant strace dump (offending bpf syscall is the last one, others included for context):\r\n```\r\n46537 bpf(BPF_MAP_CREATE, {map_type=BPF_MAP_TYPE_ARRAY, key_size=4, value_size=4, max_entries=1, map_flags=0, inner_map_fd=0, map_name=\".rodata\", map_ifindex=0, btf_fd=0, btf_key_type_id=0, btf_value_type_id=0, btf_vmlinux_value_type_id=0}, 128) = 3\r\n46537 bpf(BPF_MAP_UPDATE_ELEM, {map_fd=3, key=0x563ce3ec1204, value=0x563ce4ea7020, flags=BPF_ANY}, 128) = 0\r\n46537 bpf(BPF_MAP_CREATE, {map_type=BPF_MAP_TYPE_ARRAY, key_size=4, value_size=4, max_entries=1, map_flags=0, inner_map_fd=0, map_name=\".data\", map_ifindex=0, btf_fd=0, btf_key_type_id=0, btf_value_type_id=0, btf_vmlinux_value_type_id=0}, 128) = 4\r\n46537 bpf(BPF_MAP_UPDATE_ELEM, {map_fd=4, key=0x563ce3ec1204, value=0x563ce4eaec90, flags=BPF_ANY}, 128) = 0\r\n46537 bpf(BPF_MAP_CREATE, {map_type=BPF_MAP_TYPE_ARRAY, key_size=4, value_size=0, max_entries=1, map_flags=0, inner_map_fd=0, map_name=\".bss\", map_ifindex=0, btf_fd=0, btf_key_type_id=0, btf_value_type_id=0, btf_vmlinux_value_type_id=0}, 128) = -1 EINVAL (Invalid argument)\r\n```\n",
    "aya-rs__aya-253": "lifecyle: Add a `forget()` API for `Link`\nDefault behaviour is that the `Drop` trait calls `detach()` when the program is terminated (or panics).\r\nFor some types of long running programs you may wish to intentionally `forget()` the fd wrapped by `Link`, so you can keep the program running after exit. Query and detach can happen out-of-band for some program types (e.g via netlink, or `bpf_prog_query`)\n",
    "sharkdp__bat-1017": "bin/rails script highlighted as HTML (Rails) instead of Ruby\n<!--\r\nHey there, thanks for creating an issue!\r\n\r\nIn order to reproduce your issue, we might need to know a little bit more about the environment\r\nwhich you're running `bat` on.\r\n\r\nIf you're on Linux or MacOS:\r\n  Please run the script at https://github.com/sharkdp/bat/blob/master/diagnostics/info.sh and\r\n  paste the output at the bottom of the bug report.\r\n\r\nIf you're on Windows:\r\n  Please tell us about your Windows Version (e.g. \"Windows 10 1908\") at the\r\n  bottom of the bug report.\r\n-->\r\n\r\n**What version of `bat` are you using?**\r\nbat 0.15.1\r\n\r\n**Describe the bug you encountered:**\r\n`bin/rails` in a Ruby on Rails project has a `#!/usr/bin/env ruby` shebang, but the Sublime syntax definition for \"HTML (Rails)\" includes the `rails` extension, which matches first and prevents any useful highlighting from occurring when running `bat bin/rails`.\r\n\r\n**Describe what you expected to happen?**\r\n`bat bin/rails` uses the `#!/usr/bin/env ruby` shebang to detect a Ruby filetype and use the Ruby syntax definition for highlighting.\r\n\r\n**How did you install `bat`?**\r\n`brew install bat`\r\n\r\n---\r\n\r\n```\r\nsystem\r\n------\r\n\r\n**$ uname -srm**\r\nDarwin 19.4.0 x86_64\r\n\r\n**$ sw_vers**\r\nProductName:    Mac OS X\r\nProductVersion: 10.15.4\r\nBuildVersion:   19E2269\r\n\r\nbat\r\n---\r\n\r\n**$ bat --version**\r\nbat 0.15.1\r\n\r\n**$ env**\r\n\r\nbat_config\r\n----------\r\n\r\nbat_wrapper\r\n-----------\r\n\r\nNo wrapper script for 'bat'.\r\n\r\nbat_wrapper_function\r\n--------------------\r\n\r\nNo wrapper function for 'bat'.\r\n\r\nNo wrapper function for 'cat'.\r\n\r\ntool\r\n----\r\n\r\n**$ less --version**\r\nless 487 (POSIX regular expressions)\r\n```\n",
    "sharkdp__bat-1556": "BAT_CONFIG_PATH ignored by --generate-config-file\n<!-- Hey there, thank you for creating an issue! -->\r\n\r\n**What version of `bat` are you using?**\r\n\r\n<!-- Output of `bat --version` -->\r\nNewest\r\n\r\n**Describe the bug you encountered:**\r\n![image](https://user-images.githubusercontent.com/55729509/108675764-3694ee80-7522-11eb-9c45-3337c8d63dc7.png)\r\n\r\n\r\n**What did you expect to happen instead?**\r\n\r\nuse custom location instead\r\n\r\n\r\n**Windows version:**\r\n\r\n![image](https://user-images.githubusercontent.com/55729509/108675495-d736de80-7521-11eb-81ef-032ba4309f1f.png)\r\n\n",
    "sharkdp__bat-1522": "RUSTSEC-2020-0053: dirs: dirs is unmaintained, use dirs-next instead\nWhen `cargo-audit` is run on any crate that depends directly or indirectly on bat, the following is output (for more info, see https://rustsec.org/advisories/RUSTSEC-2020-0053):\r\n\r\n```\r\nCrate:         dirs\r\nVersion:       3.0.1\r\nWarning:       unmaintained\r\nTitle:         dirs is unmaintained, use dirs-next instead\r\nDate:          2020-10-16\r\nID:            RUSTSEC-2020-0053\r\nURL:           https://rustsec.org/advisories/RUSTSEC-2020-0053\r\nDependency tree:\r\ndirs 3.0.1\r\n\u2514\u2500\u2500 bat 0.17.1\r\n```\r\n\r\nIt can easily be remedied by replacing dirs with dirs-next.\r\n\r\nI would we willing to attempt to implement this and submit a PR if it would be accepted.\n",
    "sharkdp__bat-1506": "Can't use `bat` at all! (Error: Use of bat as a pager is disallowed...)\n**What version of `bat` are you using?**\r\nbat 0.17.1\r\n\r\n**Describe the bug you encountered:**\r\n\r\nWhenever I use `bat`, I'm shown the following error message:\r\n\r\n> [bat error]: Use of bat as a pager is disallowed in order to avoid infinite recursion problems\r\n\r\nI believe this started happening after a certain update but can't exactly pinpoint which one. I've uninstalled and reinstalled `bat` again but with no luck.\r\n\r\n**What did you expect to happen instead?**\r\nFor `bat` to display the contents as usual.\r\n\r\n**How did you install `bat`?**\r\nHomebrew\r\n\r\n---\r\n\r\nsystem\r\n------\r\n\r\n**$ uname -srm**\r\nDarwin 20.1.0 x86_64  \r\n\r\n**$ sw_vers**\r\nProductName:\tmacOS  \r\nProductVersion:\t11.0.1  \r\nBuildVersion:\t20B29  \r\n\r\nbat\r\n---\r\n\r\n**$ bat --version**\r\nbat 0.17.1  \r\n\r\n**$ env**\r\nPAGER=bat  \r\n\r\nbat_config\r\n----------\r\n\r\nbat_wrapper\r\n-----------\r\n\r\nNo wrapper script for 'bat'.\r\n\r\nbat_wrapper_function\r\n--------------------\r\n\r\nNo wrapper function for 'bat'.\r\n\r\nNo wrapper function for 'cat'.\r\n\r\ntool\r\n----\r\n\r\n**$ less --version**\r\nless 487 (POSIX regular expressions)\r\n\n",
    "sharkdp__bat-1889": "Some *.conf files not highlighted\nI wanted to add syntax highlighting for for .tmux.conf file, so I add this file to `bat/syntaxes/`\r\n\r\nhttps://raw.githubusercontent.com/gerardroche/sublime-tmux/master/Tmux.sublime-syntax\r\n\r\nI then `bat cache -b` and try viewing my `.tmux.conf` file, but it is still plain with no syntax highlighting. Have I missed something or does this file not work with bat for some reason? Tmux and the file extensions do appear with `bat -L`.\n",
    "sharkdp__bat-1440": "Newline can be added even if --style=plain\nIn #975 @sharkdp said this:\r\n\r\n> The fact that bat -p prints a trailing newline (even if there is no newline at the end of the file) should be considered a bug, I believe (but we should check older tickets, if there was a reason for this behavior).\r\n\r\nAnd I completely agree. The reason the artificial newline was added in the first place was to fix #299, but there should be no risk of regressions since --style=plain excludes any kind of decorations that bug was about.\r\n\r\nNote that a pager such as `less` will add an artificial newline too, so one either has to disable paging or use a \"pager\" that does not add a newline to get the benefit of fixing this bug.\r\n\r\n**Step-by-step:**\r\n1.  echo -n nonewline > nonewline.txt\r\n2. bat --style=plain --paging=never nonewline.txt\r\n3. bat --style=plain --pager=cat nonewline.txt\r\n\r\n**Expected result:**\r\nAfter 2. and 3. the line shall not contain a newline. I personally use `zsh` to check this since by default `zsh` will print e.g. `%` as the last char if there is a missing newline.\r\n\r\n**Actual result:**\r\nA newline is printed with `bat 0.17.1`.\r\n\r\n(I will soon open a PR with a proposed fix)\r\n\nNewline can be added even if --style=plain\nIn #975 @sharkdp said this:\r\n\r\n> The fact that bat -p prints a trailing newline (even if there is no newline at the end of the file) should be considered a bug, I believe (but we should check older tickets, if there was a reason for this behavior).\r\n\r\nAnd I completely agree. The reason the artificial newline was added in the first place was to fix #299, but there should be no risk of regressions since --style=plain excludes any kind of decorations that bug was about.\r\n\r\nNote that a pager such as `less` will add an artificial newline too, so one either has to disable paging or use a \"pager\" that does not add a newline to get the benefit of fixing this bug.\r\n\r\n**Step-by-step:**\r\n1.  echo -n nonewline > nonewline.txt\r\n2. bat --style=plain --paging=never nonewline.txt\r\n3. bat --style=plain --pager=cat nonewline.txt\r\n\r\n**Expected result:**\r\nAfter 2. and 3. the line shall not contain a newline. I personally use `zsh` to check this since by default `zsh` will print e.g. `%` as the last char if there is a missing newline.\r\n\r\n**Actual result:**\r\nA newline is printed with `bat 0.17.1`.\r\n\r\n(I will soon open a PR with a proposed fix)\r\n\n",
    "sharkdp__bat-1398": "Infinite loop when \"input file is output file\"\n<!--\r\nHey there, thanks for creating an issue!\r\n\r\nIn order to reproduce your issue, we might need to know a little bit more about the environment\r\nwhich you're running `bat` on.\r\n\r\nIf you're on Linux or MacOS:\r\n  Please run the script at https://github.com/sharkdp/bat/blob/master/diagnostics/info.sh and\r\n  paste the output at the bottom of the bug report.\r\n\r\nIf you're on Windows:\r\n  Please tell us about your Windows Version (e.g. \"Windows 10 1908\") at the\r\n  bottom of the bug report.\r\n-->\r\n\r\n**What version of `bat` are you using?**\r\n[paste the output of `bat --version` here]\r\nbat 0.15.4\r\n**Describe the bug you encountered:**\r\nWhen input file is also an output file, an infinite loop can be created, where shell writes to a file, bat reads the file, the shell redirects it to the same file and bat has to read than again, ad infinitum.\r\nTo reproduce:\r\n```\r\necho a > a\r\nbat a b > b\r\n```\r\n**Describe what you expected to happen?**\r\n`bat` should behave as `cat`; cat prints `cat: b: input file is output file` to stderr. While this behaviour could be useful, it has the potential to use up all the disk space and reduce nand lifespan.\r\n\r\n**How did you install `bat`?**\r\npacman, Arch Linux\r\n\r\n---\r\n\r\n[paste the output of `info.sh` here]\r\nsystem\r\n------\r\n\r\n**$ uname -srm**\r\nLinux 5.8.9-zen2-1-zen x86_64\r\n\r\nbat\r\n---\r\n\r\n**$ bat --version**\r\nbat 0.15.4\r\n\r\n**$ env**\r\nALACRITTY_LOG=/tmp/Alacritty-59883.log\r\nCOLORTERM=truecolor\r\nDBUS_SESSION_BUS_ADDRESS=unix:path=/run/user/1000/bus\r\nDISPLAY=:0\r\nHOME=/home/lizzie\r\nI3SOCK=/run/user/1000/sway-ipc.1000.720.sock\r\nLANG=en_US.UTF-8\r\nLANGUAGE=en_US:en\r\nLC_ADDRESS=pl_PL.UTF-8\r\nLC_COLLATE=pl_PL.UTF-8\r\nLC_CTYPE=pl_PL.UTF-8\r\nLC_MEASUREMENT=pl_PL.UTF-8\r\nLC_MESSAGES=en_US.UTF-8\r\nLC_MONETARY=pl_PL.UTF-8\r\nLC_NAME=pl_PL.UTF-8\r\nLC_NUMERIC=pl_PL.UTF-8\r\nLC_PAPER=pl_PL.UTF-8\r\nLC_TELEPHONE=pl_PL.UTF-8\r\nLC_TIME=pl_PL.UTF-8\r\nLOGNAME=lizzie\r\nMAIL=/var/spool/mail/lizzie\r\nOMF_CONFIG=/home/lizzie/.config/omf\r\nOMF_PATH=/home/lizzie/.local/share/omf\r\nPATH=/usr/local/sbin:/usr/local/bin:/usr/bin:/usr/bin/site_perl:/usr/bin/vendor_perl:/usr/bin/core_perl\r\nPWD=/home/lizzie\r\nQT_QPA_PLATFORM=wayland\r\nSHELL=/usr/bin/fish\r\nSHLVL=2\r\nSWAYSOCK=/run/user/1000/sway-ipc.1000.720.sock\r\nTERM=alacritty\r\nUSER=lizzie\r\nWAYLAND_DISPLAY=wayland-0\r\nXCURSOR_SIZE=24\r\nXDG_RUNTIME_DIR=/run/user/1000\r\nXDG_SEAT=seat0\r\nXDG_SESSION_CLASS=user\r\nXDG_SESSION_ID=1\r\nXDG_SESSION_TYPE=tty\r\nXDG_VTNR=1\r\n\r\nbat_config\r\n----------\r\n\r\nbat_wrapper\r\n-----------\r\n\r\nNo wrapper script for 'bat'.\r\n\r\nbat_wrapper_function\r\n--------------------\r\n\r\nNo wrapper function for 'bat'.\r\n\r\nNo wrapper function for 'cat'.\r\n\r\ntool\r\n----\r\n\r\n**$ less --version**\r\nless 551 (PCRE regular expressions)\r\n\n",
    "sharkdp__bat-562": "Bat is broken for filenames that are prefixes of \"cache\"\nThe issue with files named \"cache\" was already identified in #245 and fixed in #275. However, the `clap` parser doesn't require an exact match: any prefix of the subcommand \"cache\" will do. So if you try `bat c` (or \"ca\", \"cac\", \"cach\"), one of the following will happen:\r\n\r\n1. If there is a file named \"cache\", it will print that instead (the wrong file!).\r\n2. Otherwise, it will print an error message about `--build`/`--clear` being required.\r\n\r\nI think it's best to avoid subcommands and use something like `--cache` instead.\n",
    "cargo-generate__cargo-generate-785": "chore(deps): bump clap from 3.2.23 to 4.0.19\nBumps [clap](https://github.com/clap-rs/clap) from 3.2.23 to 4.0.19.\n<details>\n<summary>Release notes</summary>\n<p><em>Sourced from <a href=\"https://github.com/clap-rs/clap/releases\">clap's releases</a>.</em></p>\n<blockquote>\n<h2>v4.0.19</h2>\n<h2>[4.0.19] - 2022-11-04</h2>\n<h3>Features</h3>\n<ul>\n<li><code>ColorChoice</code> now implements <code>ValueEnum</code></li>\n</ul>\n<h2>v4.0.18</h2>\n<h2>[4.0.18] - 2022-10-20</h2>\n<h3>Fixes</h3>\n<ul>\n<li><em>(derive)</em> Allow <code>#[command(skip)]</code> to also work with enum variants with a value</li>\n</ul>\n<h2>v4.0.17</h2>\n<h2>[4.0.17] - 2022-10-18</h2>\n<h3>Fixes</h3>\n<ul>\n<li>Allow using <code>Arg::last(true)</code> with <code>Arg::value_hint(ValueHint::CommandWithArguments)</code></li>\n</ul>\n<h2>v4.0.16</h2>\n<h2>[4.0.16] - 2022-10-18</h2>\n<h3>Fixes</h3>\n<ul>\n<li><code>Arg::exclusive(true)</code> should not be exclusive with the argument's own <code>ArgGroup</code></li>\n</ul>\n<h2>v4.0.15</h2>\n<h2>[4.0.15] - 2022-10-13</h2>\n<h3>Fixes</h3>\n<ul>\n<li><em>(error)</em> Don't suggest <code>--</code> when it doesn't help</li>\n<li><em>(error)</em> Be more consistent in quoting, punctuation, and indentation in errors</li>\n</ul>\n<h2>v4.0.14</h2>\n<h2>[4.0.14] - 2022-10-12</h2>\n<h3>Fixes</h3>\n<ul>\n<li>Only put <code>ArgGroup</code> in <code>ArgMatches</code> when\u00a0explicitly specified, fixing derives handling of option-flattened fields (<a href=\"https://github-redirect.dependabot.com/clap-rs/clap/issues/4375\">#4375</a>)</li>\n</ul>\n<h2>v4.0.13</h2>\n<h2>[4.0.13] - 2022-10-11</h2>\n<h3>Features</h3>\n<ul>\n<li><em>(derive)</em> Allow <code>()</code> for fields to mean &quot;don't read&quot; (<a href=\"https://github-redirect.dependabot.com/clap-rs/clap/issues/4371\">#4371</a>)</li>\n</ul>\n<!-- raw HTML omitted -->\n</blockquote>\n<p>... (truncated)</p>\n</details>\n<details>\n<summary>Changelog</summary>\n<p><em>Sourced from <a href=\"https://github.com/clap-rs/clap/blob/master/CHANGELOG.md\">clap's changelog</a>.</em></p>\n<blockquote>\n<h2>[4.0.19] - 2022-11-04</h2>\n<h3>Features</h3>\n<ul>\n<li><code>ColorChoice</code> now implements <code>ValueEnum</code></li>\n</ul>\n<h2>[4.0.18] - 2022-10-20</h2>\n<h3>Fixes</h3>\n<ul>\n<li><em>(derive)</em> Allow <code>#[command(skip)]</code> to also work with enum variants with a value</li>\n</ul>\n<h2>[4.0.17] - 2022-10-18</h2>\n<h3>Fixes</h3>\n<ul>\n<li>Allow using <code>Arg::last(true)</code> with <code>Arg::value_hint(ValueHint::CommandWithArguments)</code></li>\n</ul>\n<h2>[4.0.16] - 2022-10-18</h2>\n<h3>Fixes</h3>\n<ul>\n<li><code>Arg::exclusive(true)</code> should not be exclusive with the argument's own <code>ArgGroup</code></li>\n</ul>\n<h2>[4.0.15] - 2022-10-13</h2>\n<h3>Fixes</h3>\n<ul>\n<li><em>(error)</em> Don't suggest <code>--</code> when it doesn't help</li>\n<li><em>(error)</em> Be more consistent in quoting, punctuation, and indentation in errors</li>\n</ul>\n<h2>[4.0.14] - 2022-10-12</h2>\n<h3>Fixes</h3>\n<ul>\n<li>Only put <code>ArgGroup</code> in <code>ArgMatches</code> when\u00a0explicitly specified, fixing derives handling of option-flattened fields (<a href=\"https://github-redirect.dependabot.com/clap-rs/clap/issues/4375\">#4375</a>)</li>\n</ul>\n<h2>[4.0.13] - 2022-10-11</h2>\n<h3>Features</h3>\n<ul>\n<li><em>(derive)</em> Allow <code>()</code> for fields to mean &quot;don't read&quot; (<a href=\"https://github-redirect.dependabot.com/clap-rs/clap/issues/4371\">#4371</a>)</li>\n</ul>\n<h2>[4.0.12] - 2022-10-10</h2>\n<h3>Features</h3>\n<ul>\n<li>Added <code>TypedValueParser::try_map</code> for when adapting an existing <code>TypedValueParser</code> can fail</li>\n<li><em>(error)</em> Create errors like clap with <code>Error::new</code>, <code>Error::with_cmd</code>, and <code>Error::insert</code></li>\n</ul>\n<!-- raw HTML omitted -->\n</blockquote>\n<p>... (truncated)</p>\n</details>\n<details>\n<summary>Commits</summary>\n<ul>\n<li><a href=\"https://github.com/clap-rs/clap/commit/7a8cf91aaaa699a715681f32d26f7e782f724f6c\"><code>7a8cf91</code></a> chore: Release</li>\n<li><a href=\"https://github.com/clap-rs/clap/commit/5dfeb1e3f9461549383650c866e8833e621314d0\"><code>5dfeb1e</code></a> docs: Update changelog</li>\n<li><a href=\"https://github.com/clap-rs/clap/commit/8c31bcea5cac70e059e05c2ed4c865fb915e8a84\"><code>8c31bce</code></a> Merge pull request <a href=\"https://github-redirect.dependabot.com/clap-rs/clap/issues/4445\">#4445</a> from tmccombs/colorchoice-valueenum</li>\n<li><a href=\"https://github.com/clap-rs/clap/commit/2ff3d437240eb663ffc4ff3c7956f1faa62b02a2\"><code>2ff3d43</code></a> feat(derive): Implement ValueEnum for ColorChoice</li>\n<li><a href=\"https://github.com/clap-rs/clap/commit/033438eb4b93980b466f1788f93e5d32f48e3014\"><code>033438e</code></a> Merge pull request <a href=\"https://github-redirect.dependabot.com/clap-rs/clap/issues/4440\">#4440</a> from clap-rs/dependabot/cargo/trybuild-1.0.71</li>\n<li><a href=\"https://github.com/clap-rs/clap/commit/7f0d9e306e24e85d8b289a19a9a990f70c83e87c\"><code>7f0d9e3</code></a> chore(deps): bump trybuild from 1.0.65 to 1.0.71</li>\n<li><a href=\"https://github.com/clap-rs/clap/commit/27bfcc56a9789a8a8d370e31000f3f7fe1081603\"><code>27bfcc5</code></a> chore: Release</li>\n<li><a href=\"https://github.com/clap-rs/clap/commit/c8423ff42d9b3be1a63bf601d2ac2fd74b6979a4\"><code>c8423ff</code></a> docs(man): Update changelog</li>\n<li><a href=\"https://github.com/clap-rs/clap/commit/5908192f3e4d24001021aa39aad23ad6cea7c105\"><code>5908192</code></a> Merge pull request <a href=\"https://github-redirect.dependabot.com/clap-rs/clap/issues/4432\">#4432</a> from drivasperez/fix-man-args</li>\n<li><a href=\"https://github.com/clap-rs/clap/commit/7030e9e995d7ed0e3856d3efb50e93e25a90a429\"><code>7030e9e</code></a> fix: Don't show default values for flags</li>\n<li>Additional commits viewable in <a href=\"https://github.com/clap-rs/clap/compare/v3.2.23...v4.0.19\">compare view</a></li>\n</ul>\n</details>\n<br />\n\n\n[![Dependabot compatibility score](https://dependabot-badges.githubapp.com/badges/compatibility_score?dependency-name=clap&package-manager=cargo&previous-version=3.2.23&new-version=4.0.19)](https://docs.github.com/en/github/managing-security-vulnerabilities/about-dependabot-security-updates#about-compatibility-scores)\n\nDependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.\n\n[//]: # (dependabot-automerge-start)\n[//]: # (dependabot-automerge-end)\n\n---\n\n<details>\n<summary>Dependabot commands and options</summary>\n<br />\n\nYou can trigger Dependabot actions by commenting on this PR:\n- `@dependabot rebase` will rebase this PR\n- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it\n- `@dependabot merge` will merge this PR after your CI passes on it\n- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it\n- `@dependabot cancel merge` will cancel a previously requested merge and block automerging\n- `@dependabot reopen` will reopen this PR if it is closed\n- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually\n- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)\n- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)\n- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)\n\n\n</details>\n",
    "cargo-generate__cargo-generate-693": "Feat: when pointing to a multi-template repo, it should be possible to explicitly specify the default template\nWhen using `cargo-generate` with a multi template repository, `cargo-generate` creates a `choice` prompt for the user to select a \r\ntemplate to expand.\r\n\r\nIt would help on usability if it was possible to influence this prompt.\r\n\r\n1) It should be possible to specify the default selected template.\r\n2) It would be nice if the template author could specify the sorting order, or specify the list of templates manually.\r\n\n",
    "cargo-generate__cargo-generate-511": "abbreviation support for gitlab and bitbucket users\nAt the moment I can point to a github repo like this:\r\n```sh\r\ncargo generate --git rustwasm/wasm-pack-template\r\n\r\n# or even shorter:\r\n\r\ncargo generate rustwasm/wasm-pack-template\r\n```\r\n\r\nIn order to support also gitlab and bitbucket users I'm proposing a prefix that would expand to the full url like this:\r\n```sh\r\n# for github\r\ncargo generate gh:github-handle/repo\r\n\r\n# for gitlab\r\ncargo generate gl:gitlab-handle/repo\r\n\r\n# for bitbucket\r\ncargo generate bb:bitbucket-handle/repo\r\n```\r\n\r\nSo essentially we have the 3 abbreviations:\r\n- Github: `gh`\r\n- GitLab: `gl`\r\n- Bitbucket: `bb`\r\n\r\n#### Note: for compatibility and convenience reasons the `gh:` abbreviation remains optional and GitHub remains the default.\r\n\n",
    "cargo-generate__cargo-generate-474": "feature: in Rhai script, add support for array in variable::set\nThis feature is not an addition to the types of placeholders in general. Instead it aims only to allow the usage of arrays through Rhai scripts. Rhai already has support for arrays and so does Liquid, so the implementation is simple and minimal changes would be required.\r\n\r\nToday there are only two variable types that can be sent from Rhai to Liquid: strings and booleans. With this feature we could also have an array of any of the types. This includes arrays of arrays and arrays with different types at each index. This still shouldn't be a problem since both Rhai and Liquid have support for arrays with dynamic types.\r\n\r\nWith this feature we could write a Rhai script that prompts the user for a comma separated list of dependencies which can then be put into Cargo.toml somewhere else in the template via Liquid.\r\n\r\n```rhai\r\nlet dependencies = variable::prompt(\"Dependencies (comma separated list)\")\r\n    .split(\",\")\r\n    .map(|input| {\r\n        input.trim();\r\n        input\r\n    });\r\n\r\nvariable::set(\"dependencies\", dependencies);\r\n```\n",
    "cargo-generate__cargo-generate-525": "forcing git initialisation by a new flag `--force-git-init`\nIt seems cargo-generate ignores any and all attempts to allow for git initialization when the target directory is already inside an existing git repository.\r\n\r\nI use git for the config files in my home directory and so it seems I can not create any git initialized repositories with cargo-generate anywhere in my home.\n",
    "cargo-generate__cargo-generate-1172": "Don't rename underscores to hyphens in project names\n`cargo-generate` swaps underscores to hyphens in project names:\r\n\r\n```\r\n\ud83e\udd37   Project Name: lock_firmware\r\n\u26a0\ufe0f   Renaming project called `lock_firmware` to `lock-firmware`...\r\n```\r\n\r\nI'm not aware of any requirement that Rust projects use hyphens, so this seems unnecessary and unwelcome.\r\n\r\nIn my opinion it's preferable to use underscores so that the crate name matches the name you use in Rust code. I lost an hour of my life to that paper cut once.\n",
    "cargo-generate__cargo-generate-880": "Cannot install on Rust 1.67\n**Describe the bug**\r\nRunning `cargo install cargo-generate` failed with rustc 1.67.0. Specifically, it fails to build git-ref 0.23.1, which is a dependency of git-config.\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Windows 10\r\n - `rustc --version`: 1.67.0\r\n\r\n**Additional context**\r\nThe bug is probably caused by gitoxide using bstr incorrectly: https://github.com/Byron/gitoxide/issues/747. [A fix](https://github.com/Byron/gitoxide/commit/a3c283ff0e3f21cedb3ba7cd464fdfa0f5133af0) has been publish yesterday, I think we just need to update git-config (or gix-config?) to 0.16.3.\n",
    "cargo-generate__cargo-generate-691": "Add option to overwrite files in existing project\n[The book has the following to say](https://cargo-generate.github.io/cargo-generate/usage.html#generating-into-current-dir) about this:\r\n\r\n> `cargo-generate` will not allow any existing files to be overwritten and will fail to generate any files should there be any conflicts.\r\n\r\nI actually think this would be a good feature to have, although the default choice of refusing to overwrite is good. Perhaps an `--overwrite` flag could be added to generate over the existing project anyway?\r\n\r\nFor an example use case, I have [this template](https://or.computer.surgery/charles/nix-rust-quickstart) that receives relatively frequent updates since Nix Flakes are still evolving. I feel like an `--overwrite` option would make it easier to propagate these changes and new best practices to existing projects generated from this template. Then one could do `cargo gen ... --overwrite && git restore -p .` instead of having to figure out how to apply all of the changes manually.\n",
    "cargo-generate__cargo-generate-680": "feat: let template specify it is designed to NOT go into a sub-folder (aka. the template always has --init behaviour)\nBy specifying \r\n\r\n```toml\r\n[template]\r\ninit = true\r\n```\r\n\r\nin `cargo-generate` of a template (or for a favorite in the global config), the template will always behave as if the user specified `--init` on the command line.\r\n\r\nThis results in a template that will always expand directly into the destination.\r\n\n",
    "cargo-generate__cargo-generate-677": "Feature request: Set default VCS from within templates\nIt would be nice if it was possible to make templates default to a different or no VCS initialisation. In my case this would be useful for a \"minimal\" template meant for messing around inside. Could also be useful for templates which are meant to be a smaller part of a larger vcs repository.\r\n\r\nAs a workaround I tried to delete the initialised vcs repository from rhai, but that doesn't work as rhai scripts run before vcs initalisation.\n",
    "cargo-generate__cargo-generate-671": "feat: support `--tag` in addition to `--branch`\nIt's really difficult right now to expand a specific tagged version of a template.\r\n\r\nWe really should allow to use tagged versions!\n",
    "cargo-generate__cargo-generate-372": "Git SSH URL Support\nThe [Github Docs](https://docs.github.com/en/enterprise-server@3.0/github/getting-started-with-github/about-remote-repositories#about-remote-repositories) specify that a remote repository URL must have one of the following forms\r\n\r\n- https://[hostname]/user/repo.git\r\n- git@[hostname]:user/repo.git\r\n\r\nAs a result, if cargo-generate handles the former, I would expect it to handle the latter.\r\n\r\n```\r\ncameron@chowder ~> cargo generate --version\r\ncargo-generate 0.6.1\r\ncameron@chowder ~> cargo generate --git https://github.com/rustwasm/wasm-pack-template.git --name my-project\r\n\ud83d\udd27   Creating project called `my-project`...\r\n     Running `git fetch --force --update-head-ok 'https://github.com/rustwasm/wasm-pack-template.git' 'refs/heads/master:refs/remotes/origin/master'`\r\n\u2728   Done! New project created /home/cameron/my-project\r\ncameron@chowder ~> cargo generate --git git@github.com/rustwasm/wasm-pack-template.git --name my-project-2\r\n\ud83d\udd27   Creating project called `my-project-2`...\r\nError: \u26d4   Git Error: unexpected http status code: 404; class=Http (34)\r\ncameron@chowder ~ [1]> cargo generate --git ssh://git@github.com/rustwasm/wasm-pack-template.git --name my-project-2\r\n\ud83d\udd27   Creating project called `my-project-2`...\r\nError: \u26d4   Git Error: authentication required but no callback set; class=Ssh (23)\r\n```\r\n\r\nIf this is a features maintainers would like to have, then I would be happy to implement it.\n",
    "rust-lang__cc-rs-1212": "Target strings that end in -none (such as aarch64-unknown-none) should not default to -fPIC\nAccording to the [docs](https://docs.rs/cc/latest/cc/struct.Build.html#method.pic)\n\n> This [pic] option defaults to false for windows-gnu and bare metal targets and to true for all other targets.\n\nThis means the bare metal target `aarch64-unknown-none` should default to false, but the current logic only looks for `-none-`, and not `-none`.\n",
    "rust-lang__cc-rs-1181": "Encoded `CFLAGS` for supporting spaces\nAccording to https://github.com/rust-lang/cc-rs/#external-configuration-via-environment-variables spaces nor escapes for spaces are not supported in e.g. `C(XX)FLAGS`. In [`xbuild`](https://github.com/rust-mobile/xbuild) we [use `CFLAGS` to set a `--sysroot` path](https://github.com/rust-mobile/xbuild/blob/875f933f5908b49436e7176f2c0cfd7f5233ee24/xbuild/src/cargo/mod.rs#L444-L445), and this can occasionally contain spaces on Windows machines (because the toolchain is unpacked to a user folder, and users like to have `Firstname Surname` as username and profile directory).\r\n\r\nA likable solution is new `CARGO_ENCODED_RUSTFLAGS`-like variables, where spaces within individual args are supported by requiring the user to replace space delimiters in between separate arguments with the `\\x1f` ASCII Unit Separator: https://doc.rust-lang.org/cargo/reference/environment-variables.html, to allow more mechanical piecing-together of these variables without messing around with nested quotes or backslash-escapes.\r\n\r\nReferencing https://github.com/rust-mobile/xbuild/issues/124, where this is one of the deciding factors to build our Android compiler support _differently_.\n",
    "rust-lang__cc-rs-1279": "Mechanism for automatically passing flags used by rustc\nWhen cc-rs is running in a build script, it currently does not check which flags were passed to rustc.\n\nThere are some flags which in order to be fully effective need to be passed to both rustc and cc, a good example being AArch64 branch protection - if the Rust code is built with BTI but the C component is not, that will disable BTI for the whole binary.\n\nWould some mechanism for checking which flags were passed to rustc and determining their corresponding cc flags be desirable to have? This could either be in the form of adding them in automatically, a separate function such as `inherit_rustc_flags()` or even just a warning to the user that some flags that should match don't match.\n\nI'm thinking about implementing something along the lines of what I described above, but I wanted to ask for some thoughts from people who work on this crate. Is this desirable in the first place? If so, roughly what direction should I go in with this?\n",
    "rust-lang__cc-rs-227": "Accept Into<Option<&str>> rather than Option<&str> in Config methods\nThere are currently three Config methods that take Option\\<&str\\>. It seems like they are commonly going to be called with Some string.\r\n\r\n```rust\r\ndefine(\"FOO\", Some(\"BAR\"))\r\n```\r\n\r\nInto\\<Option\\<&str\\>\\> could make the calls look neater.\r\n\r\n```rust\r\ndefine(\"FOO\", \"BAR\")\r\ndefine(\"FOO\", None) // uncommon\r\n```\n",
    "rust-lang__cc-rs-167": "musl: hardcoded `-static` causes issues with library objects\nCapturing an issue first reported at https://github.com/briansmith/ring/issues/544\r\n\r\nIt looks like https://github.com/alexcrichton/gcc-rs/commit/f308ef2121a812c07718e15e689cbb1c90778513 introduced an hardcoded `-static` flag for musl-gcc invocation.\r\nThis seems to be introducing linking issues when building objects for native libraries, due to non-relocatable symbols.\n",
    "rust-lang__cc-rs-226": "Rename `Config` type\nThis is not all that descriptive a name, though we're not sure what a better name is. I suggest `Builder`. If nothing better comes up, pick that and we'll bikeshed it on the PR.\r\n\r\ncc @alexcrichton @sfackler @dtolnay @kimundi @burntsushi bikeshedding.\n",
    "rust-lang__cc-rs-991": "1.0.88 breaks the Rust compile-ui tests for arm-android\nWhen trying to update cc-rs to 1.0.88 in the Rust repo, we hit an error with the compile-ui test for arm-android:\r\n<https://github.com/rust-lang/rust/pull/121854#issuecomment-1973518078>\r\n```\r\n2024-03-01T16:42:03.5816834Z ---- [ui] tests/ui/thread-local/tls.rs stdout ----\r\n2024-03-01T16:42:03.5844499Z --- stderr -------------------------------\r\n2024-03-01T16:42:03.5845537Z error: linking with `/android/ndk/toolchains/llvm/prebuilt/linux-x86_64/bin/armv7a-linux-androideabi19-clang` failed: exit status: 1\r\n2024-03-01T16:42:03.5846544Z    |\r\n2024-03-01T16:42:03.5854489Z    = note: LC_ALL=\"C\" PATH=\"/checkout/obj/build/x86_64-unknown-linux-gnu/stage2/lib/rustlib/x86_64-unknown-linux-gnu/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/android/sdk/emulator:/android/sdk/tools:/android/sdk/platform-tools\" VSLANG=\"1033\" \"/android/ndk/toolchains/llvm/prebuilt/linux-x86_64/bin/armv7a-linux-androideabi19-clang\" \"/tmp/rustc0dOpvq/symbols.o\" \"/checkout/obj/build/x86_64-unknown-linux-gnu/test/ui/thread-local/tls/a.tls.ca29c82538305dca-cgu.0.rcgu.o\" \"-Wl,--as-needed\" \"-L\" \"/checkout/obj/build/arm-linux-androideabi/native/rust-test-helpers\" \"-L\" \"/checkout/obj/build/x86_64-unknown-linux-gnu/test/ui/thread-local/tls/auxiliary\" \"-L\" \"/checkout/obj/build/x86_64-unknown-linux-gnu/stage2/lib/rustlib/arm-linux-androideabi/lib\" \"-L\" \"/checkout/obj/build/x86_64-unknown-linux-gnu/stage2/lib/rustlib/arm-linux-androideabi/lib\" \"-Wl,-Bdynamic\" \"-lstd-8e24d49e9c2a7cc4\" \"-Wl,-Bstatic\" \"/checkout/obj/build/x86_64-unknown-linux-gnu/stage2/lib/rustlib/arm-linux-androideabi/lib/libcompiler_builtins-23518b53a80b1f29.rlib\" \"-Wl,-Bdynamic\" \"-ldl\" \"-llog\" \"-lunwind\" \"-ldl\" \"-lm\" \"-lc\" \"-Wl,--eh-frame-hdr\" \"-Wl,-z,noexecstack\" \"-L\" \"/checkout/obj/build/x86_64-unknown-linux-gnu/stage2/lib/rustlib/arm-linux-androideabi/lib\" \"-o\" \"/checkout/obj/build/x86_64-unknown-linux-gnu/test/ui/thread-local/tls/a\" \"-Wl,--gc-sections\" \"-pie\" \"-Wl,-z,relro,-z,now\" \"-Wl,-O1\" \"-Wl,--strip-debug\" \"-nodefaultlibs\" \"-Wl,-rpath,$ORIGIN/../../../../stage2/lib/rustlib/arm-linux-androideabi/lib\" \"-Wl,--enable-new-dtags\" \"-Wl,-z,origin\"\r\n2024-03-01T16:42:03.5862557Z    = note: ld: error: undefined symbol: __atomic_load_4\r\n2024-03-01T16:42:03.5863027Z            >>> referenced by emutls.c\r\n2024-03-01T16:42:03.5864373Z            >>>               45c91108d938afe8-emutls.o:(__emutls_get_address) in archive /checkout/obj/build/x86_64-unknown-linux-gnu/stage2/lib/rustlib/arm-linux-androideabi/lib/libcompiler_builtins-23518b53a80b1f29.rlib\r\n2024-03-01T16:42:03.5865772Z            \r\n2024-03-01T16:42:03.5866209Z            ld: error: undefined symbol: __atomic_store_4\r\n2024-03-01T16:42:03.5866677Z            >>> referenced by emutls.c\r\n2024-03-01T16:42:03.5867943Z            >>>               45c91108d938afe8-emutls.o:(__emutls_get_address) in archive /checkout/obj/build/x86_64-unknown-linux-gnu/stage2/lib/rustlib/arm-linux-androideabi/lib/libcompiler_builtins-23518b53a80b1f29.rlib\r\n2024-03-01T16:42:03.5869403Z            clang-14: error: linker command failed with exit code 1 (use -v to see invocation)\r\n```\r\n\r\nI've narrowed down the failure to <https://github.com/rust-lang/cc-rs/commit/53564e00498156c9be00361c4b039952cbf7ff59>\r\n\r\nUsing 53564e00498156c9be00361c4b039952cbf7ff59 reproduced the issue: <https://github.com/rust-lang/rust/pull/121874#issuecomment-1974171096>\r\nThe previous commit did not have the issue: https://github.com/rust-lang/rust/actions/runs/8145164818/job/22260797425?pr=121874\r\nAnd reverting 53564e00498156c9be00361c4b039952cbf7ff59 from 1.0.88 also did not have the issue: https://github.com/rust-lang/rust/actions/runs/8145164818/job/22260797425?pr=121874\n",
    "rust-lang__cc-rs-914": "Expose function compile to an object file\nCurrently, rustc's bootstrap uses `cc` to generate object file by asking it to generate a `.a` archive, discard the archive, and \"guessing\" where the temporary object files are to use them. Things like [this](https://github.com/rust-lang/rust/blob/c5208518faa423b96e6d1fecaa6428a2fa4eb9d1/src/bootstrap/src/core/build_steps/llvm.rs#L1214). This, however, has been broken since either #684 or #786, as bootstrap does not understand the hashing mechanism used by cc-rs. This prevents upgrading cc in rustc's bootstrap, which is not ideal as `cc` has since included some bugfixes that are necessary to properly handle some situations (such as [this](https://github.com/rust-lang/cc-rs/pull/676)).\r\n\r\nI wonder if cc would accept a PR adding a public `Build::compile_objects()` function that would return a `Vec<Path>` of all the object files?\n",
    "rcoh__angle-grinder-67": "fields after count causes panic\n```sudo lsof -i -P | grep '(LISTEN)' | agrind '* | parse \":* (\" as port | count by port | fields port'```\r\n\r\nleads to a panic. Probably a bug in the pre-aggregate adapter.\n",
    "rcoh__angle-grinder-37": "Support a \"running total\" operator\n(Like `accum`) in SumoLogic. Requested by @tallpsmith\n",
    "rcoh__angle-grinder-75": "Support logfmt input\nhttps://www.brandur.org/logfmt describes the logfmt input, which is supported by a variety of platforms and logging libraries. I'd like to consume them with angle-grinder.\n",
    "starkware-libs__cairo-3132": "feat: compile-time arithmetic for constants\n# Feature Request\r\n\r\n**Describe the Feature Request**\r\n\r\nThe Cairo compiler should be able to calculate the compile-time value of constants, to make it easier to write such constants, e.g.:\r\n```\r\nconst some_value = (256 * 1080) & 0xfaff + 1234; // should become 14336\r\nconst some_power_of_2: felt252 = 2**128 - 1; // should become 340282366920938463463374607431768211455\r\n```\r\n\r\nThe only operator not currently in Cairo is `**`, but I feel an 'integer power' operator is super convenient when doing blockchain development, so it seems like it should be implemented as well.\r\n\r\n**Describe Preferred Solution**\r\n\r\nThe compiler should just compile that arithmetic expression into its proper value.\r\n\r\n**If the feature request is approved, would you be willing to submit a PR?**\r\n_(Help can be provided if you need assistance submitting a PR)_\r\n\r\n- [x] Yes\r\n- [ ] No\r\n\n",
    "starkware-libs__cairo-5683": "bug: weak inference on simple type\n# Bug Report\r\n\r\n**Cairo version:**\r\n\r\nOn commit `8d6b690cb1401e682a0aba7bcda3b40f00482572`.\r\n\r\n**Current behavior:**\r\n\r\nThe inference of very simple types seems to not be supported anymore, at least on `LegacyMap` that we had into the storage. It this expected as `LegacyMap` should be replaced by `Map`?\r\nWe had some cases also where it wasn't storage functions, and we had to insert multiple statements to guide the compiler with types.\r\n\r\nIn the present case, it was on a tuple.\r\n\r\n**Expected behavior:**\r\n\r\nBetter inference, as it seemed to be? Because we observed that on long existing code.\r\n\r\n**Steps to reproduce:**\r\n\r\n```rust\r\n#[starknet::contract]\r\nmod c1 {\r\n    #[starknet::interface]\r\n    trait IMy<T> {\r\n        fn a(self: @T);\r\n    }\r\n\r\n    #[storage]\r\n    struct Storage {\r\n        v1: LegacyMap::<felt252, (u32, u32)>,\r\n    }\r\n\r\n    #[abi(embed_v0)]\r\n    impl My of IMy<ContractState> {\r\n        fn a(self: @ContractState) {\r\n            // This does not work.\r\n            let (one, two) = self.v1.read(0);\r\n\r\n            // This works.\r\n            let a: (u32, u32) = self.v1.read(0);\r\n            let (one, two) = a;\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n**Other information:**\r\nThe error printed:\r\n```\r\nerror: Unexpected type for tuple pattern. \"?3\" is not a tuple.\r\n --> /private/tmp/test.cairo:16:17\r\n            let (one, two) = self.v1.read(0);\r\n                ^********^\r\n```\r\nWe used to be on a different commit before seing this error: `25bef0b1d7d74e6eed560d46894b5d8fb9136dac`.\r\nOn this commit, we don't have inference issues, everything compiles.\n",
    "starkware-libs__cairo-4777": "bug: One of the arguments does not satisfy the requirements of the libfunc.\n# Bug Report\r\n\r\n**Cairo version: 2.3.0-rc0**\r\n\r\n<!-- Please specify commit or tag version. -->\r\n\r\n**Current behavior:**\r\n\r\n```cairo\r\nfn g(ref v: Felt252Vec<u64>, a: usize, b: usize, c: usize, d: usize, x: u64, y: u64) {\r\n    let mut v_a = v[a];\r\n    let mut v_b = v[b];\r\n    let mut v_c = v[c];\r\n    let mut v_d = v[d];\r\n\r\n    v_a = u64_wrapping_add(u64_wrapping_add(v_a, v_b), x);\r\n    v_a = u64_wrapping_add(u64_wrapping_add(v_a, v_b), y);\r\n} \r\n```\r\n\r\nThe above code fails with the following error:\r\n```shell\r\ntesting bugreport ...\r\nError: Failed setting up runner.\r\n\r\nCaused by:\r\n    #42: One of the arguments does not satisfy the requirements of the libfunc.\r\nerror: process did not exit successfully: exit status: 1\r\n```\r\n\r\n**Expected behavior:**\r\n\r\nThe above code should compile and work.\r\n\r\n**Other information:**\r\n\r\nI have seen a similar issue which has been closed at #3863, not sure if my bug is arriving because of the same reason.\n",
    "starkware-libs__cairo-6317": "Implement `//!` comments\nAdd support for `//!` comments that are handled analogously to Rust ones. Follow implementation of `///` comments.\n",
    "starkware-libs__cairo-4909": "bug: code annotated with cfg(test) included in build\n# Bug Report\r\n\r\n**Cairo version:** \r\n\r\n2.5.0 (was fine in 2.2.0)\r\n\r\n**Current behavior:**\r\n\r\nContract that includes implementation annotated with `#[cfg(test)]` doesn't compile.\r\nWorks fine when running `scarb test`\r\n\r\n**Related code:**\r\n\r\nCode example:\r\n\r\n```\r\n#[cfg(test)]\r\n#[starknet::interface]\r\ntrait ITests<TContractState> {\r\n    fn set_value(ref self: TContractState, value: felt252);\r\n}\r\n\r\n\r\n#[starknet::contract]\r\nmod MyContract {\r\n    #[storage]\r\n    struct Storage {\r\n        value: felt252\r\n    }\r\n\r\n    #[cfg(test)]\r\n    #[abi(embed_v0)]\r\n    impl TestsImpl of super::ITests<ContractState> {\r\n        fn set_value(ref self: ContractState, value: felt252) {\r\n            self.value.write(value);\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n`scarb build` output:\r\n\r\n```\r\nerror: Plugin diagnostic: Identifier not found.\r\n --> ...cairo:121:10\r\n    impl TestsImpl of super::ITests<ContractState> {\r\n         ^*******^\r\n\r\n\r\nerror: Identifier not found.\r\n --> ...cairo[contract]:24:20\r\n        use super::TestsImpl;\r\n                   ^*******^\r\n```\r\n\n",
    "starkware-libs__cairo-6649": "LS: Incorrect hovers for path segments\nPath segments in import statements don't have hovers by themselves\n![Image](https://github.com/user-attachments/assets/f0cdd5ff-380b-42f6-b882-1efc7200ed04)\n\nHowever, when they appear in e.g. function call context, they inherit hover of the called function:\n![Image](https://github.com/user-attachments/assets/707e3877-9cbe-4837-84f9-bd4d5e937247)\n\n\n",
    "starkware-libs__cairo-6632": "LS: Incorrect hover when used on member of struct llteral\n![image](https://github.com/user-attachments/assets/1bac8b92-2c3e-4604-836d-89e37dc5bd75)\r\n![image](https://github.com/user-attachments/assets/cafb3270-80ce-46bf-bfcc-968cd4b0851a)\r\n\r\nBut not always\r\n\r\n![image](https://github.com/user-attachments/assets/ddc3e628-b914-4d80-94c6-92c45645ec63)\r\n\n",
    "starkware-libs__cairo-2289": "dev: generics type syntax contains turbofish\n```\r\nfn main() -> Option::<felt> {\r\n    fib(1, 1, 13)\r\n}\r\n\r\n/// Calculates fib...\r\nfn fib(a: felt, b: felt, n: felt) -> Option::<felt> {\r\n    get_gas()?;\r\n    match n {\r\n        0 => Option::<felt>::Some(a),\r\n        _ => fib(b, a + b, n - 1),\r\n    }\r\n}\r\n```\r\n\r\nI hate to bikeshed but the syntax looks weird with turbofish in type signatures. (Turbofish are expected in expressions though so that part\u2019s fine.) Could it be changed to this for consistency with Rust:\r\n\r\n\r\n```\r\nfn main() -> Option<felt> {\r\n    fib(1, 1, 13)\r\n}\r\n\r\n/// Calculates fib...\r\nfn fib(a: felt, b: felt, n: felt) -> Option<felt> {\r\n    get_gas()?;\r\n    match n {\r\n        0 => Option::<felt>::Some(a),\r\n        _ => fib(b, a + b, n - 1),\r\n    }\r\n}\r\n```\r\n\r\nthank you\n",
    "starkware-libs__cairo-3264": "bug: Multiple jumps to arm blocks are not allowed.\n# Bug Report\r\n\r\n**Cairo version:** bcebb2e3\r\n\r\n<!-- Please specify commit or tag version. -->\r\n\r\n**Current behavior:**\r\n\r\nThe compiler panics when trying to compile and run this test:\r\n\r\n```rust\r\n\r\nimpl U256TryIntoU64 of TryInto<u256, u64> {\r\n    #[inline(always)]\r\n    fn try_into(self: u256) -> Option<u64> {\r\n        if (self.high == 0) {\r\n            self.low.try_into()\r\n        } else {\r\n            Option::None(())\r\n        }\r\n    }\r\n}\r\n\r\n#[test]\r\nfn test_u256_tryinto_u64() {\r\n    let a = u256 { low: 64, high: 0 };\r\n    let b: u64 = a.try_into().unwrap();\r\n    assert(b == 64, 'b conv');\r\n}\r\n\r\n```\r\n\r\nThe resulting error is:\r\n\r\n```sh\r\nthread 'main' panicked at 'Multiple jumps to arm blocks are not allowed.', crates/cairo-lang-lowering/src/implicits/mod.rs:148:21\r\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\r\n```\r\n\r\nWhen I remove the `#[inline(always)]` arg, the test passes.\r\n\r\n<!-- Describe how the bug manifests. -->\r\n\r\n**Expected behavior:**\r\n\r\nI expect the compiler to compile the code regardless if the code is marked as inline or not.\n",
    "bincode-org__bincode-261": "Make `i128` support automatic\nTo revisit #236, it would be more convenient for users if `i128` support was enabled automatically on compatible compilers. We [already argued in July](https://github.com/rust-random/rand/pull/571) that this was the best option for Rand.\r\n\r\nThe linked PR shows how this can be achieved without any breakage (except for old nightlies, which are generally not possible to ensure support for anyway).\n",
    "bincode-org__bincode-217": "Set is_human_readable to false\nI have not released this yet but I will in the next few days. https://github.com/serde-rs/serde/pull/1044\r\n\r\n```rust\r\ntrait Serializer {\r\n    /* ... */\r\n\r\n    fn is_human_readable(&self) -> bool { true }\r\n}\r\n\r\ntrait Deserializer<'de> {\r\n    /* ... */\r\n\r\n    fn is_human_readable(&self) -> bool { true }\r\n}\r\n```\r\n\r\nBincode should override these to false to get more compact representation for types like IpAddr and Datetime.\n",
    "bincode-org__bincode-212": "InvalidEncoding representation\nIt looks like this is used for a very limited set of situations. It should be possible to represent them in a nicer way than `{ desc: &'static str, detail: Option<String> }`.\r\n\r\n```rust\r\nInvalidEncoding {\r\n    desc: \"string was not valid utf8\",\r\n    detail: None,\r\n}\r\nInvalidEncoding {\r\n    desc: \"error while decoding utf8 string\",\r\n    detail: Some(format!(\"Deserialize error: {}\", err))\r\n}\r\nInvalidEncoding {\r\n    desc: \"invalid u8 when decoding bool\",\r\n    detail: Some(format!(\"Expected 0 or 1, got {}\", value))\r\n}\r\nInvalidEncoding {\r\n    desc: \"Invalid char encoding\",\r\n    detail: None,\r\n}\r\nInvalidEncoding {\r\n    desc: \"invalid tag when decoding Option\",\r\n    detail: Some(format!(\"Expected 0 or 1, got {}\", value))\r\n}\r\n```\r\n\r\nMaybe something like:\r\n\r\n```rust\r\nInvalidUtf8\r\nalso InvalidUtf8...?\r\nInvalidBool\r\nInvalidChar\r\nInvalidOption\r\n```\r\n\r\nwith the relevant information in each case to build the error message.\n",
    "bincode-org__bincode-475": "CannotBorrowOwnedData on decode_from_slice for some types that implement Serialize/Deserialize - bincode::serde\nThanks for the excellent work on bincode. I'm currently testing a simple memory based cache for a system I'm writing. In various places I'm calling `serde::encode_to_vec` and `serde::decode_from_slice`. I'm running into an error on `decode_from_slice` indicating `CannotBorrowOwnedData`. I briefly looked at the error, but haven't spent much time digging into it yet. \r\n\r\nI can do something simple like the following:\r\n\r\n```rust\r\n#[derive(Serialize, Deserialize)]\r\npub struct MyStruct {\r\n    name: String,\r\n}\r\n\r\n```\r\n\r\nand then \r\n\r\n```rust\r\n  let test = MyStruct {\r\n    name: \"Test Value\".to_owned(),\r\n  };\r\n\r\n  let value = MemCache::set_data::<MyStruct>(&cache_id, &test, 5).await?;\r\n  let model = MemCache::get_data::<MyStruct>(&cache_id).await?;\r\n```\r\n\r\nwhere `set_data`\r\n\r\n```rust\r\n    async fn set_data<T>(key: &Uuid, cache_data: &T, expire_seconds: i64) -> AsyncResult<bool>\r\n    where\r\n        T: Send + Sync + Serialize,\r\n    {\r\n        let config = Configuration::standard();\r\n        let mut guard = MEM_CACHE.write().await;\r\n\r\n        let encoded = bincode::serde::encode_to_vec(&cache_data, config)?;\r\n        let cache_item = CacheItem::new(encoded, expire_seconds)?;\r\n\r\n        guard.cache_items.insert(key.clone(), cache_item);\r\n        Ok(true)\r\n    }\r\n```\r\n\r\nand `get_data`\r\n\r\n```rust\r\nasync fn get_data<T>(key: &Uuid) -> AsyncResult<T>\r\n    where\r\n        T: Send + Sync + DeserializeOwned,\r\n    {\r\n        let config = Configuration::standard();\r\n        let guard = MEM_CACHE.read().await;\r\n        /** simplified example ***/\r\n        let cache_item = match guard.cache_items.get(key).unwrap();\r\n        let (decoded, _len): (T, usize) =\r\n            bincode::serde::decode_from_slice(&cache_item.data[..], config)?;\r\n        Ok(decoded)\r\n    }\r\n````\r\n\r\nhowever, if I provide a struct that has other  types, E.G. \"Uuid and DateTime<Utc>(chrono)\", both of which have Serialize/Deserialize traits implement by their respective crates, I can successfully call `encode_to_vec` but `decode_from_slice` returns the aforementioned error. \r\n\r\nE.G.: \r\n\r\n```rust\r\n#[derive(Serialize, Deserialize)]\r\npub struct CustomerTest {\r\n    pub id: Option<Uuid>,\r\n    pub email_address: Option<String>,\r\n    pub is_active: Option<bool>,\r\n    pub date_stamp: Option<DateTime<Utc>>,\r\n}\r\n```\r\n\r\n```rust\r\n    let test2 = CustomerTest {\r\n        id: Some(Uuid::new_v4()),\r\n        email_address: Some(\"test@test_domain.io\".to_owned()),\r\n        is_active: Some(true),\r\n        date_stamp: Some(Utc::now()),\r\n    };\r\n\r\n    let cache_id = Uuid::new_v4();\r\n    let value = MemCache::set_data::<CustomerTest>(&cache_id, &test2, 5).await?;\r\n    let model = MemCache::get_data::<CustomerTest>(&cache_id).await?;\r\n```\r\n\r\nTesting it further, it appears that removing the `Uuid` type along with the `DateTime<Utc>` type results in a successful call to `decode_from_slice`. Again, it's possible to call `encode_to_vec` with all of the types listed above, but it does not appear to currently be possible to decode without raising the `CannotBorrowOwnedData` error. \r\n\r\nAny advice on this would be welcomed. Thanks again for your efforts on bincode. \n",
    "bincode-org__bincode-470": "recursive struct gives: overflow evaluating the requirement SliceReader: Sized\n```rust\r\nuse std::collections::BTreeMap;\r\n\r\n#[derive(bincode::Decode)]\r\nstruct AllTypes(BTreeMap<u8, AllTypes>);\r\n\r\nfn main() {\r\n    let result: Result<(AllTypes, _), _> = bincode::decode_from_slice(\r\n        &[],\r\n        bincode::config::Configuration::standard().with_limit::<1024>(),\r\n    );\r\n}\r\n```\r\n\r\n```toml\r\n[dependencies]\r\nbincode = \"2.0.0-beta.0\"\r\n```\r\n\r\n```\r\nerror[E0275]: overflow evaluating the requirement `SliceReader: Sized`\r\n  |\r\n  = help: consider increasing the recursion limit by adding a `#![recursion_limit = \"256\"]` attribute to your crate (`scratchhM619rEHl`)\r\n  = note: required because of the requirements on the impl of `Decoder` for `DecoderImpl<SliceReader, Configuration<LittleEndian, Varint, SkipFixedArrayLength, Limit<1024_usize>>>`\r\n  = note: 128 redundant requirements hidden\r\n  = note: required because of the requirements on the impl of `Decoder` for `&mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut &mut DecoderImpl<SliceReader, Configuration<LittleEndian, Varint, SkipFixedArrayLength, Limit<1024_usize>>>`\r\n```\r\n\r\nThis code might be wrong, but is there any way to detect it earlier?\n",
    "bincode-org__bincode-198": "Reject trailing bytes when deserializing from &[u8]\nIn `deserialize_from`, it makes sense to allow deserializing multiple values from the same io::Read. But in `deserialize`, I think trailing data should be an error.\r\n\r\nI would expect this to be an error rather than ignoring `b\"x\"`:\r\n\r\n```rust\r\nextern crate bincode;\r\n\r\nfn main() {\r\n    println!(\"{:?}\", bincode::deserialize::<char>(b\"1x\"));\r\n}\r\n```\n",
    "bincode-org__bincode-434": "Figure out bincode Decode/Encode interop with serde\nCurrently bincode 2 only allows either `Decode/Encode`, or serde's traits. It would be nice to have a way to use serde types while using `Decode/Encode`\r\n\r\nSome ideas:\r\n- Add an `#[serde_interop]` attribute to `bincode_derive`\r\n- Add a `WithSerde<T>` that implements `Decode/Encode`\r\n- Disable the default impl for `Decode/Encode` and replace it with something like:\r\n  - `impl Decode for T where T: Deserialize`\r\n  - `impl Encode for T where T: Serialize`\n",
    "bincode-org__bincode-336": "Regression in 1.3.0: memory allocation of 8391155392347897856 bytes failed\nCan be reproduced by adding the following test to the bottom of src/lib.rs in https://github.com/sharkdp/bat/tree/b09d245dea7e2f45cf461fda978f3256e7162465 and running `cargo update` and `cargo test --lib bincode_repro`. It succeeds with bincode 1.2.1 and aborts with 1.3.0.\r\n\r\n ```rust\r\n#[test]\r\nfn bincode_repro() {\r\n     use syntect::{dumps::from_binary, parsing::SyntaxSet};\r\n     from_binary::<SyntaxSet>(include_bytes!(\"../assets/syntaxes.bin\"));\r\n}\r\n```\r\n\r\n```console\r\nmemory allocation of 8391155392347897856 bytes failederror: test failed, to rerun pass '--lib'\r\n\r\nCaused by:\r\n  process didn't exit successfully: `/git/tmp/bat/target/debug/deps/bat-3446bc567e169f19 repro` (signal: 6, SIGABRT: process abort signal)\r\n```\r\n\r\nI've yanked 1.3.0 for now since it's important to keep old serialized data deserializing across minor versions.\n",
    "ast-grep__ast-grep-1560": "[refactor] unify configuration discovery for different subcommands\nprobably by a new global arg --config\n",
    "ast-grep__ast-grep-1558": "[refactor] unify configuration discovery for different subcommands\nprobably by a new global arg --config\n",
    "ast-grep__ast-grep-1707": "[feature] Combining `--error=unused-suppression` and `--update-all` should remove unused suppressions\n# \u2b50 Suggestion\r\n\r\n<!-- A summary of what you'd like to see added or changed -->\r\nWhen running `ast-grep scan --update-all --error=unused-suppression`, unused suppressions should be automatically removed.\r\n\r\n# \ud83d\udcbb Use Cases\r\n\r\n<!--\r\n  What do you want to use this for?\r\n  What shortcomings exist with current approaches?\r\n  What workarounds are you using in the meantime?\r\n-->\r\nThis makes it easier to enable `--error=unused-suppression` or to automate linting fixes for cases where `--update-all` is used.\r\n\n",
    "ast-grep__ast-grep-1664": "Inconsistent naming: 'line' vs 'row' in ast-grep node's interface and rule\nThere is an inconsistency between the use of `line` and `row` in the ast-grep node's interface and rule parameters. The node uses `line`, while the rule uses `row`, which may lead to confusion. This inconsistency should be addressed.\n\n**References:**\n- PR: https://github.com/ast-grep/ast-grep/pull/1662\n- Comment: https://github.com/ast-grep/ast-grep/pull/1662#discussion_r1885373639\n\nReported by: @HerringtonDarkholme\n",
    "ast-grep__ast-grep-1634": "[bug] ast-grep scan: special characters lead to different end columns\n### Please read the FAQ for the bug you encountered.\n\n- [X] I have read the existing FAQ\n\n### \u23ef Playground Link\n\nhttps://ast-grep.github.io/playground.html#eyJtb2RlIjoiQ29uZmlnIiwibGFuZyI6ImNwcCIsInF1ZXJ5IjoiY29uc29sZS5sb2coJE1BVENIKSIsInJld3JpdGUiOiJsb2dnZXIubG9nKCRNQVRDSCkiLCJzdHJpY3RuZXNzIjoic21hcnQiLCJzZWxlY3RvciI6IiIsImNvbmZpZyI6IiMgWUFNTCBSdWxlIGlzIG1vcmUgcG93ZXJmdWwhXG4jIGh0dHBzOi8vYXN0LWdyZXAuZ2l0aHViLmlvL2d1aWRlL3J1bGUtY29uZmlnLmh0bWwjcnVsZVxucnVsZTpcbiAga2luZDogY29tbWVudFxuICBwYXR0ZXJuOiAkQ09NTUVOVFxuICBhbGw6XG4gICAgLSByZWdleDogXCJUT0RPW146XXxGSVhNRVteOl1cIlxudHJhbnNmb3JtOlxuICBORVdfQ09NTUVOVDpcbiAgICByZXBsYWNlOlxuICAgICAgc291cmNlOiAkQ09NTUVOVFxuICAgICAgcmVwbGFjZTogKD88RklYPlRPRE98RklYTUUpXG4gICAgICBieTogXCIkRklYOlwiXG5maXg6ICRORVdfQ09NTUVOVCIsInNvdXJjZSI6IiAgLy8gIFRPRE8gdGVzdCBzdHVmZi4uLi4uXG4gIC8vICBUT0RPIHRlc3RlIMOcYmVyZ8OkbmdlIn0=\n\n### \ud83d\udcbb Code\n\n_No response_\n\n### \ud83d\ude41 Actual behavior\n\nThe playground example has two comments that are matched. In the playground, you can see that the end column is at 26 for both. When I run the rule with json output I get the following:\r\n```\r\n[\r\n{\r\n  \"text\": \"//  TODO test stuff.....\",\r\n  \"range\": {\r\n    \"byteOffset\": {\r\n      \"start\": 2,\r\n      \"end\": 26\r\n    },\r\n    \"start\": {\r\n      \"line\": 0,\r\n      \"column\": 2\r\n    },\r\n    \"end\": {\r\n      \"line\": 0,\r\n      \"column\": 26\r\n    }\r\n  },\r\n  \"file\": \"comment.cpp\",\r\n  \"lines\": \"  //  TODO test stuff.....\",\r\n  \"charCount\": {\r\n    \"leading\": 2,\r\n    \"trailing\": 0\r\n  },\r\n  \"replacement\": \"//  TODO: test stuff.....\",\r\n  \"replacementOffsets\": {\r\n    \"start\": 2,\r\n    \"end\": 26\r\n  },\r\n  \"language\": \"Cpp\",\r\n  \"metaVariables\": {\r\n    \"single\": {\r\n      \"COMMENT\": {\r\n        \"text\": \"//  TODO test stuff.....\",\r\n        \"range\": {\r\n          \"byteOffset\": {\r\n            \"start\": 2,\r\n            \"end\": 26\r\n          },\r\n          \"start\": {\r\n            \"line\": 0,\r\n            \"column\": 2\r\n          },\r\n          \"end\": {\r\n            \"line\": 0,\r\n            \"column\": 26\r\n          }\r\n        }\r\n      }\r\n    },\r\n    \"multi\": {},\r\n    \"transformed\": {\r\n      \"NEW_COMMENT\": \"//  TODO: test stuff.....\"\r\n    }\r\n  },\r\n  \"ruleId\": \"comment\",\r\n  \"severity\": \"hint\",\r\n  \"note\": null,\r\n  \"message\": \"\"\r\n},\r\n{\r\n  \"text\": \"//  TODO teste \u00dcberg\u00e4nge\",\r\n  \"range\": {\r\n    \"byteOffset\": {\r\n      \"start\": 29,\r\n      \"end\": 55\r\n    },\r\n    \"start\": {\r\n      \"line\": 1,\r\n      \"column\": 2\r\n    },\r\n    \"end\": {\r\n      \"line\": 1,\r\n      \"column\": 28\r\n    }\r\n  },\r\n  \"file\": \"comment.cpp\",\r\n  \"lines\": \"  //  TODO teste \u00dcberg\u00e4nge\",\r\n  \"charCount\": {\r\n    \"leading\": 2,\r\n    \"trailing\": 0\r\n  },\r\n  \"replacement\": \"//  TODO: teste \u00dcberg\u00e4nge\",\r\n  \"replacementOffsets\": {\r\n    \"start\": 29,\r\n    \"end\": 55\r\n  },\r\n  \"language\": \"Cpp\",\r\n  \"metaVariables\": {\r\n    \"single\": {\r\n      \"COMMENT\": {\r\n        \"text\": \"//  TODO teste \u00dcberg\u00e4nge\",\r\n        \"range\": {\r\n          \"byteOffset\": {\r\n            \"start\": 29,\r\n            \"end\": 55\r\n          },\r\n          \"start\": {\r\n            \"line\": 1,\r\n            \"column\": 2\r\n          },\r\n          \"end\": {\r\n            \"line\": 1,\r\n            \"column\": 28\r\n          }\r\n        }\r\n      }\r\n    },\r\n    \"multi\": {},\r\n    \"transformed\": {\r\n      \"NEW_COMMENT\": \"//  TODO: teste \u00dcberg\u00e4nge\"\r\n    }\r\n  },\r\n  \"ruleId\": \"comment\",\r\n  \"severity\": \"hint\",\r\n  \"note\": null,\r\n  \"message\": \"\"\r\n}\r\n]\r\n```\r\n\r\nAlthough both comment matches have the end column 26, ast-grep scan reports end column 28 for the comment with special characters.\n\n### \ud83d\ude42 Expected behavior\n\nAst-grep scan should report the actual end column.\n\n### Additional information about the issue\n\n_No response_\n",
    "ast-grep__ast-grep-1588": "[refactor] have a semi-structured tracing output\nExample\r\n\r\n```\r\nsg: summary|file: scannedCount=199\r\nsg: entity|file|src/cli/scan.rs: skippedCount=47\r\nsg: entity|rule|my-rule-id: finalSeverity=off\r\nsg: entity|rule|my-rule-id: skipReason=ruleFilter\r\nsg: entity|rule|my-rule-id: skipReason=severityOff\r\nsg: detail|file*rule|src/cli/scan.rs,my-ast-grep-rule: hitResult=hitByInclude\r\nsg: detail|file*rule|src/cli/scan.rs,my-ast-grep-rule: hitResult=hitByExclude\r\nsg: detail|file*rule|src/cli/scan.rs,my-ast-grep-rule: hitResult=normalHit\r\n```\r\n\r\n[EBNF](https://en.wikipedia.org/wiki/Extended_Backus%E2%80%93Naur_form) notation, \r\n\r\n```ebnf\r\nOUTPUT := \"sg: \", GRANULARITY,  \"|\", ENTITY_TYPE, ENTITY_IDENTIFIER_LIST , \": \", KEY_VAL_PAIR;\r\nGRANULARITY = \"summary\" | \"entity\" | \"detail\";\r\nENTITY_TYPE = \"file\" | \"rule\" | \"file*rule\";\r\nENTITY_IDENTIFER_LIST = \"\" | ( \"|\", IDENTIFIER { IDENTIFIERS } );\r\nIDENTIFIERS = \",\", IDENTIFIER;\r\nKEY_VAL_PAIR = KEY, \"=\", VAL;\r\n```\r\n\r\nInformal Notation\r\n\r\n```\r\nsg: <GRANULARITY>|<ENTITY_TYPE>|<ENTITY_IDENTIFIERS_SEPARATED_BY_COMMA>: KEY=VAL\r\n```\r\n\n",
    "async-graphql__async-graphql-1346": "Support for `@interfaceObject` and `@key` on interfaces\n## Description of the feature\r\n\r\nAdd support for `@interfaceObject` and `@key` on interfaces that was added to the federation spec in v2.3. \r\n\r\nYou can read more about this [here](https://github.com/apollographql/federation/issues/2277).\r\n\n",
    "async-graphql__async-graphql-1228": "dynamic schema: query interface on union not working\n## Expected Behavior\r\n\r\nwhen we have a union of objects that some of which implements an interface, we should be able to query the union by the interface. In the following example, if the `pet` is queried by the `Named` interface, we expect the `name` field and `__type_name` to be in response when the value is `Dog` or `Cat`\r\n\r\n## Actual Behavior\r\n\r\nquery by the interface is an empty object\r\n\r\n## Steps to Reproduce the Problem\r\n\r\nall code is in [here][code]\r\n\r\nschema:\r\n```gql\r\ninterface Named {\r\n\tname: String!\r\n}\r\ntype Cat implements Named {\r\n\tname: String!\r\n\tlife: Int!\r\n}\r\ntype Dog implements Named {\r\n\tname: String!\r\n\tpower: Int!\r\n}\r\ntype Snake {\r\n\tlength: Int!\r\n}\r\nunion Animal = Dog | Cat | Snake\r\n\r\ntype Query {\r\n\tpet: Animal!\r\n}\r\nschema {\r\n\tquery: Query\r\n}\r\n```\r\nquery:\r\n```graphql\r\nquery {\r\n    dog: pet {\r\n        ... on Dog {\r\n            __dog_typename: __typename\r\n            name\r\n            power\r\n        }\r\n    }\r\n    named: pet {\r\n        ... on Named {\r\n            __named_typename: __typename\r\n            name\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nactual response:\r\n```json\r\n{\r\n  \"dog\": {\r\n    \"__dog_typename\": \"Dog\",\r\n    \"name\": \"dog\",\r\n    \"power\": 100\r\n  },\r\n  \"named\": {}\r\n}\r\n```\r\n\r\nexpected response:\r\n\r\n```json\r\n{\r\n  \"dog\": {\r\n    \"__dog_typename\": \"Dog\",\r\n    \"name\": \"dog\",\r\n    \"power\": 100\r\n  },\r\n  \"named\": {\r\n    \"__named_typename\": \"Dog\",\r\n    \"name\": \"dog\"\r\n  }\r\n}\r\n```\r\n\r\n## Specifications\r\n\r\n- Version: 5.0.5\r\n- Platform:\r\n- Subsystem: \r\n\r\n[code]: https://github.com/smmoosavi/async-graphql-dynamic-extend/blob/4663f78a629cf88703222a81ba1ff99b704aefd7/src/schema/union_with_interface.rs\n",
    "async-graphql__async-graphql-1099": "Ability to change Document Title in GraphiQL v2 and GraphQL Playground\n## Description of the feature\r\nI would like to be able to change the html document title in the GraphiQL v2 and GraphQL Playground responses.\r\n\r\nI would like to implement this myself as part of my [Hacktoberfest](https://hacktoberfest.com) contributions.\r\nCould you add the `hacktoberfest` label to the repository, so it counts as valid contribution as soon as it's merged? Thank you :)\n",
    "async-graphql__async-graphql-1048": "SDL: missing space after input type name before open brace (without annotations)\nOld is expected, new is actual:\r\n\r\n```diff\r\n@@ -175,9 +175,9 @@ type DomainConnection {\r\n        pageInfo: PageInfo!\r\n }\r\n \r\n-input DomainContactInput {\r\n-       domain: String! \r\n-       message: String! \r\n+input DomainContactInput{\r\n+       domain: String!\r\n+       message: String!\r\n }\r\n \r\n type DomainEdge {\r\n```\r\n\r\nI think this is a regression from #1043. cc @dspicher\r\n\r\nPerhaps there should be some tests added to make sure regressions in the SDL output are caught in CI?\n",
    "async-graphql__async-graphql-1043": "4.0.10 adds trailing spaces in schema output\nAfter upgrading to 4.0.10, the schema output changed to include trailing spaces after input type fields. Would be nice to avoid this (and other unnecessary changes to schema output, ideally).\n",
    "async-graphql__async-graphql-741": "Interfaces not being exported via schema in Async GraphQL 3.x\n## Expected Behavior\r\nregistering an interface to properly expose it via the __schema API.\r\n\r\n## Actual Behavior\r\nThe interface is not accessible via the __schema API.\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n1. I have two types that implement an interface\r\n```rust\r\npub struct Question {\r\n    pub video: Video,\r\n}\r\n#[Object]\r\nimpl Question {\r\n    pub async fn id(&self) -> &VideoID {\r\n        &self.video.id\r\n    }\r\n}\r\n\r\npub struct Response {\r\n    pub video: Video,\r\n}\r\n#[Object]\r\nimpl Response {\r\n    pub async fn id(&self) -> &VideoID {\r\n        &self.video.id\r\n    }\r\n}\r\n```\r\n2. I have a union that that uses those 2 types\r\n```rust\r\n#[derive(Union)]\r\npub enum VideoUnion {\r\n    Question(Question),\r\n    Response(Response),\r\n}\r\n```\r\n3. I have an interface registered via register_output_type.\r\n```rust\r\n#[derive(Interface)]\r\n#[graphql(\r\n    name = \"Video\",\r\n    field(name = \"id\", type = \"&VideoID\"),\r\n)]\r\npub enum VideoInterface {\r\n    Question(Question),\r\n    Response(Response),\r\n}\r\n\r\n// later in registering schema\r\nschema.register_output_type::<VideoInterface>()\r\n```\r\n\r\n## Other information\r\n1. the interface types DO get exposed via printing schema.sdl(), so it seems only that portion was perhaps updated with the split of registering output vs input types?\r\n2. Note that all of my queries/endpoints return VideoUnion, Question, or Response and never \"Video\". \r\n3. this same setup works perfectly in 2.11.3\r\n\r\n## Specifications\r\n\r\n- Version: (only tested 3.0.7 and 3.0.11)\r\n- Platform: macOS 10.15 / Rust 1.56\r\n- Subsystem: \r\n\r\n\n",
    "async-graphql__async-graphql-584": "Playground settings can only be &str\n## Expected Behavior\r\n\r\nPlayground settings should be able to accept any JSON type (although maybe not Object or Array?).\r\n\r\n## Actual Behavior\r\n\r\n[`with_setting`](https://docs.rs/async-graphql/2.9.9/async_graphql/http/struct.GraphQLPlaygroundConfig.html#method.with_setting) can only accept a `&str` for the value, so any values passed are serialised into a JSON string. These then stay as a string while being inserted into the playground settings.\r\n\r\n```rust \r\nplayground_source(\r\n      GraphQLPlaygroundConfig::new(\"/admin/api/graphql\")\r\n          .with_setting(\"schema.polling.enable\", \"false\"),\r\n)\r\n```\r\n\r\n![image](https://user-images.githubusercontent.com/74549686/126666290-234f1420-8b05-4f3e-b59b-b133d6a0dc80.png)\r\n\r\n\r\n## Specifications\r\n\r\n- Version: 2.9.9\r\n- Platform: Linux\r\n\r\nI think this could be solved by changing `GraphQLPlaygroundConfig`'s settings Hashmap into `Hashmap<&'str, Value>` and then changing `with_setting` to accept a Value. \r\n\r\nI'd be happy to put a PR together for this, let me know if you think this is viable.\n",
    "async-graphql__async-graphql-574": "Lookahead doesn't allow multiple instances of a subfield\nI've encountered a limitation to `Lookahead` that I think severely limits their usability, particularly when used in public facing APIs. For internal only APIs you can (sometimes) get around this if aware of the limitations, but I feel it'd be inadvisable to use them in their current state as it could cause a lot of unexpected behaviour.\r\n\r\nTake a query with the following field selections:\r\n\r\n```gql\r\nmyQuery {\r\n  a {\r\n    b\r\n  }\r\n\r\n  a {\r\n    c\r\n  }\r\n}\r\n```\r\n\r\nWhile it might seem strange to do this, using fragments can commonly result in this sort of query and can be unavoidable without inlining the fragment content. For example, in React Apollo client it's common for components to have their own fragments. If component `B` needs field `b` and component `C` needs field `c`, for example.\r\n\r\n```gql\r\nmyQuery {\r\n  ...componentB\r\n  ...componentC\r\n}\r\n\r\nfragment componentB on MyQuery {\r\n  a {\r\n    b\r\n  }\r\n}\r\n\r\nfragment componentC on MyQuery {\r\n  a {\r\n    c\r\n  }\r\n}\r\n```\r\n\r\nIn my resolver if I do `&ctx.look_ahead().field(\"a\").field(\"c\")`, it'll indicate that it doesn't exist because `.field(\"a\")` simply takes the first `a { }`. Instead of a single `field: Option<&'a Field>`, I think `Lookahead` really needs to use `field: Vec<&'a Field>`.\r\n\r\nI'd be quite happy to provide a PR to provide this. There might be some performance penalties I'm unaware of though, so let me know if so.\n",
    "async-graphql__async-graphql-562": "[Question] Generics and context\nHello \ud83d\udc4b \r\n\r\nFirst of all thank you for this amazing crate. I'm having issues achieving a particular use case and I'm curious if its at all possible or I'm looking at the problem from the wrong perspective.\r\n\r\nIn my application I have service structs that look like this:\r\n\r\n```rust\r\n#[derive(Clone)]\r\npub struct UserService<T: UserRepository> {\r\n    repo: T,\r\n}\r\n```\r\n\r\nFrom there I can initialize `UserService` with a `PostgresRepo` or a `InMemoryRepo`, which I use in tests.\r\n\r\n**Now I hit a wall when trying to keep this generic while using services through the GraphQL context.**\r\n\r\n```rust\r\n    Schema::build(Query, EmptyMutation, EmptySubscription)\r\n        .data(user_service)\r\n```\r\n\r\nThis works fine, but it's when I want to use these services from resolvers that things get tricky:\r\n\r\n```rust\r\n        let user_service = ctx\r\n            .data::<UserService<CanIKeepThisGeneric?>>()\r\n            .expect(\"Missing user service from context\");\r\n```\r\n\r\nIt seems like at this point I must use a concrete type \u261d\ufe0f I've tried multiple approaches but could not find a way to keep resolvers generic which would allow me to test my schema with mocks. Right now I've opted for `UserService<PgUserRepository>` and plan to test resolvers in full integration tests only. Would there be a way to achieve this?\n",
    "async-graphql__async-graphql-1559": "The custom directive ARGUMENT_DEFINITION is not being output at the appropriate location in SDL\n## Rust Code\r\n\r\n```rust\r\nuse async_graphql::*;\r\n\r\n#[TypeDirective(location = \"ArgumentDefinition\")]\r\nfn testDirective(desc: String) {}\r\n\r\nstruct Query;\r\n\r\n#[Object]\r\nimpl Query {\r\n    async fn add(\r\n        &self,\r\n        #[graphql(directive = testDirective::apply(\"Desc for a\".into()))] a: i32,\r\n        #[graphql(directive = testDirective::apply(\"Desc for b\".into()))] b: i32,\r\n    ) -> i32 {\r\n        a + b\r\n    }\r\n}\r\n\r\nfn main() {\r\n    let schema = Schema::build(Query, EmptyMutation, EmptySubscription).finish();\r\n    std::fs::write(\"./schema.graphql\", schema.sdl()).unwrap();\r\n}\r\n```\r\n\r\n## Expected Behavior\r\n\r\nThe @testDirective is expected to be applied to each of the arguments (a and b)\r\n\r\n```graphql\r\ntype Query {\r\n\tadd(a: Int! @testDirective(desc: \"Desc for a\"), b: Int! @testDirective(desc: \"Desc for b\")): Int!\r\n}\r\n\r\n\r\ndirective @include(if: Boolean!) on FIELD | FRAGMENT_SPREAD | INLINE_FRAGMENT\r\ndirective @skip(if: Boolean!) on FIELD | FRAGMENT_SPREAD | INLINE_FRAGMENT\r\ndirective @testDirective(desc: String!) on ARGUMENT_DEFINITION\r\nschema {\r\n\tquery: Query\r\n}\r\n```\r\n\r\n## Actual Behavior\r\n\r\nActually, the @testDirective gets applied collectively to the last argument (b)\r\n\r\n```graphql\r\ntype Query {\r\n\tadd(a: Int!, b: Int! @testDirective(desc: \"Desc for a\") @testDirective(desc: \"Desc for b\")): Int!\r\n}\r\n\r\n\r\ndirective @include(if: Boolean!) on FIELD | FRAGMENT_SPREAD | INLINE_FRAGMENT\r\ndirective @skip(if: Boolean!) on FIELD | FRAGMENT_SPREAD | INLINE_FRAGMENT\r\ndirective @testDirective(desc: String!) on ARGUMENT_DEFINITION\r\nschema {\r\n\tquery: Query\r\n}\r\n```\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n1. execute \"## Rust Code\".\r\n\r\n## Specifications\r\n\r\n- Version:\r\n  - rust: 1.75.0\r\n  - async-graphql: 7.0.6\r\n- Platform:\r\n  - arm64 (MacOS)\r\n- Subsystem: \n",
    "async-graphql__async-graphql-1524": "Oneof directive not included in introspection result\n## Expected Behavior\r\nI would expect the `@oneof` directive to be included in the result of an introspection query whenever the `#[derive(OneofObject)]` macro is used on a struct.\r\n\r\n## Actual Behavior\r\nThe directive is not listed in the introspection query result:\r\n\r\n![image](https://user-images.githubusercontent.com/35584266/209893068-b9740649-df16-4a74-8690-1fbf8f31b336.png)\r\n\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n1. Clone this minimal example: https://github.com/bvanneerven/introspection-example\r\n2. Run with `cargo run`\r\n3. Go to http://localhost:8001 and open the network tab in the browser developer tools\r\n4. Trigger an introspection query by clicking the 'Re-fetch GraphQL schema' button\r\n5. Verify that the `@oneof` directive is not listed in the response from the server\r\n\r\n## Specifications\r\n\r\n- Version: `{ git = \"https://github.com/async-graphql/async-graphql\" }`\r\n- Platform: WSL (Ubuntu-20.04)\n",
    "async-graphql__async-graphql-1491": "Non nullable variables should allow default values\n## Expected Behavior\r\n\r\nQueries should be able to define non-nullable variables with default variables.  This is currently prevented by the check here:\r\nhttps://github.com/async-graphql/async-graphql/blob/759fb0e594606aecf4a239b00d6f3f8aeb22d885/src/validation/rules/default_values_of_correct_type.rs#L32-L36\r\n\r\nThe formal specification for how variables are processed is described here: https://spec.graphql.org/October2021/#sec-Coercing-Variable-Values\r\n\r\nIn short, in GraphQL `non-nullable` means the value can't be null, but isn't directly related to weather or not the variable must be provided by the user:\r\n\r\nThis leads to some non-intuitive behavior:\r\n* A non-nullable variable with a default value is optional, and will error if the variable is explicitly passed as null\r\n* A nullable varaible with a non-null default value can still be explicitly set to null, overwriting the default value\r\n\r\nThis same logic applies to defaults provided in the schema for arguments (https://spec.graphql.org/October2021/#sec-Coercing-Field-Arguments)\r\n\r\nThe relevant part of the JS reference implementation is here: https://github.com/graphql/graphql-js/blob/main/src/execution/values.ts#L94-L105\r\n\r\nThis checks for a default value BEFORE before checking for non-nullablity, and will only error if the field is both non-nullable and does not provide a default value\r\n\r\n## Actual Behavior\r\n\r\nAny query that defines a default value for a non-nullable variable errors\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n1. Define a schema that has a non-nullable argument\r\n2. Write a query with a non-nullable variable with a default value\r\n3. Execute the query, without providing any variables\r\n\r\n## Specifications\r\n\r\n- Version:\r\n- Platform:\r\n- Subsystem: \n",
    "async-graphql__async-graphql-10": "Support Error Extensions\nHey,\r\nfirst of all, I really enjoy using your library so far. I think it is already very comprehensive. One thing I am missing though is returning extensions for errors as described [here](https://github.com/graphql/graphql-spec/blob/master/spec/Section%207%20--%20Response.md) in the spec. Something like: \r\n```{\r\n  \"errors\": [\r\n    {\r\n      \"message\": \"Name for character with ID 1002 could not be fetched.\",\r\n      \"locations\": [ { \"line\": 6, \"column\": 7 } ],\r\n      \"path\": [ \"hero\", \"heroFriends\", 1, \"name\" ],\r\n      \"extensions\": {\r\n        \"code\": \"CAN_NOT_FETCH_BY_ID\",\r\n        \"timestamp\": \"Fri Feb 9 14:33:09 UTC 2018\"\r\n      }\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\nIn terms of api, I think it would be nice to have a trait with a single method `with_extensions` which you could implement on your errors. Something like: \r\n```\r\n// somewhere in async-graphql\r\npub trait ErrorExtensions {\r\n    fn with_extensions(&self) -> Option<serde_json::Value> {\r\n        None\r\n    }\r\n}\r\n\r\nimpl<T: Into<Error>> ErrorExtensions for T {}\r\n```\r\n```\r\n// somewhere in users code...\r\nimpl ErrorExtensions for MyError {\r\n  fn with_extensions(&self) -> Option<serde_json::Value> {\r\n\r\n    let extensions = serde_json::json!({\r\n       \"code\": self.code.to_string(),\r\n       \"timestamp\": get_current_timestamp()\r\n    });\r\n\r\n    Some(extensions)\r\n  }\r\n}\r\n```\r\n\r\nI am happy to contribute, so if you want any help just let me know.\n",
    "async-graphql__async-graphql-170": "invalid: Variable \"$var\" is not defined\nWhen executing a query in async-graphql, I'm getting a \"Variable ... is not defined\" error when I don't think I should be.\r\n\r\nA query like\r\n\r\n```graphql\r\nquery TestQuery($var: Boolean) {\r\n    test(var: $var) {\r\n        id\r\n    }\r\n}\r\n```\r\n\r\nwith no variables\r\n\r\n```json\r\n{}\r\n```\r\n\r\nwill return errors and no data.\r\n\r\n```json\r\n{\r\n  \"errors\": [\r\n    {\r\n      \"locations\": [\r\n        {\r\n          \"column\": 15,\r\n          \"line\": 2\r\n        }\r\n      ],\r\n      \"message\": \"Variable \\\"$var\\\" is not defined\"\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\nHowever, according to [the GraphQL spec \u00a76.1.2](http://spec.graphql.org/June2018/#sec-Coercing-Variable-Values), at instruction 3.g. it seems like this should be allowed.\r\n\r\nA single example of a service that does allow this is [GitHub's API](https://developer.github.com/v4/explorer/), where\r\n\r\n```graphql\r\nquery MyRepos($isFork:Boolean) { \r\n  viewer {\r\n    repositories(first:10, isFork:$isFork) {\r\n      nodes {\r\n        name\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nwith no variables\r\n\r\n```json\r\n{}\r\n```\r\n\r\nreturns data and no errors.\r\n\r\n---\r\n\r\nThe exact reason I'm running into this is because I have a GraphQL server implemented in Juniper, and I'm converting it to async-graphql. My clients (using Apollo, but I'm not familiar with much more than that) are omitting certain variables at certain times. Juniper seems to allow this but async-graphql is returning errors.\n",
    "dtolnay__async-trait-233": "Do not require Sync on unused shared reference arguments\n```rust\r\nuse async_trait::async_trait;\r\n\r\n#[async_trait]\r\ntrait Generic<T> {\r\n    async fn takes_ref(&self, thing: &T);\r\n}\r\n\r\n#[async_trait]\r\nimpl<T> Generic<T> for () {\r\n    async fn takes_ref(&self, _: &T) {}\r\n}\r\n```\r\n\r\nThis currently fails because it expands to something like:\r\n\r\n```rust\r\nimpl<T> Generic<T> for () {\r\n    fn takes_ref<'life0, 'life1, 'async_trait>(\r\n        &'life0 self,\r\n        __arg1: &'life1 T,\r\n    ) -> Pin<Box<dyn Future<Output = ()> + Send + 'async_trait>>\r\n    where\r\n        'life0: 'async_trait,\r\n        'life1: 'async_trait,\r\n        Self: 'async_trait,\r\n    {\r\n        Box::pin(async move {\r\n            let __self = self;\r\n            let __arg1 = __arg1;\r\n            let _: () = {};\r\n        })\r\n    }\r\n}\r\n```\r\n\r\nin which the anonymous future type captures a local variable of type `&T`, implying a need for `T: Sync` in order to get a `Send` future.\r\n\r\n```console\r\nerror: future cannot be sent between threads safely\r\n  --> src/main.rs:10:38\r\n   |\r\n10 |     async fn takes_ref(&self, _: &T) {}\r\n   |                                      ^^ future created by async block is not `Send`\r\n   |\r\nnote: captured value is not `Send` because `&` references cannot be sent unless their referent is `Sync`\r\n  --> src/main.rs:10:31\r\n   |\r\n8  | #[async_trait]\r\n   | -------------- in this procedural macro expansion\r\n9  | impl<T> Generic<T> for () {\r\n10 |     async fn takes_ref(&self, _: &T) {}\r\n   |                               ^ has type `&T` which is not `Send`, because `T` is not `Sync`\r\n   = note: required for the cast from `[async block@src/main.rs:10:38: 10:40]` to the object type `dyn Future<Output = ()> + Send`\r\n   = note: this error originates in the attribute macro `async_trait` (in Nightly builds, run with -Z macro-backtrace for more info)\r\nhelp: consider restricting type parameter `T`\r\n   |\r\n9  | impl<T: std::marker::Sync> Generic<T> for () {\r\n   |       +++++++++++++++++++\r\n```\r\n\r\nThe following compiles:\r\n\r\n```rust\r\n#[async_trait]\r\nimpl<T: Sync> Generic<T> for () {\r\n    async fn takes_ref(&self, _: &T) {}\r\n}\r\n```\r\n\r\nHowever that `T: Sync` bound should be unnecessary as long as the `&T` argument is unused within the future.\n",
    "dtolnay__async-trait-107": "Translation of lifetimes in Fn trait input parameters\nI think this is a fairly niche and easy to work around case but it's a surprising footgun that might be worth a fix?\r\n\r\n```rust\r\nuse async_trait::async_trait;\r\nuse core::future::Future;\r\n\r\n#[async_trait]\r\npub trait ProcessPool: Send + Sync {\r\n    type ThreadPool;\r\n\r\n    async fn spawn<F, Fut, T>(&self, work: F) -> T\r\n    where\r\n        F: FnOnce(&Self::ThreadPool) -> Fut + Send,\r\n        Fut: Future<Output = T> + 'static;\r\n}\r\n\r\n#[async_trait]\r\nimpl<P: ?Sized> ProcessPool for &P\r\nwhere\r\n    P: ProcessPool,\r\n{\r\n    type ThreadPool = P::ThreadPool;\r\n\r\n    async fn spawn<F, Fut, T>(&self, work: F) -> T\r\n    where\r\n        F: FnOnce(&Self::ThreadPool) -> Fut + Send,\r\n        Fut: Future<Output = T> + 'static,\r\n    {\r\n        (*self).spawn(work).await\r\n    }\r\n}\r\n```\r\n[Playground](https://play.rust-lang.org/?edition=2018&gist=502159c0378036ce4f089079480c43de)\r\n\r\n`Self::ThreadPool` on line 23 is translated to `<&P as ProcessPool>::ThreadPool`. I believe due to how unnamed lifetimes are treated in the call syntax of Fn traits, this is desugared to include a HRTB? This leads to the failure:\r\n\r\n```\r\nexpected a `std::ops::FnOnce<(&<&P as ProcessPool>::ThreadPool,)>` closure, found `F`\r\n```\r\n\r\nThis can be resolved by translating instead to `<&'static P as ProcessPool>::ThreadPool`. I don't know if this breaks other use cases however?\n",
    "dtolnay__async-trait-105": "Problem with declarative macros\nHello there. I have problem with declarative macros. The code is simplified as below:\r\n\r\n```Rust\r\nuse async_trait::async_trait;\r\n\r\n#[async_trait]\r\ntrait T1 {\r\n    async fn id(&self) -> i32;\r\n}\r\n\r\nmacro_rules! impl_t1 {\r\n    ($ty: ty, $id: expr) => {\r\n        #[async_trait]\r\n        impl T1 for $ty {\r\n            async fn id(&self) -> i32 {\r\n                $id\r\n            }\r\n        }\r\n    };\r\n}\r\n\r\nstruct Foo;\r\n\r\nimpl_t1!(Foo, 1);\r\n\r\nfn main() {}\r\n```\r\n\r\nrust compiler generates an error:\r\n\r\n```\r\nerror[E0424]: expected value, found module `self`\r\n  --> src/main.rs:10:9\r\n   |\r\n1  | / use async_trait::async_trait;\r\n2  | |\r\n3  | | #[async_trait]\r\n4  | | trait T1 {\r\n...  |\r\n9  | |     ($ty: ty, $id: expr) => {\r\n10 | |         #[async_trait]\r\n   | |         ^^^^^^^^^^^^^-\r\n   | |_________|____________|\r\n   |           |            this function doesn't have a `self` parameter\r\n   |           `self` value is a keyword only available in methods with a `self` parameter\r\n...\r\n21 |   impl_t1!(Foo, 1);\r\n   |   ----------------- in this macro invocation\r\n   |\r\n   = note: this error originates in an attribute macro (in Nightly builds, run with -Z macro-backtrace for more info)\r\n\r\nerror: aborting due to previous error\r\n\r\nFor more information about this error, try `rustc --explain E0424`.\r\nerror: could not compile `playground`.\r\n\r\nTo learn more, run the command again with --verbose.\r\n```\r\n\n",
    "dtolnay__async-trait-100": "Self keyword inside macro invocations in trait impl\nIssue #73 only revealed part of the problem, and only part of it was fixed.\r\n\r\nSince Merge Request #74 `Self` inside macro invocation works when used in the trait declaration, but the issue persists in the trait impl. See this example:\r\n\r\n```rust\r\nuse async_trait::async_trait;\r\n\r\nstruct Foo;\r\n\r\n#[async_trait]\r\npub trait Example {\r\n    const ASSOCIATED: &'static str;\r\n\r\n    async fn associated(&self) {\r\n        println!(\"Associated:{}\", Self::ASSOCIATED); // <-- This works now\r\n    }\r\n\r\n    async fn associated2(&self);\r\n}\r\n\r\n#[async_trait]\r\nimpl Example for Foo {\r\n    const ASSOCIATED: &'static str = \"foo\";\r\n\r\n    async fn associated2(&self) {\r\n        println!(\"Associated:{}\", Self::ASSOCIATED); // <-- This does not\r\n    }\r\n}\r\n```\r\nCompiler output:\r\n```\r\n   Compiling foo v0.1.0 (/tmp/foo)\r\nerror[E0433]: failed to resolve: use of undeclared type or module `AsyncTrait`\r\n  --> src/lib.rs:21:35\r\n   |\r\n21 |         println!(\"Associated:{}\", Self::ASSOCIATED);\r\n   |                                   ^^^^ use of undeclared type or module `AsyncTrait`\r\n\r\nerror: aborting due to previous error\r\n\r\nFor more information about this error, try `rustc --explain E0433`.\r\nerror: could not compile `foo`.\r\n\r\nTo learn more, run the command again with --verbose.\r\n```\r\n\r\nTested with 0.1.30.\r\n\r\nWorkaround from original issue (`let`-binding) also works.\n",
    "dtolnay__async-trait-90": "Forgetting \"dyn\" before Fn() + Trait causes panic\nIn non-async-trait code, this is currently legal, though it emits a warning that it should have the `dyn` keyword:\r\n\r\n```\r\nimpl<F> Foo for Fn(i8) -> F + Send + Sync\r\n  where F: ... {}\r\n```\r\n\r\nIn async-trait code, this causes a panic:\r\n```\r\n#[async_trait::async_trait]\r\nimpl<F> RequestHandler for Fn(&Request) -> F + Send + Sync\r\n  where F: ... {}\r\n```\r\n\r\n```\r\nerror: custom attribute panicked\r\n  --> src/lib.rs:15:1\r\n   |\r\n15 | #[async_trait::async_trait]\r\n   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n   |\r\n   = help: message: unexpected token\r\n```\r\n\r\n[A full example in the Playground](https://play.rust-lang.org/?version=nightly&mode=debug&edition=2018&gist=9807f69a0c79b48c21cafb6c9b84357f)\r\n\r\nI'm not sure whether the code should be *accepted*, given that the current compiler warns that the `impl` w/o the `dyn` is deprecated, but I figure `async_trait` might want to either accept w/ a similar warning, or at the very least reject with a clearer error message.\r\n\r\n(I mostly stumbled into this; I do not think the `impl` is anything _close_ to what I actually want in my real-world use case. The compiler's insistence on `dyn` is nice though, since it clued me in that I'm barking up the wrong syntactical tree.)\n",
    "dtolnay__async-trait-160": "Failed to resolve `self` in path\nMacro doesn't handle when `self` is used as path.\r\n```rust\r\nuse async_trait::async_trait; // 0.1.48\r\n\r\nfn bar() {}\r\n\r\n#[async_trait]\r\ntrait Foo {\r\n    async fn bar(&self) {\r\n        self::bar()\r\n    }\r\n}\r\n```\r\n```rust\r\nerror[E0433]: failed to resolve: use of undeclared crate or module `__self`\r\n --> src/lib.rs:8:9\r\n  |\r\n8 |         self::bar()\r\n  |         ^^^^ use of undeclared crate or module `__self`\r\n```\r\n[Playground](https://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=9567f3a7c893e1eb8da5256043246c9b)\n",
    "dtolnay__async-trait-150": "Unsize coercion fails if end of method is unreachable\nThe following async trait fails to compile. Notice that the same method body is fine in an ordinary async fn outside of an async trait.\r\n\r\nThis worked prior to #143.\r\n\r\n```rust\r\nuse async_trait::async_trait;\r\n\r\nstruct Thing;\r\ntrait Ret {}\r\nimpl Ret for Thing {}\r\n\r\nasync fn ok() -> &'static dyn Ret {\r\n    return &Thing;\r\n}\r\n\r\n#[async_trait]\r\ntrait Trait {\r\n    async fn fail() -> &'static dyn Ret {\r\n        return &Thing;\r\n    }\r\n}\r\n```\r\n\r\n```console\r\nerror[E0308]: mismatched types\r\n  --> src/main.rs:13:41\r\n   |\r\n13 |       async fn fail() -> &'static dyn Ret {\r\n   |  _________________________________________^\r\n14 | |         return &Thing;\r\n15 | |     }\r\n   | |_____^ expected struct `Thing`, found trait object `dyn Ret`\r\n   |\r\n   = note:   expected type `&Thing`\r\n           found reference `&'static (dyn Ret + 'static)`\r\nnote: return type inferred to be `&Thing` here\r\n  --> src/main.rs:14:16\r\n   |\r\n14 |         return &Thing;\r\n   |                ^^^^^^\r\n\r\nerror[E0271]: type mismatch resolving `<impl Future as Future>::Output == &'static (dyn Ret + 'static)`\r\n  --> src/main.rs:13:41\r\n   |\r\n13 |       async fn fail() -> &'static dyn Ret {\r\n   |  _________________________________________^\r\n14 | |         return &Thing;\r\n15 | |     }\r\n   | |_____^ expected trait object `dyn Ret`, found struct `Thing`\r\n   |\r\n   = note: expected reference `&'static (dyn Ret + 'static)`\r\n              found reference `&Thing`\r\n   = note: required for the cast to the object type `dyn Future<Output = &'static (dyn Ret + 'static)> + Send`\r\n```\n",
    "dtolnay__async-trait-227": "Attributes on impl parameters are not forwarded to body\nHeya, I was implementing a trait function with `#[cfg(..)]` in its parameters, and encountered the following error:\r\n\r\n```rust\r\n// within trait impl\r\nasync fn cfg_param(\r\n    &self,\r\n    #[cfg(not(feature = \"something\"))] param: u8,\r\n    #[cfg(feature = \"something\")] _unused: u8,\r\n    //                            ^^^^^^^\r\n    // cannot find value `_unused` in this scope\r\n) -> u8 {\r\n    #[cfg(not(feature = \"something\"))]\r\n    { param }\r\n    #[cfg(feature = \"something\")]\r\n    { 1 }\r\n}\r\n```\r\n\r\nThe expanded code body shows:\r\n\r\n```rust\r\nlet __self = self;\r\nlet param = param;\r\nlet _unused = _unused;\r\nlet __ret: u8 = { #[cfg(not(feature = \"something\"))] { param } };\r\n#[allow(unreachable_code)] __ret\r\n```\r\n\r\nSince `_unused` is not present in the function signature, the expanded code should likely just omit it.\r\n\r\n#227 forwards the attributes, such that the expanded code returns:\r\n\r\n```rust\r\nlet __self = self;\r\n#[cfg(not(feature = \"something\"))]\r\nlet param = param;\r\nlet __ret: u8 = { #[cfg(not(feature = \"something\"))] { param } };\r\n#[allow(unreachable_code)] __ret\r\n```\r\n\r\nThe `_unused` statement isn't present since it's been removed by the expansion.\n",
    "dtolnay__async-trait-223": "Defaulted method with `self: Arc<Self>` doesn't work\n`Arc` generates a `where Self: Send` bound, but for `Arc` it is not enough - it requires also `T: Sync` to be `Send`.  This make the following code failing to compile:\r\n```rust\r\n#[async_trait]\r\ntrait Trait {\r\n    async fn foo(self: Arc<Self>) {}\r\n}\r\n```\r\nhttps://play.rust-lang.org/?version=stable&mode=debug&edition=2021&gist=add1c3d15459405538a453e3c9a504a6\r\n```\r\nerror: future cannot be sent between threads safely\r\n --> src/lib.rs:7:35\r\n  |\r\n7 |     async fn foo(self: Arc<Self>) {}\r\n  |                                   ^^ future created by async block is not `Send`\r\n  |\r\nnote: captured value is not `Send`\r\n --> src/lib.rs:7:18\r\n  |\r\n7 |     async fn foo(self: Arc<Self>) {}\r\n  |                  ^^^^ has type `Arc<Self>` which is not `Send`\r\n  = note: required for the cast to the object type `dyn Future<Output = ()> + Send`\r\n```\r\n[Adding `Sync` as a supertrait works](https://play.rust-lang.org/?version=stable&mode=debug&edition=2021&gist=0c2bccdc20c8df461d014bd9a25b131e), but ideally the macro should also add a `Self: Sync` bound (even though I don't know how it can identify `Arc` being used), or at least document that.\n",
    "google__autocxx-129": "Nested types don't work\n```c++\r\nclass A {\r\n   class B {\r\n       ...\r\n   };\r\n};\r\n```\r\n\r\nis generated by `bindgen` as\r\n\r\n```rust\r\npub struct A {\r\n   ...\r\n}\r\n\r\npub struct A_B {\r\n   ...\r\n}\r\n```\r\n\r\nThis then gives errors when we refer to `A_B` in generated C++.\n",
    "google__autocxx-74": "Alias all functions and symbols to a single namespace\nRight now, to use autocxx-generated bindings from Rust, you need to refer to:\r\n\r\n* `ffi::cxxbridge::W` for struct W\r\n* `ffi::cxxbridge::X` for struct X\r\n* `ffi::Y` for constant Y\r\n* `ffi::defs::Z` for preprocessor symbol Z\r\n\r\n(I think).\r\n\r\nThis all needs tidying up; at least the first two should be aliased so you can refer to them using just `ffi::W`; `ffi::Z`.\r\n\r\nIt might be that `ffi` also needs to be made changeable in case there are multiple `include_cpp` macros in a file.\n",
    "google__autocxx-185": "Handle typedefs to std types\ne.g.\r\n\r\n```rust\r\npub type t_config_option_key = root::std::string;\r\n```\r\n\r\nin bindgen output.\n",
    "google__autocxx-341": "Identically named static methods in multiple classes don't work\nThanks to @nside for preparing a test case.\r\n\r\nReproduction:\r\n* Fetch this branch: https://github.com/google/autocxx/compare/main...nside:s2\r\n* `cd demo && RUST_LOG=autocxx_engine=info cargo build -vvv`\r\n\r\nErrors include:\r\n\r\n```\r\n cargo:warning=/Users/adriantaylor/Development/autocxx/target/debug/build/autocxx-demo-270e598a22aee01d/out/autocxx-build-dir/cxx/gen1.cxx:4:92: error: use of undeclared identifier 'Empty'\r\n  cargo:warning=std::unique_ptr<R2Rect> Empty_autocxx1_autocxx_wrapper() { return std::make_unique<R2Rect>(Empty()); }\r\n  cargo:warning=                                                                                           ^\r\n  cargo:warning=/Users/adriantaylor/Development/autocxx/target/debug/build/autocxx-demo-270e598a22aee01d/out/autocxx-build-dir/cxx/gen1.cxx:5:124: error: reference to type 'const R2Point' (aka 'const Vector2<double>') could not bind to an lvalue of type 'double'\r\n  cargo:warning=std::unique_ptr<R1Interval> FromPoint_autocxx_wrapper(double arg0) { return std::make_unique<R1Interval>(R2Rect::FromPoint(arg0)); }\r\n  cargo:warning=  \r\n  cargo:warning=/Users/adriantaylor/Development/autocxx/target/debug/build/autocxx-demo-270e598a22aee01d/out/autocxx-build-dir/cxx/gen1.cxx:8:158: error: use of undeclared identifier 'FromPointPair'\r\n  cargo:warning=std::unique_ptr<R2Rect> FromPointPair_autocxx1_autocxx_wrapper(const AutocxxConcrete1& arg0, const AutocxxConcrete1& arg1) { return std::make_unique<R2Rect>(FromPointPair(arg0, arg1)); }\r\n  cargo:warning=                                                                                                                                                             ^\r\n```\n",
    "google__autocxx-306": "Accept defines\n`autocxx-gen` needs to accept `-Dfoo=bar` and `-Dfoo` arguments. `autocxx-build` should do similar.\n",
    "sagiegurari__cargo-make-595": "Let toolchain describe a minimal supported rust version\n### Feature Description\r\n```\r\n[tasks.rustc-version-stable]\r\ntoolchain = \"1.56\" # required because we're using edition 2021\r\n```\r\n\r\nUnfortunately, by the time 1.57 stabilizes, the above will suddenly complain to devs using the latest stable release.\r\n\r\n### Describe The Solution You'd Like\r\n\r\nSupport a version check for the toolchain. Multiple syntaxes come to mind:\r\n```\r\n[tasks.rustc-version-stable]\r\ntoolchain = \">= 1.56\"\r\ntoolchain = \"stable >= 1.56\"\r\ntoolchain = { channel = \"stable\", version = \">= 1.56\" }\r\ntoolchain = { channel = \"stable\", feature = [\"edition_2021\"] } # optional, but most specific and declarative\r\n```\r\n\r\nThe first two could perhaps be a short version of the second.\r\n\r\nThe last is probably too much to ask, but could use names from specific RFCs. Just don't know how to get rustc to tell me which ones are supported, and maintaining that list here is not such a good idea?\r\n\r\n---\r\n\r\n- [x] I am willing to implement this in a PR\r\n\r\nIt seems parsing the output of `rustc --version` is already done in `rust_info`, so perhaps it could be a good idea to reuse that and put it into the public interface there?\r\n\r\nhttps://github.com/sagiegurari/cargo-make/blob/ee4e8b40319532079750d26c7d2415c0c6fbc306/src/lib/toolchain.rs#L60-L68\r\n\r\nwould then parse the output of `--version` additionally to checking succeeding and do the version comparison.\r\n\r\n---\r\n\r\nFor a real world example, consider https://github.com/yewstack/yew/blob/master/packages/yew-macro/Makefile.toml#L1-L5 which sets `toolchain = \"1.51\"`, to enforce support of `const_generics`. Changing this to `toolchain = \">= 1.51\"` would run into less problems.\n",
    "sagiegurari__cargo-make-714": "Cargo make incompatible with Rust 1.64 Workspace Inheritance\n### Describe The Bug\r\nAs of Rust 1.64, a package version can be set using `version.workspace = true`. \r\n\r\ncargo-make expects PackageInfo.version to be an `Option<String>`, and is unable to parse the new map structure.\r\n\r\n\r\nhttps://doc.rust-lang.org/cargo/reference/workspaces.html#the-package-table\r\n\r\n### To Reproduce\r\nUsing Rust 1.64, set \"version.workspace = true\" in a workspace package to trigger the parsing error.\r\n\r\n### Error Stack\r\n\r\n```console\r\n[cargo-make] INFO - cargo make 0.36.0\r\nthread 'main' panicked at 'Unable to parse Cargo.toml, invalid type: map, expected a string for key `package.version` at line 3 column 21', /home/voxelot/.cargo/registry/src/github.com-1ecc6299db9ec823/cargo-make-0.36.0/src/lib/environment/crateinfo.rs:194:27\r\n```\r\n\n",
    "mozilla__cbindgen-401": "Initialize struct literals with list-initializer\nOn cbindgen 0.9.1, Values of bitflags are converted to static const items with designated initializer.\r\n\r\nBut designated initializer is not available in C++11. Sadly, It is available in C++20. https://en.cppreference.com/w/cpp/language/aggregate_initialization#Designated_initializers\r\n\r\nFor C++11, struct literal should be initialized with the list-initializer.\r\n\r\n### rust source\r\n```rust\r\nbitflags! {\r\n    #[repr(C)]\r\n    pub struct ResultFlags: u8 {\r\n        const EMPTY = 0b00000000;\r\n        const PROCESSED = 0b00000001;\r\n        const TIME_UPDATED = 0b00000010;\r\n    }\r\n}\r\n```\r\n\r\n### current generated - compile error on C++11\r\n```cpp\r\nstruct ResultFlags{\r\n  uint8_t bits;\r\n\r\n  explicit operator bool() const {\r\n    return !!bits;\r\n  }\r\n  ResultFlags operator|(const ResultFlags& other) const {\r\n    return {static_cast<decltype(bits)>(this->bits | other.bits)};\r\n  }\r\n  ResultFlags& operator|=(const ResultFlags& other) {\r\n    *this = (*this | other);\r\n    return *this;\r\n  }\r\n  ResultFlags operator&(const ResultFlags& other) const {\r\n    return {static_cast<decltype(bits)>(this->bits & other.bits)};\r\n  }\r\n  ResultFlags& operator&=(const ResultFlags& other) {\r\n    *this = (*this & other);\r\n    return *this;\r\n  }\r\n};\r\n\r\nstatic const ResultFlags ResultFlags_EMPTY = { .bits = 0 };\r\nstatic const ResultFlags ResultFlags_PROCESSED = { .bits = 1 };\r\nstatic const ResultFlags ResultFlags_TIME_UPDATED = { .bits = 2 };\r\n```\r\n\r\n### suggestion - compatible with C++11\r\n```cpp\r\nstruct ResultFlags{\r\n  uint8_t bits;\r\n\r\n  explicit operator bool() const {\r\n    return !!bits;\r\n  }\r\n  ResultFlags operator|(const ResultFlags& other) const {\r\n    return {static_cast<decltype(bits)>(this->bits | other.bits)};\r\n  }\r\n  ResultFlags& operator|=(const ResultFlags& other) {\r\n    *this = (*this | other);\r\n    return *this;\r\n  }\r\n  ResultFlags operator&(const ResultFlags& other) const {\r\n    return {static_cast<decltype(bits)>(this->bits & other.bits)};\r\n  }\r\n  ResultFlags& operator&=(const ResultFlags& other) {\r\n    *this = (*this & other);\r\n    return *this;\r\n  }\r\n};\r\n\r\nstatic const ResultFlags ResultFlags_EMPTY = { 0 };\r\nstatic const ResultFlags ResultFlags_PROCESSED = { 1 };\r\nstatic const ResultFlags ResultFlags_TIME_UPDATED = { 2 };\r\n```\n",
    "mozilla__cbindgen-332": "Plan For Refactor: Ignore Extern Crates Completely\nIn Rust 2018 you're idiomatically supposed to avoid using `extern crate` as much as possible (not always possible). This means cbindgen cannot rely on `extern crate` being present. \r\n\r\nAt the same time, even if `extern crate` is present, that name might be a rename that occured in the Cargo.toml, and so that name still won't show up in the Cargo.lock file (it only contains true package names, and not renames).\r\n\r\n```toml\r\n# true name is wr_malloc_size_of, but extern crates will show malloc_size_of\r\nmalloc_size_of = { version = \"0.0.1\", package = \"wr_malloc_size_of\" }\r\n```\r\n\r\nBoth of these issues point to it being desirable for us to ignore `extern crate`s and to just dig through the Cargo.lock file, which should have everything we need to know about the crate graph already laid out for us.\r\n\r\nA quick peek at the source indicates one potentially serious barrier to adopting this strategy universally, though: cfg collection. Currently, if an `extern crate` or `mod` is adorned with `#[cfg(target_os = \"linux\")]`, we collect up this fact so that every item we emit into the `.h` file is contained within an appropriate `#if`.\r\n\r\nIn Rust 2018, these cfgs would be found in the Cargo.toml (and indeed many 2015 projects already do this in addition to the cfgs on extern crates to avoid downloading dead code):\r\n\r\n```toml\r\n[target.'cfg(target_os = \"macos\")'.dependencies]\r\ncore-foundation = \"0.6\"\r\ncore-graphics = \"0.17.1\"\r\n```\r\n\r\nSadly, we only ever parse the root Cargo.toml, and don't look at Cargo.toml's of children. (or rather: we call `cargo metadata` and parse that, which is just a nicer version of the Cargo.toml).\r\n\r\nSo a plan of action to do this well\u2122\ufe0f would be to change to:\r\n\r\n* Ignore extern crates completely\r\n* Grab the dependency graph directly from the Cargo.lock, and use that to spider deps (bonus, avoids issues with renames or `-` vs `_`).\r\n* Augment the dependency graph with the `metadata.packages.dependencies.target` field of every crate in the dependency graph (optional?)\r\n\r\nProblems:\r\n\r\n* This will break people who are relying on platform cfgs that *only* exist on `externs` -- this is probably an acceptable breaking change, as they should *want* that information to be in their Cargo.toml anyway.\r\n\r\n* There isn't a clear thing to do when there's a diamond in the dependency graph, where each path has different cfgs. This is potentially \"fine\" as it should be pretty rare, and we already blow up for way more plausible failure modes like \"there is a name conflict anywhere in our crate graph because we completely ignore namespacing\". I'm guessing the implementation will just end up using the cfgs of the first path it visits a crate through (probably what happens today).\n",
    "mozilla__cbindgen-293": "Handle bitflags\nIt would be nice to be able to use [`bitflags!`](https://github.com/rust-lang-nursery/bitflags) and have nice output generated. Ideally the output of macro expansion would just naturally work.\r\n\r\nCurrently the output of a `bitflags!` macro is a struct containing an integer, some trait implementations, and an inherent impl that contains the associated constants for each constant from the `bitflags!` macro.\r\n\r\nI believe if we were to parse associated constants and some more trait implementations, the expanded output would work. The associated constants part is a little tricky because the constants are rust structs initializers and not integer literals.\r\n\r\nAlternatively, we could parse the `bitflags!` macro and output some specially crafted output. This may be easier, but I'm not sure yet.\n",
    "mozilla__cbindgen-519": "Exclude parsing of module paths in crate\nHello!  I ran into an issue with cbindgen where I want to expose multiple C interfaces in a single static/dynamic library but want to avoid including one of these interfaces in the generated header file.\r\n\r\nThe reason for this is that our Wasm runtime has a C API but we also want to support the standard Wasm C API which has its own header files with extra information in them.  It'd be somewhat confusing if the generated header file duplicated these definitions as it's missing important logic that's implemented in the standard header file.\r\n\r\nI tried conditionally including the module with the standard definitions with a cargo feature and using the `parse.expand` options but ran into issues, one of which was that it required nightly Rust.  So I tried splitting out the standard definitions into another crate and reexporting them but due to https://github.com/rust-lang/rfcs/issues/2771 this didn't actually work out (I got the linking to work correctly on OSX and Windows but not on Linux).\r\n\r\nDue to the size of this API and the fact that we're using macros to generate many functions, it'd be really nice to not have to manually blacklist each definition.  Ideally there would be a way to tag a module path as excluded from parsing by cbindgen.  Alternatively, a way to pass features for parsing without needing to `cargo expand` it might solve this problem too. \r\n\r\nI'm open to alternatives and at some indeterminate point in the future some of my previous attempts may work, but it seems that this capability could still be useful.\r\n\r\nPlease let me know if this is a feature that you're interested in!\n",
    "mozilla__cbindgen-501": "Manually avoid declaring opaque structs\nMy code uses the following types on the FFI:\r\n```rust\r\nstruct Foo(NonZeroU64);\r\nstruct Bar {\r\n  foo: Option<Foo>,\r\n}\r\n```\r\nWhat I want here really is `foo: u64`.\r\n\r\nWhat `cbindgen` ends up producing is:\r\n```cpp\r\ntypedef struct Option_Foo Option_Foo;\r\n```\r\n\r\nIt looks like this opaque type leaves me no way to redefine the binding in the header, or work around otherwise. Is there anything we could to do make this work?\n",
    "mozilla__cbindgen-494": "Panics with parse_deps=true\nWhen running cbindgen in [this](https://github.com/RazrFalcon/ttf-parser/tree/master/c-api) dir with such config:\r\n\r\n```toml\r\nlanguage = \"C\"\r\ninclude_guard = \"TTFP_H\"\r\nbraces = \"SameLine\"\r\ntab_width = 4\r\ndocumentation_style = \"doxy\"\r\n\r\n[defines]\r\n\"feature = logging\" = \"ENABLE_LOGGING\"\r\n\r\n[fn]\r\nsort_by = \"None\"\r\n\r\n[parse]\r\nparse_deps = true\r\n```\r\n I'm getting:\r\n\r\n`thread 'main' panicked at 'called Option::unwrap() on a None value', /home/razr/.cargo/registry/src/github.com-1ecc6299db9ec823/cbindgen-0.13.1/src/bindgen/parser.rs:687:25`\n",
    "mozilla__cbindgen-489": "Create opaque type for a generic specialization with `RefCell` etc.\nI have:\r\n\r\n```rust\r\nbundle.rs:\r\n\r\npub type Memoizer = RefCell<IntlLangMemoizer>;\r\npub type FluentBundle<R> = bundle::FluentBundleBase<R, Memoizer>;\r\n\r\nffi.rs:\r\n\r\ntype FluentBundleRc = FluentBundle<Rc<FluentResource>>;\r\n\r\n#[no_mangle]\r\npub unsafe extern \"C\" fn fluent_bundle_new(\r\n    locales: &ThinVec<nsCString>,\r\n    use_isolating: bool,\r\n    pseudo_strategy: &nsACString,\r\n) -> *mut FluentBundleRc;\r\n```\r\n\r\ncbindgen generates out of it:\r\n\r\n```cpp\r\nusing Memoizer = RefCell<IntlLangMemoizer>;\r\n\r\ntemplate<typename R>\r\nusing FluentBundle = FluentBundleBase<R, Memoizer>;\r\n```\r\n\r\nwhich results in an error:\r\n\r\n```\r\n error: no template named 'RefCell'\r\n 0:05.42 using Memoizer = RefCell<IntlLangMemoizer>;\r\n```\r\n\r\nIt would be great to have cbindgen generate an opaque type in this case since all uses in C++ use it as opaque.\n",
    "mozilla__cbindgen-563": "panic: Result has 2 params but is being instantiated with 1 values\ncbdingen version: `v0.14.2`\r\n\r\nTo reproduce the error, run `cbindgen --lang c --output test.h test.rs`, with the source of `test.rs` being:\r\n```rust\r\nuse std::fmt;\r\n\r\n// Result<(), T> seems to trip up cbindgen, here T=fmt::Error\r\n// as it was how I ran into it.\r\ntype FmtResult = Result<(), fmt::Error>;\r\n\r\nfn main() {\r\n    println!(\"cbindgen doesn't like Result<(), T>\");\r\n}\r\n```\r\nShould produce the following error+backtrace with `RUST_BACKTRACE=1`:\r\n```\r\nthread 'main' panicked at 'Result has 2 params but is being instantiated with 1 values', /home/sanoj/.local/share/cargo/registry/src/github.com-1ecc6299db9ec823/cbindgen-0.14.2/src/bindgen/ir/opaque.rs:112:9\r\nstack backtrace:\r\n   0: backtrace::backtrace::libunwind::trace\r\n             at /cargo/registry/src/github.com-1ecc6299db9ec823/backtrace-0.3.40/src/backtrace/libunwind.rs:88\r\n   1: backtrace::backtrace::trace_unsynchronized\r\n             at /cargo/registry/src/github.com-1ecc6299db9ec823/backtrace-0.3.40/src/backtrace/mod.rs:66\r\n   2: std::sys_common::backtrace::_print_fmt\r\n             at src/libstd/sys_common/backtrace.rs:84\r\n   3: <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt\r\n             at src/libstd/sys_common/backtrace.rs:61\r\n   4: core::fmt::write\r\n             at src/libcore/fmt/mod.rs:1025\r\n   5: std::io::Write::write_fmt\r\n             at src/libstd/io/mod.rs:1426\r\n   6: std::sys_common::backtrace::_print\r\n             at src/libstd/sys_common/backtrace.rs:65\r\n   7: std::sys_common::backtrace::print\r\n             at src/libstd/sys_common/backtrace.rs:50\r\n   8: std::panicking::default_hook::{{closure}}\r\n             at src/libstd/panicking.rs:193\r\n   9: std::panicking::default_hook\r\n             at src/libstd/panicking.rs:210\r\n  10: std::panicking::rust_panic_with_hook\r\n             at src/libstd/panicking.rs:475\r\n  11: rust_begin_unwind\r\n             at src/libstd/panicking.rs:375\r\n  12: std::panicking::begin_panic_fmt\r\n             at src/libstd/panicking.rs:326\r\n  13: <cbindgen::bindgen::ir::opaque::OpaqueItem as cbindgen::bindgen::ir::item::Item>::instantiate_monomorph\r\n  14: cbindgen::bindgen::ir::ty::Type::add_monomorphs\r\n  15: cbindgen::bindgen::library::Library::generate\r\n  16: cbindgen::bindgen::builder::Builder::generate\r\n  17: cbindgen::main\r\n  18: std::rt::lang_start::{{closure}}\r\n  19: std::rt::lang_start_internal::{{closure}}\r\n             at src/libstd/rt.rs:52\r\n  20: std::panicking::try::do_call\r\n             at src/libstd/panicking.rs:292\r\n  21: __rust_maybe_catch_panic\r\n             at src/libpanic_unwind/lib.rs:78\r\n  22: std::panicking::try\r\n             at src/libstd/panicking.rs:270\r\n  23: std::panic::catch_unwind\r\n             at src/libstd/panic.rs:394\r\n  24: std::rt::lang_start_internal\r\n             at src/libstd/rt.rs:51\r\n  25: main\r\n  26: __libc_start_main\r\n  27: _start\r\n```\r\n\r\nThe error does not occur with `--lang c++`.\r\n\r\nAlso reported here: https://github.com/eqrion/cbindgen/issues/206, but without a snippet to reproduce it.\n",
    "mozilla__cbindgen-556": "Running cbindgen on a u32 bitflag with a 1<<31 entry produces C++ code that doesn't compile\nAssuming you have a setup where `cargo +nightly test` passes everything, apply this patch:\r\n\r\n```\r\ndiff --git a/tests/rust/bitflags.rs b/tests/rust/bitflags.rs\r\nindex 6c3fe4e..017104a 100644\r\n--- a/tests/rust/bitflags.rs\r\n+++ b/tests/rust/bitflags.rs\r\n@@ -13,10 +13,18 @@ bitflags! {\r\n         const START = 1 << 1;\r\n         /// 'end'\r\n         const END = 1 << 2;\r\n         /// 'flex-start'\r\n         const FLEX_START = 1 << 3;\r\n     }\r\n }\r\n \r\n+bitflags! {\r\n+    #[repr(C)]\r\n+    pub struct DebugFlags: u32 {\r\n+        /// Flag with the topmost bit set of the u32\r\n+        const BIGGEST_ALLOWED = 1 << 31;\r\n+    }\r\n+}\r\n+\r\n #[no_mangle]\r\n-pub extern \"C\" fn root(flags: AlignFlags) {}\r\n+pub extern \"C\" fn root(flags: AlignFlags, bigger_flags: DebugFlags) {}\r\n```\r\n\r\nand run the tests. For me there's this failure:\r\n\r\n```\r\nRunning: \"/home/kats/.mozbuild/clang/bin/clang++\" \"-D\" \"DEFINED\" \"-c\" \"/home/kats/zspace/cbindgen/tests/expectations/bitflags.cpp\" \"-o\" \"/home/kats/tmp/cbindgen-test-outputWsIxRN/bitflags.o\" \"-I\" \"/home/kats/zspace/cbindgen/tests\" \"-Wall\" \"-Werror\" \"-Wno-attributes\" \"-std=c++17\" \"-Wno-deprecated\" \"-Wno-unused-const-variable\" \"-Wno-return-type-c-linkage\"\r\nthread 'test_bitflags' panicked at 'Output failed to compile: Output { status: ExitStatus(ExitStatus(256)), stdout: \"\", stderr: \"/home/kats/zspace/cbindgen/tests/expectations/bitflags.cpp:83:80: error: constant expression evaluates to -2147483648 which cannot be narrowed to type \\'uint32_t\\' (aka \\'unsigned int\\') [-Wc++11-narrowing]\\nstatic const DebugFlags DebugFlags_BIGGEST_ALLOWED = DebugFlags{ /* .bits = */ (1 << 31) };\\n                                                                               ^~~~~~~~~\\n/home/kats/zspace/cbindgen/tests/expectations/bitflags.cpp:83:80: note: insert an explicit cast to silence this issue\\nstatic const DebugFlags DebugFlags_BIGGEST_ALLOWED = DebugFlags{ /* .bits = */ (1 << 31) };\\n                                                                               ^~~~~~~~~\\n                                                                               static_cast<uint32_t>( )\\n1 error generated.\\n\" }', tests/tests.rs:118:5\r\n```\n",
    "mozilla__cbindgen-479": "Wrong output for static arrays\n```rust\r\n#[no_mangle]\r\npub static mut MCRT_ERROR_TEXT: [c_char; 128] = [0; 128];\r\n```\r\noutputs this\r\n```c\r\nextern char[128] MCRT_ERROR_TEXT;\r\n```\r\nwhen it should be this:\r\n```c\r\nextern char MCRT_ERROR_TEXT[128];\r\n```\n",
    "mozilla__cbindgen-466": "Keep order of exported functions\nHi,\r\n\r\nIn my project all `extern \"C\" pub fn`'s are declared in a single file / module.\r\nIs it possible to ensure that the order of the generated exported functions in the header keeps same as in the module?\r\n\r\nTo me it seems that the functions are ordered by the functions name. Am I correct about this? Is there a way of changing / workaround this?\n",
    "mozilla__cbindgen-454": "`doc` attribute doesn't behave like rustc does\nInputs\r\n---\r\n\r\n```rust\r\n#[no_mangle]\r\n#[doc = \"a \\n b\"]\r\npub extern \"C\" fn example_a() {}\r\n```\r\n\r\nand\r\n\r\n```rust\r\n#[no_mangle]\r\n#[doc = \"a \\n\\n b\"]\r\npub extern \"C\" fn example_b() {}\r\n```\r\n\r\nRendered rustdoc\r\n---\r\n[rustdoc/the doc attribute](https://doc.rust-lang.org/rustdoc/the-doc-attribute.html)\r\n\r\n![\u5716\u7247](https://user-images.githubusercontent.com/5238484/71337544-22a0d600-2587-11ea-9905-b7483eb65788.png)\r\n\r\n![\u5716\u7247](https://user-images.githubusercontent.com/5238484/71337575-3f3d0e00-2587-11ea-9504-f38aad154490.png)\r\n\r\nActual generated header\r\n---\r\n\r\n```cpp\r\n///a\r\n b\r\nvoid example_a();\r\n```\r\n\r\n```cpp\r\n///a\r\n\r\n b\r\nvoid example_b();\r\n```\r\n\r\nExpected generated header\r\n---\r\n\r\n```cpp\r\n///a b\r\nvoid example_a();\r\n```\r\n\r\n```cpp\r\n///a\r\n///\r\n///b\r\nvoid example_b();\r\n```\r\n\r\nThis happens when I'm trying to generate multi-line comments with macro. Looks like ([code](https://github.com/eqrion/cbindgen/blob/16fe3ec142653277d5405d9a6d25914d925c9c3c/src/bindgen/utilities.rs#L252)) we simply use value in single `doc` attribute directly without any modification (like rustdoc does).\r\n\r\nBTW, I'm happy to help this out :)\n",
    "mozilla__cbindgen-452": "Mark non-pub fields as private in c++ headers\nIf I have the following Rust struct:\r\n\r\n```rust\r\n#[repr(C)]\r\npub struct MyStruct {\r\n    value1: i32,\r\n    pub value2: i32\r\n}\r\n```\r\nIt would be very useful for the generated struct to reflect the field's visibility:\r\n\r\n```c++\r\nstruct MyStruct {\r\nprivate:\r\n    int32_t value1;\r\npublic:\r\n    int32_t value2;\r\n};\r\n```\r\n\r\nMy main motivation for this is to create exported structs where **all fields are private**. An example is a pointer wrapper: If I allocate a pointer for an opaque struct with Box and then return the raw pointer, there's nothing stopping the caller from modifying it before passing it back for destruction. If instead I make a struct to wrap it, and give it private fields, all the caller can do is copy the struct around and pass it back unchanged.\r\n\r\nA change like this would enable APIs that were more type-safe and more in the spirit of Rust.\r\n\r\nAn alternate, lower-tech approach would be an annotation to just unconditionally mark all fields private. I imagine most use-cases will want all-private or all-public fields, so an annotation to set them all private might be a smarter solution, and save field-specific visibility for a use case that needs it.\r\n\r\nWhat do you think? Is there interest in this? If so I'd be happy to tackle it.\n",
    "mozilla__cbindgen-447": "Should respect #[export_name]\nRust supports `#[export_name = \"...\"]` as an alternative to `#[no_mangle]` that allows to customise exported name of various items.\n",
    "axodotdev__cargo-dist-555": "Installer.sh sourcing ~/.cargo/bin in ~/.profile is not always sufficient\nHi folks! Love the project! \r\n\r\nI'm excited to have released my latest Rust project, a passphrase generator called Phraze, with cargo-dist v0.4.2. [Here's the first release that uses cargo-dist](https://github.com/sts10/phraze/releases/tag/v0.3.3). I checked the box for a shell script install otpino, and sure enough I get the pretty \"Install prebuilt binaries via shell script\" one-liner in my release notes for users to paste into their terminals: `curl --proto '=https' --tlsv1.2 -LsSf https://github.com/sts10/phraze/releases/download/v0.3.3/phraze-installer.sh | sh`\r\n\r\nExcited to a make it easier for non-Rust devs to use my Rust tool, I booted up another machine of mine that runs Debian but doesn't have Rust or Cargo installed. (In a sense this is my targeted user for why I choose to use cargo-dist -- if the user has Cargo installed, they can just use cargo to install my program!) \r\n\r\n## Expected behavior \r\n\r\nI had my fingers crossed that, on that machine, I could simply run the `curl` one liner and then, poof, use my passphrase generator. \r\n\r\nSince I didn't have a `~/cargo` directory (or Cargo installed) on this particular machine, I just assumed that the script would install my executable elsewhere, likely somewhere already in this machine's PATH. \r\n\r\nWhen I ran the script, it told me the program had been installed successfully to `~/.cargo/bin`. I was suspicious since, not having Cargo installed on this machine, I knew that directory wasn't in PATH. I did also get some kind of message to `source` something... (I'm really sorry that I can't recreate this right now), but I figured it was just telling me to restart my terminal (a fair request). \r\n\r\nI then expected to be able to run `phraze` and have it work.\r\n\r\n## Observed behavior\r\nI tried running `phraze` but I got a command not found error. Even starting the terminal again, same thing: command not found. \r\n\r\nJust to check, when I ran `echo $PATH`, `~/.cargo/bin` was not in the PATH. \r\n\r\n## Suggestions\r\n\r\nI was hoping that when the installer.sh script would have detected that `~/.cargo/bin` was NOT in the current PATH, the script would (A) install the executable to /usr/local/bin or somewhere already in the PATH; (B) automatically add `~/.cargo/bin` to the user's PATH (maybe writing the end of ~/.bashrc); or (c) Print to screen a very clear message like \"To finish installation of <program name>, run: `echo \"export PATH = \"$HOME/.cargo/bin:$PATH\" >> ~/.bashrc && source ~/.bashrc` or something. (I think the Rust install script does something like option C?) \r\n\r\nTo generalize, I think that if the installer script installs the executable to a directory NOT currently in the PATH, it should, at minimum, print clear, next-step instructions on how to add the directory to the PATH. Otherwise a user may get/feel lost when confronting the \"command not found\" message when they first try to run the program.\r\n\r\nI hope this makes sense -- in a bit of a hurry right now, but I can investigate further tomorrow. \n",
    "axodotdev__cargo-dist-1655": "fix: Make RECEIPT_HOME variable XDG compliant\nThe setting of RECEIPT_HOME using \"${HOME}/.config\" will fail for users who move their config folder elsewhere using XDG_CONFIG_HOME. Both dash and bash (the usual interpreters for /bin/sh) both support parameter substitution.\n",
    "axodotdev__cargo-dist-1586": "PowerShell installer not generated for pc-windows-gnu\nWe've been improving support for `pc-windows-gnu` targets recently, but a major exception: the powershell installers skip all `pc-windows-gnu` builds. We should make sure this gets fixed.\n",
    "axodotdev__cargo-dist-417": "release lifecycle plugins\nThis is the followup and ultimate payoff of #378 \r\n\r\nExpose/upgrade `publish-jobs = [...]` and `upload-jobs = [...]` so that users can refer to their own .yml files that cargo-dist embeds into release.yml and weaves into the dependency graph. This could be used for:\r\n\r\n* Adding custom publish steps (\"[publish to this other package manager](https://github.com/axodotdev/cargo-dist/blob/e01b5e390e3f10cc6ff1812066b64c96e3a8e3ca/.github/workflows/publish-release.yml)\", \"post to social media\", ...)\r\n* Adding (\"[generate a schema file](https://github.com/axodotdev/cargo-dist/blob/e01b5e390e3f10cc6ff1812066b64c96e3a8e3ca/.github/workflows/append-release.yml)\", \"build this other installer\", ...)\r\n* Post-processing artifacts (\"sign my binaries\", \"test the binaries\", ...)\n",
    "axodotdev__cargo-dist-367": "create way to turn off release creation\nhttps://github.com/libsql/sqld/pull/625/commits/1c652b9daece08082485766227994bbdf72349db\r\n\r\n- separate dist plan from release creation\r\n- allow config that doesn't add the create-release job\n",
    "axodotdev__cargo-dist-275": "default to the version specified in `rust-toolchain.toml` when `rust-toolchain-version` not provided\nI use cargo's `rust-toolchain.toml` to pin my rust version to a specific stable release.\r\nThis enforces that developers and CI all run the same version of rust.\r\nIt also allows me to set CI to fail if any rustc or clippy warnings occur without violating the \"not rocket science\" rule.\r\n\r\nI think this should be the standard way to set what rust version to use, with the `rust-toolchain-version` acting as override and automatically setup when the user hasnt created a `rust-toolchain.toml`\r\n\r\nI think the following logic would work:\r\n* If a `rust-toolchain.toml` specifies a `channel` (the toolchain version) then:\r\n   * `cargo dist init` should not set a `rust-toolchain-version`\r\n* If a `rust-toolchain.toml` specifies a `channel` (the toolchain version) and cargo dist's `rust-toolchain-version` is unset then:\r\n   * `cargo dist generate-ci` should not include the `name: Install cargo-dist` section. The `rust-toolchain.toml` will cause rustup to automatically install the specified toolchain the first time `cargo` is invoked in a directory containing `rust-toolchain.toml` or one of its subdirectories)\r\n\r\n\n",
    "axodotdev__cargo-dist-1067": "Supports SHA-3 and BLAKE2 as checksum algorithms\nCurrently, it only supports SHA-2 (SHA-256 and SHA-512), but I think it would be useful to support SHA-3 and BLAKE2 as well.\r\n\r\n- <https://crates.io/crates/blake2>\r\n- <https://crates.io/crates/sha3>\n",
    "axodotdev__cargo-dist-1024": "curl url issues-requested URL returned error: 404\n## Description\r\nThrowing error while installing released application using the mention url in the release not. \r\n``` curl: (22) The requested URL returned error: 404 ``` this is due the extension of `.git` with the url.\r\n\r\ncurrent url `https://github.com/hugobyte/composer.git/releases/download/v0.0.5/composer-cli-aarch64-apple-darwin.tar.xz`\r\n\r\nExpected behaviour:\r\nhttps://github.com/hugobyte/composer/releases/download/v0.0.5/composer-cli-aarch64-apple-darwin.tar.xz\r\n\r\ncargo dist created installer script mentioned url also should changed to expected format\r\n\n",
    "axodotdev__cargo-dist-791": "Allow publishing under bin name instead of package name\nHello!\r\n\r\nWe want to publish our binary on homebrew under the binary name, but it is published under the crate name. Is there a way to do that?\n",
    "axodotdev__cargo-dist-776": "sed error in install script\nI'm using `cargo-dist` in a project, and was testing out the install script and saw an error message.\r\n\r\n```\r\ncurl --proto '=https' --tlsv1.2 -LsSf https://github.com/ethankhall/scope/releases/download/v2024.2.4/dev-scope-installer.sh | sh\r\nsed: 1: \"s,\"CARGO_DIST_BINS\",\"sc ...\": bad flag in substitute command: '\"'\r\n```\r\n\r\nThe install looks to have worked, but I would expect to not see this error message.\r\n\r\n## System Details\r\n\r\n```\r\n\u276f echo $SHELL\r\n/bin/zsh\r\n\u276f zsh --version\r\nzsh 5.9 (x86_64-apple-darwin23.0)\r\n\u276f sh --version\r\nGNU bash, version 3.2.57(1)-release (arm64-apple-darwin23)\r\nCopyright (C) 2007 Free Software Foundation, Inc.\r\n```\n",
    "killercup__cargo-edit-304": "cargo-edit adds semver metadata\nCurrently if one adds `zstd` one ends up with `0.4.24+zstd.1.4.0` as version which causes a warning on compile:\r\n\r\n    warning: version requirement` 0.4.24+zstd.1.4.0` for dependency `zstd`\r\n    includes semver metadata which will be ignored, removing the metadata is\r\n    recommended to avoid confusion\r\n\r\nThe correct version would be just `0.4.24`.\n",
    "killercup__cargo-edit-290": "Add option to add `default-features = false`\nCommonly used when working with no_std.\n",
    "killercup__cargo-edit-289": "`rm` subcommand does not support multiple crates\nWhen adding crates, `add` allows me to add multiple crates at once:\r\n\r\n```\r\ncargo add serde serde_derive\r\n```\r\n\r\nI would expect `rm` to operate in the same fashion:\r\n```\r\ncargo rm serde serde_derive\r\n```\r\nInstead I get `Invalid arguments`, along with a usage statement.\r\n\r\nIf someone can confirm that `rm` should support multiple target crates, I'd love to take a stab at this with a PR sometime this week / weekend.\n",
    "killercup__cargo-edit-558": "dependency in atty is marked as optional while it's required\nIf you try to add a dependency on `cargo-edit` as following\r\n\r\n```\r\ncargo-edit = { version = \"0.8.0\", default-features = false, features = [\"vendored-openssl\", \"vendored-libgit2\"] }\r\n```\r\nit fails to compile:\r\n\r\n```\r\n  --> cargo-edit-0.8.0/src/fetch.rs:96:26\r\n   |\r\n96 |     let colorchoice = if atty::is(atty::Stream::Stdout) {\r\n   |                          ^^^^ use of undeclared crate or module `atty`\r\n\r\nerror[E0433]: failed to resolve: use of undeclared crate or module `atty`\r\n  --> cargo-edit-0.8.0/src/fetch.rs:96:35\r\n   |\r\n96 |     let colorchoice = if atty::is(atty::Stream::Stdout) {\r\n   |                                   ^^^^ use of undeclared crate or module `atty`\r\n\r\n```\r\n\r\nCode is now different but the problem remains. Dependency on `atty` should be changed to required or code in question should return `ColorChoice::Never`.\n",
    "killercup__cargo-edit-545": "feature request: have `--features` flag check available features\n`cargo add` by default already queries `crates.io` for the latest versions which is great. I'm wondering if it's also possible to have it query available feature flags at the same time? This comes from a slight frustration in the following scenario: \r\n```Bash\r\n> cargo add -p common csv --features serde\r\n    Updating 'https://github.com/rust-lang/crates.io-index' index\r\n      Adding csv v1.1.6 to dependencies with features: [\"serde\"]\r\n> cargo build\r\n    the package `common` depends on `csv`, with features: `serde` but `csv` does not have these features.\r\n    It has a required dependency with that name, but only optional dependencies can be used as features.\r\n```\r\n\r\nThis is a frequent occurrence since a lot of crates have common features like `serde` or `derive` but they're often used interchangeably so it can be frustrating to try and find out which one it is. I personally use `cargo add` all the time with this, and it would be a really nice quality of life feature to have `cargo add` check for this. Would this be possible? In any case, thanks for all the great work! \n",
    "killercup__cargo-edit-527": "User messages should be printed to stderr\nCargo seems to print programamtic messages to stdout and user messages to stderr.  This came up in #524.  We should do similar.\n",
    "killercup__cargo-edit-734": "cargo upgrade should default to --skip-compatible\nFor library crates, updating all dependency requirements in `Cargo.toml` to the latest semver-compatible versions is harmful to the ecosystem, as this makes it harder to resolve versions in case of for example yanking. I was already using `--skip-compatible` for my project, but just noticed that [another library crate](https://github.com/mattsse/chromiumoxide/pull/79) used `cargo upgrade` to force dependency upgrades this way, making it impossible to use the latest version of that crate after the latest futures version was [yanked](https://github.com/rust-lang/futures-rs/issues/2529).\n",
    "killercup__cargo-edit-732": "`cargo upgrade --manifest-path` only works with absolute paths\nWe try to find the path in the `CargoMetadata` but it won't match.\r\n\r\n`cargo-set-version` should have the needed logic for this.  I guess an alternative to `dunce::canonicalize` is `same_file`.\r\n\r\nWhen fixing this, we should copy `tests/cmd/upgrade/workspace_member_cwd.*` into a `_manifest_path` test that specifies the manifest path instead of relying on cwd.\n",
    "killercup__cargo-edit-390": "Feature request: \"cargo add -p\" in a workspace\n`cargo add` doesn't work on a workspace:\r\n\r\n> cargo add tokio\r\n>       Adding tokio v0.1.7 to dependencies\r\n> Command failed due to unhandled error: Found virtual manifest, but this command requires running against an actual package in this workspace.\r\n\r\nThis works:\r\n\r\n`cargo add tokio --manifest-path crate_name/Cargo.toml`\r\n\r\nIt's also possible to `cd` into the inner crate directory and use `cargo add` in it.\r\n\r\nHowever, the following command would be more ergonomic and consistent with cargo:\r\n\r\n`cargo add tokio -p crate_name`\r\n\r\nThe same applies to `rm` and `upgrade` commands as well.\n",
    "killercup__cargo-edit-342": "cargo edit should respect `package` flag on dependencies\nWith Rust 2018 and the ability to omit `extern crate` Cargo [gained](https://github.com/rust-lang/cargo/issues/5653) the ability to rename crates in the `Cargo.toml` file.\r\n\r\nFor a dependency like `bar = { package = \"foo\", version = \"0.1\" }`, `cargo upgrade` should look for possible upgrades to the `foo` crate.\r\n\r\nThanks to @Amanieu for making me aware of this!\n",
    "killercup__cargo-edit-572": "Git Dependency Specify Commit Hash\nI don't see a way to specify the commit hash (`rev` field) of Git deps. While setting it manually definitely gets the job done, it's a bit tedious, and it would be nice if there was to be another argument (like `--branch`) to set the `rev`.\n",
    "tokio-rs__bytes-100": "Debug assertion fails when splitting a Bytes created with from_static\n```rust\r\nextern crate bytes;\r\n\r\nuse bytes::Bytes;\r\n\r\nfn main() {\r\n    let mut a = Bytes::from_static(b\"ab\");\r\n    let b = a.split_off(1);\r\n    println!(\"{:?}, {:?}\", a, b);\r\n}\r\n```\r\n\r\nIn a debug build, this code results in the following:\r\n\r\n```text\r\nthread 'main' panicked at 'assertion failed: self.is_shared()', /Users/foo/.cargo/registry/src/github.com-1ecc6299db9ec823/bytes-0.4.1/src/bytes.rs:1510\r\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\r\nstack backtrace:\r\n   0: bytes::bytes::Inner::set_start\r\n   1: bytes::bytes::Inner::split_off\r\n   2: bytes::bytes::Bytes::split_off\r\n   3: bytes_test::main\r\n```\r\n\r\nA release build works fine:\r\n\r\n```text\r\n[97], [98]\r\n```\n",
    "tokio-rs__bytes-316": "BytesMut should implicitly grow the internal storage in its `BufMut` implementation.\nThis will bring the implementation in line with that of `Vec`. This is a breaking change.\r\n\r\nRelates to #131, #77.\n",
    "tokio-rs__bytes-286": "Change From<&'a [u8]> to an explicit function\nMost of the `From` conversions to `Bytes` are shallow copies, just grabbing a pointer and pulling it in. There is also the `from_static` function to save copying a static set of bytes. However, the `From<&'a [u8]>` impl will copy the slice into a new buffer (either inline or a new heap allocation, depending on size). \r\n\r\nUnfortunately, that `&'a [u8]` means it applies to `&'static [u8]` as well. In cases where one is generic over `Into<Bytes>`, a user can easily and accidentally cause copies of static slices, instead of remembering to call `Bytes::from_static`. This issue proposes to change the defaults, so that **the faster way is easier**.\r\n\r\n- Remove `From<&'a [u8]>` for `Bytes`/`BytesMut`.\r\n- Add `From<&'static [u8]>` for `Bytes`/`BytesMut`.\r\n- Add a new constructor that can take `&'a [u8]`, that explicitly shows a copy will happen.\r\n\r\nThe name of this new method could be a few things, these just some examples that occurred to me:\r\n\r\n- `Bytes::copy(slice)`\r\n- `Bytes::copy_from(slice)`\n",
    "tokio-rs__bytes-376": "BytesMut::freeze ignores advance\nHi,\r\nI created a `BytesBuf` with some data and removed the leading n bytes with `advance(n)`. After some more computations I converted the result to an immutable `Bytes` value. My expectation was that the content of the `BytesMut` and `Bytes` would be identical. Instead the `Bytes` still contained the discared bytes.\r\n\r\nExample program:\r\n\r\n```rust\r\nuse bytes::{BytesMut, Buf, BufMut};\r\n\r\nfn main() {\r\n    let mut x = BytesMut::new();\r\n    x.put(&b\"hello\"[..]);\r\n    \r\n    \r\n    let mut y = BytesMut::new();\r\n    y.put(&b\"hello\"[..]);\r\n    y.advance(2);\r\n\r\n    println!(\"{:?} {:?}\", x, y); // b\"hello\" b\"llo\"\r\n    assert_ne!(x, y);\r\n    assert_ne!(&x[..], &y[..]);\r\n    \r\n    let x1 = x.freeze();\r\n    let y1 = y.freeze();\r\n    \r\n    println!(\"{:?} {:?}\", x1, y1); // b\"hello\" b\"hello\"\r\n    // expected: b\"hello\" b\"llo\"\r\n    assert_eq!(x1, y1);\r\n    assert_eq!(&x1[..], &y1[..]);\r\n}\r\n```\r\n\r\n<https://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=ffaabad67256d03d04f6478d60b93381>\r\n\r\nAs a work-around I use `split_to` instead of `advance` and ignore the return value.\nBytesMut::freeze ignores advance\nHi,\r\nI created a `BytesBuf` with some data and removed the leading n bytes with `advance(n)`. After some more computations I converted the result to an immutable `Bytes` value. My expectation was that the content of the `BytesMut` and `Bytes` would be identical. Instead the `Bytes` still contained the discared bytes.\r\n\r\nExample program:\r\n\r\n```rust\r\nuse bytes::{BytesMut, Buf, BufMut};\r\n\r\nfn main() {\r\n    let mut x = BytesMut::new();\r\n    x.put(&b\"hello\"[..]);\r\n    \r\n    \r\n    let mut y = BytesMut::new();\r\n    y.put(&b\"hello\"[..]);\r\n    y.advance(2);\r\n\r\n    println!(\"{:?} {:?}\", x, y); // b\"hello\" b\"llo\"\r\n    assert_ne!(x, y);\r\n    assert_ne!(&x[..], &y[..]);\r\n    \r\n    let x1 = x.freeze();\r\n    let y1 = y.freeze();\r\n    \r\n    println!(\"{:?} {:?}\", x1, y1); // b\"hello\" b\"hello\"\r\n    // expected: b\"hello\" b\"llo\"\r\n    assert_eq!(x1, y1);\r\n    assert_eq!(&x1[..], &y1[..]);\r\n}\r\n```\r\n\r\n<https://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=ffaabad67256d03d04f6478d60b93381>\r\n\r\nAs a work-around I use `split_to` instead of `advance` and ignore the return value.\n",
    "tokio-rs__bytes-361": "Bytes may recreate Vec incorrectly on drop\nThis example:\r\n\r\n```\r\ndiff --git a/examples/rrr.rs b/examples/rrr.rs\r\nindex e69de29..60374de 100644\r\n--- a/examples/rrr.rs\r\n+++ b/examples/rrr.rs\r\n@@ -0,0 +1,7 @@\r\n+use bytes::Bytes;\r\n+\r\n+fn main() {\r\n+    let mut bytes = Bytes::from(vec![10, 20, 30]);\r\n+    bytes.truncate(2);\r\n+    drop(bytes);\r\n+}\r\ndiff --git a/src/bytes.rs b/src/bytes.rs\r\nindex 93ab84b..6af5148 100644\r\n--- a/src/bytes.rs\r\n+++ b/src/bytes.rs\r\n@@ -767,6 +767,7 @@ impl From<Vec<u8>> for Bytes {\r\n         let slice = vec.into_boxed_slice();\r\n         let len = slice.len();\r\n         let ptr = slice.as_ptr();\r\n+        println!(\"dismantling a vec of cap {}\", len);\r\n         drop(Box::into_raw(slice));\r\n \r\n         if ptr as usize & 0x1 == 0 {\r\n@@ -886,6 +887,7 @@ unsafe fn promotable_odd_drop(data: &mut AtomicPtr<()>, ptr: *const u8, len: usi\r\n \r\n unsafe fn rebuild_vec(buf: *mut u8, offset: *const u8, len: usize) -> Vec<u8> {\r\n     let cap = (offset as usize - buf as usize) + len;\r\n+    println!(\"rebuilding vec with cap {}\", cap);\r\n     Vec::from_raw_parts(buf, cap, cap)\r\n }\r\n \r\ndiff --git a/src/lib.rs b/src/lib.rs\r\nindex 2df1fb3..5d9355b 100644\r\n--- a/src/lib.rs\r\n+++ b/src/lib.rs\r\n@@ -1,6 +1,5 @@\r\n #![deny(warnings, missing_docs, missing_debug_implementations, rust_2018_idioms)]\r\n #![doc(html_root_url = \"https://docs.rs/bytes/0.5.3\")]\r\n-#![no_std]\r\n \r\n //! Provides abstractions for working with bytes.\r\n //!\r\n```\r\n\r\n```\r\n% cargo run --example rrr\r\n    Finished dev [unoptimized + debuginfo] target(s) in 0.01s\r\n     Running `target/debug/examples/rrr`\r\ndismantled a vec of cap 3\r\nrebuilding vec with cap 2\r\n```\r\n\r\nSo we are allocating 3 * 4 bytes, but when calling deallocation we are passing hint parameter 2 * 4 which causes deallocation by `RawVec` which calls `GlobalAlloc.dealloc` which violates the spec: (\"layout must be the same layout that was used to allocate that block of memory\").\r\n\r\nI suspect it may crash deallocation or cause memory leaks, although I could not reproduce either.\r\n\r\nI tried this program:\r\n\r\n```\r\n#[global_allocator]\r\nstatic ALLOC: jemallocator::Jemalloc = jemallocator::Jemalloc;\r\n\r\nuse bytes::Bytes;\r\n\r\nfn main() {\r\n    loop {\r\n        let mut bytes = Bytes::from(vec![10; 100000000]);\r\n        bytes.truncate(1);\r\n        drop(bytes);\r\n    }\r\n}\r\n```\r\n\r\nAfter a few seconds of run, macOS Activity Monitor shows 100Gb of memory usage by this program which is a sign that something doesn't work as expected.\n",
    "tokio-rs__bytes-346": "Bytes assumes that Vec<u8>'s allocation is more than 1 byte aligned\nIt uses the low bit of the pointer to distinguish between KIND_VEC and KIND_ARC.\r\n\r\nFolded over from #340 \n",
    "tokio-rs__bytes-265": "Add RangeArgument trait and use it for slice\nA trait that mirrors [std::RangeArgument](https://doc.rust-lang.org/nightly/std/collections/range/trait.RangeArgument.html) can be introduced to avoid having to have `split_to`, `split_from`, `split` functions.\n",
    "tokio-rs__bytes-710": "Consider replacing Bytes::make_mut by impl From<Bytes> for BytesMut\n`Bytes::make_mut` is a very good addition to the API but I think it would be better if it was instead exposed as `<BytesMut as From<Bytes>>::from`. Could this be done before the next bytes version is released? `Bytes::make_mut` isn't released yet.\n",
    "tokio-rs__bytes-686": "Contradictory allocation behaviour compared to documentation\nI hope I'm not just hopelessly confused, but I fail to see what kind of guarantees are made around allocations and using the APIs. For example, https://docs.rs/bytes/latest/bytes/buf/trait.BufMut.html#method.put_slice says that `self must have enough remaining capacity to contain all of src.` but the implementation will happily extend the buffer of a `BytesMut` beyond what's reported from a call to `capacity()`. Similarly, the documentation of `BufMut::put_bytes()` explicitly mentions a panic will happen if there is not enough capacity, yet the implementation again does not panic and instead allocates more memory - similarly for the other put* functions.\r\n\r\nSome functions, like `BytesMut::extend_from_slice()`, explicitly call out this re-allocation behaviour - but what then is the point of that function, if it does the same as `put_slice()`?\n",
    "tokio-rs__bytes-450": "Consider renaming `Buf::bytes()` and `BufMut::bytes_mut()`\nThese two functions are named in a way that implies they return the *entire* set of bytes represented by the `Buf`/`BufMut`.\r\n\r\nSome options:\r\n\r\n* `window()` / `window_mut()`\r\n* `chunk()` / `chunk_mut()`.\r\n* `fragment()` / `fragment_mut()`\n",
    "tokio-rs__bytes-432": "Maybe `BufMut` trait should be `unsafe`?\nI was thinking that it's likely that some `unsafe` code will rely on properties of `BufMut`. More specifically:\r\n\r\n* That `remaining_mut` returns correct value\r\n* `bytes_mut` always returns the same slice (apart from `advance()`)\r\n* `has_remaining_mut` returns correct value\r\n* `bytes_vectored` fills the correct data\r\n\r\nThus, I'd suggest making the trait `unsafe` to specify that `unsafe` code might rely on those properties and the implementors must ensure they hold.\n",
    "tokio-rs__bytes-413": "BytesMut fails to reuse buffer in trivial case where all data has been consumed\nThe following test fails with bytes 0.5.5:\r\n\r\n```rust\r\n    #[test]\r\n    fn bytes_mut_reuse() {\r\n        use bytes::{BytesMut, Buf};\r\n        let mut buf = BytesMut::new();\r\n        buf.reserve(8192);\r\n        buf.extend_from_slice(&[0u8;100][..]);\r\n        \r\n        let p = &buf[0] as *const u8;\r\n        buf.advance(100);\r\n\r\n        buf.reserve(8192);\r\n        buf.extend_from_slice(b\" \");\r\n\r\n        assert_eq!(&buf[0] as *const u8, p);\r\n    }\r\n```\r\n\r\nI would expect this test to pass, as we should be able to reuse the entire buffer given that there is only one reference, and that since we've consumed the entire buffer there should be no data to copy.\r\n\r\nThe issue appears to come from this condition here:\r\n\r\nhttps://github.com/tokio-rs/bytes/blob/master/src/bytes_mut.rs#L562-L564\r\n\r\nHere, `additional` refers to the value passed to reserve - this is the amount of data above the current length, but here we require that the current offset be beyond that, for some reason - perhaps this is meant to be checking against `additional - capacity`? Additionally, this does not take into account the amount of data that we need to copy - if `self.len() == 0` then the copy is free and we should always take this option.\n",
    "tokio-rs__bytes-377": "advance_mut implementation of BufMut for Vec<u8> seems inconsistent with documentation\nThe documentation of `BufMut::advance_mut` states the following about panics:\r\n\r\n> # Panics\r\n>\r\n> This function **may** panic if `cnt > self.remaining_mut()`.\r\n>\r\n> # Implementer notes\r\n>\r\n> It is recommended for implementations of `advance_mut` to panic if\r\n> `cnt > self.remaining_mut()`. If the implementation does not panic,\r\n> the call must behave as if `cnt == self.remaining_mut()`.\r\n>\r\n> A call with `cnt == 0` should never panic and be a no-op.\r\n\r\nCurrently, the impl for `Vec<u8>` will [reserve to accommodate the advance](https://github.com/tokio-rs/bytes/blob/master/src/buf/buf_mut.rs#L996). This seems to be in conflict with `If the implementation does not panic, the call must behave as if cnt == self.remaining_mut().`\nadvance_mut implementation of BufMut for Vec<u8> seems inconsistent with documentation\nThe documentation of `BufMut::advance_mut` states the following about panics:\r\n\r\n> # Panics\r\n>\r\n> This function **may** panic if `cnt > self.remaining_mut()`.\r\n>\r\n> # Implementer notes\r\n>\r\n> It is recommended for implementations of `advance_mut` to panic if\r\n> `cnt > self.remaining_mut()`. If the implementation does not panic,\r\n> the call must behave as if `cnt == self.remaining_mut()`.\r\n>\r\n> A call with `cnt == 0` should never panic and be a no-op.\r\n\r\nCurrently, the impl for `Vec<u8>` will [reserve to accommodate the advance](https://github.com/tokio-rs/bytes/blob/master/src/buf/buf_mut.rs#L996). This seems to be in conflict with `If the implementation does not panic, the call must behave as if cnt == self.remaining_mut().`\n",
    "tokio-rs__bytes-253": "BytesMut::split_to doesn't panic as it should\nThe method's documentation says \"Panics if `at > len`\". But this test fails (the code doesn't panic):\r\n```\r\n#[test]\r\n#[should_panic]\r\nfn test_split_to() {\r\n    let mut buf = BytesMut::from(&b\"hello world\"[..]);\r\n    let len = buf.len();\r\n    let x = buf.split_to(len + 1);\r\n}\r\n```\r\nUnlike `Bytes::split_to`, `BytesMut::split_to` doesn't have an assert that enforces `at <= len`. There is even a test (`split_to_uninitialized`) that checks for the lack of the assert.\r\n\r\nIs this a documentation issue or should the implementation (and tests) be fixed? Why are `Bytes` and `BytesMut` inconsistent?\r\n\n",
    "tokio-rs__bytes-197": "BytesMut memory usage grows without bound\nI'm working on a high-throughput network service with Tokio, and I'm running into an issue where the memory used by a `BytesMut` grows without bound as more and more messages are processed. After some debugging, I was able to come up with this minimal example:\r\n\r\n    extern crate bytes;\r\n    use bytes::*;\r\n\r\n    fn leaks_memory() {\r\n        let mut data = BytesMut::from(Vec::with_capacity(16));\r\n\r\n        loop {\r\n            data.reserve(4);\r\n            data.put(&b\"leak\"[..]);\r\n            data.advance(4);\r\n        }\r\n    }\r\n\r\n    fn also_leaks_memory() {\r\n        let mut data = BytesMut::with_capacity(8192);\r\n\r\n        loop {\r\n            data.reserve(4);\r\n            data.put(&b\"leak\"[..]);\r\n            data.advance(4);\r\n        }\r\n    }\r\n\r\n    fn constant_memory() {\r\n        let mut data = BytesMut::from(Vec::with_capacity(16));\r\n\r\n        loop {\r\n            data.reserve(4);\r\n            data.put(&b\"leak\"[..]);\r\n\r\n            data = data.split_off(4);\r\n        }\r\n    }\r\n\r\n    fn also_constant_memory() {\r\n        let mut data = BytesMut::with_capacity(16);\r\n\r\n        loop {\r\n            data.reserve(4);\r\n            data.put(&b\"leak\"[..]);\r\n            data.advance(4);\r\n        }\r\n    }\r\n\r\nIt looks like what's happening is that a `BytesMut` backed by a `Vec` isn't actually reusing space at the beginning of the buffer when `reserve` is called, but only if it was moved forwards with `advance`. I'm not sure whether any of the other methods (e.g. `truncate`) cause the problem. The documentation says `reserve` will try to recycle existing space (which it's clearly doing in `also_constant_memory`) but it seems to be failing when it shouldn't.\n",
    "tokio-rs__bytes-186": "Object safety for traits\n Currently, rust complains:\r\n```\r\nerror[E0038]: the trait `bytes::Buf` cannot be made into an object\r\n  --> src/proto.rs:17:5\r\n   |\r\n17 |     buf: Option<Box<Buf>>,\r\n   |     ^^^^^^^^^^^^^^^^^^^^^ the trait `bytes::Buf` cannot be made into an object\r\n   |\r\n   = note: method `get_u16` has generic type parameters\r\n   = note: method `get_i16` has generic type parameters\r\n   = note: method `get_u32` has generic type parameters\r\n   = note: method `get_i32` has generic type parameters\r\n   = note: method `get_u64` has generic type parameters\r\n   = note: method `get_i64` has generic type parameters\r\n   = note: method `get_uint` has generic type parameters\r\n   = note: method `get_int` has generic type parameters\r\n   = note: method `get_f32` has generic type parameters\r\n   = note: method `get_f64` has generic type parameters\r\n```\r\n\r\nWhile I'm not sure if boxing buf is good for performance reasons, I'd prefer that boxing be allowed for flexibility.\r\n\r\nThis can be done in in two ways:\r\n1. Use different methods `get_u16_le` and `get_u16_be`\r\n2. Making a wrapper type: `buf.little_endian_reader().get_u16()`\r\nWhile slightly less convenient, I still think it's beneficial to make a trait object-safe.\r\n\r\nThis can only be done as a breaking change in 0.5 though.\n",
    "tokio-rs__bytes-560": "reserve_inner over allocates which can lead to a OOM conidition\n# Summary\r\n\r\n`reseve_inner` will double the size of the underlying shared vector instead of just extending the BytesMut buffer in place if a call to `BytesMut::reserve` would fit inside the current allocated shared buffer. If this happens repeatedly you will eventually attempt to allocate a buffer that is too large.\r\n\r\n# Repro\r\n\r\n```rust\r\nfn reserve_in_arc_unique_does_not_overallocate_after_split() {\r\n    let mut bytes = BytesMut::from(LONG);\r\n    let orig_capacity = bytes.capacity();\r\n    drop(bytes.split_off(LONG.len() / 2));\r\n    let new_capacity = bytes.capacity();\r\n    bytes.reserve(orig_capacity - new_capacity);\r\n    assert_eq!(bytes.capacity(), orig_capacity);\r\n}\r\n```\n",
    "chronotope__chrono-991": "IsoWeek comparisons seem off\nIntuitively, this test should pass. Is this intentional behavior?\r\n\r\n```\r\n#[test]\r\nfn iso_week_lt() {\r\n    use chrono::{Local,TimeZone,Datelike};\r\n    let week1 = Local.ymd(2018,12,31).iso_week();\r\n    let week2 = Local.ymd(2019,01,01).iso_week();\r\n    println!(\"{:?} < {:?}\", week1, week2); // \"2019-W01 < 2019-W01\"\r\n    assert!(week1 == week2); // fail\r\n    assert!(!(week1 > week2)); // pass\r\n    assert!(!(week1 < week2)); // fail\r\n}\r\n```\n",
    "chronotope__chrono-368": "Bug in parse_from_rfc2822 with -0000 timezone\nThe following program:\n\n``` rust\nextern crate chrono;\n\nuse chrono::datetime::DateTime;\n\nfn main() {\n    let minus = \"Fri, 1 Feb 2013 13:51:20 -0000\";\n    let plus  = \"Fri, 1 Feb 2013 13:51:20 +0000\";\n    println!(\"{} -> {:?}\",minus,DateTime::parse_from_rfc2822(minus));\n    println!(\"{} -> {:?}\",plus,DateTime::parse_from_rfc2822(plus));\n}\n```\n\noutputs:\n\n```\nFri, 1 Feb 2013 13:51:20 -0000 -> Err(ParseError(NotEnough))\nFri, 1 Feb 2013 13:51:20 +0000 -> Ok(2013-02-01T13:51:20+00:00)\n```\n\nThis seems wrong.  There should be no difference between -0000 and +0000 right?\n\n",
    "chronotope__chrono-508": "chrono::DurationRound is not TZ aware\nThe functions implemented in the chrono::DurationRound trait return wrong values when a time zone is involved.\r\nThe TZ offset \"leaks\" into the time value.\r\n\r\n[Example on Rust Playground.](https://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=c3229ea84b66a4beae8817e8ebec7443)\r\n\r\nIf this is expected it should be documented, I think.\n",
    "chronotope__chrono-445": "Add round/truncate functions for any specified Duration\nIt would be very useful for some use cases to have a round or truncate function for any specified Duration.\r\n\r\nFor now, I'm doing this to truncate some DateTime to a 5 minutes interval:\r\n```rust\r\n    let dt = Utc::now();\r\n    let round_down = dt.timestamp() % (5 * 60);\r\n    let dt_rounded = dt.with_nanosecond(0).unwrap() - time::Duration::seconds(round_down);\r\n```\r\n\r\nIt would be nice to have something like this:\r\n```rust\r\n    let dt = Utc::now();\r\n    let dt_rounded = dt.truncate(time::Duration::minutes(5));\r\n```\r\n\r\nI can submit a PR if there is some basic mentoring available -- I'm still inexperienced in Rust.\n",
    "chronotope__chrono-378": "Consider including the `T` in Display of DateTime\nCurrently, you cannot roundtrip a DateTime to a String through `ToString` and back with `FromStr`, because `FromStr` rejects strings without the `T` between the date and time, and `ToString` does not include it. This is pretty surprising behavior IMO, and it doesn't seem harmful to include the `T` in the displayed output anyway.\n",
    "chronotope__chrono-1621": "`std::fmt::Display` implementation of `Weekday` does not honour width, alignment or fill\n## Summary\r\n\r\nThe `Display` implementation of `Weekday` uses `Formatter::write_str`, which doesn't honour [width](https://doc.rust-lang.org/std/fmt/index.html#width) or [alignment and fill](https://doc.rust-lang.org/std/fmt/index.html#fillalignment).\r\n\r\n## Reproducer\r\n\r\n```rust\r\nuse chrono::Weekday;\r\n\r\nfn main() {\r\n    println!(\"Expected result: <{:X>10}>\", format!(\"{}\", Weekday::Mon));\r\n    println!(\"Actual result: <{:X>10}>\", Weekday::Mon);\r\n}\r\n```\r\n\r\n([Playground](https://play.rust-lang.org/?version=stable&mode=debug&edition=2021&gist=e9d6cafc549ad505e6f932697fbda305))\r\n\r\n## Expected result\r\n\r\n`<XXXXXXXMon>`\r\n\r\n## Actual result\r\n\r\n`<Mon>`\n",
    "chronotope__chrono-320": "DelayedFormat does not respect format items\n[This code](https://play.rust-lang.org/?gist=b9a3b5a1faaf2042346d1c269022b6f9&version=stable):\r\n\r\n```rust\r\nextern crate chrono;\r\n\r\nfn main() {\r\n    let date = chrono::Utc::now();\r\n    let tz = date.format(\"%Z\");\r\n    println!(\"left {:>10} right\", tz.to_string());\r\n    println!(\"left {:>10} right\", tz)\r\n}\r\n```\r\n\r\nOutputs:\r\n\r\n```text\r\nleft        UTC right\r\nleft UTC right\r\n```\r\n\r\nBut both lines should probably be the same.\r\n\r\ncc #230 \n",
    "chronotope__chrono-308": "Creating a TimeZone from epoch nanosecond\nWe should be able to construct a `TimeZone` from a nanosecond timestamp produced by `DateTime::timestamp_nanos()`.\r\n\r\nThis is similar to #264 but for nanosecond.\n",
    "chronotope__chrono-242": "supported timezone syntax for DateTime from string\nI'm trying to accommodate the default timezone syntax returned from postgresql.  It seems to provide an abbreviated form that chrono may not support-- it omits 00 minutes.  Is there support for this in Chrono?  \r\n\r\nhttp://play.integer32.com/?gist=b6394d764deb6a4bcf7b1b5ebd038969&version=stable\r\n\r\n```\r\nextern crate chrono;\r\nuse chrono::prelude::*;\r\nuse chrono::DateTime;\r\n\r\nfn main() {\r\n    let dt = \"2018-02-06 11:17:09.534889-05\";\r\n    let test = DateTime::parse_from_str(dt, \"%Y-%m-%d %H:%M:%S%.6f-%z\");\r\n    println!(\"{:?}\", test);                                        \r\n}\r\n\r\n```\n",
    "chronotope__chrono-711": "Make conversion from NaiveDateTime to DateTime easier\nHello,\r\n\r\nI noticed that the conversion from a NaiveDateTime to a DateTime by supplying a TimeZone is not really as easy as it could be (or IDE-friendly).\r\n\r\nMostly, I think the problem is that you have the conversion method on the `TimeZone` trait, instead of on the `NaiveDateTime` object. At least speaking for myself, if I want to convert a NaiveDateTime, I already have one (e.g. because I manually parsed it from somewhere without Time information) and then just want to supply the TimeZone object. As a normal developer, I would just press `.` on the object and hope that my IDE will display me a suitable method.\r\n\r\nTherefore, what about something like this?\r\n\r\n```rust\r\nimpl NaiveDateTime {\r\n    pub fn to_datetime_local<Tz: TimeZone>(&self, tz: Tz) -> LocalResult<DateTime<Tz>> {\r\n        tz.from_local_datetime(self)\r\n    }\r\n}\r\n```\r\n\r\nThis makes it really obvious how to construct a DateTime<TimeZone> from a NaiveDateTime:\r\n\r\n```rust\r\n#[test]\r\nfn test_naivedatetime_to_local() {\r\n    let offset = FixedOffset::east(3600);\r\n    let dt = NaiveDate::from_ymd(2022,05,07).and_hms(14,51,00)\r\n        .to_datetime_local(offset);\r\n    assert_eq!(\"2022-05-07T14:51:00+01:00\", dt.single().unwrap().to_rfc3339());\r\n}\r\n```\r\n\r\nFurthermore, while the `LocalResult` is of course correct, I think it would be nice to have some kind of \"lossy\" output. I would assume that most of the time there is only one result (as the DST transitions are mostly in the night anyway, where they have the least impact). Currently the user has to handle this situation every time, while most of the time the conversion will be correct. Anyway, I think it would be good for a time library to have some sensible default how to work with this, as not every user might know what to do in this case.\r\n\r\nI checked on the Java time API, and they handle it like this (https://docs.oracle.com/javase/8/docs/api/java/time/LocalDateTime.html#atZone-java.time.ZoneId-):\r\n\r\n> In most cases, there is only one valid offset for a local date-time. In the case of an overlap, where clocks are set back, there are two valid offsets. This method uses the earlier offset typically corresponding to \"summer\".\r\n>\r\n> In the case of a gap, where clocks jump forward, there is no valid offset. Instead, the local date-time is adjusted to be later by the length of the gap. For a typical one hour daylight savings change, the local date-time will be moved one hour later into the offset typically corresponding to \"summer\".\r\n>\r\n> To obtain the later offset during an overlap, call [ZonedDateTime.withLaterOffsetAtOverlap()](https://docs.oracle.com/javase/8/docs/api/java/time/ZonedDateTime.html#withLaterOffsetAtOverlap--) on the result of this method. To throw an exception when there is a gap or overlap, use [ZonedDateTime.ofStrict(LocalDateTime, ZoneOffset, ZoneId)](https://docs.oracle.com/javase/8/docs/api/java/time/ZonedDateTime.html#ofStrict-java.time.LocalDateTime-java.time.ZoneOffset-java.time.ZoneId-).\r\n\r\n\r\nWhy not create an additional method on `LocalResult` which returns something like the Java handling (not quite sure how other time libraries handle this situation)?\r\n \n",
    "chronotope__chrono-686": "Panic in `parse_from_rfc2822` with overflowing date\n```rust\r\n#[test]\r\nfn panic() {\r\n    chrono::DateTime::parse_from_rfc2822(\"31 DEC 262143 23:59 -2359\");\r\n}\r\n```\n",
    "chronotope__chrono-1403": "Truncating a timestamp close to EPOCH fails\nDue to this check in `duration_truc`:\r\nhttps://github.com/chronotope/chrono/blob/main/src/round.rs#L221-L223\r\n\r\nExpected behaviour: I should be able to truncate the timestamp to 0\n",
    "chronotope__chrono-1323": "Utc nanoseconds do not always roundtrip\n# Reproducer\r\n\r\n## Code\r\n```rust\r\n#[test]\r\nfn nano_roundrip() {\r\n    let nanos = i64::MIN + 2;\r\n    let dt = Utc.timestamp_nanos(nanos);\r\n    let nanos2 = dt.timestamp_nanos();\r\n    assert_eq!(nanos, nanos2);\r\n}\r\n```\r\n\r\n## Expected Result\r\nTest passes.\r\n\r\n## Actual Result\r\nTest panics when calling `dt.timestamp_nanos()` (so we don't even get to the actual comparison:\r\n\r\n`value can not be represented in a timestamp with nanosecond precision.`\r\n\r\n# Technical Background\r\n`dt.timestamp()` is `-9223372037`, however `nanos / 1_000_000_000` is `-9223372036`, hence I conclude that this IF branch was taken:\r\n\r\nhttps://github.com/chronotope/chrono/blob/b64cedc6a8758d15265702895d917045ce1eebf8/src/offset/mod.rs#L427-L430\r\n\r\nHence this `checked_mul` overflows:\r\n\r\nhttps://github.com/chronotope/chrono/blob/b64cedc6a8758d15265702895d917045ce1eebf8/src/naive/datetime/mod.rs#L482\r\n\r\n~My guess is that the conversion routine (first code block) isn't entirely accurate.~ The conversion is alright, I rather think when converting back we have to be more careful.\n",
    "chronotope__chrono-1294": "Utc nanoseconds do not always roundtrip\n# Reproducer\r\n\r\n## Code\r\n```rust\r\n#[test]\r\nfn nano_roundrip() {\r\n    let nanos = i64::MIN + 2;\r\n    let dt = Utc.timestamp_nanos(nanos);\r\n    let nanos2 = dt.timestamp_nanos();\r\n    assert_eq!(nanos, nanos2);\r\n}\r\n```\r\n\r\n## Expected Result\r\nTest passes.\r\n\r\n## Actual Result\r\nTest panics when calling `dt.timestamp_nanos()` (so we don't even get to the actual comparison:\r\n\r\n`value can not be represented in a timestamp with nanosecond precision.`\r\n\r\n# Technical Background\r\n`dt.timestamp()` is `-9223372037`, however `nanos / 1_000_000_000` is `-9223372036`, hence I conclude that this IF branch was taken:\r\n\r\nhttps://github.com/chronotope/chrono/blob/b64cedc6a8758d15265702895d917045ce1eebf8/src/offset/mod.rs#L427-L430\r\n\r\nHence this `checked_mul` overflows:\r\n\r\nhttps://github.com/chronotope/chrono/blob/b64cedc6a8758d15265702895d917045ce1eebf8/src/naive/datetime/mod.rs#L482\r\n\r\n~My guess is that the conversion routine (first code block) isn't entirely accurate.~ The conversion is alright, I rather think when converting back we have to be more careful.\n",
    "chronotope__chrono-1285": "Add timestamp_micros to Utc\nI wanted to know if there is a reason for having the functions `timestamp_millis` and `timestamp_nanos` in the trait `TimeZone` but not `timestamp_micros`.\r\nIf there is no reason not to have it, will it be possible to implement it?\n",
    "chronotope__chrono-1157": "Add a FixedOffset parser\nIn [my project](https://gitlab.com/xmpp-rs/xmpp-parsers), an [XMPP](https://xmpp.org) element parser, I need to be able to parse a timezone on its own, in order to implement [XEP-0202](https://xmpp.org/extensions/xep-0202.html).\r\n\r\nI\u2019m currently using [a super ugly workaround](https://gitlab.com/xmpp-rs/xmpp-parsers/blob/master/src/time.rs#L46-49) by creating a DateTime from a random date concatenated with the timezone I want to parse, and then extracting the timezone from it.\r\n\r\nA correct way to implement that could be to `impl std::str::FromStr for FixedOffset`, which would return only the timezone information and reject any other string.\n",
    "chronotope__chrono-999": "Implement PartialOrd for Month\nIt would be nice if Month implemented PartialOrd.\r\n\r\nFor instance, I have a situation where I am aggregating data on a monthly basis, year by year. For that, I have a YearMonth struct like this:\r\n\r\n```rust\r\nstruct YearMonth {\r\n    year: i32,\r\n    month: Month,\r\n}\r\n```\r\n\r\nFor the actual calculation, this is then used as key in a `HashMap`, or part of a tuple inside a `Vec`. I then want to find all the `YearMonth` for the last 12 months, which means I have a comparison like `.filter(|year_month| year_month >= current_year_month.month.minus_one_year())` . Since `Month` does not implement `PartialOrd`, I cannot simply derive the implementation for `YearMonth`, but have to implement my own.\n",
    "rinja-rs__askama-673": "Trim all but 1 whitespace jinja condition\n@vallentin suggested [here](https://github.com/djc/askama/pull/664#pullrequestreview-945253861) that we could extend the \"trim_all_whitespace\" feature to be able to trim all whitespace characters but one.\r\n\r\nSo currently, we have:\r\n\r\n```jinja\r\n<div>    {%- if foo -%} blabla {%- endif -%} </div>\r\n```\r\n\r\nWhich will remove all whitespace characters before and after (by using `-`) and we have:\r\n\r\n```jinja\r\n<div>    {%+ if foo +%} blabla {%+ endif +%} </div>\r\n```\r\n\r\nWhich means that the whitespace should be saved (only useful when the \"trim all whitespace\" feature is enabled).\r\n\r\nThe idea would now to add a new character to strip all whitespace characters but one. I propose `~`:\r\n\r\n```jinja\r\n<div>    {%~ if foo %} blabla {% endif %} </div>\r\n```\n",
    "rinja-rs__askama-652": "Capitalize does not work with non ascii chars\nCapitalize filter only works with ascii chars not chars like \u00e5, \u00e4 and \u00f6.\n",
    "rinja-rs__askama-359": "into_f64, into_isize unusable\n`{{ number | into_f64 }}` expands to `into_f64(&number)`, which doesn't compile, because borrowed number doesn't `impl NumCast`.\n",
    "rinja-rs__askama-861": "Fuzzing askama_parser results in panic\nHi, fuzzing `askama_parser` resulted in panic at following line.\r\nhttps://github.com/djc/askama/blob/43e92aa3b6b9cd967a70bd0fd54d1f087d6ed76b/askama_parser/src/expr.rs#L290\r\nI suppose it happens because crash input contains Cyrillic letters which are multi-byte and we need exact byte indices to avoid such panic in `[..]` notation.\r\n```rust\r\n#[test]\r\nfn testing() {\r\n    let d = \"{eeuuu{b&{!!&{!!11{{\r\n        0!(!1q\u0484\u05d0!)!!!!!!n!\";\r\n    if let Ok(_) = Ast::from_str(d, &Syntax::default()) {}\r\n}\r\n```\r\n```\r\nrunning 1 test\r\nthread 'tests::testing' panicked at 'byte index 6 is not a char boundary; it is inside '\u05d0' (bytes 5..7) of `!1q\u0484\u05d0!)!!!!!!n!`', askama_parser/src/expr.rs:290:22\r\nstack backtrace:\r\n```\n",
    "rinja-rs__askama-837": "Parse error when using macro with expanded module path\nI am making a crate that allows people to embed icons from Iconify at compile time, but I ran into a little snag.\r\nTried on main and 0.12. Only happens when using a macro, normal functions work fine.\r\n\r\nThe intended usage is:\r\n```jsx\r\n<body>\r\n    <h1>Hello</h1>\r\n    {{ iconify::svg!(\"mdi:home\")|safe }}\r\n</body>\r\n```\r\n\r\nBut it gives me a parse error:\r\n```\r\nerror: problems parsing template source at row 5, column 19 near:\r\n       \"!(\\\"mdi:home\\\") }}\\r\\n</body>\\r\\n</html>\\r\"\r\n```\r\n\r\nI can work around it by importing the macro (below compiles fine), but I'd prefer being able to keep the module path so I don't need to.\r\n```jsx\r\n{{ svg!(\"mdi:home\")|safe }}\r\n```\n",
    "rinja-rs__askama-951": "0.12.1 only allow lower-case variable name in template\nI don't know if I asked a stupid question, but I spend one day to find it ! my rust version is 1.74.0, I run it on my win11 and WSL ubuntu 22.04, see the same error below\r\n```rust\r\nuse askama::Template;\r\n\r\n#[derive(Template)] \r\n#[template(path = \"hello.html\")]\r\nstruct HelloTemplate<'a> {\r\n    nAme: &'a str, \r\n}\r\nfn main() {\r\n    let hello = HelloTemplate { nAme: \"world\" }; \r\n    println!(\"{}\", hello.render().unwrap());\r\n}\r\n```\r\n```html\r\nHello, {{ nAme }}!\r\n```\r\n```toml\r\n[package]\r\nname = \"hello\"\r\nversion = \"0.1.0\"\r\nedition = \"2021\"\r\n\r\n[dependencies]\r\naskama=\"0.12.1\"\r\n```\r\n[xxx.DESKTOP-ABCDE12] \u2b9e cargo run -p hello\r\n   Compiling hello v0.1.0 (C:\\xx\\xx\\xx\\hello)\r\nerror[E0425]: cannot find value `nAme` in this scope\r\n --> hello\\src\\main.rs:3:10\r\n  |\r\n3 | #[derive(Template)]\r\n  |          ^^^^^^^^\r\n  |\r\n  = note: this error originates in the derive macro `Template` (in Nightly builds, run with -Z macro-backtrace for more info)\r\nhelp: you might have meant to use the available field\r\n  |\r\n3 | #[derive(self.Template)]\r\n  |          +++++\r\n\r\nFor more information about this error, try `rustc --explain E0425`.\r\nerror: could not compile `hello` (bin \"hello\") due to previous error\r\n\n",
    "rinja-rs__askama-911": "Feature request: enhance match to include multiple targets\nThis has previously been discussed at https://github.com/djc/askama/issues/711#issuecomment-1794340598 but I would like to move it to its own issue as it can be implemented separately.\r\n\r\nThe request is to enhance Askana's syntax for the `match` block (see https://djc.github.io/askama/template_syntax.html#match) to handle multiple targets in the same 'arm'.\r\n\r\nSee https://doc.rust-lang.org/reference/expressions/match-expr.html for the Rust syntax in the Reference Manual. Note that a match arm can have multiple targets; the object of this feature request is to replicate this in Askama. (I am not requesting 'match arm guards' (`if` clauses)).\r\n\r\nSo given code like\r\n```\r\nenum Suit {Clubs, Diamonds, Hearts, Spades}\r\n```\r\none could write a template like \r\n```\r\nThe card is\r\n{% match suit %}\r\n   {% when Suit::Clubs or Suit::Spades %}\r\n     black\r\n   {% when Suit::Diamonds or Suit::Hearts %}\r\n     red\r\n{% endmatch %}\r\n```\r\nAlternatively, `or` could be replaced by `|` in the proposed design, but I think Askama prefers keywords to symbols.\r\n\r\nLooking at the code, `combinator/mod.rs(587)`*ff* defines how match statements are stored in the parse structure and how the code is parsed into this structure, and line 232*ff* covers `when` arms. So the `target` field would need to be a vector of `Targets`, and the `when()` function would need to be able to parse the modified `when` syntax., and the `parse()` function for `Match` around 595 also would need changing.\r\n\r\nThe `Match` structure is used in `generator.rs` around 544*ff* to generate the Rust code. This currently calls `visit_target` at 1559*ff* to generate the actual target; this would need to be changed around 576 to a call for each target and to output intervening `|` tokens.\r\n\r\nThere is some code around `heritage.rs(93)`. I'm not sure what it does, but it looks like it moves the match arms without change, so maybe it does not require any change.\r\n\r\nAlso, the documentation will need changing, of course. near `template_syntax.md(417)`*ff*.\r\n\r\nThe test could look something like the following (in `testing/tests/matches.rs)`, with the template above in `testing/templates/match-enum.html`).\r\n\r\n```\r\nenum Suit {Clubs, Diamonds, Hearts, Spades}\r\n#[derive(Template)]\r\n#[template(path = \"match-enum.html\")]\r\nstruct MatchEnumTemplate {\r\n    item: Suit,\r\n}\r\n\r\n#[test]\r\nfn test_match_enum() {\r\n    let s = MatchEnumTemplate { item: Suit::Clubs};\r\n    assert_eq!(s.render().unwrap(), \"\\nThe card is black\\n\");\r\n\r\n    let s = MatchEnumTemplate { item: Suit::Hearts};\r\n    assert_eq!(s.render().unwrap(), \"\\nThe card is red\\n\");\r\n\r\n}\r\n```\n",
    "rinja-rs__askama-910": "Allow to have named arguments in macro\nIt'd pretty nice to be able to have named arguments. For example:\r\n\r\n```\r\n{% macro menu_link(href, text, target) %}\r\n...\r\n{% endmacro menu_link %}\r\n```\r\n\r\nThen to be able to call it like this:\r\n\r\n```\r\n{% menu_link(href=\"/something\", text=\"link\", target=\"_blank\") %}\r\n```\r\n\r\nIt makes the code much better when reading it.\r\n\r\nAs a first step, only allowing it for macros would be nice, but potentially extending it to filters would be nice too.\n",
    "rinja-rs__askama-399": "Unwanted whitespace in match arm\nFor a Template struct containing a field `ver: Option<&'a str>` and the following template:\r\n\r\n```jinja2\r\n{% let suffix -%}\r\n{% match ver -%}\r\n  {% when Some with (ver) -%}\r\n    {% let suffix = format!(\"-{}\", ver) -%}\r\n  {% when None -%}\r\n    {% let suffix = String::new() -%}\r\n{% endmatch -%}\r\n```\r\n\r\nThis code is part of the first match arm: `writer.write_str(\"\\n \")?;`. However, since every line ends with `-%}`, there should't be any newlines inserted into this part of the template.\nUnwanted whitespace in match arm\nFor a Template struct containing a field `ver: Option<&'a str>` and the following template:\r\n\r\n```jinja2\r\n{% let suffix -%}\r\n{% match ver -%}\r\n  {% when Some with (ver) -%}\r\n    {% let suffix = format!(\"-{}\", ver) -%}\r\n  {% when None -%}\r\n    {% let suffix = String::new() -%}\r\n{% endmatch -%}\r\n```\r\n\r\nThis code is part of the first match arm: `writer.write_str(\"\\n \")?;`. However, since every line ends with `-%}`, there should't be any newlines inserted into this part of the template.\n",
    "rinja-rs__askama-394": "Whitespace issue with if conditions\nAskama seems to be including whitespace from inside an if condition even when the condition is not fulfilled. Here is my template file:\r\n\r\n```jinja\r\n{%- if some_condition -%}\r\n# WARNING\r\n\r\n{% endif -%}\r\n\r\n# FILE START\r\n```\r\n\r\nWhat I expected is:\r\n\r\n- When `some_condition` is `true`:\r\n\r\n  ```\r\n  # WARNING\r\n  \r\n  # FILE START\r\n  ```\r\n\r\n- When `some_condition` is `false`:\r\n\r\n  ```\r\n  # FILE START\r\n  ```\r\n\r\nWhat I got is:\r\n\r\n- When `some_condition` is `true`: same as expected output\r\n- When `some_condition` is `false` (notice the blank lines before `FILE START`):\r\n\r\n  ```\r\n  \r\n  \r\n  # FILE START\r\n  ```\r\n\r\nIs this a bug? If not, is there a way to get the behaviour I described?\nAdd test for whitespace inside a condition\nAdds test for https://github.com/djc/askama/issues/377.\n",
    "rinja-rs__askama-393": "Allow paths to start with `::`\n[Discovered while working on #315 and #327.]\r\n\r\nAt the moment `{{ std::string::String::new()}}` works but `{{ ::std::string::String::new() }}` doesn't.\r\n\nAllow paths to start with `::`\n[Discovered while working on #315 and #327.]\r\n\r\nAt the moment `{{ std::string::String::new()}}` works but `{{ ::std::string::String::new() }}` doesn't.\r\n\n",
    "rinja-rs__askama-391": "The operator parser gets precedences wrong\nConsider the expression `a + b == c`. If we changed the code generated from `{lhs} {op} {rhs}` to include parentheses around the entire thing, we get `(a + (b == c))`, which is incorrect, because _(i)_ the `+` and `==` operators combined are not associative (and I think that's true for any two different operators), so need to be evaluated left to right, and _(ii)_ the `==` operator has higher precedence than `+`. It only currently works because askama emits the code unmodified enough for the rust compiler to correct the mistake.\n",
    "rinja-rs__askama-374": "Consider using `compile_error!` instead of panicking\nI just tried out askama for the first time and my IDE (using rust-analyzer) reported that my code failed to compile because `proc-macro derive panicked`. This error message is not very helpful as I had to go to the command line and ask cargo what the real problem was. If the derive macro issued a `compile_error!(msg)` instead of panicking, the error message would've been correctly reported by rust-analyzer. This is also [already built into syn](https://docs.rs/syn/1.0.45/syn/struct.Error.html#method.to_compile_error) to make life easier.\n",
    "rinja-rs__askama-500": "move occurs because `item1.list2` has type `Vec<Box<dyn MyTrait + Send>>`, which does not implement the `Copy` trait\nI got this error with `main` but not with `0.10.5`.\r\n\r\n```\r\nerror[E0507]: cannot move out of `item1.list2` which is behind a shared reference\r\n --> src/main.rs:3:10\r\n  |\r\n3 | #[derive(Template)]\r\n  |          ^^^^^^^^ move occurs because `item1.list2` has type `Vec<Box<dyn MyTrait + Send>>`, which does not implement the `Copy` trait\r\n  |\r\n  = note: this error originates in a derive macro (in Nightly builds, run with -Z macro-backtrace for more info)\r\n```\r\n\r\n\r\nCargo.toml\r\n```toml\r\n[dependencies]\r\n\r\n# works\r\naskama = \"0.10.5\"\r\n\r\n# doesn't work\r\naskama = { git = \"https://github.com/djc/askama.git\", branch = \"main\" }\r\n```\r\n\r\nmain.rs\r\n```rust\r\nuse askama::Template;\r\n\r\n#[derive(Template)]\r\n#[template(path = \"template.txt\")]\r\nstruct MyStruct1 {\r\n    list1: Vec<MyStruct2>,\r\n}\r\n\r\nstruct MyStruct2 {\r\n    list2: Vec<Box<dyn MyTrait + Send>>,\r\n}\r\n\r\npub trait MyTrait {\r\n    fn render(&self) -> String;\r\n}\r\n\r\nfn main() {}\r\n```\r\n\r\ntemplate.txt\r\n```\r\n{% for item1 in list1 %}\r\n{% for item2 in item1.list2 %}\r\n{% endfor %}\r\n{% endfor %}\r\n```\r\n\r\n\r\nFeel free to rename the issue.\n",
    "rinja-rs__askama-499": "Error \"proc-macro derive produced unparseable tokens\" with nested macro call\nI was working on updating [UniFFI](https://github.com/mozilla/uniffi-rs/) to the latest `main` branch of Askama, and ran into a case where the `#[derive(Template)]` seems to generate invalid code. Below is a reduced example:\r\n\r\n```\r\nuse askama::Template;\r\n\r\n#[derive(Template)]\r\n#[template(source=\"\r\n\r\nuse askama::Template;\r\n\r\n#[derive(Template)]\r\n#[template(source=\"\r\n\r\n    {%- macro outer(ctx) -%}\r\n    {%- call inner(ctx, \\\"name\\\") -%}\r\n    {%- endmacro -%}\r\n\r\n    {%- macro inner(ctx, name) -%}\r\n    {{ name }} = value;\r\n    {%- endmacro -%}\r\n\r\n    {%- call outer(ctx) -%}\r\n\r\n\", ext=\"txt\", print=\"code\")]\r\nstruct MacroBug {\r\n    ctx: (),\r\n}\r\n\r\nimpl MacroBug {\r\n    #[cfg(test)]\r\n    fn testme() -> String {\r\n        MacroBug { ctx: () }.render().unwrap()\r\n    }\r\n}\r\n\r\n#[cfg(test)]\r\nmod test {\r\n    use super::*;\r\n    #[test]\r\n    fn test_it() {\r\n        assert_eq!(MacroBug::testme(), \"name = value;\")\r\n    }\r\n}\r\n```\r\n\r\nThis compiles and runs correctly on the latest Askama release, but when compiled against current `main` ([b318d7cb](https://github.com/djc/askama/commit/b318d7cbcded2c6dfc66bbe19687f1246a9a9eab)) it gives an error:\r\n\r\n```\r\nerror: expected pattern, found `,`\r\n --> src/lib.rs:4:10\r\n  |\r\n4 | #[derive(Template)]\r\n  |          ^^^^^^^^ expected pattern\r\n  |\r\n  = note: this error originates in a derive macro (in Nightly builds, run with -Z macro-backtrace for more info)\r\n\r\nerror: proc-macro derive produced unparseable tokens\r\n --> src/lib.rs:4:10\r\n  |\r\n4 | #[derive(Template)]\r\n  |          ^^^^^^^^\r\n```\r\n\r\nThe issue seems to be in the code for calling the inner macro. The generated code front `print=\"code\"` looks like:\r\n\r\n```\r\nimpl ::askama::Template for MacroBug {\r\n    fn render_into(&self, writer: &mut dyn ::std::fmt::Write) -> ::askama::Result<()> {\r\n        {\r\n            {\r\n                let (, name) = (, (\"name\"));\r\n```\n",
    "rinja-rs__askama-486": "askama_escape Why escape slashes?\nSorry, I just don't seem to understand what harm slashes can do in html.\r\n\r\n[Why does it escape slashes?](https://github.com/djc/askama/blob/467f4ade19fa34983de7e6f6d81c6b4d5ff140fe/askama_escape/src/lib.rs#L134)\n",
    "rinja-rs__askama-458": "Proper file extension for templates for plugin integration?\nFirst of all, let me congratulate you for your work. I'm developing an application with Askama and Rocket, and I'm very happy with the results. However, I recently hit an interesting bump. This was using VS Code as my development environment:\r\n\r\n- As the templates are all HTML, I'm just using `.html` extension.\r\n- The HTML formatting plugins don't recognize Askama templates. That means no syntax highlighting, no error detection, and no proper formatting. In fact one plugin completely mangled a few templates and caused my website to crash.\r\n- As Askama is based on Jinja2, I tried to rename my files as `.html.j2` and use a Jinja2 plugin (no Askama plugin seems to exist), and lo and behold, it worked perfectly. Syntax highlighting and proper formatting. The code compiles and runs flawlessly, but...\r\n- Askama's Rocket responder implementation guesses the content type from the file extension, but `.html.j2` is not recognized, so it just returns an empty response! No error message, no nothing, just a totally blank page.\r\n\r\nSo my question is, how can we fix this? I have a couple ideas:\r\n\r\n- Write a proper Askama plugin with its own file extension, or reuse an existing Jinja2 plugin, even if the two syntaxes don't match perfectly?\r\n- Fix the responders implementations to strip the last part of the extension from the file name, in case it matches a predefined list.\nProper file extension for templates for plugin integration?\nFirst of all, let me congratulate you for your work. I'm developing an application with Askama and Rocket, and I'm very happy with the results. However, I recently hit an interesting bump. This was using VS Code as my development environment:\r\n\r\n- As the templates are all HTML, I'm just using `.html` extension.\r\n- The HTML formatting plugins don't recognize Askama templates. That means no syntax highlighting, no error detection, and no proper formatting. In fact one plugin completely mangled a few templates and caused my website to crash.\r\n- As Askama is based on Jinja2, I tried to rename my files as `.html.j2` and use a Jinja2 plugin (no Askama plugin seems to exist), and lo and behold, it worked perfectly. Syntax highlighting and proper formatting. The code compiles and runs flawlessly, but...\r\n- Askama's Rocket responder implementation guesses the content type from the file extension, but `.html.j2` is not recognized, so it just returns an empty response! No error message, no nothing, just a totally blank page.\r\n\r\nSo my question is, how can we fix this? I have a couple ideas:\r\n\r\n- Write a proper Askama plugin with its own file extension, or reuse an existing Jinja2 plugin, even if the two syntaxes don't match perfectly?\r\n- Fix the responders implementations to strip the last part of the extension from the file name, in case it matches a predefined list.\n",
    "rinja-rs__askama-433": "Updated book to include urlencode and urlencode_strict\nForgot to include these in #429.\r\n\nQuestion: passing a const, not as a field.\nI'm trying to reference a constant in my template, since I reuse it all over the place (including across templates) and it'd be a pain to have to update it everywhere it needs to change. I have a template file with `{{ date.format(FMT_STR) }}`, a `const FMT_STR: &'static str = \"...\";`, and a `date: chrono::naive::NaiveDate`. As expected, this produces `self.date.format(self.FMT_STR)`. How can I get `self.date.format(FMT_STR)` instead? i.e. How can I refer to my constant, instead of a field?\n",
    "rinja-rs__askama-426": "Filters have precedence over unary operators\nPerforming e.g. `{{ -2|abs }}` is parsed as `{{ -(2|abs) }}` resulting in `-2` being rendered.\r\n\r\n\r\n\nFilters have precedence over unary operators\nPerforming e.g. `{{ -2|abs }}` is parsed as `{{ -(2|abs) }}` resulting in `-2` being rendered.\r\n\r\n\r\n\n",
    "rinja-rs__askama-423": "Version 0.10 places Copy value literals behind a reference where 0.9 did not\nI have a large collection of templates that compiles perfectly fine with version 0.9 of askama, but when I try to upgrade to 0.10, I get a bunch of type errors because a bunch of `Copy` types that were previously passed as values now get placed behind a reference\nVersion 0.10 places Copy value literals behind a reference where 0.9 did not\nI have a large collection of templates that compiles perfectly fine with version 0.9 of askama, but when I try to upgrade to 0.10, I get a bunch of type errors because a bunch of `Copy` types that were previously passed as values now get placed behind a reference\n",
    "rinja-rs__askama-411": "Add support for redefining the same variable with `let` (just as Rust permits)\n[Discovered while working on #315 and #327.]\r\n\r\nThe following statements, although allowed by Rust, are disallowed by `askama`:\r\n~~~~\r\n{% let x = 1 %}\r\n{% let x = 2 %}\r\n~~~~\r\n\r\nThe failure is:\r\n~~~~\r\ncannot assign twice to immutable variable\r\nhelp: make this binding mutable: `mut x`\r\n~~~~\r\n\nAdd support for redefining the same variable with `let` (just as Rust permits)\n[Discovered while working on #315 and #327.]\r\n\r\nThe following statements, although allowed by Rust, are disallowed by `askama`:\r\n~~~~\r\n{% let x = 1 %}\r\n{% let x = 2 %}\r\n~~~~\r\n\r\nThe failure is:\r\n~~~~\r\ncannot assign twice to immutable variable\r\nhelp: make this binding mutable: `mut x`\r\n~~~~\r\n\n",
    "rinja-rs__askama-1097": "Allow Trailing Commas in Arrays Inside Template Expressions\nBasically what the title says.\r\n\r\nTo give an example of what I mean, this here compiles just fine:\r\n\r\n```html\r\n<nav class=\"flex justify-between items-center max-w-7xl gap-x-12\">\r\n    {% for (route, name) in [\r\n        (\"/about\", \"About\"),\r\n        (\"/contact\", \"Contact\"),\r\n        (\"/events\", \"Events\"),\r\n        (\"/history\", \"History\")\r\n    ] %}\r\n    <div class=\"gap-x-6 leading-6 hover:bg-gray-200\">\r\n        <a href=\"{{ route }}\"><span>{{ name }}</span></a>\r\n    </div>\r\n    {% endfor %}\r\n</nav>\r\n```\r\n\r\nBut this here doesn't:\r\n\r\n```html\r\n<nav class=\"flex justify-between items-center max-w-7xl gap-x-12\">\r\n    {% for (route, name) in [\r\n        (\"/about\", \"About\"),\r\n        (\"/contact\", \"Contact\"),\r\n        (\"/events\", \"Events\"),\r\n        (\"/history\", \"History\"),\r\n    ] %}\r\n    <div class=\"gap-x-6 leading-6 hover:bg-gray-200\">\r\n        <a href=\"{{ route }}\"><span>{{ name }}</span></a>\r\n    </div>\r\n    {% endfor %}\r\n</nav>\r\n```\r\n\r\nNote the little comma after the `(\"/history\", \"History\")` tuple in the second example.\r\n\r\nI'm not sure if this is trivial to implement or not, but I thought I might bring it to y'alls' attention.\r\n\r\nIt wasn't that of a big deal in the end though, so I wouldn't call this a \"major issue\" or whatever, not by a long shot. Though, since Rust allows such trailing commas, I think `askama` should as well.\r\n\r\nFor reference, this is the error I got:\r\n```\r\nerror: problems parsing template source at row 30, column 31 near:\r\n       \",\\n    ] %}\\n    <div class=\\\"gap-x-6 leadi\"...\r\n  --> src/routes/mod.rs:96:10\r\n   |\r\n96 | #[derive(Template)]\r\n   |          ^^^^^^^^\r\n   |\r\n   = note: this error originates in the derive macro `Template` (in Nightly builds, run with -Z macro-backtrace for more info)\r\n```\r\n\r\nRunning with `RUSTFLAGS=\"-Zmacro-backtrace\" cargo +nightly build` gives the following:\r\n```\r\nerror: problems parsing template source at row 30, column 31 near:\r\n       \",\\n    ] %}\\n    <div class=\\\"gap-x-6 leadi\"...\r\n  --> src/routes/mod.rs:96:10\r\n   |\r\n96 | #[derive(Template)]\r\n   |          ^^^^^^^^ in this derive macro expansion\r\n   |\r\n  ::: /home/max/.cargo/registry/src/index.crates.io-6f17d22bba15001f/askama_derive-0.12.5/src/lib.rs:22:1\r\n   |\r\n22 | pub fn derive_template(input: TokenStream) -> TokenStream {\r\n   | --------------------------------------------------------- in this expansion of `#[derive(Template)]`\r\n```\r\n\r\nNeither error was too helpful, but it does point to line 30, column 31, which in my code is precisely the closing parenthesis before the trailing comma; careful reading helps at least.\n",
    "rinja-rs__askama-1093": "Include statement has no effect when used from a block fragment\nWhen using a block fragment include statements don't seem to work.\r\n\r\nSee https://github.com/OscartGiles/askama/commit/74162b9453486a53a4de40bba905b4be31dcf3f0 for an example. \r\n\r\nIs this intented behaviour or a bug?\n",
    "rinja-rs__askama-1057": "Add  `elif` keyword\nHi,\r\n\r\nwe recently migrated from Tera to Askama and overall it was quite straightforward. One thing that did not work out of the box was the `elif` keyword, so it would be nice to include that. In addition, `elif` seems to be [supported by jinja](https://jinja.palletsprojects.com/en/3.1.x/templates/#if).\n",
    "rinja-rs__askama-1029": "Compilation error when using nested template blocks with in a single template file\nHello! I Encountered a compilation error when using[ block fragments](https://github.com/djc/askama/pull/824) with Vec<&str> in a single template file. The error does not occur when the template is split into separate files.\r\n\r\nThis is working like expected\r\n``` html\r\n{% block index %}\r\nSection 1: {{ s1 }}\r\n{% endblock %}\r\n\r\n{% block section %}\r\n  Value ={{ value }}\r\n{% endblock %}\r\n```\r\n\r\n``` rust\r\nuse askama::Template;\r\n\r\n#[derive(Template)]\r\n#[template(path = \"combain.txt\", block=\"index\")]\r\nstruct RenderInPlace<'a> {\r\n   s1: Section<'a>\r\n}\r\n\r\n#[derive(Template)]\r\n#[template(path = \"combain.txt\", block=\"section\")]\r\nstruct Section<'a> {\r\n   value: &'a str,\r\n}\r\nfn main() {\r\n    let value = \"x\";\r\n\r\n    let t = RenderInPlace { s1: Section { value } };\r\n    println!(\"{}\", t);\r\n}\r\n```\r\n``` sh\r\nSection 1: \r\n\r\n\r\n  Value =x\r\n```\r\n\r\nWhen changing to Vec for the value i get a compilation error..\r\n``` html \r\n{% block index %}\r\nSection 1: {{ s1 }}\r\n{% endblock %}\r\n\r\n{% block section %}\r\n  {% for value in  values %}\r\n    Value = {{ value }}\r\n  {% endfor %}\r\n{% endblock %}\r\n```\r\n``` rust\r\nuse askama::Template;\r\n\r\n#[derive(Template)]\r\n#[template(path = \"combain.txt\", block=\"index\")]\r\nstruct RenderInPlace<'a> {\r\n   s1: Section<'a>\r\n}\r\n\r\n#[derive(Template)]\r\n#[template(path = \"combain.txt\", block=\"section\")]\r\nstruct Section<'a> {\r\n   values: Vec<&'a str>,\r\n}\r\n\r\nfn main() {\r\n\r\n    let values: Vec<&str>= vec![\"a\", \"b\", \"c\"];\r\n\r\n    let t = RenderInPlace { s1: Section { values } };\r\n    println!(\"{}\", t);\r\n}\r\n\r\n```\r\n``` sh\r\nerror[E0609]: no field `value` on type `&Section<'a>`\r\n --> src/main.rs:9:10\r\n  |\r\n9 | #[derive(Template)]\r\n  |          ^^^^^^^^ unknown field\r\n  |\r\n  = note: this error originates in the derive macro `Template` (in Nightly builds, run with -Z macro-backtrace for more info)\r\n\r\n```\r\nHowever when i split the template file in two it is working as expected.\r\n`index.html`\r\n``` html\r\n{% block index %}\r\nSection 1: {{ s1 }}\r\n{% endblock %}\r\n```\r\n`section.html`\r\n``` html\r\n{% block section %}\r\n  {% for value in  values %}\r\n    Value ={{ value }}\r\n  {% endfor %}\r\n{% endblock %}\r\n```\r\n\r\n``` rust\r\nuse askama::Template;\r\n\r\n#[derive(Template)]\r\n#[template(path = \"index.txt\", block=\"index\")]\r\nstruct RenderInPlace<'a> {\r\n   s1: Section<'a>\r\n}\r\n\r\n#[derive(Template)]\r\n#[template(path = \"section.txt\", block=\"section\")]\r\nstruct Section<'a> {\r\n   values: Vec<&'a str>,\r\n}\r\n\r\nfn main() {\r\n\r\n    let values: Vec<&str>= vec![\"a\", \"b\", \"c\"];\r\n\r\n    let t = RenderInPlace { s1: Section { values } };\r\n    println!(\"{}\", t);\r\n}\r\n```\r\n```sh \r\nSection 1: \r\n  \r\n    Value =a\r\n  \r\n    Value =b\r\n  \r\n    Value =c\r\n  \r\n```\r\n\n",
    "tracel-ai__burn-2224": "NaN for `[N, C, 1, W]` interpolate inputs with bilinear and bicubic modes for burn-wgpu and burn-ndarray backends\n**Describe the bug**\r\nNaN values when the input tensor is `[N, C, 1, W]` shape. \r\n\r\n**To Reproduce**\r\n\r\n1. Enable `test_1d_bilinear` test in `crates/burn-tensor/src/tests/module/bilinear_interpolate.rs` and `test_1d_bicubic` in `crates/burn-tensor/src/tests/module/bilinear_interpolate.rs` which are ignored for now. (Copy of tests are in the comments)\r\n2. cd burn-wgpu && cargo test\r\n3. cd burn-ndarray && cargo test\r\n4. Enable `resize_with_scales_1d_linear` test in `crates/burn-import/onnx-tests/tests/onnx_tests.rs` which is ignored.\r\n\r\n**NOTE:**\r\n\r\nThese tests work under `burn-tch` and pytorch.\r\n\r\n\r\nRelated Issues:\r\n\r\n1. #1246\r\n2. #2081\r\n\n",
    "tracel-ai__burn-1902": "The `model.load_record()` method turns off the activation function during the forward pass\n**Describe the bug**\r\nThe `model.load_record()` method turns off the activation function during the forward pass.\r\n\r\n**To Reproduce**\r\n1. Initialize the model with the ReLU activation function.\r\n2. Perform a forward pass with input data before loading weights.\r\n3. Load the model weights using model.load_record(record).\r\n4. Perform a forward pass with input data after loading weights.\r\n5. Observe that the activation function is not applied as expected after loading the weights.\r\n```rust\r\nuse burn::{\r\n    backend::NdArray, \r\n    module::Module, \r\n    nn::{\r\n        conv::{Conv2d, Conv2dConfig}, \r\n        BatchNorm, BatchNormConfig, PaddingConfig2d, Relu\r\n    }, \r\n    tensor::{backend::Backend, Device, Tensor, Distribution, Shape},\r\n    record::{FullPrecisionSettings, Recorder}\r\n};\r\nuse burn_import::pytorch::{LoadArgs, PyTorchFileRecorder};\r\n\r\n\r\n#[derive(Module, Debug)]\r\npub struct RustCustomModel<B: Backend> {\r\n    conv: Conv2d<B>,\r\n    bn: BatchNorm<B, 2>,\r\n    relu: Option<Relu>,\r\n    activation: bool\r\n}\r\n\r\nimpl<B: Backend> RustCustomModel<B> {\r\n    pub fn new(activation: bool, device: &Device<B>) -> Self {\r\n\r\n        let conv: Conv2d<B> = Conv2dConfig::new([3, 64], [1, 1])\r\n            .with_stride([1, 1])\r\n            .with_padding(PaddingConfig2d::Explicit(1, 1))\r\n            .with_bias(false)\r\n            .init(device);\r\n        let bn: BatchNorm<B, 2> = BatchNormConfig::new(64).init(device);\r\n\r\n        let relu: Option<Relu> = if activation {Some(Relu::new())} else {None};\r\n        println!(\"init relu: {:?}\", relu);\r\n        Self {\r\n            conv,\r\n            bn,\r\n            relu,\r\n            activation\r\n        }\r\n    }\r\n\r\n    pub fn forward(&self, input: Tensor<B, 4>) -> Tensor<B, 4> {\r\n\r\n        let out: Tensor<B, 4> = self.conv.forward(input);\r\n        let out: Tensor<B, 4> = self.bn.forward(out);\r\n        println!(\"self.relu: {:?}\", self.relu);\r\n        if let Some(relu) = &self.relu{\r\n            println!(\"with activation\");\r\n            relu.forward(out)\r\n            } else {\r\n            println!(\"without activation\");\r\n            out\r\n        }\r\n    }\r\n}\r\n\r\nfn main() {\r\n    let device = Default::default();\r\n    \r\n    let model = RustCustomModel::<NdArray>::new(true, &device);\r\n    \r\n    let input_shape = Shape::new([1, 64, 56, 56]);\r\n    let input_tensor = Tensor::<NdArray, 4>::random(input_shape, Distribution::Default, &device);\r\n    \r\n    println!(\"\\n### before load weight ### \");\r\n    println!(\"input shape: {:?}\", input_tensor.shape());\r\n    let output_tensor = model.forward(input_tensor.clone());\r\n    println!(\"output shape: {:?}\", output_tensor.shape());\r\n    \r\n    println!(\"\\n### after load weight ###\");\r\n    let load_args = LoadArgs::new(\"model.pt\".into());\r\n    let record = PyTorchFileRecorder::<FullPrecisionSettings>::default()\r\n    .load(load_args, &device)\r\n    .expect(\"Should load PyTorch model weights\");\r\n    let model = model.load_record(record);\r\n\r\n    println!(\"input shape: {:?}\", input_tensor.shape());\r\n    let output_tensor = model.forward(input_tensor.clone());\r\n    println!(\"output shape: {:?}\", output_tensor.shape());\r\n\r\n}\r\n\r\n```\r\n\r\n**Expected behavior**\r\nThe activation function (ReLU) should be correctly applied during the forward pass both before and after loading the model weights.\r\n\r\n**Actual Behavior**:\r\nBefore loading the weights, the forward pass correctly applies the ReLU activation function. After loading the weights, the ReLU activation function is set to None, resulting in the forward pass running without the activation function.\r\n\r\n```diff\r\n// output log\r\ninit relu: Some(Relu)\r\n\r\n### before load weight ### \r\ninput shape: Shape { dims: [1, 64, 56, 56] }\r\n+ self.relu: Some(Relu)\r\n+ with activation\r\noutput shape: Shape { dims: [1, 64, 58, 58] }\r\n\r\n### after load weight ###\r\ninput shape: Shape { dims: [1, 64, 56, 56] }\r\n- self.relu: None\r\n- without activation\r\noutput shape: Shape { dims: [1, 64, 58, 58] }\r\n\r\n```\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: ubuntu 24.04\r\n - rustc 1.78.0 (9b00956e5 2024-04-29)\r\n```\r\n[dependencies]\r\nburn = { version = \"0.13.2\", features = [\"ndarray\"] }\r\nburn-import = { version = \"0.13.2\" }\r\n```\n",
    "tracel-ai__burn-923": "Autotune causes inaccurate estimated training time\nThe autotune mechanism runs many benchmarks at the beginning of a training execution, then the best operations are stored and used directly throughout the rest of the training. \r\n\r\nHowever, the estimated training time shown in the UI is computed with the time spent on the past iterations, times the number of remaining iterations. This is now inaccurate especially in the beginning (the estimation will be pessimistic), since the first iterations will likely take longer than the later ones because of autotune. \r\n\r\nSimple as it sounds, I think this will be non trivial to fix. Maybe at least it will be less blatant when #911 is implemented. \n",
    "tracel-ai__burn-888": "AdamW NaN\nWhen learning with AdamW, we get NaNs. \r\n\r\nI did not investigate in details, but we had a similar problem with Adam. \r\nI think it's related to a division by zero occurring because we start at time 0. In Adam we start at time 1 to fix that problem, but changing this value might have an incidence on the algorithm behaviour.\n",
    "tracel-ai__burn-815": "Dashboard shows wrong remaining time estimate when resuming from checkpoint\n**Describe the bug**\r\n<!-- A clear and concise description of what the bug is. -->\r\nResuming a training from a checkpoint will show the progress bar let's say at 25% and remaining time is not calculated based on the time per batch and number of batches remaining but rather it seems it is elapsed time and percentage of progress.\r\n\r\nFor a long training it is pretty easy to see.\r\n**To Reproduce**\r\n<!-- \r\n Steps to reproduce the behavior:\r\n 1. Go to '...'\r\n 2. Click on '....'\r\n 3. Scroll down to '....'\r\n 4. See error\r\n-->\r\nResume from checkpoint, estimate is wrong\r\n**Expected behavior**\r\n<!-- A clear and concise description of what you expected to happen. -->\r\nWhen resuming my training, I expected the estimate to be calculated to the same or very close to when I stopped it. An acceptable alternative would be for the estimate to converge quickly after a few seconds / minutes towards the actual ETA.\r\n**Screenshots**\r\n<!-- If applicable, add screenshots to help explain your problem. -->\r\n![image](https://github.com/burn-rs/burn/assets/6208924/6e843524-4cbd-48ff-97c7-abb8b57ae374)\r\nA single epoch takes a few hours. I resumed training about 20-30 minutes before screenshot.\n",
    "tracel-ai__burn-799": "How to use .clamp() with a generic backend?\nI fear I've probably missed something here, so a pointer in the right direction would be appreciated. As I understand it, we're supposed to define our model with just B: Backend, and only use a concrete definition in our entrypoint. We ran into trouble using .clamp() with this however - eg:\r\n\r\n```rust\r\nuse burn::backend::WgpuBackend;\r\nuse burn::tensor::backend::Backend;\r\nuse burn::tensor::{Data, Tensor};\r\n\r\nfn generic_code<B: Backend>() {\r\n    let tensor = Tensor::<B, 2>::from_data(Data::<f32, 2>::from([[2., 3.], [4., 5.]]).convert());\r\n    tensor.clamp(3., 4.);\r\n}\r\n\r\nfn main() {\r\n    generic_code::<WgpuBackend>();\r\n}\r\n```\r\n\r\ngives \r\n\r\n```\r\nerror[E0308]: arguments to this method are incorrect\r\n   --> src/main.rs:7:12\r\n    |\r\n7   |     tensor.clamp(3., 4.);\r\n    |            ^^^^^\r\n    |\r\nnote: expected associated type, found floating-point number\r\n```\r\n\r\nI can work around this by changing the the function to \r\n\r\n```rust\r\nfn generic_code<B: Backend<FloatElem = f32>() {\r\n```\r\n\r\nBut that means we're no longer completely backend-agonstic. Is there a better way?\n",
    "tracel-ai__burn-572": "Adaptive average pooling\nImplement adaptive average pooling in all backends. \r\n- [ ] ndarray\r\n- [ ] tch\r\n- [ ] wgpu\r\n- [ ] autodiff\n",
    "tracel-ai__burn-390": "Intermittent test failure\nCI has failed due to this error but it worked when restarted: \r\n\r\n```\r\nerror: test failed, to rerun pass `--lib`\r\n\r\nfailures:\r\n\r\n---- nn::transformer::decoder::tests::test_autoregressive_norm_last stdout ----\r\nthread 'nn::transformer::decoder::tests::test_autoregressive_norm_last' panicked at 'assertion failed: `(left == right)`\r\n  left: `[0.23948555, -1.4476444, 1.7394568, -0.37974617, -0.7028924, -0.4129355, -1.9158951, 0.5557, 1.1982789, 0.40759498, 0.06550879, 0.6530054, 0.096770726, -0.04666269, 1.3337429, -1.6876903, -0.40740308, -0.12567851, -0.7417101, 0.33780476, 2.0305002, -0.5805786, -1.112808, 0.90371263, -0.42485318, -1.6029015, 0.774434, -0.54886544, 0.43462497, -0.18808673, -2.1350539, 0.20949733, 0.87836653, 0.41200003, 0.7943648, 1.3964221, -0.16162446, 0.8851795, 1.745951, -1.2020794, -0.7502541, 0.5759191, -1.9597254, 0.059071593, 0.9495946, 0.63463026, -0.80792814, 0.031265542, -0.8413961, -1.1042768, 0.6303067, -1.8922045, 0.44333157, -0.24039328, -1.1531141, 0.4702631, 1.3636328, 0.12676455, 1.1119264, 1.0851598, -0.17424995, 0.091177955, 0.52813435, -2.269342, 0.7240235, 1.2046725, -1.5445613, 0.43560714, 1.3055882, -0.08621346, 0.2435217, -0.4583588, 0.17207853, 0.71333534, 1.3131536, -1.8801376, -1.7852423, 0.68362814, -0.06631981, 1.0313472, -0.47530693, -0.68399745, 0.096292794, 0.88116866, 0.9159162, 0.30998585, 1.8870828, -1.6558123, 0.27701497, -0.91328967, -1.6643143, 0.77425784, -0.114014834, -0.4628347, 0.47438326, 0.17162472, 0.3830775, -1.7981151, 1.4499048, -1.6079453, 1.0426321, -0.4928484, -0.70687276, -0.18113491, 0.69756544, -0.13894956, 1.2459149, 0.10677127, -1.2047524, -0.7041038, 0.7481061, -0.77757, -0.9965105, -0.5658682, -0.24453977, -0.19981912, 2.489774, 0.44647074, -0.02859344, 1.0374068, 0.23086856, 0.18305853, 1.7442065, -0.14733128, -2.0698054, -0.04084435, -0.86746764, 1.4469825, 0.21824387, -0.50633633, -0.93084013, 0.7392653, -0.6499252, 0.6358838, 1.3024436, -0.9860946, -0.40290937, 0.5891721, -1.7343421, 0.30868047, 2.050654, -0.6654694, -0.49161807, 0.043524742]`,\r\n right: `[0.23948555, -1.4476444, 1.7394568, -0.37974617, -0.7028924, -0.4129355, -1.9158951, 0.555783, 1.1982789, 0.40759498, 0.06550879, 0.6530054, 0.09677075, -0.046662606, 1.3337431, -1.6876905, -0.40740314, -0.12567848, -0.74171, 0.33780485, 2.0305, -0.58057874, -1.112808, 0.90371263, -0.42485303, -1.6029017, 0.7744845, -0.54886556, 0.4346251, -0.18808684, -2.1350539, 0.2094973, 0.8783665, 0.41199994, 0.794365, 1.3964226, -0.16162448, 0.8851795, 1.7459514, -1.2020794, -0.75025433, 0.5759191, -1.9597256, 0.059071384, 0.94959474, 0.63463026, -0.8079282, 0.031265605, -0.8413961, -1.1042768, 0.6303067, -1.8922045, 0.44333157, -0.24039328, -1.1531141, 0.4702631, 1.3636328, 0.12676455, 1.1119264, 1.0851598, -0.17424987, 0.09117803, 0.5281344, -2.269342, 0.7240236, 1.2046725, -1.5445613, 0.43560714, 1.3055882, -0.08621345, 0.2435217, -0.45835873, 0.1720786, 0.7133352, 1.3131536, -1.8801373, -1.7852426, 0.683628, -0.06631989, 1.0313474, -0.47530708, -0.6839973, 0.09629285, 0.88116825, 0.9159164, 0.30998558, 1.8870829, -1.6558119, 0.27701497, -0.9132897, -1.6643144, 0.77425784, -0.114014894, -0.46283472, 0.4743833, 0.17162453, 0.3830775, -1.7981151, 1.4499048, -1.6079453, 1.0426321, -0.4928484, -0.70687276, -0.18113491, 0.69756544, -0.13894956, 1.2459149, 0.10677127, -1.2047523, -0.7041039, 0.748106, -0.77757025, -0.9965105, -0.56586826, -0.24453977, -0.19981901, 2.4897742, 0.44647083, -0.028593497, 1.0374067, 0.23086847, 0.1830584, 1.7442065, -0.14733131, -2.0698054, -0.04084452, -0.8674678, 1.4469824, 0.2182439, -0.5063364, -0.9308399, 0.73926544, -0.6499253, 0.63588357, 1.3024436, -0.9860947, -0.40290907, 0.58917207, -1.7343421, 0.30868053, 2.0506537, -0.6654691, -0.49161795, 0.04352488]`', /home/runner/work/burn/burn/burn-tensor/src/tensor/data.rs:231:13\r\n\r\n\r\nfailures:\r\n    nn::transformer::decoder::tests::test_autoregressive_norm_last\r\n\r\ntest result: FAILED. 62 passed; 1 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.26s\r\n\r\nError: Process completed with exit code 101.\r\n\r\n```\n",
    "tracel-ai__burn-1682": "Support forward without a batch dimension\n### Feature description\r\nSupport forward without a batch dimension\r\n\r\n### Feature motivation\r\nLinear model import from pytorch cannot be used as it for example.\r\nImported model work with tensor of rank 1 but Burn Linear doesn't not support tensor of rank 1 at this time.\r\n\r\nAs discuted with @nathanielsimard on [discord.](https://discord.com/channels/1038839012602941528/1038839013735399547/1231624499653378049)\r\n\n",
    "tracel-ai__burn-1657": "Incorrect implementation of Transpose ONNX operation\n**Describe the bug**\r\n\r\nThis PR https://github.com/tracel-ai/burn/pull/546/files incorrectly implemented transpose operation. Instead of using permute operator, this uses transpose Burn operator which only flips last two dimensions. \r\n\n",
    "tracel-ai__burn-1188": "Support autotune of fused compute shaders\nWhen creating new shaders, we should be able to execute them with different launch options based on benchmarks performed by the autotune system.\n",
    "tracel-ai__burn-1087": "Autotune: benchmarks cached on disk\nThe autotune mechanism uses a cache to check if, for a specific operation on an input size within a specific range, the benchmarks have already been computed. If so, the fastest operation in that setting on your machine is stored in the cache and we just use this one. That way, it is likely only in the beginning of training/inference that we need to run benchmarks, and then the cache allows for reuse. \r\n\r\nHowever, the cache is stored in RAM, which means the benchmarks will be recomputed for every new execution, although they will likely reproduce the same results when run on the same machine. \r\n\r\nBy storing the cache and/or all benchmark results in a file on disk, we will avoid the computation of benchmarks at every execution. \r\n\r\nWe should invalidate the cache when the burn version is different.\r\nThe on disk key should be the autotune key + the device from the compute client.\n",
    "tracel-ai__burn-978": "Support for `count_include_pad=False` for AvgPool1d and AvgPool2d\n\r\n#### Description\r\n\r\nThe current implementation of the `AvgPool2d` layer in the Burn framework assumes that `count_include_pad=True`, meaning that zero-padding is included in the average pooling calculation. While this approach is valid and useful in some contexts, it can lead to limitations in flexibility and compatibility with other frameworks and standards.\r\n\r\n#### Proposal\r\n\r\nI propose adding a `count_include_pad` option to `AvgPool2dConfig`, with support for both `True` and `False` values. This change will allow users to configure whether or not padding is included in the average calculation, aligning more closely with common practices and standards in deep learning.\r\n\r\n#### Why is this Important?\r\n\r\n1. **Alignment with ONNX Specification**: The ONNX specification defaults to `count_include_pad=False` for average pooling. Aligning with this standard will enhance compatibility and make it easier for users to transfer models between Burn and other frameworks that adhere to the ONNX specification.\r\n\r\n2. **Increased Flexibility**: By offering both options, users can choose the behavior that best fits their specific use case and dataset. This can lead to better performance and more accurate results, depending on the context.\r\n\r\n3. **Avoiding Potential Issues**: Including padding in the average calculation (when not desired) might lead to down-weighting of actual feature values near the edges of the input. This can potentially result in a loss of information and a degradation in performance.\r\n\r\n#### Action Items\r\n\r\n1. [x] AvgPool1d in `core`\r\n2. [x] AvgPool2d in `core`\r\n3. [ ] AvgPool1d in `burn-import`\r\n4. [x] AvgPool2d in `burn-import`\r\n\r\n\r\n#### References\r\n1. [ONNX AveragePool](https://onnx.ai/onnx/operators/onnx__AveragePool.html#attributes)\r\n5. [AvgPool2d Pytorch](https://pytorch.org/docs/stable/generated/torch.nn.AvgPool2d.html)\r\n\n",
    "tracel-ai__burn-2186": "LayerNorm does not normalize its input correctly\n**Describe the bug**\r\nBoth from pytorch documentation...:\r\nhttps://pytorch.org/docs/stable/generated/torch.nn.LayerNorm.html#torch.nn.LayerNorm\r\n```\r\ny = (x \u2212 E[x]) / sqrt(Var[x] + \u03f5)\u2217\u03b3 + \u03b2\r\n```\r\n\r\n... and from pytorch ATen implementation...:\r\nhttps://github.com/pytorch/pytorch/blob/6564e746ed494505be5f65aa99f8cf1884bb6342/aten/src/ATen/native/cpu/layer_norm_kernel.cpp#L115\r\n```python\r\n  rstd_val = float(1) / std::sqrt(rstd_val + eps)\r\n```\r\n\r\n... they normalize by `sqrt(var + eps)`. Now if we take a look at burn...:\r\nhttps://github.com/tracel-ai/burn/blob/c29ed43441fc5b3286749816c9069ed90f178a77/crates/burn-core/src/nn/norm/layer.rs#L70\r\n\r\n... we normalize by `sqrt(var) + eps`, which leads to precision issues.\n",
    "tokio-rs__axum-1934": "Axum 0.6.15 seems to break ServeDir completely\n- [x] I have looked for existing issues (including closed) about this\r\n\r\n## Bug Report\r\n\r\n### Version\r\n\r\n`cargo tree | grep axum`\r\n```\r\naxum v0.6.15\r\n\u2502   \u251c\u2500\u2500 axum-core v0.3.4\r\n\u2502   \u251c\u2500\u2500 axum-core v0.3.4\r\n```\r\n`cargo tree | grep tower-http`\r\n```\r\ntower-http\r\n\u251c\u2500\u2500 tower-http v0.4.0\r\n```\r\n\r\n> Note: With axum `v0.6.12` the exact same code works as epxected\r\n\r\n\r\n### Platform\r\n\r\nApple MacBook Pro M1. \r\n\r\n### Crates\r\n\r\n\r\n### Description\r\n\r\nUsed to work with axum `v0.6.12`, but since I just updated to `v0.6.15` the `ServeDir` service does not work anymore. \r\n\r\nWith this kind of code:\r\n```rs\r\n\tlet routes_static =\r\n\t\tRouter::new().nest_service(\"/\", get_service(ServeDir::new(\"./\")));\r\n\r\n\tlet routes_all = Router::new().fallback_service(routes_static);\r\n\r\n\tlet addr = SocketAddr::from(([127, 0, 0, 1], 8080));\r\n\taxum::Server::bind(&addr)\r\n\t\t.serve(routes_all.into_make_service())\r\n\t\t.await\r\n\t\t.unwrap();\r\n```\r\n\r\nWhen doing a `GET` to a known path, like `/src/main.rs`\r\n\r\n```\r\nthread 'tokio-runtime-worker' panicked at 'assertion failed: matches!(extensions.remove :: < MatchedPath > (), None)', /Users/jeremychone/.cargo/registry/src/github.com-1ecc6299db9ec823/axum-0.6.15/src/extract/matched_path.rs:146:9\r\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\r\n```\r\n\r\nExpected result: as in `v0.6.12`\n",
    "tokio-rs__axum-1810": "TypedHeader shouldn't reject missing headers by default\n- [x] I have looked for existing issues (including closed) about this\r\n\r\n## Feature Request\r\n\r\nTypedHeader should allow specific Header type to handle missing headers instead of immediately rejecting the request.\r\n\r\n### Motivation\r\n\r\n`Header` trait already allows to decode headers from arbitrary iterators, including iterators with zero, one or more header value repetitions.\r\n\r\nSome `Header` implementations require their header value to be always present, in which case `Header::decode` will return an error anyway, while many other headers might be optional by design, in which case their `Header::decode` will correctly handle empty iterator and return some default parsed value (e.g. empty collection).\r\n\r\nHowever, right now axum's `TypedHeader` checks for header name's presence in the request and, if it's not there, immediately rejects the request, not giving those `Header::decode` implementation a chance to gracefully handle the empty case.\r\n\r\n### Proposal\r\n\r\nForward empty iterator to the `<H as Header>::decode` and use its result instead of immediately rejecting the request. This will correctly handle both mandatory headers (as those will still return an error) as well as optional ones.\r\n\r\n### Alternatives\r\n\r\nIf this is considered undesirable for some reason, another alternative could be to implement a custom extractor for `Option<TypedHeader<H>>`. It won't be ideal as the user will have to manually invoke `H::decode` again to get the correct default value, but might be less of a breaking change.\n",
    "tokio-rs__axum-1469": "`from_extractor` not compatible with `RequestBodyLimitLayer`\nI tried adding the `RequestBodyLimitLayer` to my application. This works for everything, except the routes that contain a layer built with `from_extractor`.\r\n\r\nMy `axum` version is `0.5.16`, `tower-http` is `0.3.4` and `rustc` is `1.63.0`.\r\n\r\n## A minimized example\r\n\r\nThis does not compile, but it does as soon as I comment out one of the two `layer` lines.\r\n\r\n```rust\r\nuse async_trait::async_trait;\r\nuse axum::{\r\n    extract::{FromRequest, RequestParts},\r\n    middleware::from_extractor,\r\n    response::Html,\r\n    routing::get,\r\n    Router,\r\n};\r\nuse std::{convert::Infallible, net::SocketAddr};\r\nuse tower_http::limit::RequestBodyLimitLayer;\r\n\r\n#[tokio::main]\r\nasync fn main() {\r\n    let app = Router::new()\r\n        .layer(from_extractor::<MyExtractor>())\r\n        .layer(RequestBodyLimitLayer::new(1))\r\n        .route(\"/\", get(handler));\r\n\r\n    let addr = SocketAddr::from(([127, 0, 0, 1], 3000));\r\n    axum::Server::bind(&addr)\r\n        .serve(app.into_make_service())\r\n        .await\r\n        .unwrap();\r\n}\r\n\r\nasync fn handler() -> Html<&'static str> {\r\n    Html(\"<h1>Hello, World!</h1>\")\r\n}\r\n\r\nstruct MyExtractor;\r\n\r\n#[async_trait]\r\nimpl<B> FromRequest<B> for MyExtractor\r\nwhere\r\n    B: Send,\r\n{\r\n    type Rejection = Infallible;\r\n\r\n    async fn from_request(req: &mut RequestParts<B>) -> std::result::Result<Self, Self::Rejection> {\r\n        todo!()\r\n    }\r\n}\r\n```\r\n## The Error Message\r\n\r\n```\r\nerror[E0277]: the trait bound `http_body::limited::Limited<_>: Default` is not satisfied\r\n   --> src/main.rs:15:16\r\n    |\r\n15  |         .layer(from_extractor::<MyExtractor>())\r\n    |          ----- ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ the trait `Default` is not implemented for `http_body::limited::Limited<_>`\r\n    |          |\r\n    |          required by a bound introduced by this call\r\n    |\r\n    = help: the trait `tower_service::Service<Request<ReqBody>>` is implemented for `ExtractorMiddleware<S, E>`\r\n    = note: required for `ExtractorMiddleware<Route<http_body::limited::Limited<_>>, MyExtractor>` to implement `tower_service::Service<Request<http_body::limited::Limited<_>>>`\r\nnote: required by a bound in `Router::<B>::layer`\r\n   --> /home/hak/.cargo/registry/src/github.com-1ecc6299db9ec823/axum-0.5.16/src/routing/mod.rs:305:50\r\n    |\r\n305 |         L::Service: Service<Request<NewReqBody>, Response = Response<NewResBody>, Error = Infallible>\r\n    |                                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ required by this bound in `Router::<B>::layer`\r\n\r\nFor more information about this error, try `rustc --explain E0277`.\r\n```\r\n\n",
    "tokio-rs__axum-3059": "into_make_service_with_connect_info not compile anymore\n<!--\r\nThank you for reporting an issue.\r\n\r\nPlease fill in as much of the template below as you're able.\r\n-->\r\n\r\nafter this PR https://github.com/tokio-rs/axum/pull/2941\r\n\r\nwith `tap_io` called on `listener`, \r\n\r\n`axum::serve(listener, app.into_make_service_with_connect_info::<SocketAddr>()).await.unwrap();`   not compile anymore\r\n \r\nif comment out the tap_io call, it will pass the compilation\r\n\r\n```rust\r\n        /*.tap_io(|tcp_stream| {\r\n            if let Err(err) = tcp_stream.set_nodelay(true) {\r\n                eprintln!(\"failed to set TCP_NODELAY on incoming connection: {err:#}\");\r\n            }\r\n        })*/;\r\n```\r\n\r\n- [x] I have looked for existing issues (including closed) about this\r\n\r\n## Bug Report\r\n\r\n### Version\r\n\r\nmain branch\r\n\r\n### Platform\r\n\r\nlinux\r\n\r\n### Crates\r\n\r\n<!--\r\nIf known, please specify the affected axum crates. Otherwise, delete this\r\nsection.\r\n-->\r\n\r\n### Description\r\n\r\nI tried this code:\r\n\r\n```rust\r\nuse axum::{response::Html, routing::get, Router};\r\nuse axum::extract::connect_info::ConnectInfo;\r\nuse axum::serve::ListenerExt;\r\nuse std::net::SocketAddr;\r\n\r\n#[tokio::main]\r\nasync fn main() {\r\n    // build our application with a route\r\n    let app = Router::new().route(\"/\", get(handler));\r\n\r\n    // run it\r\n    let listener = tokio::net::TcpListener::bind(\"127.0.0.1:3000\")\r\n        .await\r\n        .unwrap();\r\n    println!(\"listening on {}\", listener.local_addr().unwrap());\r\n\r\n    let listener = listener\r\n        .tap_io(|tcp_stream| {\r\n            if let Err(err) = tcp_stream.set_nodelay(true) {\r\n                eprintln!(\"failed to set TCP_NODELAY on incoming connection: {err:#}\");\r\n            }\r\n        });\r\n\r\n    axum::serve(listener, app.into_make_service_with_connect_info::<SocketAddr>()).await.unwrap();\r\n}\r\n\r\nasync fn handler(ConnectInfo(addr): ConnectInfo<SocketAddr>) -> Html<String> {\r\n    Html(format!(\"<h1>Hello, World! {}</h1>\", addr))\r\n}\r\n```\r\n\r\ncargo\r\n\r\n```toml\r\n[package]\r\nname = \"axum-connection-info\"\r\nversion = \"0.1.0\"\r\nedition = \"2021\"\r\n\r\n[dependencies]\r\naxum = { git = \"https://github.com/tokio-rs/axum\", branch = \"main\" }\r\ntokio = { version = \"1.41.1\", features = [\"full\"] }\r\n```\r\n\r\n---------------------------------------------------\r\n\r\n92 | pub fn serve<L, M, S>(listener: L, make_service: M) -> Serve<L, M, S>\r\n   |        ----- required by a bound in this function\r\n...\r\n95 |     M: for<'a> Service<IncomingStream<'a, L>, Error = Infallible, Response = S>,\r\n   |        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ required by this bound in `serve`\r\n\r\nerror[E0277]: `Serve<TapIo<TcpListener, {closure@main.rs:18:17}>, IntoMakeServiceWithConnectInfo<..., ...>, ...>` is not a future\r\n  --> src/main.rs:24:84\r\n   |\r\n24 |     axum::serve(listener, app.into_make_service_with_connect_info::<SocketAddr>()).await.unwrap();\r\n   |     -------------------------------------------------------------------------------^^^^^\r\n   |     |                                                                             ||\r\n   |     |                                                                             |`Serve<TapIo<TcpListener, {closure@main.rs:18:17}>, IntoMakeServiceWithConnectInfo<..., ...>, ...>` is not a future\r\n   |     |                                                                             help: remove the `.await`\r\n   |     this call returns `Serve<TapIo<tokio::net::TcpListener, {closure@src/main.rs:18:17: 18:29}>, IntoMakeServiceWithConnectInfo<Router, std::net::SocketAddr>, AddExtension<Router, ConnectInfo<std::net::SocketAddr>>>`\r\n\r\n\r\n\n",
    "tokio-rs__axum-3051": "Consider disallowing root nesting\nBefore the 0.8.0 release, I would like to come back to `nest(\"/\", router)` and `nest_service(\"/\", svc)`. I believe I suggested disallowing them (in favor of `merge` and `fallback_service`) before, but if so there must have been some pushback by David since we still allow both.\n\nAny pointers or thoughts appreciated. \n",
    "tokio-rs__axum-3039": "Hit unreachable code when deserializing a [char; 2] inside Path\n### Description\r\n\r\nHi, I used this struct inside a `Path`\r\n```\r\n#[derive(Debug, Deserialize)]\r\nstruct MoreChars {\r\n    first_two: [char; 2],\r\n    second_two: [char; 2],\r\n    crate_name: String,\r\n}\r\n```\r\n\r\nwith the route `.route(\"/:first_two/:second_two/:crate_name\", get(handler::<MoreChars>))`\r\nand upon extraction of the path it hit unreachable code inside `deserialize_tuple` for `Path`\r\n\r\nI was hoping to only hit that when the first path element is 2 characters long\r\nCan't say much more about that, I guess that's my report.\r\n\r\nAxum version: 0.7.9\r\n\n",
    "tokio-rs__axum-2992": "`Event::json_data` can construct an invalid SSE event by passing a `serde_json::value::RawValue`\n<!--\r\nThank you for reporting an issue.\r\n\r\nPlease fill in as much of the template below as you're able.\r\n-->\r\n\r\n- [x] I have looked for existing issues (including closed) about this\r\n\r\n## Bug Report\r\n\r\nWhen using `Event::json_data` with a `serde_json::value::RawValue` it is possible to construct an invalid SSE event.\r\nThis happens because `RawValue` will also capture newlines between object entries as it only validates that the bytes are valid json.\r\nThis means that the string `\"{\\n\\\"foo\\\":\\\"bar\\\"}\"` when deserialized into a `RawValue` and serialized with `Event::json_data` will not be parsed correctly as internally it gets written to the buffer using `serde_json::to_writer`.\r\n\r\n### Reproduction\r\n\r\nLooking at the output of `dbg!` of the bytes should be enough to see the issue but I thought I would verify it again using a SSE parsing lib. \r\n\r\n```rs\r\n//! ```cargo\r\n//! [dependencies]\r\n//! axum = \"0.7\"\r\n//! eventsource-stream = \"0.2\"\r\n//! serde_json = { version = \"1\", features = [\"raw_value\"]}\r\n//! futures = \"0.3\"\r\n//! ```\r\n\r\nuse axum::response::{sse::Event, IntoResponse, Sse};\r\nuse eventsource_stream::Eventsource;\r\nuse futures::TryStreamExt;\r\nuse serde_json::value::RawValue;\r\nuse std::error::Error;\r\n\r\nfn main() -> Result<(), Box<dyn Error>> {\r\n    let data = \"{\\n\\\"foo\\\":\\\"bar\\\"}\";\r\n    let var_name = serde_json::from_str::<Box<RawValue>>(data)?;\r\n    let valid_event = Event::default().data(var_name.get());\r\n    let invalid_event = Event::default().json_data(&var_name)?;\r\n    let stream = Sse::new(futures::stream::iter([\r\n        Ok::<_, std::convert::Infallible>(valid_event),\r\n        Ok(invalid_event),\r\n    ]))\r\n    .into_response()\r\n    .into_body()\r\n    .into_data_stream()\r\n    .inspect_ok(|b| {\r\n        dbg!(String::from_utf8_lossy(b.as_ref()));\r\n    })\r\n    .eventsource();\r\n    let events = futures::executor::block_on(stream.try_collect::<Vec<_>>())?;\r\n    for e in events {\r\n        assert_eq!(\r\n            serde_json::from_str::<serde_json::Value>(&dbg!(e.data))?,\r\n            serde_json::from_str::<serde_json::Value>(data)?\r\n        );\r\n    }\r\n    Ok(())\r\n}\r\n```\r\n\r\n## Solutions\r\n\r\n1. Document that all use (also nested) of `serde_json::value::RawValue` could lead to invalid Events (easy)\r\n2. Internally use `serde_json::to_string` instead and than call to `Event::data` which will split the newlines correctly into multiple data fields. (Slow)\r\n3. Continue using `serde_json::to_writer` but wrap buffer in some custom writer which will skip newlines which should be fine as newlines are guaranteed to be escaped in json strings. (should be pretty fast still)\r\n\r\nI would be interested in making a PR for 3. if that is the desired solution.\r\n\n",
    "tokio-rs__axum-2903": "Add a method-not-allowed fallback on the Router level\n- [x] I have looked for existing issues (including closed) about this\r\n\r\n## Feature Request\r\n\r\n### Motivation\r\n\r\nIt's a common mistake to expect `Router::fallback` to be triggered on method-not-allowed.\r\nFurthermore, as shown by [#1005](https://github.com/tokio-rs/axum/issues/1005), it is pretty easy to misinterpret the current behavior for a bug.\r\nWhile returning HTTP 405 is normal in this case, it would be helpful to have a simple baked-in solution to handle it,  in a way similar to fallback.\r\n\r\n### Proposal\r\n\r\nAdd a `Router::method_not_allowed_fallback` method that allows defining a fallback for this specific situation\r\n\r\n#### Usage\r\n\r\n```rust\r\nuse std::net::SocketAddr;\r\n\r\nuse axum::{routing::get, Router, response::IntoResponse};\r\nuse hyper::Server;\r\n\r\nasync fn hello_world() -> impl IntoResponse {\r\n    \"Hello, world!\\n\"\r\n}\r\n\r\nasync fn default_fallback() -> impl IntoResponse {\r\n    \"Default fallback\\n\"\r\n}\r\n\r\nasync fn handle_405() -> impl IntoResponse {\r\n    \"Method not allowed fallback\"\r\n}\r\n\r\n#[tokio::main]\r\nasync fn main() -> Result<(), hyper::Error> {\r\n    let router = Router::new()\r\n        .route(\"/\", get(hello_world))\r\n        .fallback(default_fallback)\r\n        .method_not_allowed_fallback(handle_405);\r\n\r\n    let addr = SocketAddr::from(([127, 0, 0, 1], 3000));\r\n\r\n    Server::bind(&addr).serve(router.into_make_service()).await\r\n}\r\n```\r\n\r\n### Alternatives\r\n\r\nAn included middleware such as `MethodNotAllowedLayer(fallback: Handler)`.\r\n\r\n#### Usage\r\n\r\n```rust\r\nuse std::net::SocketAddr;\r\n\r\nuse axum::{response::IntoResponse, routing::get, Router, middleware::MethodNotAllowedLayer};\r\nuse hyper::Server;\r\n\r\nasync fn hello_world() -> impl IntoResponse {\r\n    \"Hello, world!\\n\"\r\n}\r\n\r\nasync fn default_fallback() -> impl IntoResponse {\r\n    \"Default fallback\\n\"\r\n}\r\n\r\nasync fn handle_405() -> impl IntoResponse {\r\n    \"Method not allowed fallback\"\r\n}\r\n\r\n#[tokio::main]\r\nasync fn main() -> Result<(), hyper::Error> {\r\n    let router = Router::new()\r\n        .route(\"/\", get(hello_world))\r\n        .layer(MethodNotAllowedLayer(handle_405))\r\n        .fallback(default_fallback);\r\n\r\n    let addr = SocketAddr::from(([127, 0, 0, 1], 3000));\r\n\r\n    Server::bind(&addr).serve(router.into_make_service()).await\r\n}\r\n```\r\n\r\n\r\nAnyway, I think it would be great to mention this topic in the `Router::fallback` documentation.\n",
    "tokio-rs__axum-868": "HTTP Status on Invalid JSON Request\nWhen I send a request where the `content-type` is not `application/json` I get the answer `415 Unsupported Media Type` and if the JSON parsing fails I get `422 Unprocessable Entity`\r\n\r\nTwo issues:\r\n\r\n1. This is not documented correctly: https://docs.rs/axum/latest/axum/struct.Json.html In this documentation both of them would result in `400 Bad Request`\r\n\r\n2. `422 Unprocessable Entity` seems to be part of an HTTP extension intended for WebDAV. Is it appropriate to use this in a non-WebDAV server?\r\n\r\n3. The description of `422 Unprocessable Entity` https://datatracker.ietf.org/doc/html/rfc4918#section-11.2 says that this should be used for syntactically correct, but semantically wrong requests. I also get that with a syntactically wrong JSON like `}`\n",
    "tokio-rs__axum-755": "Incorrect `content-length` header in reply to HEAD request when chunked transfer enconding is used\n## Bug Report\r\n\r\nThis is a followup to #730. Unfortunately, I found a case in which it still does not work correctly.\r\n\r\n### Version\r\n\r\naxum main branch, commit 16ee83a\r\n\r\n### Platform\r\n\r\nDebian Linux 12 (\u201cbookworm\u201d)\r\nLinux feynman 5.15.0-3-amd64 <span>#</span>1 SMP Debian 5.15.15-1 (2022-01-18) x86_64 GNU/Linux\r\nrustc 1.58.1 (db9d1b20b 2022-01-20)\r\n\r\n### Description\r\n\r\nThe `content-length` header in the reply to a simple `HEAD` request is set to 0 if the corresponding `GET` request uses `transfer-encoding: chunked`.\r\n\r\n#### Steps to reproduce\r\n\r\nRun the example program (which uses tower-http v0.2.1):\r\n\r\n```rust\r\nuse axum::{routing::get, Router};\r\nuse tower_http::compression::{predicate::SizeAbove, CompressionLayer};\r\n\r\n#[tokio::main]\r\nasync fn main() {\r\n    let app = Router::new()\r\n        .route(\"/\", get(|| async { \"Hello, World!\" }))\r\n        .layer(CompressionLayer::new().compress_when(SizeAbove::new(0)));\r\n    axum::Server::bind(&\"0.0.0.0:3000\".parse().unwrap())\r\n        .serve(app.into_make_service())\r\n        .await\r\n        .unwrap();\r\n}\r\n```\r\n\r\nSend a HTTP/1.1 `HEAD` request for /. Set the `accept-encoding` request header to `gzip`. I used the the following command on the Linux command line:\r\n\r\n```sh\r\nprintf 'HEAD / HTTP/1.1\\r\\naccept-encoding: gzip\\r\\n\\r\\n' | nc 127.0.0.1 3000\r\n```\r\n\r\n#### Observed behavior\r\n\r\nThe output contains the line:\r\n\r\n```\r\ncontent-length: 0\r\n```\r\n\r\n#### Expected behavior\r\n\r\nThe output contains no `content-length` header.\r\n\r\nNote the response to the corresponding `GET` request uses chunked transfer encoding. Its headers look like this:\r\n\r\n```\r\nHTTP/1.1 200 OK\r\ncontent-type: text/plain; charset=utf-8\r\ncontent-encoding: gzip\r\ntransfer-encoding: chunked\r\ndate: Sun, 06 Feb 2022 16:03:44 GMT\r\n```\n",
    "tokio-rs__axum-682": "Use HTTP 308 instead of 301 for trailing slash redirects\n## Feature Request\r\n\r\n### Motivation\r\n\r\nPerforming a POST to `/some/url/` (with the trailing slash) does an HTTP 301 (introduced in #410) to `/some/url`. However, HTTP 301 transforms a POST to a GET, which is undesired.\r\n\r\n### Proposal\r\n\r\nUse [HTTP 308](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/308) instead, as suggested by @jplatte.\r\n\r\n### Alternatives\r\n\r\nI could change my route to accept both GET and POST (which is what my previous web server did by default \ud83d\ude3f) \n",
    "tokio-rs__axum-533": "Rename `box_body` to `boxed`\nAs its consistent with `http_body::Body::boxed`.\r\n\r\nWill be deprecated in 0.3.4 and removed in 0.4\n",
    "tokio-rs__axum-530": "Rename `box_body` to `boxed`\nAs its consistent with `http_body::Body::boxed`.\r\n\r\nWill be deprecated in 0.3.4 and removed in 0.4\n",
    "tokio-rs__axum-529": "Panic if merging two routers that each have a fallback\nCurrently when you `Router::merge` two routes that each have a fallback it'll pick the fallback of the router on the right hand side, and if only one has a fallback it'll pick that one. This might lead users to think that multiple fallbacks are supported (see https://github.com/tokio-rs/axum/discussions/480#discussioncomment-1601938), which it isn't.\r\n\r\nI'm wondering if, in 0.4, we should change it such that merging two routers that each have a fallback causes a panic telling you that multiple fallbacks are not supported. This would also be consistent with the general routing which panics on overlapping routes.\r\n\r\nThe reason multiple fallbacks are not allowed is that `Router` tries hard to merge all your routes in one `matchit::Node` rather than nesting them somehow. This leads to significantly nicer internals and better performance.\r\n\r\n@jplatte what do you think?\n",
    "tokio-rs__axum-423": "First parameterized path component stripped from logs\n## Bug Report\r\n\r\n<!--\r\nThank you for reporting an issue.\r\n\r\nPlease fill in as much of the template below as you're able.\r\n-->\r\n\r\n\r\n### Version\r\n\r\n<!--\r\nList the versions of all `axum` crates you are using. The easiest way to get\r\nthis information is using `cargo tree`:\r\n\r\n`cargo tree | grep axum`\r\n-->\r\naxum v0.3.0 (https://github.com/tokio-rs/axum.git?rev=9b17d86b92006d39e6c97acb80206c4e010c3f91#9b17d86b)\r\n\r\n### Platform\r\n\r\n<!---\r\nOutput of `uname -a` (UNIX), or version and 32 or 64-bit (Windows)\r\n-->\r\nDarwin 20.6.0 Darwin Kernel Version 20.6.0: Mon Aug 30 06:12:21 PDT 2021; root:xnu-7195.141.6~3/RELEASE_X86_64 x86_64\r\n\r\n### Description\r\n\r\nWhen having multiple nested and parameterized routes, the logging output seems to swallow the first parameterized path component.\r\n\r\nA trimmed version of my router looks as follows:\r\n```rust\r\nRouter::new()\r\n    .nest(\r\n        \"/:user\",\r\n        Router::new()\r\n            .nest(\r\n                \"/:repo\",\r\n                Router::new()\r\n                    .route(\r\n                        \"/settings\",\r\n                        get(handlers::repo::settings).post(handlers::repo::settings_post),\r\n                    )\r\n                    .route(\"/\", get(handlers::repo::index)),\r\n            )\r\n        .route(\r\n            \"/settings\",\r\n            get(handlers::user::settings).post(handlers::user::settings_post),\r\n        )\r\n        .route(\"/\", get(handlers::user::index)),\r\n    )\r\n    .route(\"/login\", get(handlers::login))\r\n    .route(\"/\", get(handlers::index))\r\n```\r\n\r\nIf I go to the following routes, the logs outputs:\r\n- `/user1/repo1/settings` -> `/repo1/settings`\r\n- `/user1/settings` -> `/settings`\r\n- `/user1` -> `/`\r\n- `/login` -> `/login`\r\n- `/` -> `/`\r\n\r\nSo interestingly only the very first parameter `:user` is stripped and if there are more parameters like `:repo` they show up in the logs.\r\n\r\nOnly parameters seem to be affected, if I go to `/login` it shows properly in the logs.\r\n\r\n<!--\r\nEnter your issue details below this comment.\r\n\r\nOne way to structure the description:\r\n\r\n<short summary of the bug>\r\n\r\nI tried this code:\r\n\r\n<code sample that causes the bug>\r\n\r\nI expected to see this happen: <explanation>\r\n\r\nInstead, this happened: <explanation>\r\n-->\r\n\n",
    "tokio-rs__axum-412": "Allow access to matched route pattern(s) from middlewares\n## Feature Request\r\n\r\nAs far as I can tell it's not possible to access information about if a route matched and if so, which route pattern (or patterns in case of nested routes) was matched. This is something a lot of services in environments I've worked needs.\r\n\r\nI could implement my own router (cue Bender quote), but I think this would be a common enough use case for production services that it would be valuable to have in the standard router.\r\n\r\n### Motivation\r\n\r\nI'm trying to create a minimal web server that does nothing of importance, but does it while serving up request logs and metrics in a particular format.\r\n\r\nMy sample server exposes two endpoints, `/api/hello/:name` and `/prometheus`. The first just returns `format!(\"Hello, {}!\", name)`, and the second returns application metrics.\r\n\r\nIn this service, I would use the pattern for my logs (currently emitting `tracing::info!` events, probably with the path parameters at separate keys) and in the request metrics (currently using `opentelemetry` and Prometheus)\r\n\r\nCurrently I log and split the metrics on the full path, but doing that with any sort of cardinality on the path parameters won't scale.\r\n\r\nI'm looking to create collapsed metrics like eg.\r\n```\r\nhttp_server_requests_seconds_count{method=\"GET\",status=\"200\",uri=\"/api/hello/:name\"} 4\r\n...\r\n```\r\ninstead of my current\r\n```\r\nhttp_server_requests_seconds_count{method=\"GET\",status=\"200\",uri=\"/api/hello/world\"} 1\r\nhttp_server_requests_seconds_count{method=\"GET\",status=\"200\",uri=\"/api/hello/foo\"} 1\r\nhttp_server_requests_seconds_count{method=\"GET\",status=\"200\",uri=\"/api/hello/bar\"} 1\r\nhttp_server_requests_seconds_count{method=\"GET\",status=\"200\",uri=\"/api/hello/fnord\"} 1\r\n...\r\n```\r\n\r\nIn addition I would like the ability to separate a \"404\" that was due to no route matching and a \"404\" due to a particular resource identified by parameters, so I can have metrics (and corresponding logs) like so:\r\n```\r\nhttp_server_requests_seconds_count{method=\"GET\",status=\"404\",uri=\"\"} 1\r\nhttp_server_requests_seconds_count{method=\"GET\",status=\"404\",uri=\"/api/hello/:name\"} 1\r\n...\r\n```\r\n\r\nSample server source code here: https://github.com/gsson/mini-web-rs/tree/axum-issue-386 (see `meter_layer.rs`)\r\n\r\n### Proposal\r\n\r\nI think it would be useful to use the matched route pattern as attributes in logs, request metrics and such. The absence of a matched pattern in the case of 404s is similarly useful to distinguish a missed route from a missing resource.\r\n\r\nI guess attaching a public extension to the request/response would do the trick, but I'm still an Axum noob.\r\n\n",
    "tokio-rs__axum-1189": "Add an example for a GET-or-HEAD handler that special-cases HEAD\nRegistering a `GET` route also registers a `HEAD` route that calls the same handler. axum will strip the response body if this handler is called with `HEAD`, but that is potentially much slower than never generating a response body in the first place. We should have an example with a handler that uses `http::Method` as an extractor and checks its value to decide whether to build a response with or without a body.\n",
    "tokio-rs__axum-892": "`Router::into_make_service_with_connect_info()` has unnecessary `Target` parameter that can fail to be inferred\n## Bug Report\r\n\r\n### Version\r\n\r\naxum 0.4.8\r\n\r\n### Crates\r\n\r\naxum\r\n\r\n### Description\r\n\r\n[`Router::into_make_service_with_connect_info()`](https://docs.rs/axum/0.4.8/axum/struct.Router.html#method.into_make_service_with_connect_info)[^1] has a method signature\r\n\r\n[^1]: Also [`Handler::into_make_service_with_connect_info()`](https://docs.rs/axum/0.4.8/axum/handler/trait.Handler.html#method.into_make_service_with_connect_info). I will only focus on `Router` here though.\r\n\r\n```rust\r\npub fn into_make_service_with_connect_info<C, Target>(\r\n    self\r\n) -> IntoMakeServiceWithConnectInfo<Self, C>\r\nwhere\r\n    C: Connected<Target>\r\n```\r\n\r\nThe `Target` parameter here only serves to ensure that `C` implements some `Connected<Target>`. From the sample in that docs, expected usage looks like\r\n\r\n```rust\r\napp.into_make_service_with_connect_info::<SocketAddr, _>()\r\n```\r\n\r\nThe problem is, the second parameter can only be omitted if the `C` type only implements `Connected` for one single connection type. As soon as you have one `C` that implements `Connected` for multiple targets, that parameter needs to be specified explicitly. This is very annoying.\r\n\r\nIt's also unnecessary. [`IntoMakeServiceWithConnectInfo`](https://docs.rs/axum/0.4.8/axum/extract/connect_info/struct.IntoMakeServiceWithConnectInfo.html#) already only implements `Service<T> where C: Connected<T>`. Which means the bound on `into_make_service_with_connect_info()` isn't necessary for correctness. It probably does produce a better error message when the wrong type is used, but having to write out the connection type is frustrating, especially since I can write the wrong connection type on that method and it will still compile as long as my `C` type still implements `Connected` for the correct connection (i.e. I can write `app.into_make_service_with_connect_info::<SocketAddr, &'_ AddrStream>()` even though I'm using a different custom stream type for my actual server as long as `SocketAddr: Connected<&'_ MyCustomStream>`).\r\n\r\nI'm not really sure why this bound exists here. axum generally defers bounds until the point at which they're absolutely necessary, it's usually possible to construct a type with the wrong parameters only to have it fail to implement the right trait as a result, so it's surprising to me that `into_make_service_with_connect_info()` bothers with this bound.\r\n\r\n#### Proposed solution\r\n\r\nRemove the `C: Connected<Target>` bound on `into_make_service_with_connect_info()`. The resulting type will still enforce this bound on its `Service` impl. The type parameter has to go as well. Unfortunately it looks like Rust doesn't allow defaulted type parameters on methods (?!?) so we can't just leave it unused with a default, which does mean this is backwards-incompatible.\r\n\r\n#### Alternative solution\r\n\r\nAdd the `Target` parameter as an actual parameter of `IntoMakeServiceWithConnectInfo` and only implement `Service` in terms of that instead of making it generic. This way the call to `Server::serve(app)` will infer that type parameter if it's otherwise ambiguous. The downside is now the same `IntoMakeServiceWithConnectInfo` can no longer be used with different connection types. It's also backwards-incompatible so I don't think there's any benefit to this approach.\n",
    "tokio-rs__axum-2881": "add means to find the socket address for Serve and WithGracefulShutdown\n- [*] I have looked for existing issues (including closed) about this\r\n\r\n## Feature Request\r\n\r\nI would like to get the socket address of `Serve` and `WithGracefulShutdown`.\r\n\r\n### Motivation\r\n\r\nI am the maintainer of Axum Test, and the initial motivation behind this is to help with testing servers that have been gracefully shutdown. The way Axum Test works is by having a `TestServer`, and one passes in a `Router` or a `IntoMakeService`, and the `TestServer` then sets that up to be served.\r\n\r\nThis is relevant, as it means a developer cannot call `Serve::with_graceful_shutdown` before passing their application into a `TestServer`.\r\n\r\nI can extend my code to allow that. However I need to know what address the `Serve` is running on, in order to then make requests to it. Ideally I'd like to be able to just get it from `Serve` directly.\r\n\r\n### Proposal\r\n\r\nI'd propose to add the methods `Serve::local_addr` and `WithGracefulShutdown::local_addr`. This is pretty simple to do, and the code would be something like:\r\n\r\n```rust\r\n#[cfg(all(feature = \"tokio\", any(feature = \"http1\", feature = \"http2\")))]\r\nimpl<M, S> Serve<M, S> {\r\n    pub fn local_addr(&self) -> io::Result<std::net::SocketAddr> {\r\n        self.tcp_listener.local_addr()\r\n    }\r\n}\r\n\r\nimpl<M, S, F> WithGracefulShutdown<M, S, F> {\r\n    pub fn local_addr(&self) -> io::Result<std::net::SocketAddr> {\r\n        self.tcp_listener.local_addr()\r\n    }\r\n}\r\n```\r\n\r\nI would be happy to make a PR for this myself if there is interest.\r\n\r\n### Alternatives\r\n\r\nCould offer a means to expose the `TcpListener`.\r\n\r\nAnother alternative could be to move the `with_graceful_shutdown` to be attached earlier, before calling `serve`. This would make it separate to what the service is listening to, and could also solve my issue (although this would be a large and breaking API change).\n",
    "biomejs__biome-2324": "\ud83d\udcce Implement `lint/noFlatMapIdentity` - `clippy/flat_map_identity`\n### Description\n\nImplement [flat_map_identity](https://rust-lang.github.io/rust-clippy/master/#/flat_map_identity).\r\n\r\n**Want to contribute?** Lets you know you are interested! We will assign you to the issue to prevent several people to work on the same issue. Don't worry, we can unassign you later if you are no longer interested in the issue! Read our [contributing guide](https://github.com/biomejs/biome/blob/main/CONTRIBUTING.md) and [analyzer contributing guide](https://github.com/biomejs/biome/blob/main/crates/biome_analyze/CONTRIBUTING.md).\r\n\r\nYou can use the implementation of [useFlatMap](https://biomejs.dev/linter/rules/use-flat-map/) as a staring point.\n",
    "biomejs__biome-2317": "\ud83d\udc1b In Svelte context=module Scripts error \"import { type x ident }' are a TypeScript only feature.\"\n### Environment information\n\n```block\nCLI:\r\n  Version:                      1.6.3\r\n  Color support:                true\r\n\r\nPlatform:\r\n  CPU Architecture:             aarch64\r\n  OS:                           macos\r\n\r\nEnvironment:\r\n  BIOME_LOG_DIR:                unset\r\n  NO_COLOR:                     unset\r\n  TERM:                         \"xterm-256color\"\r\n  JS_RUNTIME_VERSION:           \"v20.11.1\"\r\n  JS_RUNTIME_NAME:              \"node\"\r\n  NODE_PACKAGE_MANAGER:         \"pnpm/8.15.5\"\r\n\r\nBiome Configuration:\r\n  Status:                       Loaded successfully\r\n  Formatter disabled:           false\r\n  Linter disabled:              false\r\n  Organize imports disabled:    false\r\n  VCS disabled:                 true\r\n\r\nWorkspace:\r\n  Open Documents:               0\n```\n\n\n### What happened?\n\n1. Have a Svelte component with code below\r\n```svelte\r\n<script context=\"module\" lang=\"ts\">\r\n\timport { timeline, type TimelineSegment } from 'motion'\r\n</script>\r\n```\r\n2. Observe that type imports produce \"import { type x ident }' are a TypeScript only feature\". If imports are moved into regular svelte block, things work correctly.\n\n### Expected result\n\nNo error\n\n### Code of Conduct\n\n- [X] I agree to follow Biome's Code of Conduct\n",
    "biomejs__biome-2300": "\ud83d\udcce Feature: --staged option to simplify the creation of git hook scripts\n### Description\r\n\r\n## Problem Statement\r\n\r\nAs of today, `biome` does not provide a direct mechanism to select (for linting, formatting or checking) only the files that are staged for a commit.\r\n\r\nWe have a \"similar\" flag, `--changed`, but its main purpose is to be used in CI, and allows us to check only the files that changed between 2 points in history (which can be explicit or implicit).\r\n\r\nMany people think at first that `--changed` will also help them to select only the files that are staged, not being the case.\r\n\r\nMore advanced users have found workarounds to this issue ( https://github.com/biomejs/biome/issues/1198#issuecomment-1858364218 ), but these involve having to write longer, more complex and slower scripts. Not everyone can come up with these solutions, even if they seem simple after we see them.\r\n\r\nOthers rely on tools such as `lint-staged`, but this involves adding more dependencies to the project (which in this case are much slower than `biome`), and opens up the possibility for more bugs caused by unexpected interactions between `lint-staged` and `biome`.\r\n\r\n## Proposal\r\n\r\nAfter a discussion held in Discord ( https://discord.com/channels/1132231889290285117/1222450681919832134 ), we agreed that it would be a good idea to introduce a new `--staged` flag for the `lint`, `format` and `check` commands that will make biome take into account only the files that are _staged_.\r\n\r\n### Addendum\r\n\r\nWhile `--staged` doesn't give us much when we are running \"potentially destructive\" commands such as `format` or `check --apply` (because we still need to independently obtain a list of staged files so we can re-add them to the \"stage\" before they are committed), it gives a clear advantage for readonly-mode commands such as `lint` without `--apply`.\r\n\n",
    "biomejs__biome-2250": "\ud83d\udcdd biom crashed\n### Environment information\n\n```bash\n\u276f pnpm biome check . --apply\r\nBiome encountered an unexpected error\r\n\r\nThis is a bug in Biome, not an error in your code, and we would appreciate it if you could report it to https://github.com/biomejs/biome/issues/ along with the following information to help us fixing the issue:\r\n\r\nSource Location: crates/biome_js_analyze/src/utils.rs:109:13\r\nThread Name: biome::worker_5\r\nMessage: internal error: entered unreachable code: The node can't have the same range of the operator.\n```\n\n\n### Configuration\n\n```JSON\nN/A\n```\n\n\n### Playground link\n\nn/a\n\n### Code of Conduct\n\n- [X] I agree to follow Biome's Code of Conduct\n",
    "biomejs__biome-2116": "\ud83d\udc1b Typescripts \"Module\" syntax is invalid for typescript-enabled common js\n### Environment information\n\n```block\nCLI:\r\n  Version:                      1.6.1\r\n  Color support:                true\r\n\r\nPlatform:\r\n  CPU Architecture:             aarch64\r\n  OS:                           linux\r\n\r\nEnvironment:\r\n  BIOME_LOG_DIR:                unset\r\n  NO_COLOR:                     unset\r\n  TERM:                         \"xterm-256color\"\r\n  JS_RUNTIME_VERSION:           \"v20.11.1\"\r\n  JS_RUNTIME_NAME:              \"node\"\r\n  NODE_PACKAGE_MANAGER:         unset\r\n\r\nBiome Configuration:\r\n  Status:                       Loaded successfully\r\n  Formatter disabled:           false\r\n  Linter disabled:              true\r\n  Organize imports disabled:    false\r\n  VCS disabled:                 false\r\n\r\nWorkspace:\r\n  Open Documents:               0\n```\n\n\n### What happened?\n\n1. Create a file called `index.cts` (this is a _forced_ commonjs file, but it is typescript so we are allowed to used use ESM-like syntax: https://www.typescriptlang.org/play?module=1#code/KYDwDg9gTgLgBAE2AMwIYFcA28DecDGAVgM4BccMU6wcAvgNxA).\r\n2. Add an export to the file using ESM-like syntax (e.g. `export default { cjs: true };`)\r\n3. Run `biome format .`\r\n4. Get parsing error:\r\n```\r\n./src/tests/data/cjs.cts:1:1 parse \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\r\n\r\n  \u00d7 Illegal use of an export declaration outside of a module\r\n  \r\n  > 1 \u2502 export default { cjs: true };\r\n      \u2502 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n    2 \u2502 \r\n  \r\n  i not allowed inside scripts\r\n```\r\n\r\nSee playground: https://biomejs.dev/playground/?code=ZQB4AHAAbwByAHQAIABkAGUAZgBhAHUAbAB0ACAAewAgAGMAagBzADoAIAB0AHIAdQBlACAAfQA7AAoA&typescript=false&jsx=false&script=true\n\n### Expected result\n\nBiome should recognize that this is a typescript file (`.cts` not `.cjs`), and therefore ESM-like syntax is allowed.\r\n\r\nPerhaps more generally, maybe it should recognize that some other transpiler will be touching this code before execution, so _seemingly_ invalid code is actually allowed and formatting should proceed as usual.\r\n\r\nTo be clear, the _intention_ of this error is correct. If I were using `import`/`export` in a `.cjs` file (or a `.js` file with `{ \"type\": \"commonjs\" }`) I would expect this error to occur. \r\n\r\nIn the Biome playground I needed to set the source type to Script to get the failure, which explicitly disables the ability to enable typescript. I suspect there is some failure to recognize `.cts` as module+typescript, rather than commonjs.\n\n### Code of Conduct\n\n- [X] I agree to follow Biome's Code of Conduct\n",
    "biomejs__biome-2044": "\ud83d\udc1b Including smart-quote `\u2018` with escape `\\` confuses the JS lexer\n### Environment information\n\n```block\nCLI:\r\n  Version:                      1.5.3\r\n  Color support:                true\r\n\r\nPlatform:\r\n  CPU Architecture:             x86_64\r\n  OS:                           macos\r\n\r\nEnvironment:\r\n  BIOME_LOG_DIR:                unset\r\n  NO_COLOR:                     unset\r\n  TERM:                         \"xterm-256color\"\r\n  JS_RUNTIME_VERSION:           \"v20.7.0\"\r\n  JS_RUNTIME_NAME:              \"node\"\r\n  NODE_PACKAGE_MANAGER:         unset\r\n\r\nBiome Configuration:\r\n  Status:                       Loaded successfully\r\n  Formatter disabled:           false\r\n  Linter disabled:              false\r\n  Organize imports disabled:    false\r\n  VCS disabled:                 true\r\n\r\nWorkspace:\r\n  Open Documents:               0\n```\n\n\n### What happened?\n\n1. In the playground, paste in\r\n```js\r\n\"hello world\".replace(/\\\u2019/, \"\")\r\n```\r\n\r\nor put that in a .js file and run `biome lint` against it.\r\n\r\n---\r\nThe `biome lint` gives this output:\r\n\r\n```\r\nsrc/js/test.js:1:28 parse \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\r\n\r\n  \u2716 unterminated regex literal\r\n\r\n  > 1 \u2502 \"hello\".replace(/\\\u2018/, \"'\");\r\n      \u2502\r\n    2 \u2502\r\n\r\n  \u2139 ...but the line ends here\r\n\r\n  > 1 \u2502 \"hello\".replace(/\\\u2018/, \"'\");\r\n      \u2502\r\n    2 \u2502\r\n\r\n  \u2139 a regex literal starts there...\r\n\r\n  > 1 \u2502 \"hello\".replace(/\\\u2018/, \"'\");\r\n      \u2502                 ^\r\n    2 \u2502\r\n\r\n\r\nsrc/js/test.js:2:1 parse \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\r\n\r\n  \u2716 expected `)` but instead the file ends\r\n\r\n    1 \u2502 \"hello\".replace(/\\\u2018/, \"'\");\r\n  > 2 \u2502\r\n      \u2502\r\n\r\n  \u2139 the file ends here\r\n\r\n    1 \u2502 \"hello\".replace(/\\\u2018/, \"'\");\r\n  > 2 \u2502\r\n      \u2502\r\n\r\n\r\nsrc/js/test.js lint \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\r\n\r\n  \u2716 The file contains diagnostics that needs to be addressed.\r\n\r\n\r\nChecked 1 file(s) in 15ms\r\nFound 3 error(s)\r\nlint \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\r\n\r\n  \u2716 Some errors were emitted while running checks.\r\n```\r\n\r\n---\r\nThe playground crashes completely, and shows this in the browser console:\r\n\r\n```\r\nclient.LpXbfsP5.js:24 RangeError: Invalid position 33 in document of length 31\r\n    at qe.lineAt (PlaygroundLoader.O4NTypk8.js:1:4066)\r\n    at SA (PlaygroundLoader.O4NTypk8.js:10:41341)\r\n    at li.update [as updateF] (PlaygroundLoader.O4NTypk8.js:10:41717)\r\n    at Object.update (PlaygroundLoader.O4NTypk8.js:4:17201)\r\n    at ke.computeSlot (PlaygroundLoader.O4NTypk8.js:4:25884)\r\n    at _c (PlaygroundLoader.O4NTypk8.js:4:20008)\r\n    at new ke (PlaygroundLoader.O4NTypk8.js:4:25071)\r\n    at ke.applyTransaction (PlaygroundLoader.O4NTypk8.js:4:25853)\r\n    at get state (PlaygroundLoader.O4NTypk8.js:4:21482)\r\n    at Rt.update (PlaygroundLoader.O4NTypk8.js:9:14200)\r\npi @ client.LpXbfsP5.js:24\r\nt.callback @ client.LpXbfsP5.js:24\r\neo @ client.LpXbfsP5.js:22\r\ngo @ client.LpXbfsP5.js:24\r\nha @ client.LpXbfsP5.js:24\r\nkf @ client.LpXbfsP5.js:24\r\n_f @ client.LpXbfsP5.js:24\r\nyn @ client.LpXbfsP5.js:24\r\nSo @ client.LpXbfsP5.js:24\r\npn @ client.LpXbfsP5.js:22\r\nXn @ client.LpXbfsP5.js:24\r\n(anonymous) @ client.LpXbfsP5.js:24\r\nE @ client.LpXbfsP5.js:9\r\nlt @ client.LpXbfsP5.js:9\r\nclient.LpXbfsP5.js:22 Uncaught RangeError: Invalid position 33 in document of length 31\r\n    at qe.lineAt (PlaygroundLoader.O4NTypk8.js:1:4066)\r\n    at SA (PlaygroundLoader.O4NTypk8.js:10:41341)\r\n    at li.update [as updateF] (PlaygroundLoader.O4NTypk8.js:10:41717)\r\n    at Object.update (PlaygroundLoader.O4NTypk8.js:4:17201)\r\n    at ke.computeSlot (PlaygroundLoader.O4NTypk8.js:4:25884)\r\n    at _c (PlaygroundLoader.O4NTypk8.js:4:20008)\r\n    at new ke (PlaygroundLoader.O4NTypk8.js:4:25071)\r\n    at ke.applyTransaction (PlaygroundLoader.O4NTypk8.js:4:25853)\r\n    at get state (PlaygroundLoader.O4NTypk8.js:4:21482)\r\n    at Rt.update (PlaygroundLoader.O4NTypk8.js:9:14200)\r\n```\r\n\r\n---\r\n\r\nTrying to run `biome format` on it gives:\r\n```\r\n./node_modules/@biomejs/biome/bin/biome format --verbose  src/js/test.js\r\nsrc/js/test.js format \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\r\n\r\n  \u2716 Format with errors is disabled.\r\n\r\n```\r\n\r\n---\r\n\r\nThis also happens with other similar types of \"smart\" quotes, \r\n```js\r\n\"hello world\".replace(/\\\u201f/, \"\")\r\n```\r\nfor instance.\n\n### Expected result\n\nIt should work just fine, the same as\r\n```\r\n\"hello world\".replace(/\\'/, \"\")\r\n```\r\n\n\n### Code of Conduct\n\n- [X] I agree to follow Biome's Code of Conduct\n",
    "biomejs__biome-1806": "\ud83d\udc85  `useNamingConvention` can suggest useless fix\n### Environment information\r\nUsed [`biome-linux-x64` binary from the release](https://github.com/biomejs/biome/releases/tag/cli%2Fv1.5.3) (sha256sum: `adf8a6029f43ac6eb07c86519f7ff08875915acec082d0be9393888044806243`)\r\n\r\n\r\n\r\n```\r\nCLI:\r\n  Version:                      1.5.3\r\n  Color support:                true\r\n\r\nPlatform:\r\n  CPU Architecture:             x86_64\r\n  OS:                           linux\r\n\r\nEnvironment:\r\n  BIOME_LOG_DIR:                unset\r\n  NO_COLOR:                     unset\r\n  TERM:                         \"foot\"\r\n  JS_RUNTIME_VERSION:           unset\r\n  JS_RUNTIME_NAME:              unset\r\n  NODE_PACKAGE_MANAGER:         unset\r\n\r\nBiome Configuration:\r\n  Status:                       Loaded successfully\r\n  Formatter disabled:           false\r\n  Linter disabled:              false\r\n  Organize imports disabled:    false\r\n  VCS disabled:                 true\r\n\r\nWorkspace:\r\n  Open Documents:               0\r\n```\r\n\r\n\r\n### Rule name\r\n\r\n[lint/style/useNamingConvention](https://biomejs.dev/linter/rules/use-naming-convention/)\r\n\r\n### Playground link\r\n\r\nhttps://biomejs.dev/playground/?lintRules=all&code=ZQB4AHAAbwByAHQAIABjAG8AbgBzAHQAIABkAGEAdABhACAAPQAgAHsAIABIxVWxWNU4wZTGOgAgADEAIAB9AAoA\r\n\r\n### Expected result\r\n\r\nCurrently it shows this:\r\n```typescript\r\n  \u26a0 This object property name should be in camelCase.\r\n  \r\n  > 1 \u2502 export const data = { \uc548\ub155\ud558\uc138\uc694: 1 }\r\n      \u2502                       ^^^^^^^^^^\r\n    2 \u2502 \r\n  \r\n  \u2139 The name could be renamed to `\uc548\ub155\ud558\uc138\uc694`.\r\n```\r\n\r\nSince the suggested fix is same as original, the message should be removed or replaced to something else. Disabling the lint could be an option.\r\n\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow Biome's Code of Conduct\n",
    "biomejs__biome-1747": "\"Suppress rule\" quickfix removes indentation\nBiome version `1.5.3`  \r\nVSCode version `1.85.2`  \r\nExtension version `2.1.2`\r\n\r\nSteps:\r\n\r\n1. Enable `lint/suspicious/noAssignInExpressions` and `lint/suspicious/noConsoleLog`.\r\n\r\n2. Code\r\n    ```typescript\r\n    // file.ts\r\n    export function foo() {\r\n      let x: number;\r\n      while ((x = Math.random()) > 0.1) {\r\n        console.log(x);\r\n      }\r\n    }\r\n    ```\r\n\r\n3. Apply quickfix\r\n\r\n   - To assignment (notice the two spaces after `while` too):\r\n      ```typescript\r\n      export function foo() {\r\n        let x: number;\r\n        // biome-ignore lint/suspicious/noAssignInExpressions: <explanation>\r\n      while  ((x = Math.random()) > 0.1) {\r\n          console.log(x);\r\n        }\r\n        return numbers;\r\n      }\r\n      ```\r\n    \r\n   - To `console.log`:\r\n      ```typescript\r\n      export function foo() {\r\n        let x: number;\r\n        while ((x = Math.random()) > 0.1) {\r\n          // biome-ignore lint/suspicious/noConsoleLog: <explanation>\r\n      console.log(x);\r\n        }\r\n      }\r\n      ```\n",
    "biomejs__biome-1527": "\ud83d\udc1b useArrowFunction exception in operator expression ?\n### Environment information\r\n\r\n```block\r\nCLI:\r\n  Version:                      1.5.1\r\n  Color support:                true\r\n\r\nPlatform:\r\n  CPU Architecture:             x86_64\r\n  OS:                           macos\r\n\r\nEnvironment:\r\n  BIOME_LOG_DIR:                unset\r\n  NO_COLOR:                     unset\r\n  TERM:                         \"xterm-256color\"\r\n  JS_RUNTIME_VERSION:           \"v20.9.0\"\r\n  JS_RUNTIME_NAME:              \"node\"\r\n  NODE_PACKAGE_MANAGER:         \"npm/10.1.0\"\r\n\r\nBiome Configuration:\r\n  Status:                       unset\r\n\r\nWorkspace:\r\n  Open Documents:               0\r\n```\r\n\r\n\r\n### What happened?\r\n\r\n```js\r\nconst _setImmediate =  (typeof setImmediate === 'function' &&\r\nfunction (fn) {\r\n  setImmediate(fn);\r\n}) ||\r\nfunction (fn) {\r\n  setTimeout(fn, 0);\r\n};\r\n```\r\n\r\nafter `check --apply`\r\n\r\n```js\r\nconst _setImmediate =  (typeof setImmediate === 'function' &&\r\n(fn) => {\r\n  setImmediate(fn);\r\n}) ||\r\n(fn) => {\r\n  setTimeout(fn, 0);\r\n};\r\n```\r\n\r\n> Uncaught SyntaxError: Malformed arrow function parameter list\r\n\r\n\r\n### Expected result\r\n\r\n```js\r\nconst _setImmediate =  (typeof setImmediate === 'function' &&\r\n((fn) => {\r\n  setImmediate(fn);\r\n})) ||\r\n((fn) => {\r\n  setTimeout(fn, 0);\r\n});\r\n```\r\n\r\nArrow functions should be wrapped with `()` ?\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow Biome's Code of Conduct\n",
    "biomejs__biome-1441": "\ud83d\udc1b `useHookAtTopLevel`: unconditional hook usage flagged as conditionally called\n### Environment information\r\n\r\n```block\r\nhttps://biomejs.dev/playground/?indentStyle=space&quoteStyle=single&trailingComma=none&lintRules=all&code=aQBtAHAAbwByAHQAIAB7ACAAYwByAGUAYQB0AGUAQwBvAG4AdABlAHgAdAAsACAAdQBzAGUAQwBhAGwAbABiAGEAYwBrACwAIAB1AHMAZQBDAG8AbgB0AGUAeAB0ACAAfQAgAGYAcgBvAG0AIAAnAHIAZQBhAGMAdAAnADsACgAKAGMAbwBuAHMAdAAgAEMAbwBuAHQAZQB4AHQAIAA9ACAAYwByAGUAYQB0AGUAQwBvAG4AdABlAHgAdAAoAHsAfQApADsACgAKAGUAeABwAG8AcgB0ACAAZgB1AG4AYwB0AGkAbwBuACAAdQBzAGUASwBlAHkAKABrAGUAeQA6ACAAcwB0AHIAaQBuAGcAKQAgAHsACgAgACAAcgBlAHQAdQByAG4AIAB1AHMAZQBDAG8AbgB0AGUAeAB0ACgAQwBvAG4AdABlAHgAdAApAFsAawBlAHkAXQA7AAoAfQAKAAoAZQB4AHAAbwByAHQAIABmAHUAbgBjAHQAaQBvAG4AIAB1AHMAZQBTAHQAdQBmAGYAKAApACAAewAKACAAIAByAGUAdAB1AHIAbgAgAHsACgAgACAAIAAgAGEAYgBjADoAIAB1AHMAZQBDAGEAbABsAGIAYQBjAGsAKAAoACkAIAA9AD4AIABuAHUAbABsACwAIABbAF0AKQAKACAAIAB9ADsACgB9AAoACgBlAHgAcABvAHIAdAAgAGYAdQBuAGMAdABpAG8AbgAgAHUAcwBlAFMAdAB1AGYAZgAyACgAKQAgAHsACgAgACAAcgBlAHQAdQByAG4AIABbAHUAcwBlAEMAYQBsAGwAYgBhAGMAawAoACgAKQAgAD0APgAgAG4AdQBsAGwALAAgAFsAXQApAF0AOwAKAH0ACgA%3D\r\n```\r\n\r\nhttps://biomejs.dev/playground/?indentStyle=space&quoteStyle=single&trailingComma=none&lintRules=all&code=aQBtAHAAbwByAHQAIAB7ACAAYwByAGUAYQB0AGUAQwBvAG4AdABlAHgAdAAsACAAdQBzAGUAQwBhAGwAbABiAGEAYwBrACwAIAB1AHMAZQBDAG8AbgB0AGUAeAB0ACAAfQAgAGYAcgBvAG0AIAAnAHIAZQBhAGMAdAAnADsACgAKAGMAbwBuAHMAdAAgAEMAbwBuAHQAZQB4AHQAIAA9ACAAYwByAGUAYQB0AGUAQwBvAG4AdABlAHgAdAAoAHsAfQApADsACgAKAGUAeABwAG8AcgB0ACAAZgB1AG4AYwB0AGkAbwBuACAAdQBzAGUASwBlAHkAKABrAGUAeQA6ACAAcwB0AHIAaQBuAGcAKQAgAHsACgAgACAAcgBlAHQAdQByAG4AIAB1AHMAZQBDAG8AbgB0AGUAeAB0ACgAQwBvAG4AdABlAHgAdAApAFsAawBlAHkAXQA7AAoAfQAKAAoAZQB4AHAAbwByAHQAIABmAHUAbgBjAHQAaQBvAG4AIAB1AHMAZQBTAHQAdQBmAGYAKAApACAAewAKACAAIAByAGUAdAB1AHIAbgAgAHsACgAgACAAIAAgAGEAYgBjADoAIAB1AHMAZQBDAGEAbABsAGIAYQBjAGsAKAAoACkAIAA9AD4AIABuAHUAbABsACwAIABbAF0AKQAKACAAIAB9ADsACgB9AAoACgBlAHgAcABvAHIAdAAgAGYAdQBuAGMAdABpAG8AbgAgAHUAcwBlAFMAdAB1AGYAZgAyACgAKQAgAHsACgAgACAAcgBlAHQAdQByAG4AIABbAHUAcwBlAEMAYQBsAGwAYgBhAGMAawAoACgAKQAgAD0APgAgAG4AdQBsAGwALAAgAFsAXQApAF0AOwAKAH0ACgA%3D\r\n\r\n\r\n### What happened?\r\n\r\nBiome flags these hooks as being conditionally called when they are not.\r\n\r\n### Expected result\r\n\r\nNo issues reported.\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow Biome's Code of Conduct\n",
    "biomejs__biome-1393": "\ud83d\udc1b `useHookAtTopLevel`: unconditional hook usage flagged as conditionally called\n### Environment information\r\n\r\n```block\r\nhttps://biomejs.dev/playground/?indentStyle=space&quoteStyle=single&trailingComma=none&lintRules=all&code=aQBtAHAAbwByAHQAIAB7ACAAYwByAGUAYQB0AGUAQwBvAG4AdABlAHgAdAAsACAAdQBzAGUAQwBhAGwAbABiAGEAYwBrACwAIAB1AHMAZQBDAG8AbgB0AGUAeAB0ACAAfQAgAGYAcgBvAG0AIAAnAHIAZQBhAGMAdAAnADsACgAKAGMAbwBuAHMAdAAgAEMAbwBuAHQAZQB4AHQAIAA9ACAAYwByAGUAYQB0AGUAQwBvAG4AdABlAHgAdAAoAHsAfQApADsACgAKAGUAeABwAG8AcgB0ACAAZgB1AG4AYwB0AGkAbwBuACAAdQBzAGUASwBlAHkAKABrAGUAeQA6ACAAcwB0AHIAaQBuAGcAKQAgAHsACgAgACAAcgBlAHQAdQByAG4AIAB1AHMAZQBDAG8AbgB0AGUAeAB0ACgAQwBvAG4AdABlAHgAdAApAFsAawBlAHkAXQA7AAoAfQAKAAoAZQB4AHAAbwByAHQAIABmAHUAbgBjAHQAaQBvAG4AIAB1AHMAZQBTAHQAdQBmAGYAKAApACAAewAKACAAIAByAGUAdAB1AHIAbgAgAHsACgAgACAAIAAgAGEAYgBjADoAIAB1AHMAZQBDAGEAbABsAGIAYQBjAGsAKAAoACkAIAA9AD4AIABuAHUAbABsACwAIABbAF0AKQAKACAAIAB9ADsACgB9AAoACgBlAHgAcABvAHIAdAAgAGYAdQBuAGMAdABpAG8AbgAgAHUAcwBlAFMAdAB1AGYAZgAyACgAKQAgAHsACgAgACAAcgBlAHQAdQByAG4AIABbAHUAcwBlAEMAYQBsAGwAYgBhAGMAawAoACgAKQAgAD0APgAgAG4AdQBsAGwALAAgAFsAXQApAF0AOwAKAH0ACgA%3D\r\n```\r\n\r\nhttps://biomejs.dev/playground/?indentStyle=space&quoteStyle=single&trailingComma=none&lintRules=all&code=aQBtAHAAbwByAHQAIAB7ACAAYwByAGUAYQB0AGUAQwBvAG4AdABlAHgAdAAsACAAdQBzAGUAQwBhAGwAbABiAGEAYwBrACwAIAB1AHMAZQBDAG8AbgB0AGUAeAB0ACAAfQAgAGYAcgBvAG0AIAAnAHIAZQBhAGMAdAAnADsACgAKAGMAbwBuAHMAdAAgAEMAbwBuAHQAZQB4AHQAIAA9ACAAYwByAGUAYQB0AGUAQwBvAG4AdABlAHgAdAAoAHsAfQApADsACgAKAGUAeABwAG8AcgB0ACAAZgB1AG4AYwB0AGkAbwBuACAAdQBzAGUASwBlAHkAKABrAGUAeQA6ACAAcwB0AHIAaQBuAGcAKQAgAHsACgAgACAAcgBlAHQAdQByAG4AIAB1AHMAZQBDAG8AbgB0AGUAeAB0ACgAQwBvAG4AdABlAHgAdAApAFsAawBlAHkAXQA7AAoAfQAKAAoAZQB4AHAAbwByAHQAIABmAHUAbgBjAHQAaQBvAG4AIAB1AHMAZQBTAHQAdQBmAGYAKAApACAAewAKACAAIAByAGUAdAB1AHIAbgAgAHsACgAgACAAIAAgAGEAYgBjADoAIAB1AHMAZQBDAGEAbABsAGIAYQBjAGsAKAAoACkAIAA9AD4AIABuAHUAbABsACwAIABbAF0AKQAKACAAIAB9ADsACgB9AAoACgBlAHgAcABvAHIAdAAgAGYAdQBuAGMAdABpAG8AbgAgAHUAcwBlAFMAdAB1AGYAZgAyACgAKQAgAHsACgAgACAAcgBlAHQAdQByAG4AIABbAHUAcwBlAEMAYQBsAGwAYgBhAGMAawAoACgAKQAgAD0APgAgAG4AdQBsAGwALAAgAFsAXQApAF0AOwAKAH0ACgA%3D\r\n\r\n\r\n### What happened?\r\n\r\nBiome flags these hooks as being conditionally called when they are not.\r\n\r\n### Expected result\r\n\r\nNo issues reported.\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow Biome's Code of Conduct\n",
    "biomejs__biome-1327": "\ud83d\udc85 useExhaustiveDependencies nested access check relies on the source format\n### Environment information\n\n```block\nCLI:\r\n  Version:                      1.4.1\r\n  Color support:                true\r\n\r\nPlatform:\r\n  CPU Architecture:             x86_64\r\n  OS:                           linux\r\n\r\nEnvironment:\r\n  BIOME_LOG_DIR:                unset\r\n  NO_COLOR:                     unset\r\n  TERM:                         \"xterm-256color\"\r\n  JS_RUNTIME_VERSION:           \"v18.14.0\"\r\n  JS_RUNTIME_NAME:              \"node\"\r\n  NODE_PACKAGE_MANAGER:         unset\r\n\r\nBiome Configuration:\r\n  Status:                       Loaded successfully\r\n  Formatter disabled:           false\r\n  Linter disabled:              false\r\n  Organize imports disabled:    false\r\n  VCS disabled:                 false\r\n\r\nWorkspace:\r\n  Open Documents:               0\n```\n\n\n### What happened?\n\nThe `correctness/useExhaustiveDependencies` rule works in different ways when the formatting differs.\r\n\r\n[Playground Link](https://biomejs.dev/playground/?lintRules=all&code=aQBtAHAAbwByAHQAIAB7AHUAcwBlAEMAYQBsAGwAYgBhAGMAawB9ACAAZgByAG8AbQAgACcAcgBlAGEAYwB0ACcAOwAKAAoAZgB1AG4AYwB0AGkAbwBuACAAQQBwAHAAKAApACAAewAKACAAIABjAG8AbgBzAHQAIABhACAAPQAgAHsACgAgACAAIAAgAGIAOgAgAE0AYQB0AGgALgByAGEAbgBkAG8AbQAoACkACgAgACAAfQAKAAoAIAAgAC8ALwAgAEIAcgBvAGsAZQBuAAoAIAAgAHUAcwBlAEMAYQBsAGwAYgBhAGMAawAoACgAKQAgAD0APgAgAHsACgAgACAAIAAgAGEAbABlAHIAdAAoAGEACgAgACAAIAAgACAAIAAuAGIAKQAKACAAIAB9ACwAIABbAGEALgBiAF0AKQA7AAoACgAgACAALwAvACAAVwBvAHIAawBzAAoAIAAgAHUAcwBlAEMAYQBsAGwAYgBhAGMAawAoACgAKQAgAD0APgAgAHsACgAgACAAIAAgAGEAbABlAHIAdAAoAGEALgBiACkACgAgACAAfQAsACAAWwBhAC4AYgBdACkAOwAKAH0ACgAKAA%3D%3D)\r\n\r\n\n\n### Expected result\n\nThe formatting shouldn't matter.\n\n### Code of Conduct\n\n- [X] I agree to follow Biome's Code of Conduct\n",
    "biomejs__biome-3674": "\ud83d\udc85 Improve `nursery/noNodejsModules` detection (ignore type only imports and apply it only on `use-client` directives)\n### Environment information\n\n```bash\nCLI:\r\n  Version:                      1.5.3\r\n  Color support:                true\r\n\r\nPlatform:\r\n  CPU Architecture:             aarch64\r\n  OS:                           macos\r\n\r\nEnvironment:\r\n  BIOME_LOG_DIR:                unset\r\n  NO_COLOR:                     unset\r\n  TERM:                         \"xterm-256color\"\r\n  JS_RUNTIME_VERSION:           \"v20.10.0\"\r\n  JS_RUNTIME_NAME:              \"node\"\r\n  NODE_PACKAGE_MANAGER:         \"bun/1.0.20\"\r\n\r\nBiome Configuration:\r\n  Status:                       Loaded successfully\r\n  Formatter disabled:           false\r\n  Linter disabled:              false\r\n  Organize imports disabled:    false\r\n  VCS disabled:                 false\r\n\r\nWorkspace:\r\n  Open Documents:               0\n```\n\n\n### Rule name\n\n`nursery/noNodejsModules`\n\n### Playground link\n\nhttps://biomejs.dev/playground/?lintRules=all&code=aQBtAHAAbwByAHQAIAB0AHkAcABlACAAewAgAEEAcwB5AG4AYwBMAG8AYwBhAGwAUwB0AG8AcgBhAGcAZQAgAH0AIABmAHIAbwBtACAAIgBuAG8AZABlADoAYQBzAHkAbgBjAF8AaABvAG8AawBzACIAOwAKAAoAZQB4AHAAbwByAHQAIAB0AHkAcABlACAAVABlAHMAdAAgAD0AIABBAHMAeQBuAGMATABvAGMAYQBsAFMAdABvAHIAYQBnAGUA\n\n### Expected result\n\n1. On the attached link, I am only importing a type from a Node module, should it report?\r\n2. A good option to make sure the file includes client-only code is to check if the `use client` directive is being used.\n\n### Code of Conduct\n\n- [X] I agree to follow Biome's Code of Conduct\n",
    "biomejs__biome-3451": "Removal of necessary parentheses when formatting union of types which include an `infer` ... `extends`\nReproduction is simple, see playground link.\r\n\r\n### Environment information\r\n\r\n```bash\r\nCLI:\r\n  Version:                      1.8.3\r\n  Color support:                true\r\n\r\nPlatform:\r\n  CPU Architecture:             aarch64\r\n  OS:                           linux\r\n\r\nEnvironment:\r\n  BIOME_LOG_DIR:                unset\r\n  NO_COLOR:                     unset\r\n  TERM:                         \"xterm-256color\"\r\n  JS_RUNTIME_VERSION:           \"v20.11.0\"\r\n  JS_RUNTIME_NAME:              \"node\"\r\n  NODE_PACKAGE_MANAGER:         \"pnpm/9.5.0\"\r\n\r\nBiome Configuration:\r\n  Status:                       Loaded successfully\r\n  Formatter disabled:           false\r\n  Linter disabled:              false\r\n  Organize imports disabled:    false\r\n  VCS disabled:                 true\r\n\r\nFormatter:\r\n  Format with errors:           false\r\n  Indent style:                 Space\r\n  Indent width:                 2\r\n  Line ending:                  Lf\r\n  Line width:                   80\r\n  Attribute position:           Auto\r\n  Ignore:                       []\r\n  Include:                      []\r\n\r\nJavaScript Formatter:\r\n  Enabled:                      true\r\n  JSX quote style:              Double\r\n  Quote properties:             AsNeeded\r\n  Trailing commas:              All\r\n  Semicolons:                   Always\r\n  Arrow parentheses:            Always\r\n  Bracket spacing:              true\r\n  Bracket same line:            false\r\n  Quote style:                  Double\r\n  Indent style:                 unset\r\n  Indent width:                 unset\r\n  Line ending:                  unset\r\n  Line width:                   unset\r\n  Attribute position:           Auto\r\n\r\nJSON Formatter:\r\n  Enabled:                      true\r\n  Indent style:                 unset\r\n  Indent width:                 unset\r\n  Line ending:                  unset\r\n  Line width:                   unset\r\n  Trailing Commas:              unset\r\n\r\nCSS Formatter:\r\n  Enabled:                      false\r\n  Indent style:                 unset\r\n  Indent width:                 unset\r\n  Line ending:                  unset\r\n  Line width:                   unset\r\n  Quote style:                  Double\r\n\r\nWorkspace:\r\n  Open Documents:               0\r\n```\r\n\r\n\r\n### Configuration\r\n\r\n```JSON\r\n{\r\n  \"$schema\": \"https://biomejs.dev/schemas/1.8.3/schema.json\",\r\n  \"organizeImports\": {\r\n    \"enabled\": true\r\n  },\r\n  \"linter\": {\r\n    \"enabled\": true,\r\n    \"rules\": {\r\n      \"recommended\": true,\r\n      \"complexity\": {\r\n        \"noForEach\": \"off\"\r\n      },\r\n      \"performance\": {\r\n        \"noAccumulatingSpread\": \"off\"\r\n      },\r\n      \"style\": {\r\n        \"noUselessElse\": \"off\"\r\n      },\r\n      \"suspicious\": {\r\n        \"noExplicitAny\": \"off\",\r\n        \"noShadowRestrictedNames\": \"off\"\r\n      }\r\n    }\r\n  },\r\n  \"formatter\": {\r\n    \"indentStyle\": \"space\"\r\n  },\r\n  \"files\": {\r\n    \"ignore\": [\"coverage\", \"pnpm-lock.yaml\", \"test/convex/_generated\"]\r\n  }\r\n}\r\n```\r\n\r\n\r\n### Playground link\r\n\r\nhttps://biomejs.dev/playground/?code=dAB5AHAAZQAgAFQAeQBwAGUAPABUAD4AIAA9ACAAWwBUAF0AIABlAHgAdABlAG4AZABzACAAWwAoAGkAbgBmAGUAcgAgAFMAIABlAHgAdABlAG4AZABzACAAcwB0AHIAaQBuAGcAKQAgAHwAIAB1AG4AZABlAGYAaQBuAGUAZABdACAAPwAgAFMAIAA6ACAAVAA7AA%3D%3D\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow Biome's Code of Conduct\n",
    "biomejs__biome-3304": "\ud83d\udcce Implement suppression action for the CSS analyzer\n### Description\r\n\r\nAt the moment, there's no way to suppress a CSS lint rule via editor because we don't expose an action that creates the suppression comment.\r\n\r\nWe should create one here:\r\n\r\nhttps://github.com/biomejs/biome/blob/bb5faa052cc9b0596aec30a9627ea94a93af51b3/crates/biome_css_analyze/src/suppression_action.rs#L7-L26\r\n\r\n@togami2864 I am going to assign this task to you, but feel free to assign to any contributor that would like to implement this. This a feature that we must have before making any rule stable.\r\n\r\nThe testing infrastructure of the crate `biome_css_analyze` is already ready to test suppression comments. Just create a `suppression` folder next to `specs`. You check how it's done in the JS analyzer: https://github.com/biomejs/biome/tree/main/crates/biome_js_analyze/tests/suppression/a11y/useKeyWithClickEvents\n",
    "biomejs__biome-2794": "\ud83d\udcce Implement rule `useTopLevelRegex`\n### Description\n\nI *don't* know if there's a similar rule out there, we can add a reference later.\r\n\r\nI came up with this rule while looking at many JS PRs out there, and I was surprised that there are many developers that don't adopt the following practice. Given the following code, the rule should trigger a case similar to this:\r\n\r\n```js\r\n\r\nfunction foo(someString) {\r\n\treturn /[a-Z]*/.test(someString)\r\n}\r\n```\r\n\r\nThe rule should suggest moving the regex in a top-level variable:\r\n\r\n```js\r\n\r\nconst REGEX = /[a-Z]*/;\r\n\r\nfunction foo(someString) {\r\n\treturn REGEX.test(someString)\r\n}\r\n```\r\n\r\nThe rule should not provide a code action; it should only suggest moving the regex in a variable at the top level of the module.\r\n\r\nThe reason for this rule is simple: regex requires a parsing phase, which could be expensive for some long ones. V8 and other engines have a long history of parsing, so I'm sure there is some optimisation, but recreating a new regex every time we call the function `foo` is definitely not optimal.\r\n\n",
    "biomejs__biome-2788": "\ud83d\udc1b vue sfc `lang=\"tsx\"` support\n### Environment information\r\n\r\n```block\r\nCLI:\r\n  Version:                      1.7.3\r\n  Color support:                true\r\n\r\nPlatform:\r\n  CPU Architecture:             aarch64\r\n  OS:                           macos\r\n\r\nEnvironment:\r\n  BIOME_LOG_DIR:                unset\r\n  NO_COLOR:                     unset\r\n  TERM:                         \"xterm-256color\"\r\n  JS_RUNTIME_VERSION:           \"v20.12.2\"\r\n  JS_RUNTIME_NAME:              \"node\"\r\n  NODE_PACKAGE_MANAGER:         unset\r\n\r\nBiome Configuration:\r\n  Status:                       Loaded successfully\r\n  Formatter disabled:           false\r\n  Linter disabled:              false\r\n  Organize imports disabled:    true\r\n  VCS disabled:                 false\r\n\r\nWorkspace:\r\n  Open Documents:               0\r\n```\r\n\r\n\r\n### What happened?\r\n\r\n### Reproducing\r\n\r\nhttps://codesandbox.io/p/devbox/silent-framework-dxvf7x\r\n\r\n### Code\r\n\r\n```vue\r\n<script setup lang=\"tsx\">\r\nfunction Button() {\r\n  return <div>Vue Button</div>;\r\n}\r\n</script>\r\n```\r\n\r\n### Got\r\n\r\n```log\r\n\r\n> @ check /workspace\r\n> biome check ./src\r\n\r\n./src/index.vue:2:10 parse \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\r\n\r\n  \u2716 type assertion are a TypeScript only feature. Convert your file to a TypeScript file or remove the syntax.\r\n  \r\n    1 \u2502 function Button() {\r\n  > 2 \u2502   return <div>Vue Button</div>;\r\n      \u2502          ^^^^^^^^\r\n    3 \u2502 }\r\n    4 \u2502 \r\n  \r\n  \u2139 TypeScript only syntax\r\n  \r\n\r\n./src/index.vue:2:19 parse \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\r\n\r\n  \u2716 Expected a semicolon or an implicit semicolon after a statement, but found none\r\n  \r\n    1 \u2502 function Button() {\r\n  > 2 \u2502   return <div>Vue Button</div>;\r\n      \u2502                   ^^^^^^\r\n    3 \u2502 }\r\n    4 \u2502 \r\n  \r\n  \u2139 An explicit or implicit semicolon is expected here...\r\n  \r\n    1 \u2502 function Button() {\r\n  > 2 \u2502   return <div>Vue Button</div>;\r\n      \u2502                   ^^^^^^\r\n    3 \u2502 }\r\n    4 \u2502 \r\n  \r\n  \u2139 ...Which is required to end this statement\r\n  \r\n    1 \u2502 function Button() {\r\n  > 2 \u2502   return <div>Vue Button</div>;\r\n      \u2502   ^^^^^^^^^^^^^^^^^^^^^^\r\n    3 \u2502 }\r\n    4 \u2502 \r\n  \r\n\r\n./src/index.vue:2:32 parse \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\r\n\r\n  \u2716 unterminated regex literal\r\n  \r\n    1 \u2502 function Button() {\r\n  > 2 \u2502   return <div>Vue Button</div>;\r\n      \u2502                                \r\n    3 \u2502 }\r\n    4 \u2502 \r\n  \r\n  \u2139 ...but the line ends here\r\n  \r\n    1 \u2502 function Button() {\r\n  > 2 \u2502   return <div>Vue Button</div>;\r\n      \u2502                                \r\n    3 \u2502 }\r\n    4 \u2502 \r\n  \r\n  \u2139 a regex literal starts there...\r\n  \r\n    1 \u2502 function Button() {\r\n  > 2 \u2502   return <div>Vue Button</div>;\r\n      \u2502                          ^\r\n    3 \u2502 }\r\n    4 \u2502 \r\n  \r\n\r\n./src/index.vue:2:19 lint/correctness/noUnreachable \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\r\n\r\n  \u2716 This code will never be reached ...\r\n  \r\n    1 \u2502 function Button() {\r\n  > 2 \u2502   return <div>Vue Button</div>;\r\n      \u2502                   ^^^^^^^^^^^^^\r\n    3 \u2502 }\r\n    4 \u2502 \r\n  \r\n  \u2139 ... because this statement will return from the function beforehand\r\n  \r\n    1 \u2502 function Button() {\r\n  > 2 \u2502   return <div>Vue Button</div>;\r\n      \u2502   ^^^^^^^^^^^^^^^\r\n    3 \u2502 }\r\n    4 \u2502 \r\n  \r\n\r\n./src/index.vue:2:4 parse \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\r\n\r\n  \u2716 type assertion are a TypeScript only feature. Convert your file to a TypeScript file or remove the syntax.\r\n  \r\n    1 \u2502 <script setup lang=\"tsx\">\r\n  > 2 \u2502 function Button() {\r\n      \u2502    ^^^^^^^^\r\n    3 \u2502   return <div>Vue Button</div>;\r\n    4 \u2502 }\r\n  \r\n  \u2139 TypeScript only syntax\r\n  \r\n\r\n./src/index.vue:2:13 parse \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\r\n\r\n  \u2716 Expected a semicolon or an implicit semicolon after a statement, but found none\r\n  \r\n    1 \u2502 <script setup lang=\"tsx\">\r\n  > 2 \u2502 function Button() {\r\n      \u2502             ^^^^^^\r\n    3 \u2502   return <div>Vue Button</div>;\r\n    4 \u2502 }\r\n  \r\n  \u2139 An explicit or implicit semicolon is expected here...\r\n  \r\n    1 \u2502 <script setup lang=\"tsx\">\r\n  > 2 \u2502 function Button() {\r\n      \u2502             ^^^^^^\r\n    3 \u2502   return <div>Vue Button</div>;\r\n    4 \u2502 }\r\n  \r\n  \u2139 ...Which is required to end this statement\r\n  \r\n  > 1 \u2502 <script setup lang=\"tsx\">\r\n      \u2502                       ^^^\r\n  > 2 \u2502 function Button() {\r\n      \u2502 ^^^^^^^^^^^^^^^^^^\r\n    3 \u2502   return <div>Vue Button</div>;\r\n    4 \u2502 }\r\n  \r\n\r\n./src/index.vue:3:6 parse \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\r\n\r\n  \u2716 unterminated regex literal\r\n  \r\n    1 \u2502 <script setup lang=\"tsx\">\r\n    2 \u2502 function Button() {\r\n  > 3 \u2502   return <div>Vue Button</div>;\r\n      \u2502      \r\n    4 \u2502 }\r\n    5 \u2502 </script>\r\n  \r\n  \u2139 ...but the line ends here\r\n  \r\n    1 \u2502 <script setup lang=\"tsx\">\r\n    2 \u2502 function Button() {\r\n  > 3 \u2502   return <div>Vue Button</div>;\r\n      \u2502      \r\n    4 \u2502 }\r\n    5 \u2502 </script>\r\n  \r\n  \u2139 a regex literal starts there...\r\n  \r\n    1 \u2502 <script setup lang=\"tsx\">\r\n  > 2 \u2502 function Button() {\r\n      \u2502                    \r\n  > 3 \u2502   return <div>Vue Button</div>;\r\nBiome encountered an unexpected error\r\n\r\nThis is a bug in Biome, not an error in your code, and we would appreciate it if you could report it to https://github.com/biomejs/biome/issues/ along with the following information to help us fixing the issue:\r\n\r\nSource Location: /home/runner/work/biome/biome/crates/biome_text_size/src/range.rs:50:9\r\nThread Name: main\r\nMessage: assertion failed: start <= end\r\n\r\n\u2009ELIFECYCLE\u2009 Command failed with exit code 101.\r\n```\r\n\r\n### Expected result\r\n\r\nParsing should succeed.\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow Biome's Code of Conduct\n",
    "biomejs__biome-2692": "\ud83d\udc85 Svelte Reactive Blocks marked as Unexpected/Unused\n### Environment information\r\n\r\n```bash\r\nCLI:\r\n  Version:                      1.7.1\r\n  Color support:                true\r\n\r\nPlatform:\r\n  CPU Architecture:             aarch64\r\n  OS:                           macos\r\n\r\nEnvironment:\r\n  BIOME_LOG_DIR:                unset\r\n  NO_COLOR:                     unset\r\n  TERM:                         \"xterm-256color\"\r\n  JS_RUNTIME_VERSION:           \"v21.7.3\"\r\n  JS_RUNTIME_NAME:              \"node\"\r\n  NODE_PACKAGE_MANAGER:         \"pnpm/9.0.5\"\r\n\r\nBiome Configuration:\r\n  Status:                       Loaded successfully\r\n  Formatter disabled:           false\r\n  Linter disabled:              false\r\n  Organize imports disabled:    false\r\n  VCS disabled:                 false\r\n\r\nLinter:\r\n  Recommended:                  true\r\n  All:                          false\r\n  Rules:\r\nWorkspace:\r\n  Open Documents:               0\r\n```\r\n\r\n\r\n### Rule names\r\n\r\n`lint/suspicious/noConfusingLabels`, `lint/correctness/noUnusedLabels`\r\n\r\n### Playground link\r\n\r\nhttps://biomejs.dev/playground/?code=JAA6ACAAewAKACAAIABjAG8AbgBzAG8AbABlAC4AbABvAGcAKAAiAEkAJwBtACAAaQBuACAAYQAgAHIAZQBhAGMAdABpAHYAZQAgAGIAbABvAGMAawAhACIAKQAKAH0A\r\n\r\n### Expected result\r\n\r\nWhile in a Svelte Code Block, a Reactive Block\r\n```ts\r\n$: {\r\n\tconsole.log(someData);\r\n};\r\n```\r\ncan be defined, which will trigger whenever its variables change. In this case, Biome is marking the `$` symbol as an `Unepected`/`Unused` label, which can cause it to be removed with `--apply`.\r\n\r\nI would expect the `$` symbol to be an allowed symbol in the context of Svelte Code Blocks, and thus allowed to exist.\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow Biome's Code of Conduct\n",
    "biomejs__biome-2658": "\ud83d\udcce  Implement no-duplicate-at-import-rules\n## Description\r\n\r\nImplement [no-duplicate-at-import-rules](https://stylelint.io/user-guide/rules/no-duplicate-at-import-rules)\r\n\r\n> [!IMPORTANT]\r\n> - Please skip implementing options for now since we will evaluate users actually want them later.\r\n> - Please ignore handling extended CSS language cases such as `sass` and `less`.\r\n> - Please skip custom function since we haven't syntax model yet.\r\n\r\n**Want to contribute?** Lets you know you are interested! We will assign you to the issue to prevent several people to work on the same issue. Don't worry, we can unassign you later if you are no longer interested in the issue! Read our [contributing guide](https://github.com/biomejs/biome/blob/main/CONTRIBUTING.md) and [analyzer contributing guide](https://github.com/biomejs/biome/blob/main/crates/biome_analyze/CONTRIBUTING.md).\n",
    "biomejs__biome-2655": "\ud83d\udcce  Implement  selector-pseudo-element-no-unknown\n## Description\r\n\r\nImplement [selector-pseudo-element-no-unknown](https://stylelint.io/user-guide/rules/selector-pseudo-element-no-unknown)\r\n\r\n> [!IMPORTANT]\r\n> - Please skip implementing options for now since we will evaluate users actually want them later.\r\n> - Please ignore handling extended CSS language cases such as `sass` and `less`.\r\n> - Please skip custom function since we haven't syntax model yet.\r\n\r\n**Want to contribute?** Lets you know you are interested! We will assign you to the issue to prevent several people to work on the same issue. Don't worry, we can unassign you later if you are no longer interested in the issue! Read our [contributing guide](https://github.com/biomejs/biome/blob/main/CONTRIBUTING.md) and [analyzer contributing guide](https://github.com/biomejs/biome/blob/main/crates/biome_analyze/CONTRIBUTING.md).\n",
    "biomejs__biome-2621": "\ud83d\udc1b JSON Parser: Unterminated string literal can make `inner_string_text` panic\n### Environment information\r\n\r\n```block\r\nUnrelated, the issue is reproducible when nursery/noDuplicateJsonKeys is enabled.\r\n```\r\n\r\n\r\n### What happened?\r\n\r\nOur JSON parser allows `JSON_STRING_LITERAL` to include an unterminated string literal:\r\n\r\nhttps://github.com/biomejs/biome/blob/a5a67ed6202c5a37a33641de949fbeb572a45381/crates/biome_json_parser/src/lexer/mod.rs#L573-L579\r\n\r\nhttps://github.com/biomejs/biome/blob/a5a67ed6202c5a37a33641de949fbeb572a45381/crates/biome_json_parser/src/lexer/mod.rs#L620-L628\r\n\r\nThis will make the function `inner_string_text` panic when the unterminated string literal is just a single doublequote `\"`:\r\n\r\nhttps://github.com/biomejs/biome/blob/a5a67ed6202c5a37a33641de949fbeb572a45381/crates/biome_json_syntax/src/lib.rs#L118-L123\r\n\r\nThe function `inner_string_text` is called in the JSON nursery rule `noDuplicateJsonKeys`:\r\n\r\nhttps://github.com/biomejs/biome/blob/a5a67ed6202c5a37a33641de949fbeb572a45381/crates/biome_json_analyze/src/lint/nursery/no_duplicate_json_keys.rs#L58\r\n\r\nAnd this nursery rule is enabled by default when debugging or in a nightly build. So when changing the VS Code extension `lspBin` to a local debug build, and when a JSON file containing content like this is scanned by the extension, Biome will panic and keep reloading until it's killed permanently:\r\n\r\n```json\r\n{\r\n  \"a\": \"\"\"\r\n}\r\n```\r\n\r\nThe above erroneous JSON can appear quite frequently when using code completion so it will kill Biome often.\r\n\r\n### Expected result\r\n\r\nUnterminated string literal in an `AnyJsonValue` place should be a `JsonBogusValue` instead of a `JsonStringLiteral`.\r\n\r\nHowever I don't know how to treat it when the unterminated string literal appears in the `JsonMemberName` place. The JSON grammar may need changing. And I don't have enough knowledge to modify the grammar.\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow Biome's Code of Conduct\n\ud83d\udc1b JSON Parser: Unterminated string literal can make `inner_string_text` panic\n### Environment information\r\n\r\n```block\r\nUnrelated, the issue is reproducible when nursery/noDuplicateJsonKeys is enabled.\r\n```\r\n\r\n\r\n### What happened?\r\n\r\nOur JSON parser allows `JSON_STRING_LITERAL` to include an unterminated string literal:\r\n\r\nhttps://github.com/biomejs/biome/blob/a5a67ed6202c5a37a33641de949fbeb572a45381/crates/biome_json_parser/src/lexer/mod.rs#L573-L579\r\n\r\nhttps://github.com/biomejs/biome/blob/a5a67ed6202c5a37a33641de949fbeb572a45381/crates/biome_json_parser/src/lexer/mod.rs#L620-L628\r\n\r\nThis will make the function `inner_string_text` panic when the unterminated string literal is just a single doublequote `\"`:\r\n\r\nhttps://github.com/biomejs/biome/blob/a5a67ed6202c5a37a33641de949fbeb572a45381/crates/biome_json_syntax/src/lib.rs#L118-L123\r\n\r\nThe function `inner_string_text` is called in the JSON nursery rule `noDuplicateJsonKeys`:\r\n\r\nhttps://github.com/biomejs/biome/blob/a5a67ed6202c5a37a33641de949fbeb572a45381/crates/biome_json_analyze/src/lint/nursery/no_duplicate_json_keys.rs#L58\r\n\r\nAnd this nursery rule is enabled by default when debugging or in a nightly build. So when changing the VS Code extension `lspBin` to a local debug build, and when a JSON file containing content like this is scanned by the extension, Biome will panic and keep reloading until it's killed permanently:\r\n\r\n```json\r\n{\r\n  \"a\": \"\"\"\r\n}\r\n```\r\n\r\nThe above erroneous JSON can appear quite frequently when using code completion so it will kill Biome often.\r\n\r\n### Expected result\r\n\r\nUnterminated string literal in an `AnyJsonValue` place should be a `JsonBogusValue` instead of a `JsonStringLiteral`.\r\n\r\nHowever I don't know how to treat it when the unterminated string literal appears in the `JsonMemberName` place. The JSON grammar may need changing. And I don't have enough knowledge to modify the grammar.\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow Biome's Code of Conduct\n",
    "biomejs__biome-2600": "\ud83d\udc85 useTemplate problem\n### Environment information\r\n\r\n```bash\r\nCLI:\r\n  Version:                      1.7.1\r\n  Color support:                true\r\n\r\nPlatform:\r\n  CPU Architecture:             aarch64\r\n  OS:                           macos\r\n\r\nEnvironment:\r\n  BIOME_LOG_DIR:                unset\r\n  NO_COLOR:                     unset\r\n  TERM:                         \"xterm\"\r\n  JS_RUNTIME_VERSION:           \"v21.7.3\"\r\n  JS_RUNTIME_NAME:              \"node\"\r\n  NODE_PACKAGE_MANAGER:         \"pnpm/9.0.5\"\r\n\r\nBiome Configuration:\r\n  Status:                       Loaded successfully\r\n  Formatter disabled:           false\r\n  Linter disabled:              false\r\n  Organize imports disabled:    false\r\n  VCS disabled:                 true\r\n\r\nLinter:\r\n  Recommended:                  true\r\n  All:                          false\r\n  Rules:                        complexity/noMultipleSpacesInRegularExpressionLiterals = \"off\"\r\n\r\nWorkspace:\r\n  Open Documents:               0\r\n```\r\n\r\n\r\n### Rule name\r\n\r\nuseTemplate\r\n\r\n### Playground link\r\n\r\nhttps://biomejs.dev/playground/?code=JwBgAGAAYAB0AHMAXABuACcAIAArACAAeAAgACsAIAAnAFwAbgBgAGAAYAAnADsACgA%3D\r\n\r\n### Expected result\r\n\r\nNo error because the current code is readable enough. Instead, biome suggests a syntax invalid fix, and the readability also gets worse.\r\n\r\n```\r\n  \u2716 Template literals are preferred over string concatenation.\r\n  \r\n  > 1 \u2502 '```ts\\n' + x + '\\n```';\r\n      \u2502 ^^^^^^^^^^^^^^^^^^^^^^^\r\n    2 \u2502 \r\n  \r\n  \u2139 Unsafe fix: Use a template literal.\r\n  \r\n    1   \u2502 - '```ts\\n'\u00b7+\u00b7x\u00b7+\u00b7'\\n```';\r\n      1 \u2502 + `\\`\\`\\`ts\\n${x}\\n`\\`\\``;\r\n    2 2 \u2502   \r\n```\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow Biome's Code of Conduct\n",
    "biomejs__biome-2573": "\ud83d\udcce  Implement font-family-no-missing-generic-family-keyword\nImplement [font-family-no-missing-generic-family-keyword](https://stylelint.io/user-guide/rules/font-family-no-missing-generic-family-keyword)\n",
    "biomejs__biome-2513": "\ud83d\udcce Implement `block-no-empty`\n### Description\r\n\r\nImplement [block-no-empty](https://stylelint.io/user-guide/rules/block-no-empty)\r\n\r\n**Want to contribute?** Lets you know you are interested! We will assign you to the issue to prevent several people to work on the same issue. Don't worry, we can unassign you later if you are no longer interested in the issue! Read our [contributing guide](https://github.com/biomejs/biome/blob/main/CONTRIBUTING.md) and [analyzer contributing guide](https://github.com/biomejs/biome/blob/main/crates/biome_analyze/CONTRIBUTING.md).\n",
    "biomejs__biome-2510": "\ud83d\udcce Investigate AST nodes `TsNameWithTypeArguments` vs `TsReferenceType`\n### Description\r\n\r\nWhile reviewing #2092, I noticed that `TsNameWithTypeArguments` and `TsReferenceType` have the same shape and are always used together in a match condition in the semantic model. It seems that these two nodes have the same purpose.\r\n\r\nWe should investigate if there is a difference between these two types. If there is no difference then we should remove `TsNameWithTypeArguments`.\n",
    "biomejs__biome-2453": "\ud83d\udc85 [noMisplacedAssertion] The rule does not support `it.each` in `vitest`\n### Environment information\r\n\r\n```bash\r\n\u276f ppm biome rage --linter\r\nCLI:\r\n  Version:                      1.6.4\r\n  Color support:                true\r\n\r\nPlatform:\r\n  CPU Architecture:             aarch64\r\n  OS:                           macos\r\n\r\nEnvironment:\r\n  BIOME_LOG_DIR:                unset\r\n  NO_COLOR:                     unset\r\n  TERM:                         \"xterm-256color\"\r\n  JS_RUNTIME_VERSION:           \"v21.0.0\"\r\n  JS_RUNTIME_NAME:              \"node\"\r\n  NODE_PACKAGE_MANAGER:         \"pnpm/8.15.7\"\r\n\r\nBiome Configuration:\r\n  Status:                       Loaded successfully\r\n  Formatter disabled:           false\r\n  Linter disabled:              false\r\n  Organize imports disabled:    true\r\n  VCS disabled:                 false\r\n\r\nLinter:\r\n  Recommended:                  true\r\n  All:                          false\r\n  Rules:                        a11y/all = true\r\n                                complexity/all = true\r\n                                complexity/noExcessiveCognitiveComplexity = \"off\"\r\n                                complexity/noStaticOnlyClass = \"off\"\r\n                                complexity/noUselessSwitchCase = \"off\"\r\n                                complexity/useSimplifiedLogicExpression = \"off\"\r\n                                correctness/all = true\r\n                                nursery/all = true\r\n                                nursery/noConsole = \"off\"\r\n                                nursery/useImportRestrictions = \"off\"\r\n                                performance/all = true\r\n                                security/all = true\r\n                                style/all = true\r\n                                style/useNamingConvention = {\"level\":\"error\",\"options\":{\"strictCase\":false}}\r\n                                suspicious/all = true\r\n                                suspicious/useAwait = \"off\"\r\n\r\nWorkspace:\r\n  Open Documents:               0\r\n```\r\n\r\n\r\n### Rule name\r\n\r\nlint/nursery/noMisplacedAssertion\r\n\r\n### Playground link\r\n\r\nhttps://biomejs.dev/playground/?lintRules=all&code=aQB0AC4AZQBhAGMAaAAoAFsAXQApACgAJwB0AGUAcwB0ACcALAAgACgAKQAgAD0APgAgAHsACgAgACAAZQB4AHAAZQBjAHQAKAB0AHIAdQBlACkALgB0AG8AQgBlACgAdAByAHUAZQApADsACgB9ACkAOwA%3D\r\n\r\n### Actual result\r\n\r\nThis is the warning message when `it.each()` is used.\r\n\r\n> The assertion isn't inside a it(), test() or Deno.test() function call.biome[lint/nursery/noMisplacedAssertion](https://biomejs.dev/linter/rules/no-misplaced-assertion)\r\n\r\n```ts\r\n// src/__tests__/some.test.ts\r\nit.each([])('test', () => {\r\n  expect(true).toBe(true);\r\n});\r\n```\r\n\r\n### Expected result\r\n\r\nThe following code should work without any errors or warnings and `it.each()` should be supported.\r\n\r\n```ts\r\nit.each([])('test', () => {\r\n  expect(true).toBe(true);\r\n});\r\n```\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow Biome's Code of Conduct\n",
    "biomejs__biome-2404": "\ud83d\udcce Implement `lint/noConstantMinMax` - `clippy/min_max`\n### Description\n\nImplement [clippy/min_max](https://rust-lang.github.io/rust-clippy/master/#/min_max)\r\n\r\n**Want to contribute?** Lets you know you are interested! We will assign you to the issue to prevent several people to work on the same issue. Don't worry, we can unassign you later if you are no longer interested in the issue! Read our [contributing guide](https://github.com/biomejs/biome/blob/main/CONTRIBUTING.md) and [analyzer contributing guide](https://github.com/biomejs/biome/blob/main/crates/biome_analyze/CONTRIBUTING.md).\r\n\r\nThe rule should apply to `Math.min`/`Math,max`.\r\nWe should check that `Math` is a global unresolved reference.\r\nSee the rules such as [noGlobalIsFinite](https://biomejs.dev/linter/rules/no-global-is-finite/) to check this.\r\n\r\nSuggest names: `noConstantMinMax`, `noConstantMathMinMax`\n",
    "biomejs__biome-1070": "\ud83d\udc85 useSingleVarDeclarator suggests non-working code\n### Environment information\n\n```bash\nCLI:\r\n  Version:                      1.3.3\r\n  Color support:                true\r\n\r\nPlatform:\r\n  CPU Architecture:             aarch64\r\n  OS:                           macos\r\n\r\nEnvironment:\r\n  BIOME_LOG_DIR:                unset\r\n  NO_COLOR:                     unset\r\n  TERM:                         \"xterm-256color\"\r\n  JS_RUNTIME_VERSION:           \"v20.9.0\"\r\n  JS_RUNTIME_NAME:              \"node\"\r\n  NODE_PACKAGE_MANAGER:         \"npm/10.2.2\"\r\n\r\nBiome Configuration:\r\n  Status:                       Loaded successfully\r\n  Formatter disabled:           false\r\n  Linter disabled:              false\r\n  Organize imports disabled:    true\r\n  VCS disabled:                 true\r\n\r\nWorkspace:\r\n  Open Documents:               0\n```\n\n\n### Rule name\n\nuseSingleVarDeclarator\n\n### Playground link\n\nhttps://biomejs.dev/playground/?code=IAAgACAAIABjAG8AbgBzAHQACgAgACAAIAAgACAAIABBACAAPQAgADEAMAAwACwACgAgACAAIAAgACAAIABCACAAPQAgADEANQAwACwACgAgACAAIAAgACAAIABEACAAPQAgADEAMgAwACwACgAgACAAIAAgACAAIABFACAAPQAgAEQAIAAvACAAQgAsAAoAIAAgACAAIAAgACAARgAgAD0AIAB7AGgAZQBpAGcAaAB0ADoAIABCACwAIAB3AGkAZAB0AGgAOgAgAEEAfQA7AA%3D%3D\n\n### Expected result\n\nCode should work after lint fix :) \r\n\r\n```diff\r\n-     const\r\n-       A = 100,\r\n-       B = 150,\r\n-       D = 120,\r\n-       E = D / B,\r\n-       F = {height: B, width: A};\r\n+     constA = 100;    constB = 150;    constD = 120;    constE = D / B;    constF = {height: B, width: A};\r\n```\r\n\r\nExpected result was \r\n```ts\r\n    const A = 100;\r\n    const B = 150;\r\n    const D = 120;\r\n    const E = D / B;\r\n    const F = {height: B, width: A};\r\n```\n\n### Code of Conduct\n\n- [X] I agree to follow Biome's Code of Conduct\n",
    "biomejs__biome-996": "\ud83d\udc1b When using `React` hook prefix, exhaustive deps breaks\n### Environment information\r\n\r\n```block\r\n\u21b3  pnpm biome rage\r\nCLI:\r\n  Version:                      1.3.1\r\n  Color support:                true\r\n\r\nPlatform:\r\n  CPU Architecture:             x86_64\r\n  OS:                           windows\r\n\r\nEnvironment:\r\n  BIOME_LOG_DIR:                unset\r\n  NO_COLOR:                     unset\r\n  TERM:                         unset\r\n  JS_RUNTIME_VERSION:           \"v18.16.0\"\r\n  JS_RUNTIME_NAME:              \"node\"\r\n  NODE_PACKAGE_MANAGER:         \"pnpm/8.9.2\"\r\n\r\nBiome Configuration:\r\n  Status:                       Loaded successfully\r\n  Formatter disabled:           false\r\n  Linter disabled:              false\r\n  Organize imports disabled:    false\r\n  VCS disabled:                 true\r\n\r\nWorkspace:\r\n  Open Documents:               0\r\n```\r\n\r\n\r\n### What happened?\r\n\r\nWhile the following works as-expected:\r\n\r\n```tsx\r\nimport {useState, useEffect} from \"react\";\r\n\r\nconst Comp = () => {\r\n  const [count, setCount] = useState(0)\r\n\r\n  useEffect(() => {\r\n    setCount(v => v+1);\r\n  }, [])\r\n  \r\n  return null;\r\n}\r\n```\r\n\r\nAliasing React like so:\r\n\r\n```tsx\r\nimport * as React from \"react\";\r\n\r\nconst Comp = () => {\r\n  const [count, setCount] = React.useState(0)\r\n\r\n  React.useEffect(() => {\r\n    setCount(v => v+1);\r\n  }, [])\r\n  \r\n  return null;\r\n}\r\n```\r\n\r\nForces the following error to be thrown:\r\n\r\n```\r\nThis hook do not specify all of its dependencies.\r\n```\r\n\r\n[Playground link](https://biomejs.dev/playground/?code=aQBtAHAAbwByAHQAIAAqACAAYQBzACAAUgBlAGEAYwB0ACAAZgByAG8AbQAgACIAcgBlAGEAYwB0ACIAOwAKAAoAYwBvAG4AcwB0ACAAQwBvAG0AcAAgAD0AIAAoACkAIAA9AD4AIAB7AAoAIAAgAGMAbwBuAHMAdAAgAFsAYwBvAHUAbgB0ACwAIABzAGUAdABDAG8AdQBuAHQAXQAgAD0AIABSAGUAYQBjAHQALgB1AHMAZQBTAHQAYQB0AGUAKAAwACkACgAKACAAIABSAGUAYQBjAHQALgB1AHMAZQBFAGYAZgBlAGMAdAAoACgAKQAgAD0APgAgAHsACgAgACAAIAAgAHMAZQB0AEMAbwB1AG4AdAAoAHYAIAA9AD4AIAB2ACsAMQApADsACgAgACAAfQAsACAAWwBdACkACgAgACAACgAgACAAcgBlAHQAdQByAG4AIABuAHUAbABsADsACgB9AA%3D%3D)\r\n\r\n### Expected result\r\n\r\nNo errors to be thrown in the code sample listed above\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow Biome's Code of Conduct\n",
    "biomejs__biome-872": "\ud83d\udc1b unnecessary trailing comma in type parameter list\n### Environment information\r\n\r\n```block\r\nPlaground\r\n```\r\n\r\n\r\n### What happened?\r\n\r\nBiome keeps the trailing comma of type parameter lists.\r\nThe following example:\r\n\r\n```ts\r\nclass A<T,> {\r\n}\r\n```\r\n\r\nis formatted to:\r\n\r\n```ts\r\nclass A<T,> {}\r\n```\r\n\r\n[Playground link](https://biomejs.dev/playground?code=YwBsAGEAcwBzACAAQQA8AFQALAA%2BACAAewAKACAAIAAKAH0A)\r\n\r\n### Expected result\r\n\r\nBiome should remove an unnecessary trailing comma.\r\nThe example should thus be formatted to:\r\n\r\n```ts\r\nclass A<T> {}\r\n```\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow Biome's Code of Conduct\n",
    "biomejs__biome-867": "\ud83d\udc85 False positive `lint/correctness/noUnusedVariables` on bracketless arrow functions\n### Environment information\n\n```bash\n$ bun biome rage\r\nCLI:\r\n  Version:                      1.3.3-nightly.38797b7\r\n  Color support:                true\r\n\r\nPlatform:\r\n  CPU Architecture:             x86_64\r\n  OS:                           linux\r\n\r\nEnvironment:\r\n  BIOME_LOG_DIR:                unset\r\n  NO_COLOR:                     unset\r\n  TERM:                         \"xterm-256color\"\r\n  JS_RUNTIME_VERSION:           \"v18.14.1\"\r\n  JS_RUNTIME_NAME:              \"node\"\r\n  NODE_PACKAGE_MANAGER:         \"bun/1.0.13\"\r\n\r\nBiome Configuration:\r\n  Status:                       Loaded successfully\r\n  Formatter disabled:           false\r\n  Linter disabled:              false\r\n  Organize imports disabled:    false\r\n  VCS disabled:                 true\r\n\r\nWorkspace:\r\n  Open Documents:\n```\n\n\n### Rule name\n\n`lint/correctness/noUnusedVariables`\n\n### Playground link\n\nhttps://biomejs.dev/playground/?lintRules=all&code=PAA%2BAAoAIAAgADwAdQBsAD4ACgAgACAAIAAgAHsAWwAxACwAMgAsADMAXQAuAG0AYQBwACgAZQAgAD0APgAgACgACgAgACAAIAAgACAAIAA8AGwAaQAgAGsAZQB5AD0AewBlAH0APgB7AGUAfQA8AC8AbABpAD4ACgAgACAAIAAgACkAKQB9AAoAIAAgADwALwB1AGwAPgAKACAAIAAgACAACgAgACAAPAB1AGwAPgAKACAAIAAgACAAewBbADEALAAyACwAMwBdAC4AbQBhAHAAKAAoAGUAKQAgAD0APgAgACgACgAgACAAIAAgACAAIAA8AGwAaQAgAGsAZQB5AD0AewBlAH0APgB7AGUAfQA8AC8AbABpAD4ACgAgACAAIAAgACkAKQB9AAoAIAAgADwALwB1AGwAPgAKADwALwA%2BAA%3D%3D\n\n### Expected result\n\nIt should not throw an error in the case shown in the playground.\n\n### Code of Conduct\n\n- [X] I agree to follow Biome's Code of Conduct\n",
    "biomejs__biome-859": "\ud83d\udc1b File ignored when `.gitignore` partially matching characters are included\n### Environment information\n\n```block\nCLI:\r\n  Version:                      1.3.3\r\n  Color support:                true\r\n\r\nPlatform:\r\n  CPU Architecture:             aarch64\r\n  OS:                           macos\r\n\r\nEnvironment:\r\n  BIOME_LOG_DIR:                unset\r\n  NO_COLOR:                     unset\r\n  TERM:                         \"xterm-256color\"\r\n  JS_RUNTIME_VERSION:           \"v20.9.0\"\r\n  JS_RUNTIME_NAME:              \"node\"\r\n  NODE_PACKAGE_MANAGER:         \"pnpm/8.10.2\"\r\n\r\nBiome Configuration:\r\n  Status:                       Loaded successfully\r\n  Formatter disabled:           false\r\n  Linter disabled:              false\r\n  Organize imports disabled:    false\r\n  VCS disabled:                 false\r\n\r\nWorkspace:\r\n  Open Documents:               0\n```\n\n\n### What happened?\n\nrepro: https://codesandbox.io/p/devbox/funny-proskuriakova-p5vszk?file=/.gitignore:3,1\r\n\r\nWhen `.gitignore` contains characters like `out`, git will ignore just `out` file or `out` directory. Biome ignores `layout.tsx`, `routes/foo.ts`  when `vcs` option enabled. I think it is partially matching like lay `out` and r `out` es.\r\nIs this expected behavior?\r\nThanks\r\n\r\nfrom https://discord.com/channels/1132231889290285117/1177202269054320680\n\n### Expected result\n\nThe same behavior as git.\n\n### Code of Conduct\n\n- [X] I agree to follow Biome's Code of Conduct\n",
    "biomejs__biome-693": "\ud83d\udc1b `biome format` breaks emojis when used via stdin\n### Environment information\r\n\r\n```block\r\nCLI:\r\n  Version:                      1.2.2\r\n  Color support:                true\r\n\r\nPlatform:\r\n  CPU Architecture:             aarch64\r\n  OS:                           macos\r\n\r\nEnvironment:\r\n  BIOME_LOG_DIR:                unset\r\n  NO_COLOR:                     unset\r\n  TERM:                         \"xterm-256color\"\r\n  JS_RUNTIME_VERSION:           \"v20.7.0\"\r\n  JS_RUNTIME_NAME:              \"node\"\r\n  NODE_PACKAGE_MANAGER:         unset\r\n\r\nBiome Configuration:\r\n  Status:                       unset\r\n\r\nWorkspace:\r\n  Open Documents:               0\r\n\r\nDiscovering running Biome servers...\r\n\r\nServer:\r\n  Status:                       stopped\r\n```\r\n\r\n\r\n### What happened?\r\n\r\nWhen using `biome format` via stdin, some emojis seem to break. This does not affect all emojis, and it does not affect `biome format --write`.\r\n\r\n(The different emoji sizes is a Wezterm-font-thing, I checked that the issue persists when opening the file in TextEdit.)\r\n\r\n<img width=\"956\" alt=\"Pasted image 2023-09-30 at 13 14 41@2x\" src=\"https://github.com/biomejs/biome/assets/73286100/1d145c2f-c1be-4a98-bb06-18eb21b4415d\">\r\n\r\n\r\n### Expected result\r\n\r\nEmojis not breaking\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow Biome's Code of Conduct\n",
    "biomejs__biome-619": "\ud83d\udcce js_parser: support RegExp `v` flag\n### Description\n\nMake the JavaScript parser to recognize the RegExp `v` flag (Unicode sets). The [tc39/proposal-regexp-v-flag](https://github.com/tc39/proposal-regexp-v-flag) has reached the stage 4 of the TC39 process and is [widely supported](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp/unicodeSets#browser_compatibility) by browsers and Node.js/Deno.\r\n\r\nFor example, the following is currently a parse error:\r\n\r\n```js\r\n/[\\p{Control}--[\\t\\n]]/v\r\n```\r\n\r\n[Open in playground](https://biomejs.dev/playground/?code=LwBbAFwAcAB7AEMAbwBuAHQAcgBvAGwAfQAtAC0AWwBcAHQAXABuAF0AXQAvAHYA)\n",
    "biomejs__biome-521": "\ud83d\udcce Implement `lint/noEmptyBlockStatements` - `eslint/no-empty` `eslint/no-empty-static-block`\n### Description\r\n\r\nThis lint rule should integrate both [no-empty](https://eslint.org/docs/latest/rules/no-empty/) and [no-empty-static-block](https://eslint.org/docs/latest/rules/no-empty-static-block/) rules.\r\n\r\n**Want to contribute?** Lets you know you are interested! We will assign you to the issue to prevent several people to work on the same issue. Don't worry, we can unassign you later if you are no longer interested in the issue! Read our [contributing guide](https://github.com/biomejs/biome/blob/main/CONTRIBUTING.md) and [analyzer contributing guide](https://github.com/biomejs/biome/blob/main/crates/biome_analyze/CONTRIBUTING.md).\n",
    "biomejs__biome-469": "\ud83d\udcce Implement `lint/noMisrefactoredShorthandAssign` - `clippy/misrefactored_assign_op`\n### Description\n\nClippy [misrefactored_assign_op](https://rust-lang.github.io/rust-clippy/master/#/misrefactored_assign_op).\r\n\r\nWant to contribute? Lets us know you are interested! We will assign you to the issue to prevent several people to work on the same issue. Don't worry, we can unassign you later if you are no longer interested in the issue! Read our [contributing guide](https://github.com/biomejs/biome/blob/main/CONTRIBUTING.md) and [analyzer contributing guide](https://github.com/biomejs/biome/blob/main/crates/biome_analyze/CONTRIBUTING.md).\r\n\r\nThe implementor may take some inspirations from [useShorthandAssign](https://biomejs.dev/linter/rules/use-shorthand-assign).\n",
    "biomejs__biome-468": "\ud83d\udc1b `noRedundantUseStrict`: Applying fixes also removes the comment above \"use strict\" directive\n### Environment information\n\n```block\nCLI:\r\n  Version:                      1.2.2\r\n  Color support:                true\r\n\r\nPlatform:\r\n  CPU Architecture:             x86_64\r\n  OS:                           windows\r\n\r\nEnvironment:\r\n  BIOME_LOG_DIR:                unset\r\n  NO_COLOR:                     unset\r\n  TERM:                         unset\r\n  JS_RUNTIME_VERSION:           \"v18.17.1\"\r\n  JS_RUNTIME_NAME:              \"node\"\r\n  NODE_PACKAGE_MANAGER:         \"npm/9.1.2\"\r\n\r\nBiome Configuration:\r\n  Status:                       unset\r\n\r\nWorkspace:\r\n  Open Documents:               0\n```\n\n\n### What happened?\n\nExample Code\r\n-----\r\n\r\n```javascript\r\n// some comments...\r\n\"use strict\";\r\n\r\nconsole.info(\"HELLO, WORLD!\");\r\n```\r\n\r\nStep to reproduce\r\n----\r\n\r\n1. Save this code to somewhere. (I tried this without any configuration file)\r\n2. Run `biome check --apply example.js`\r\n3. Check fixed code and notify the `// some comments...` is also removed.\n\n### Expected result\n\nIt should only remove the `\"use strict\"` directive, not the comment.\r\n\r\n```javascript\r\n// some comments...\r\n\r\nconsole.info(\"HELLO, WORLD!\");\r\n```\n\n### Code of Conduct\n\n- [X] I agree to follow Biome's Code of Conduct\n",
    "biomejs__biome-457": "\ud83d\udcce change how `rome rage` collects data\n### Description\r\n\r\nAt the moment, when you run `biome rage`, the command reads a bunch of stuff from your machine and the configuration file. \r\n\r\nThen, if a Daemon is running that is hooked to the LSP of the user, it prints all the logs captured in the last hour. This can be overwhelming if the user has used the LSP heavily for the last hour.\r\n\r\nI propose to change the command as is:\r\n- `biome rage`: prints basic information but not the logs;\r\n- `biome rage --daemon-logs`: current behaviour;\r\n\r\nWe can bikeshed the flag's name, but I'm more concerned about the change in functionality.\n",
    "biomejs__biome-385": "\ud83d\udc1b correctness/noSelfAssign false positive\n### Environment information\n\n```block\nbiome v 1.2.2\n```\n\n\n### What happened?\n\nSee code.\r\n\r\n```\r\ndocument\r\n\t\t\t\t\t\t\t\t.querySelector(`[data-field-id=\"customModel-container\"]`)\r\n\t\t\t\t\t\t\t\t.querySelector('input').value = document\r\n\t\t\t\t\t\t\t\t.querySelector(`[data-field-id=\"${modelField.id}-field\"]`)\r\n\t\t\t\t\t\t\t\t.querySelector('input').value;\r\n```\r\n\r\nerror is:\r\n\r\n```\r\n\u2716 value is assigned to itself.\r\n  \r\n    3694 \u2502 \t\t\t\t\t\t\t\t.querySelector('input').value = document\r\n    3695 \u2502 \t\t\t\t\t\t\t\t.querySelector(`[data-field-id=\"${modelField.id}-field\"]`)\r\n  > 3696 \u2502 \t\t\t\t\t\t\t\t.querySelector('input').value;\r\n         \u2502 \t\t\t\t\t\t\t\t                        ^^^^^\r\n    3697 \u2502 \t\t\t\t\t\t});\r\n    3698 \u2502 \t\t\t\t\t},\r\n  \r\n  \u2139 This is where is assigned.\r\n  \r\n    3692 \u2502 \t\t\t\t\t\t\tdocument\r\n    3693 \u2502 \t\t\t\t\t\t\t\t.querySelector(`[data-field-id=\"customModel-container\"]`)\r\n  > 3694 \u2502 \t\t\t\t\t\t\t\t.querySelector('input').value = document\r\n         \u2502 \t\t\t\t\t\t\t\t                        ^^^^^\r\n    3695 \u2502 \t\t\t\t\t\t\t\t.querySelector(`[data-field-id=\"${modelField.id}-field\"]`)\r\n    3696 \u2502 \t\t\t\t\t\t\t\t.querySelector('input').value;\r\n```\n\n### Expected result\n\nThat's not a self-assignment though.\n\n### Code of Conduct\n\n- [X] I agree to follow Biome's Code of Conduct\n",
    "biomejs__biome-384": "\ud83d\udc1b `lint/noMultipleSpacesInRegularExpressionLiterals` code fix doesn't correctly handle consecutive spaces followed by a quantifier\n### Environment information\n\n```block\nPlayground\n```\n\n\n### What happened?\n\nThe rule provides a wrong an incorrect suggestion when a quantifier follows multiple spaces.\r\n\r\nFor instance, the rule provides the following incorrect fix:\r\n\r\n```diff\r\n- /  +/\r\n+ / {2}+/\r\n```\n\n### Expected result\n\nThe rule should provide a correct fix.\n\n### Code of Conduct\n\n- [X] I agree to follow Biome's Code of Conduct\n",
    "biomejs__biome-326": "\ud83d\udcce Implement `json.parser.allowTrailingCommas`\n### Description\r\n\r\nAs reported in #83, some config files support trailing comma.\r\n`json.parser.allowTrailingCommas: true` enables trailing commas in `json` and `jsonc` files, making the following example valid:\r\n\r\n```jsonc\r\n{\r\n  \"prop1\": [\r\n    1,\r\n    2,\r\n  ],\r\n  \"prop2\": 0,\r\n}\r\n```\r\n\r\nSimilar to `json.parser.allowComments`, `json.parser.allowTrailingCommas: true` should be enabled by default when parsing files such as `tsconfig.json`, [VSCode config files](https://code.visualstudio.com/docs/languages/json#_json-with-comments), and others?\n",
    "biomejs__biome-3207": "\ud83d\udc1b `npx @biomejs/biome migrate` command crashes\n### Environment information\n\n```block\nCLI:\r\n  Version:                      1.8.1\r\n  Color support:                true\r\n\r\nPlatform:\r\n  CPU Architecture:             x86_64\r\n  OS:                           linux\r\n\r\nEnvironment:\r\n  BIOME_LOG_DIR:                unset\r\n  NO_COLOR:                     unset\r\n  TERM:                         \"xterm-256color\"\r\n  JS_RUNTIME_VERSION:           \"v20.14.0\"\r\n  JS_RUNTIME_NAME:              \"node\"\r\n  NODE_PACKAGE_MANAGER:         \"npm/10.7.0\"\r\n\r\nBiome Configuration:\r\n  Status:                       Loaded successfully\r\n  Formatter disabled:           false\r\n  Linter disabled:              false\r\n  Organize imports disabled:    false\r\n  VCS disabled:                 true\r\n\r\nWorkspace:\r\n  Open Documents:               0\n```\n\n\n### What happened?\n\n`npx @biomejs/biome migrate` \r\n\r\n```bash\r\nBiome encountered an unexpected error                                                                                                                                  \r\nThis is a bug in Biome, not an error in your code, and we would appreciate it if you could report it to https://github.com/biomejs/biome/issues/ along with the following information to help us fixing the issue:\r\n                                                                         \r\nSource Location: /home/runner/work/biome/biome/crates/biome_rowan/src/ast/mod.rs:686:41 \r\nThread Name: main                                             \r\nMessage: Malformed list, node expected but found token COMMA@1621..1622 \",\" [] [] instead. You must add missing markers for missing elements.\r\n```\n\n### Expected result\n\nIt should update the biome.json file or something positive on what next to do, but not an error or bug report like this.\n\n### Code of Conduct\n\n- [X] I agree to follow Biome's Code of Conduct\n",
    "biomejs__biome-3036": "\ud83d\udc1b Quotes within quotes of Formatter IR isn't escaped\n### Environment information\r\n\r\n```block\r\nThis is running Biomejs playground with no special options enabled.\r\n```\r\n\r\n\r\n### What happened?\r\n\r\n1. Had a string in Biome.js playground: https://biomejs.dev/playground/?code=YQB3AGEAaQB0ACAAIgBhACIAIAA%3D\r\n```ts\r\nawait \"a\" \r\n```\r\n3. Double quotes is not escaped or enclosing string is not single quoted (as in Prettier Formatter IR):\r\n![Screenshot 2023-12-04 at 7 53 08 PM](https://github.com/biomejs/biome/assets/53054099/130828a8-d212-4305-9571-d1952d7b1d2d)\r\n4. This also causes broken syntax highlighting\r\n\r\n### Expected result\r\n\r\nExpected result is either the double quotes surrounding `\"a\"` are escaped:\r\n\r\n```ts\r\n[\"await \\\"a\\\";\", hard_line_break]\r\n```\r\n\r\nOr single quotes used for enclosing quotes instead:\r\n\r\n```ts\r\n['await \"a\";', hard_line_break]\r\n```\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow Biome's Code of Conduct\n",
    "biomejs__biome-3034": "\ud83d\udcce  Implement selector-pseudo-class-no-unknown\n## Description\r\n\r\nImplement [selector-pseudo-class-no-unknown](https://stylelint.io/user-guide/rules/selector-pseudo-class-no-unknown)\r\n\r\n> [!IMPORTANT]\r\n> - Please skip implementing options for now since we will evaluate users actually want them later.\r\n> - Please ignore handling extended CSS language cases such as `sass` and `less`.\r\n> - Please skip custom function since we haven't syntax model yet.\r\n\r\n**Want to contribute?** Lets you know you are interested! We will assign you to the issue to prevent several people to work on the same issue. Don't worry, we can unassign you later if you are no longer interested in the issue! Read our [contributing guide](https://github.com/biomejs/biome/blob/main/CONTRIBUTING.md) and [analyzer contributing guide](https://github.com/biomejs/biome/blob/main/crates/biome_analyze/CONTRIBUTING.md).\n",
    "biomejs__biome-2989": "\ud83d\udcce Support `{a,b}` glob pattern syntax for includes/excludes\n# Summary\r\n\r\nWe want to support `{a,b}` pattern matching syntax for includes and excludes. It will allow us to more comprehensively support all the patterns that the Editorconfig spec defines (although not completely).\r\n\r\nSpecifically, this syntax is to indicate that in the pattern `{a,b}`, there is a comma separated list of patterns that are applicable in that position. \n",
    "biomejs__biome-2958": "\ud83d\udcce  Implement declaration-block-no-shorthand-property-overrides\n## Description\r\n\r\nImplement [declaration-block-no-shorthand-property-overrides](https://stylelint.io/user-guide/rules/declaration-block-no-shorthand-property-overrides)\r\n\r\n> [!IMPORTANT]\r\n> - Please skip implementing options for now since we will evaluate users actually want them later.\r\n> - Please ignore handling extended CSS language cases such as `sass` and `less`.\r\n> - Please skip custom function since we haven't syntax model yet.\r\n\r\n**Want to contribute?** Lets you know you are interested! We will assign you to the issue to prevent several people to work on the same issue. Don't worry, we can unassign you later if you are no longer interested in the issue! Read our [contributing guide](https://github.com/biomejs/biome/blob/main/CONTRIBUTING.md) and [analyzer contributing guide](https://github.com/biomejs/biome/blob/main/crates/biome_analyze/CONTRIBUTING.md).\n",
    "biomejs__biome-2892": "\ud83d\udcce Make code fix kind configurable\n### Description\r\n\r\nUsers have asked several times for a way to [disable a rule fix](https://github.com/biomejs/biome/discussions/2104) or to upgrade a rule fix from `unsafe` to `safe`. Some users would also like a way to downgrade a fix from `safe` to `unsafe`.\r\n\r\nDisabling a code fix is particularly useful if a user encounters a bug with the code fix.\r\nThe user can then disable the rule and continue to use `--apply`/`--apply-unsafe`.\r\nUpgrading a code fix to `safe` has the advantage of allowing users to automatically fix a rule in an IDE.\r\nConversely, downgrading a rule allows you to disable auto-fixing in the IDE.\r\n\r\nI propose to add a new field `fix` to each rule configuration.\r\n`fix` will take a value among `safe`, `unsafe` and `none`.\r\nIf the field is not set, then the default fix kind is the kind declared in the rule.\r\nThis field has no effect for rules without a code fix. Ideally we should output an error for such rules.\r\n\r\nHere is an example, where we disable the code fix of `noUnusedVariables`, where we downgrade the code fix `useConst` of and upgrade the code fix of `useTemplate`\r\n\r\n```json\r\n{\r\n  \"linter\": {\r\n    \"rules\": {\r\n      \"correctness\": {\r\n        \"noUnusedVariables\": {\r\n          \"level\": \"error\",\r\n          \"fix\": \"none\"\r\n        },\r\n        \"style\": {\r\n          \"useConst\": {\r\n            \"level\": \"warn\",\r\n            \"fix\": \"unsafe\"\r\n          },\r\n          \"useTemplate\": {\r\n            \"level\": \"warn\",\r\n            \"fix\": \"safe\"\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n```\n",
    "biomejs__biome-2868": "\ud83d\udc1b parser chokes when `const` modifier describes a constructor function\n### Environment information\r\n\r\n- [Biome playground](https://biomejs.dev/playground/?lineWidth=120&code=LwAvACAAVAB5AHAAZQBTAGMAcgBpAHAAdAAgAHAAbABhAHkAZwByAG8AdQBuAGQAOgAgAGgAdAB0AHAAcwA6AC8ALwB0AHMAcABsAGEAeQAuAGQAZQB2AC8ATgBWAFgAbABCAFcACgAvAC8AIABHAGkAdABIAHUAYgAgAGkAcwBzAHUAZQA6ACAAaAB0AHQAcABzADoALwAvAGcAaQB0AGgAdQBiAC4AYwBvAG0ALwBiAGkAbwBtAGUAagBzAC8AYgBpAG8AbQBlAC8AaQBzAHMAdQBlAHMALwAyADgAMgA1AAoACgAvAC8AIABCAGkAbwBtAGUAJwBzACAAcABhAHIAcwBlAHIAIABzAGUAZQBtAHMAIAB0AG8AIABjAGgAbwBrAGUAIABvAG4AIAB0AGgAZQAgAGAAYwBvAG4AcwB0AGAAIABtAG8AZABpAGYAaQBlAHIACgAvAC8AIAB3AGgAZQBuACAAdABoAGUAIABtAGUAdABoAG8AZAAgAG4AYQBtAGUAIABpAHMAIABgAG4AZQB3AGAACgAKAGQAZQBjAGwAYQByAGUAIABjAG8AbgBzAHQAIABlAHgAYQBtAHAAbABlADoAIAB7AAoAIAAgAC8ALwAgACAAkyGTIZMhkyGTIQoAIAAgAG4AZQB3ADwAYwBvAG4AcwB0ACAAVAA%2BACgAYQByAGcAcwA6ACAAVAApADoAIABUAAoAfQAKAAoALwAvACAAVABoAGUAIABUAHkAcABlAFMAYwByAGkAcAB0ACAAZABvAGMAcwAgAGkAbgBjAGwAdQBkAGUAIABhACAAcwBtAGEAbABsACAAcwBlAGMAdABpAG8AbgAgAG8AbgAgAGgAbwB3ACAAYABuAGUAdwBgACAAYwBhAG4AIABiAGUAIAB1AHMAZQBkACAAdABvACAAaQBtAHAAbABlAG0AZQBuAHQAIABtAGkAeABpAG4AcwA6AAoALwAvACAAaAB0AHQAcABzADoALwAvAHcAdwB3AC4AdAB5AHAAZQBzAGMAcgBpAHAAdABsAGEAbgBnAC4AbwByAGcALwBkAG8AYwBzAC8AaABhAG4AZABiAG8AbwBrAC8AMgAvAGcAZQBuAGUAcgBpAGMAcwAuAGgAdABtAGwAIwB1AHMAaQBuAGcALQBjAGwAYQBzAHMALQB0AHkAcABlAHMALQBpAG4ALQBnAGUAbgBlAHIAaQBjAHMACgA%3D)\r\n- [TypeScript playground](https://tsplay.dev/NVXlBW)\r\n\r\n\r\n```block\r\nCLI:\r\n  Version:                      1.7.3\r\n  Color support:                true\r\n\r\nPlatform:\r\n  CPU Architecture:             aarch64\r\n  OS:                           macos\r\n\r\nEnvironment:\r\n  BIOME_LOG_DIR:                unset\r\n  NO_COLOR:                     unset\r\n  TERM:                         \"xterm-256color\"\r\n  JS_RUNTIME_VERSION:           \"v20.9.0\"\r\n  JS_RUNTIME_NAME:              \"node\"\r\n  NODE_PACKAGE_MANAGER:         unset\r\n\r\nBiome Configuration:\r\n  Status:                       Loaded successfully\r\n  Formatter disabled:           false\r\n  Linter disabled:              false\r\n  Organize imports disabled:    false\r\n  VCS disabled:                 false\r\n\r\nWorkspace:\r\n  Open Documents:               0\r\n```\r\n\r\n### What happened?\r\n\r\nHopefully the playground repro + biome rage + issue title is descriptive enough, but let me know if you'd like me to talk through anything! :)\r\n\r\n### Expected result\r\n\r\nParser understands that `new` in a type signature is a method, and allows type parameters to be declared with the `const` modifier\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow Biome's Code of Conduct\n",
    "biomejs__biome-4321": "\ud83d\udc85 useFilenamingConvention errors on files starting with non-letter, a $ for example\n### Environment information\n\n```bash\nCLI:\r\n  Version:                      1.9.2\r\n  Color support:                true\r\n\r\nPlatform:\r\n  CPU Architecture:             aarch64\r\n  OS:                           macos\r\n\r\nEnvironment:\r\n  BIOME_LOG_PATH:               unset\r\n  BIOME_LOG_PREFIX_NAME:        unset\r\n  BIOME_CONFIG_PATH:            unset\r\n  NO_COLOR:                     unset\r\n  TERM:                         \"alacritty\"\r\n  JS_RUNTIME_VERSION:           \"v20.17.0\"\r\n  JS_RUNTIME_NAME:              \"node\"\r\n  NODE_PACKAGE_MANAGER:         \"pnpm/9.11.0\"\r\n\r\nBiome Configuration:\r\n  Status:                       Loaded successfully\r\n  Formatter disabled:           false\r\n  Linter disabled:              false\r\n  Organize imports disabled:    false\r\n  VCS disabled:                 false\r\n\r\nLinter:\r\n  JavaScript enabled:           true\r\n  JSON enabled:                 true\r\n  CSS enabled:                  true\r\n  GraphQL enabled:              false\r\n  Recommended:                  true\r\n  All:                          false\r\n  Enabled rules:\r\n  style/useImportType\r\n  suspicious/noCatchAssign\r\n  suspicious/noUnsafeNegation\r\n  complexity/useLiteralKeys\r\n  complexity/noMultipleSpacesInRegularExpressionLiterals\r\n  a11y/useValidLang\r\n  complexity/noUselessEmptyExport\r\n  suspicious/useNamespaceKeyword\r\n  suspicious/useValidTypeof\r\n  a11y/useValidAriaRole\r\n  correctness/noConstantCondition\r\n  a11y/useAriaActivedescendantWithTabindex\r\n  suspicious/noAssignInExpressions\r\n  style/useDefaultParameterLast\r\n  complexity/noEmptyTypeParameters\r\n  correctness/noConstructorReturn\r\n  style/useSelfClosingElements\r\n  suspicious/noDuplicateParameters\r\n  suspicious/noDuplicateSelectorsKeyframeBlock\r\n  suspicious/noMisplacedAssertion\r\n  correctness/noUnknownProperty\r\n  style/useTemplate\r\n  correctness/noUnusedLabels\r\n  complexity/noUselessTernary\r\n  correctness/noUnreachableSuper\r\n  suspicious/noCompareNegZero\r\n  correctness/noSwitchDeclarations\r\n  a11y/noAutofocus\r\n  correctness/noUnsafeOptionalChaining\r\n  correctness/noConstAssign\r\n  suspicious/noControlCharactersInRegex\r\n  complexity/noUselessTypeConstraint\r\n  style/noVar\r\n  suspicious/noDoubleEquals\r\n  suspicious/noRedundantUseStrict\r\n  style/useLiteralEnumMembers\r\n  suspicious/noGlobalIsNan\r\n  suspicious/noEmptyInterface\r\n  suspicious/noConstEnum\r\n  suspicious/noMisleadingCharacterClass\r\n  correctness/noPrecisionLoss\r\n  a11y/noLabelWithoutControl\r\n  suspicious/noRedeclare\r\n  correctness/noStringCaseMismatch\r\n  correctness/noSetterReturn\r\n  correctness/noInvalidConstructorSuper\r\n  suspicious/noImplicitAnyLet\r\n  suspicious/noFallthroughSwitchClause\r\n  suspicious/noUnsafeDeclarationMerging\r\n  correctness/noUnreachable\r\n  a11y/useKeyWithClickEvents\r\n  suspicious/noDuplicateObjectKeys\r\n  complexity/noUselessThisAlias\r\n  complexity/noThisInStatic\r\n  complexity/useOptionalChain\r\n  correctness/noInnerDeclarations\r\n  suspicious/noDuplicateCase\r\n  a11y/useValidAnchor\r\n  complexity/useRegexLiterals\r\n  correctness/noSelfAssign\r\n  correctness/noInvalidBuiltinInstantiation\r\n  style/noUselessElse\r\n  style/useShorthandFunctionType\r\n  suspicious/noShadowRestrictedNames\r\n  correctness/noInvalidDirectionInLinearGradient\r\n  style/useThrowNewError\r\n  suspicious/noImportantInKeyframe\r\n  a11y/useMediaCaption\r\n  complexity/noUselessLabel\r\n  complexity/noUselessCatch\r\n  correctness/noUnsafeFinally\r\n  a11y/useAriaPropsForRole\r\n  correctness/noNonoctalDecimalEscape\r\n  style/useEnumInitializers\r\n  a11y/useHtmlLang\r\n  suspicious/noDuplicateTestHooks\r\n  complexity/noStaticOnlyClass\r\n  suspicious/noEvolvingTypes\r\n  style/useWhile\r\n  complexity/useArrowFunction\r\n  style/noInferrableTypes\r\n  a11y/noNoninteractiveTabindex\r\n  complexity/useSimpleNumberKeys\r\n  correctness/useYield\r\n  a11y/noInteractiveElementToNoninteractiveRole\r\n  style/useNumericLiterals\r\n  correctness/noUnnecessaryContinue\r\n  suspicious/noApproximativeNumericConstant\r\n  suspicious/noImportAssign\r\n  suspicious/noLabelVar\r\n  correctness/noGlobalObjectCalls\r\n  suspicious/useDefaultSwitchClauseLast\r\n  a11y/useAltText\r\n  correctness/noEmptyCharacterClassInRegex\r\n  correctness/noUnknownUnit\r\n  suspicious/noSparseArray\r\n  a11y/useIframeTitle\r\n  complexity/noBannedTypes\r\n  correctness/noVoidElementsWithChildren\r\n  suspicious/noPrototypeBuiltins\r\n  style/useAsConstAssertion\r\n  correctness/useJsxKeyInIterable\r\n  style/useExportType\r\n  complexity/noUselessLoneBlockStatements\r\n  suspicious/noDebugger\r\n  style/noArguments\r\n  suspicious/noMisleadingInstantiator\r\n  a11y/useValidAriaValues\r\n  a11y/useFocusableInteractive\r\n  suspicious/noCommentText\r\n  correctness/noUnmatchableAnbSelector\r\n  suspicious/noDuplicateJsxProps\r\n  suspicious/noGlobalAssign\r\n  a11y/noPositiveTabindex\r\n  correctness/noEmptyPattern\r\n  complexity/noExcessiveNestedTestSuites\r\n  security/noDangerouslySetInnerHtmlWithChildren\r\n  a11y/useKeyWithMouseEvents\r\n  suspicious/noExtraNonNullAssertion\r\n  suspicious/noShorthandPropertyOverrides\r\n  correctness/noRenderReturnValue\r\n  correctness/useExhaustiveDependencies\r\n  security/noGlobalEval\r\n  style/useConst\r\n  a11y/noRedundantRoles\r\n  complexity/useFlatMap\r\n  correctness/useIsNan\r\n  correctness/useHookAtTopLevel\r\n  correctness/noUnusedVariables\r\n  suspicious/noGlobalIsFinite\r\n  suspicious/noSelfCompare\r\n  suspicious/noAsyncPromiseExecutor\r\n  suspicious/noDuplicateFontNames\r\n  suspicious/noThenProperty\r\n  suspicious/useGetterReturn\r\n  style/useNodejsImportProtocol\r\n  a11y/noDistractingElements\r\n  suspicious/noArrayIndexKey\r\n  complexity/noWith\r\n  suspicious/noDuplicateClassMembers\r\n  complexity/noExtraBooleanCast\r\n  suspicious/noSuspiciousSemicolonInJsx\r\n  a11y/useValidAriaProps\r\n  a11y/noRedundantAlt\r\n  correctness/noChildrenProp\r\n  correctness/noUnknownFunction\r\n  correctness/noInvalidPositionAtImportRule\r\n  suspicious/noConfusingLabels\r\n  suspicious/noConfusingVoidType\r\n  suspicious/noFocusedTests\r\n  a11y/useButtonType\r\n  style/noShoutyConstants\r\n  a11y/noAriaUnsupportedElements\r\n  correctness/noInvalidGridAreas\r\n  style/useFilenamingConvention\r\n  correctness/noFlatMapIdentity\r\n  a11y/noBlankTarget\r\n  a11y/useHeadingContent\r\n  correctness/useValidForDirection\r\n  correctness/noVoidTypeReturn\r\n  correctness/noInvalidUseBeforeDeclaration\r\n  a11y/noAriaHiddenOnFocusable\r\n  a11y/useGenericFontNames\r\n  correctness/noUnknownMediaFeatureName\r\n  a11y/useAnchorContent\r\n  complexity/noUselessRename\r\n  style/useNumberNamespace\r\n  complexity/noUselessConstructor\r\n  a11y/noAccessKey\r\n  nursery/useSortedClasses\r\n  style/noUnusedTemplateLiteral\r\n  complexity/noUselessSwitchCase\r\n  style/useExponentiationOperator\r\n  style/noNegationElse\r\n  style/useSingleVarDeclarator\r\n  suspicious/noExportsInTest\r\n  a11y/noNoninteractiveElementToInteractiveRole\r\n  style/noCommaOperator\r\n  suspicious/noDuplicateAtImportRules\r\n  suspicious/useIsArray\r\n  a11y/noHeaderScope\r\n  complexity/noUselessFragments\r\n  suspicious/noMisrefactoredShorthandAssign\r\n  complexity/noForEach\r\n  suspicious/noClassAssign\r\n  suspicious/noEmptyBlock\r\n  suspicious/noFunctionAssign\r\n\r\nWorkspace:\r\n  Open Documents:               0\n```\n\n\n### Rule name\n\nuseFilenamingConvention\n\n### Playground link\n\nhttps://github.com/hilja/biome-repro-1727426814198\n\n### Expected result\n\nSettings for `useFilenamingConvention`:\r\n\r\n```json\r\n{\r\n  \"linter\": {\r\n    \"rules\": {\r\n      \"style\": {\r\n        \"useFilenamingConvention\": {\r\n          \"level\": \"error\",\r\n          \"options\": {\r\n            \"strictCase\": true,\r\n            \"requireAscii\": true,\r\n            \"filenameCases\": [\"camelCase\", \"export\"]\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nRemix has route files like this `app/routes/$.tsx` and Biome errors on it:\r\n\r\n```\r\nThe filename should be in camelCase or equal to the name of an export.\r\n```\r\n\r\nThat `$.tsx` can\u2019t really be camelCased no matter what. Should filenames like this be ignored by default?\r\n\r\nRemix also has routes like this that are caught in the error: `app.$foo.$bar.tsx`.\r\n\r\nFor now I can ignore them in overrides of course.\n\n### Code of Conduct\n\n- [X] I agree to follow Biome's Code of Conduct\n",
    "biomejs__biome-4186": "\ud83d\udc1b biome lint panics when encountering multi-byte characters\n### Environment information\r\n\r\n```block\r\nCLI:\r\n  Version:                      1.9.3\r\n  Color support:                true\r\n\r\nPlatform:\r\n  CPU Architecture:             x86_64\r\n  OS:                           linux\r\n\r\nEnvironment:\r\n  BIOME_LOG_PATH:               unset\r\n  BIOME_LOG_PREFIX_NAME:        unset\r\n  BIOME_CONFIG_PATH:            unset\r\n  NO_COLOR:                     unset\r\n  TERM:                         \"xterm-256color\"\r\n  JS_RUNTIME_VERSION:           \"v18.17.1\"\r\n  JS_RUNTIME_NAME:              \"node\"\r\n  NODE_PACKAGE_MANAGER:         \"bun/1.1.29\"\r\n\r\nBiome Configuration:\r\n  Status:                       Loaded successfully\r\n  Formatter disabled:           false\r\n  Linter disabled:              false\r\n  Organize imports disabled:    false\r\n  VCS disabled:                 true\r\n\r\nWorkspace:\r\n  Open Documents:               0\r\n```\r\n\r\n\r\n### What happened?\r\n\r\nWhen running `biome lint` on a JavaScript file containing (only) the expression `a + '\u20ac'`, Biome encounters an internal panic. The error message indicates an issue with byte indexing for the Euro symbol (\u20ac), which uses more than one byte. Here is the exact error:\r\n\r\n```\r\nBiome encountered an unexpected error\r\nSource Location: crates/biome_js_factory/src/utils.rs:34:36\r\nThread Name: biome::worker_1\r\nMessage: byte index 1 is not a char boundary; it is inside '\u20ac' (bytes 0..3) of `\u20ac`\r\n```\r\n\r\nThe original code that triggered the error was `return v.toFixed(2).replace('.', ',') + ' \u20ac';` which I was able to trim down to just `a + '\u20ac'` in a separate file while still producing the same error.\r\n\r\nIf I change the original code to use template literals instead, no panic happens:\r\n\r\n    `${v.toFixed(2).replace('.', ',')} \u20ac`\r\n\r\n### Expected result\r\n\r\nBiome should correctly parse and lint the file without crashing, even when handling non-ASCII characters like the Euro symbol.\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow Biome's Code of Conduct\n",
    "biomejs__biome-4179": "\ud83d\udcce Implement `useCollapsedIf` - `clippy/collapsible_if`, `unicorn/no-lonely-if`\n### Description\n\nImplement [clippy/collapsible_if](https://rust-lang.github.io/rust-clippy/master/#/collapsible_if) and [unicorn/no-lonely-if](https://github.com/sindresorhus/eslint-plugin-unicorn/blob/main/docs/rules/no-lonely-if.md).\r\n\r\n**Want to contribute?** Lets you know you are interested! We will assign you to the issue to prevent several people to work on the same issue. Don't worry, we can unassign you later if you are no longer interested in the issue! Read our [contributing guide](https://github.com/biomejs/biome/blob/main/CONTRIBUTING.md) and [analyzer contributing guide](https://github.com/biomejs/biome/blob/main/crates/biome_analyze/CONTRIBUTING.md).\r\n\r\nThe implementer could take some inspirations from the implementation of existing rules such as `useCollapsedElseIf`.\n",
    "biomejs__biome-3907": "\ud83d\udc1bA `unset` value in editorconfig is not supported. \n### Environment information\n\n```block\nCLI:\r\n  Version:                      1.9.0\r\n  Color support:                true\r\n\r\nPlatform:\r\n  CPU Architecture:             x86_64\r\n  OS:                           linux\r\n\r\nEnvironment:\r\n  BIOME_LOG_PATH:               unset\r\n  BIOME_LOG_PREFIX_NAME:        unset\r\n  BIOME_CONFIG_PATH:            unset\r\n  NO_COLOR:                     unset\r\n  TERM:                         \"xterm-256color\"\r\n  JS_RUNTIME_VERSION:           \"v20.10.0\"\r\n  JS_RUNTIME_NAME:              \"node\"\r\n  NODE_PACKAGE_MANAGER:         unset\r\n\r\nBiome Configuration:\r\n  Status:                       Loaded successfully\r\n  Formatter disabled:           false\r\n  Linter disabled:              false\r\n  Organize imports disabled:    false\r\n  VCS disabled:                 false\r\n\r\nWorkspace:\r\n  Open Documents:               0\n```\n\n\n### What happened?\n\n1. I have the next .editorconfig on project root\r\n```\r\n# EditorConfig is awesome: https://EditorConfig.org\r\n\r\n# top-most EditorConfig file\r\nroot = true\r\n\r\n[*]\r\nindent_style = space\r\nindent_size = 2\r\nend_of_line = lf\r\ncharset = utf-8\r\ntrim_trailing_whitespace = true\r\ninsert_final_newline = true\r\n\r\n[/tests/data/**]\r\ncharset = unset\r\nend_of_line = unset\r\ninsert_final_newline = unset\r\ntrim_trailing_whitespace = unset\r\nindent_style = unset\r\nindent_size = unset\r\n```\r\n2. I set formatter.useEditorconfig to true\r\n3. I saw the next error message\r\n```\r\n  \u2716 Failed to parse the .editorconfig file.\r\n    \r\n    Caused by:\r\n      Custom(\"unknown variant `unset`, expected one of `lf`, `crlf`, `cr`\")\r\n```\n\n### Expected result\n\nThe `unset` value for the property seems to be the correct value according to the [editorconfig site](https://editorconfig.org/).\r\nI use for ignoring test files.\r\n\r\nHopefully this feature will be supported. \n\n### Code of Conduct\n\n- [X] I agree to follow Biome's Code of Conduct\n\ud83d\udc1b Editorconfig fails to parse `max_line_length = off`\n### Environment information\n\n```block\nN/A\n```\n\n\n### What happened?\n\n1. use this editorconfig\r\n```ini\r\nroot = true\r\n\r\n[*]\r\nmax_line_length = off\r\n```\r\n2. `biome format --use-editorconfig`\r\n3. see parsing failure\n\n### Expected result\n\nIt should at minimum emit a warning diagnostic.\n\n### Code of Conduct\n\n- [X] I agree to follow Biome's Code of Conduct\n",
    "biomejs__biome-3870": "\ud83d\udcdd `useEditorconfig` does not work with `biome ci`\n### Environment information\n\n```bash\nCLI:\r\n  Version:                      1.9.0\r\n  Color support:                true\r\n\r\nPlatform:\r\n  CPU Architecture:             aarch64\r\n  OS:                           macos\r\n\r\nEnvironment:\r\n  BIOME_LOG_PATH:               unset\r\n  BIOME_LOG_PREFIX_NAME:        unset\r\n  BIOME_CONFIG_PATH:            unset\r\n  NO_COLOR:                     unset\r\n  TERM:                         \"xterm-256color\"\r\n  JS_RUNTIME_VERSION:           \"v20.17.0\"\r\n  JS_RUNTIME_NAME:              \"node\"\r\n  NODE_PACKAGE_MANAGER:         \"yarn/4.4.1\"\r\n\r\nBiome Configuration:\r\n  Status:                       Loaded successfully\r\n  Formatter disabled:           false\r\n  Linter disabled:              false\r\n  Organize imports disabled:    false\r\n  VCS disabled:                 true\r\n\r\nFormatter:\r\n  Format with errors:           false\r\n  Indent style:                 Tab\r\n  Indent width:                 2\r\n  Line ending:                  Lf\r\n  Line width:                   80\r\n  Attribute position:           Auto\r\n  Bracket spacing:              BracketSpacing(true)\r\n  Ignore:                       []\r\n  Include:                      []\r\n\r\nJavaScript Formatter:\r\n  Enabled:                      true\r\n  JSX quote style:              Double\r\n  Quote properties:             AsNeeded\r\n  Trailing commas:              All\r\n  Semicolons:                   Always\r\n  Arrow parentheses:            Always\r\n  Bracket spacing:              unset\r\n  Bracket same line:            false\r\n  Quote style:                  Double\r\n  Indent style:                 unset\r\n  Indent width:                 unset\r\n  Line ending:                  unset\r\n  Line width:                   unset\r\n  Attribute position:           unset\r\n\r\nJSON Formatter:\r\n  Enabled:                      true\r\n  Indent style:                 unset\r\n  Indent width:                 unset\r\n  Line ending:                  unset\r\n  Line width:                   unset\r\n  Trailing Commas:              unset\r\n\r\nCSS Formatter:\r\n  Enabled:                      true\r\n  Indent style:                 unset\r\n  Indent width:                 unset\r\n  Line ending:                  unset\r\n  Line width:                   unset\r\n  Quote style:                  Double\r\n\r\nGraphQL Formatter:\r\n  Enabled:                      false\r\n  Indent style:                 unset\r\n  Indent width:                 unset\r\n  Line ending:                  unset\r\n  Line width:                   unset\r\n  Bracket spacing:              unset\r\n  Quote style:                  unset\r\n\r\nWorkspace:\r\n  Open Documents:               0\n```\n\n\n### Configuration\n\n```JSON\n{\r\n  \"formatter\": {\r\n    \"enabled\": true,\r\n    \"useEditorconfig\": true\r\n  }\r\n}\n```\n\n\n### Playground link\n\nhttps://github.com/tstyche/tstyche/pull/301\n\n### Code of Conduct\n\n- [X] I agree to follow Biome's Code of Conduct\n",
    "boa-dev__boa-1631": "Support 'shebang' ( #!/usr/bin/boa )\n\r\n**Feature**\r\nSupport - that is ignore - the unix shebang, e.g. `#!/usr/bin/boa`\r\nThis is something nodejs and deno both do: they just ignore the unix-style shebang, and this is sometimes required to execute scripts written for either.\r\n\r\n**Example code**\r\n\r\n```javascript\r\n#!/bin/whatever\r\nconsole.log(\"I still work\");\r\n```\r\n\n",
    "boa-dev__boa-1518": "Moving a `JsObject` inside a closure causes a panic\n<!--\r\nThank you for reporting a bug in Boa! This will make us improve the engine. But first, fill the following template so that we better understand what's happening. Feel free to add or remove sections as you feel appropriate.\r\n-->\r\n\r\n**Describe the bug**\r\nCurrently moving any `Gc<T>` inside a closure causes a panic. This issue comes from https://github.com/Manishearth/rust-gc/issues/50, and it doesn't seem like it will get fixed until there's some API for garbage collectors in rustc.\r\nHowever, we currently allow moving `JsObjects` and `JsValues` inside closures, which causes a panic on destruction.\r\n\r\n**To Reproduce**\r\n```Rust\r\nuse boa::{Context, JsValue};\r\n\r\nfn main() -> Result<(), JsValue> {\r\n    let mut context = Context::new();\r\n\r\n    let object = context.construct_object();\r\n\r\n    let moved_object = object.clone();\r\n\r\n    context.register_global_closure(\"closure\", 0, move |_, _, _| {\r\n        // This value is captured from main function.\r\n        moved_object.is_array();\r\n        Ok(JsValue::Undefined)\r\n    })?;\r\n\r\n    Ok(())\r\n}\r\n\r\n```\r\n\r\n**Additional comments**\r\nShould we restrict closures to only `Fn(..) + Copy`? Or should we allow any Fn and document that moving a `JsObject` into a closure causes a panic?\r\nMaybe we could even make all closures `Fn(..) + Copy` and ask the user to pass a `Captures` type, then we change the definition of our closures to `Fn(&JsValue, &[JsValue], &mut Closure, Box<dyn Any>)` and ask the user to downcast the `dyn Any` to the type of its `Captures`. This allows maximum flexibility because the user can pass `JsValue` and `JsObject`, but it's also not very ergonomic.\n",
    "boa-dev__boa-972": "The `length` property of an array is enumerable\n**Describe the bug**\r\nThe `length` property of an array is enumerable, but it should not.\r\n\r\n\r\n**To Reproduce**\r\nThis JavaScript code reproduces the issue:\r\n```javascript\r\n>> [].propertyIsEnumerable(\"length\")\r\ntrue\r\n```\r\n\r\n**Expected behavior**\r\n`[].propertyIsEnumerable(\"length\")` should be `false`.\r\n\r\n**Build environment**\r\n\r\n- OS: Windows 10\r\n- Version: 0.10\r\n- Target triple: x86_64-pc-windows-msvc\r\n- Rustc version: rustc 1.48.0 (7eac88abb 2020-11-16)\r\n\r\n**Additional context**\r\nNone\r\n\n",
    "boa-dev__boa-870": "JSON.stringify sometimes changes values from int to float\nWhen using functions like `Math.round` or `Math.floor`, type of the attribute seems seems to be float. This is not observable when inspecting the object, but is visible using `JSON.stringify`.\r\n**To Reproduce**\r\nStart CLI, enter\r\n```javascript\r\nJSON.stringify({foo:Math.round(1)})\r\n```\r\nResponse: `{\"foo\":1.0}`. \r\n**Expected behavior**\r\nExpected response `{\"foo\":1}`.\r\n\r\n**Build environment:**\r\n- boa version: master (87aea64c)\r\n - OS: Ubuntu \r\n - Version: 20.04\r\n - Target triple: x86_64-unknown-linux-gnu\r\n - Rustc version:  1.43.1 (8d69840ab 2020-05-04)\r\n\r\n\n",
    "boa-dev__boa-825": "Calling \"new\" on a primitive value does not throw an error\n<!--\r\nThank you for reporting a bug in Boa! This will make us improve the engine. But first, fill the following template so that we better understand what's happening. Feel free to add or remove sections as you feel appropriate.\r\n-->\r\n\r\n**Describe the bug**\r\nCalling `new` on a primitive value (or, in other words, calling a primitive value as a constructor) does not error.\r\n\r\n<!-- E.g.:\r\nThe variable statement is not working as expected, it always adds 10 when assigning a number to a variable\"\r\n-->\r\n\r\n**To Reproduce**\r\n```js\r\nconst a = \"\";\r\nnew a();\r\n```\r\n\r\n<!-- E.g.:\r\nThis JavaScript code reproduces the issue:\r\n```javascript\r\nvar a = 10;\r\na;\r\n```\r\n-->\r\n\r\n**Expected behavior**\r\nA `TypeError` is supposed to be raised. The spec can be found [here](https://tc39.es/ecma262/#sec-new-operator) (step 7). Chrome implements this properly:\r\n![image](https://user-images.githubusercontent.com/31050943/95126567-b6ade980-0724-11eb-9b26-18a718200d35.png)\r\n\r\n<!-- E.g.:\r\nRunning this code, `a` should be set to `10` and printed, but `a` is instead set to `20`. The expected behaviour can be found in the [ECMAScript specification][spec].\r\n\r\n[spec]: https://www.ecma-international.org/ecma-262/10.0/index.html#sec-variable-statement-runtime-semantics-evaluation\r\n-->\r\n\r\n**Build environment (please complete the following information):**\r\n\r\n- OS: `Windows 10`\r\n- Version: `Version 1909 (OS Build 18363.1082)`\r\n- Target triple: `x86_64-pc-windows-msvc`\r\n- Rustc version: `rustc 1.46.0 (04488afe3 2020-08-24)`\r\n\r\n**Additional context**\r\nMDN: [https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/new](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/new)\r\nSpec: [https://tc39.es/ecma262/#sec-evaluatenew](https://tc39.es/ecma262/#sec-evaluatenew)\r\n\r\n<!-- E.g.:\r\nYou can find more information in [MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/var).\r\n-->\r\n\n",
    "boa-dev__boa-805": "Implement Function.prototype.call\n**ECMASCript feature**\r\nI noticed recently that Function.prototype.call exists and is not implemented.\r\n[ECMAScript specification][spec].\r\n\r\n[spec]: https://tc39.es/ecma262/#sec-function.prototype.call\r\n\r\n**Example code**\r\nThis code should now work and give the expected result:\r\n```javascript\r\nlet e = new Error();\r\nObject.prototype.toString.call(e)\r\n```\r\nThe expected output is `\"[object Error]\"`\r\n\n",
    "boa-dev__boa-799": "The lexer might create invalid spans\n**Describe the bug**\r\n\r\nExpected an Error, not a panic.\r\n\r\n**To Reproduce**\r\n\r\nCan be reproduced with this program\r\n```rust\r\nfn main() {\r\n    let data: Vec<u8> = vec![0x2d, 0x2d, 0x0d, 0x00, 0x33];\r\n    if let Ok(s) = std::str::from_utf8(&data) {\r\n        let _ = boa::parse(s);\r\n    }\r\n}\r\n```\r\n**Expected behavior**\r\n\r\nAn Error, not a panic\r\n\r\n**Build environment (please complete the following information):**\r\n\r\n- OS: Ubuntu 20.04\r\n- Version: 0.10.0\r\n- Target triple: [e.g. x86_64-unknown-linux-gnu]\r\n- Rustc version: 1.48.0-nightly (d006f5734 2020-08-28)\r\n\r\n**Additional context**\r\n\r\nFull stacktrace:\r\n```\r\nthread 'main' panicked at 'a span cannot start after its end', /home/capitol/.cargo/registry/src/github.com-1ecc6299db9ec823/Boa-0.10.0/src/syntax/lexer/mod.rs:189:17\r\nstack backtrace:\r\n   0: std::panicking::begin_panic\r\n             at /home/capitol/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/std/src/panicking.rs:505\r\n   1: boa::syntax::ast::position::Span::new\r\n             at /home/capitol/.cargo/registry/src/github.com-1ecc6299db9ec823/Boa-0.10.0/src/syntax/ast/position.rs:71\r\n   2: boa::syntax::lexer::Lexer<R>::next\r\n             at /home/capitol/.cargo/registry/src/github.com-1ecc6299db9ec823/Boa-0.10.0/src/syntax/lexer/mod.rs:189\r\n   3: boa::syntax::parser::cursor::buffered_lexer::BufferedLexer<R>::fill\r\n             at /home/capitol/.cargo/registry/src/github.com-1ecc6299db9ec823/Boa-0.10.0/src/syntax/parser/cursor/buffered_lexer/mod.rs:116\r\n   4: boa::syntax::parser::cursor::buffered_lexer::BufferedLexer<R>::peek\r\n             at /home/capitol/.cargo/registry/src/github.com-1ecc6299db9ec823/Boa-0.10.0/src/syntax/parser/cursor/buffered_lexer/mod.rs:201\r\n   5: boa::syntax::parser::cursor::Cursor<R>::peek\r\n             at /home/capitol/.cargo/registry/src/github.com-1ecc6299db9ec823/Boa-0.10.0/src/syntax/parser/cursor/mod.rs:56\r\n   6: <boa::syntax::parser::expression::left_hand_side::member::MemberExpression as boa::syntax::parser::TokenParser<R>>::parse\r\n             at /home/capitol/.cargo/registry/src/github.com-1ecc6299db9ec823/Boa-0.10.0/src/syntax/parser/expression/left_hand_side/member.rs:64\r\n   7: <boa::syntax::parser::expression::left_hand_side::LeftHandSideExpression as boa::syntax::parser::TokenParser<R>>::parse\r\n             at /home/capitol/.cargo/registry/src/github.com-1ecc6299db9ec823/Boa-0.10.0/src/syntax/parser/expression/left_hand_side/mod.rs:66\r\n   8: <boa::syntax::parser::expression::update::UpdateExpression as boa::syntax::parser::TokenParser<R>>::parse\r\n             at /home/capitol/.cargo/registry/src/github.com-1ecc6299db9ec823/Boa-0.10.0/src/syntax/parser/expression/update.rs:70\r\n   9: <boa::syntax::parser::expression::assignment::exponentiation::ExponentiationExpression as boa::syntax::parser::TokenParser<R>>::parse\r\n             at /home/capitol/.cargo/registry/src/github.com-1ecc6299db9ec823/Boa-0.10.0/src/syntax/parser/expression/assignment/exponentiation.rs:91\r\n  10: <boa::syntax::parser::expression::MultiplicativeExpression as boa::syntax::parser::TokenParser<R>>::parse\r\n             at /home/capitol/.cargo/registry/src/github.com-1ecc6299db9ec823/Boa-0.10.0/src/syntax/parser/expression/mod.rs:71\r\n  11: <boa::syntax::parser::expression::AdditiveExpression as boa::syntax::parser::TokenParser<R>>::parse\r\n             at /home/capitol/.cargo/registry/src/github.com-1ecc6299db9ec823/Boa-0.10.0/src/syntax/parser/expression/mod.rs:71\r\n  12: <boa::syntax::parser::expression::ShiftExpression as boa::syntax::parser::TokenParser<R>>::parse\r\n             at /home/capitol/.cargo/registry/src/github.com-1ecc6299db9ec823/Boa-0.10.0/src/syntax/parser/expression/mod.rs:71\r\n  13: <boa::syntax::parser::expression::RelationalExpression as boa::syntax::parser::TokenParser<R>>::parse\r\n             at /home/capitol/.cargo/registry/src/github.com-1ecc6299db9ec823/Boa-0.10.0/src/syntax/parser/expression/mod.rs:71\r\n  14: <boa::syntax::parser::expression::EqualityExpression as boa::syntax::parser::TokenParser<R>>::parse\r\n             at /home/capitol/.cargo/registry/src/github.com-1ecc6299db9ec823/Boa-0.10.0/src/syntax/parser/expression/mod.rs:71\r\n  15: <boa::syntax::parser::expression::BitwiseANDExpression as boa::syntax::parser::TokenParser<R>>::parse\r\n             at /home/capitol/.cargo/registry/src/github.com-1ecc6299db9ec823/Boa-0.10.0/src/syntax/parser/expression/mod.rs:71\r\n  16: <boa::syntax::parser::expression::BitwiseXORExpression as boa::syntax::parser::TokenParser<R>>::parse\r\n             at /home/capitol/.cargo/registry/src/github.com-1ecc6299db9ec823/Boa-0.10.0/src/syntax/parser/expression/mod.rs:71\r\n  17: <boa::syntax::parser::expression::BitwiseORExpression as boa::syntax::parser::TokenParser<R>>::parse\r\n             at /home/capitol/.cargo/registry/src/github.com-1ecc6299db9ec823/Boa-0.10.0/src/syntax/parser/expression/mod.rs:71\r\n  18: <boa::syntax::parser::expression::LogicalANDExpression as boa::syntax::parser::TokenParser<R>>::parse\r\n             at /home/capitol/.cargo/registry/src/github.com-1ecc6299db9ec823/Boa-0.10.0/src/syntax/parser/expression/mod.rs:71\r\n  19: <boa::syntax::parser::expression::LogicalORExpression as boa::syntax::parser::TokenParser<R>>::parse\r\n             at /home/capitol/.cargo/registry/src/github.com-1ecc6299db9ec823/Boa-0.10.0/src/syntax/parser/expression/mod.rs:71\r\n  20: <boa::syntax::parser::expression::assignment::conditional::ConditionalExpression as boa::syntax::parser::TokenParser<R>>::parse\r\n             at /home/capitol/.cargo/registry/src/github.com-1ecc6299db9ec823/Boa-0.10.0/src/syntax/parser/expression/assignment/conditional.rs:69\r\n  21: <boa::syntax::parser::expression::assignment::AssignmentExpression as boa::syntax::parser::TokenParser<R>>::parse\r\n             at /home/capitol/.cargo/registry/src/github.com-1ecc6299db9ec823/Boa-0.10.0/src/syntax/parser/expression/assignment/mod.rs:175\r\n  22: <boa::syntax::parser::expression::Expression as boa::syntax::parser::TokenParser<R>>::parse\r\n             at /home/capitol/.cargo/registry/src/github.com-1ecc6299db9ec823/Boa-0.10.0/src/syntax/parser/expression/mod.rs:71\r\n  23: <boa::syntax::parser::statement::expression::ExpressionStatement as boa::syntax::parser::TokenParser<R>>::parse\r\n             at /home/capitol/.cargo/registry/src/github.com-1ecc6299db9ec823/Boa-0.10.0/src/syntax/parser/statement/expression/mod.rs:46\r\n  24: <boa::syntax::parser::statement::Statement as boa::syntax::parser::TokenParser<R>>::parse\r\n             at /home/capitol/.cargo/registry/src/github.com-1ecc6299db9ec823/Boa-0.10.0/src/syntax/parser/statement/mod.rs:197\r\n  25: <boa::syntax::parser::statement::StatementListItem as boa::syntax::parser::TokenParser<R>>::parse\r\n             at /home/capitol/.cargo/registry/src/github.com-1ecc6299db9ec823/Boa-0.10.0/src/syntax/parser/statement/mod.rs:379\r\n  26: <boa::syntax::parser::statement::StatementList as boa::syntax::parser::TokenParser<R>>::parse\r\n             at /home/capitol/.cargo/registry/src/github.com-1ecc6299db9ec823/Boa-0.10.0/src/syntax/parser/statement/mod.rs:315\r\n  27: <boa::syntax::parser::ScriptBody as boa::syntax::parser::TokenParser<R>>::parse\r\n             at /home/capitol/.cargo/registry/src/github.com-1ecc6299db9ec823/Boa-0.10.0/src/syntax/parser/mod.rs:148\r\n  28: <boa::syntax::parser::Script as boa::syntax::parser::TokenParser<R>>::parse\r\n             at /home/capitol/.cargo/registry/src/github.com-1ecc6299db9ec823/Boa-0.10.0/src/syntax/parser/mod.rs:125\r\n  29: boa::syntax::parser::Parser<R>::parse_all\r\n             at /home/capitol/.cargo/registry/src/github.com-1ecc6299db9ec823/Boa-0.10.0/src/syntax/parser/mod.rs:104\r\n  30: boa::parse\r\n             at /home/capitol/.cargo/registry/src/github.com-1ecc6299db9ec823/Boa-0.10.0/src/lib.rs:73\r\n  31: boa_reproduce::main\r\n             at ./src/main.rs:4\r\n  32: core::ops::function::FnOnce::call_once\r\n             at /home/capitol/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/ops/function.rs:227\r\n```\n",
    "boa-dev__boa-790": "panic on division by zero\n**Describe the bug**\r\n\r\nExpected an Error, not a panic.\r\n\r\n**To Reproduce**\r\n\r\nCan be reproduced with this program:\r\n\r\n```\r\nfn main() {\r\n    let mut context = boa::Context::new();\r\n    let _ = context.eval(\"1n/0n\");\r\n}\r\n```\r\n\r\n**Expected behavior**\r\n\r\nAn Error\r\n\r\n**Build environment (please complete the following information):**\r\n\r\n- OS: Ubuntu 20.04\r\n- Version: 0.10.0\r\n- Target triple: [e.g. x86_64-unknown-linux-gnu]\r\n- Rustc version: 1.48.0-nightly (d006f5734 2020-08-28)\r\n\r\n**Additional context**\r\n\r\nStacktrace:\r\n```\r\nthread 'main' panicked at 'attempt to divide by zero', /home/capitol/.cargo/registry/src/github.com-1ecc6299db9ec823/num-bigint-0.3.0/src/algorithms.rs:600:9\r\nstack backtrace:\r\n   0: std::panicking::begin_panic\r\n             at /home/capitol/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/std/src/panicking.rs:505\r\n   1: num_bigint::biguint::algorithms::div_rem_ref\r\n             at /home/capitol/.cargo/registry/src/github.com-1ecc6299db9ec823/num-bigint-0.3.0/src/algorithms.rs:600\r\n   2: <num_bigint::biguint::BigUint as num_integer::Integer>::div_rem\r\n             at /home/capitol/.cargo/registry/src/github.com-1ecc6299db9ec823/num-bigint-0.3.0/src/biguint.rs:1492\r\n   3: <num_bigint::bigint::BigInt as num_integer::Integer>::div_rem\r\n             at /home/capitol/.cargo/registry/src/github.com-1ecc6299db9ec823/num-bigint-0.3.0/src/bigint.rs:2222\r\n   4: <&num_bigint::bigint::BigInt as core::ops::arith::Div<&num_bigint::bigint::BigInt>>::div\r\n             at /home/capitol/.cargo/registry/src/github.com-1ecc6299db9ec823/num-bigint-0.3.0/src/bigint.rs:1716\r\n   5: <num_bigint::bigint::BigInt as core::ops::arith::DivAssign<&num_bigint::bigint::BigInt>>::div_assign\r\n             at /home/capitol/.cargo/registry/src/github.com-1ecc6299db9ec823/num-bigint-0.3.0/src/bigint.rs:1724\r\n   6: <num_bigint::bigint::BigInt as core::ops::arith::DivAssign>::div_assign\r\n             at /home/capitol/.cargo/registry/src/github.com-1ecc6299db9ec823/num-bigint-0.3.0/src/macros.rs:114\r\n   7: boa::builtins::bigint::operations::<impl core::ops::arith::Div for boa::builtins::bigint::BigInt>::div\r\n             at /home/capitol/.cargo/registry/src/github.com-1ecc6299db9ec823/Boa-0.10.0/src/builtins/bigint/operations.rs:42\r\n   8: boa::value::operations::<impl boa::value::Value>::div\r\n             at /home/capitol/.cargo/registry/src/github.com-1ecc6299db9ec823/Boa-0.10.0/src/value/operations.rs:109\r\n   9: boa::exec::operator::<impl boa::exec::Executable for boa::syntax::ast::node::operator::BinOp>::run\r\n             at /home/capitol/.cargo/registry/src/github.com-1ecc6299db9ec823/Boa-0.10.0/src/exec/operator/mod.rs:62\r\n  10: <boa::syntax::ast::node::Node as boa::exec::Executable>::run\r\n             at /home/capitol/.cargo/registry/src/github.com-1ecc6299db9ec823/Boa-0.10.0/src/exec/mod.rs:107\r\n  11: boa::exec::statement_list::<impl boa::exec::Executable for boa::syntax::ast::node::statement_list::StatementList>::run\r\n             at /home/capitol/.cargo/registry/src/github.com-1ecc6299db9ec823/Boa-0.10.0/src/exec/statement_list.rs:17\r\n  12: boa::context::Context::eval\r\n             at /home/capitol/.cargo/registry/src/github.com-1ecc6299db9ec823/Boa-0.10.0/src/context.rs:494\r\n  13: boa_reproduce::main\r\n             at ./src/main.rs:3\r\n  14: core::ops::function::FnOnce::call_once\r\n             at /home/capitol/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/ops/function.rs:227\r\n```\n",
    "boa-dev__boa-785": "Panic when no arguments are given to JSON.parse\n<!--\r\nThank you for reporting a bug in Boa! This will make us improve the engine. But first, fill the following template so that we better understand what's happening. Feel free to add or remove sections as you feel appropriate.\r\n-->\r\n\r\n**Describe the bug**\r\nA panic occurs when no arguments are passed to `JSON.parse`.\r\n\r\n<!-- E.g.:\r\nThe variable statement is not working as expected, it always adds 10 when assigning a number to a variable\"\r\n-->\r\n\r\n**To Reproduce**\r\n```js\r\nJSON.parse()\r\n```\r\n\r\n<!-- E.g.:\r\nThis JavaScript code reproduces the issue:\r\n```javascript\r\nvar a = 10;\r\na;\r\n```\r\n-->\r\n\r\n**Expected behavior**\r\nExpected: a JavaScript error is raised (Chrome seems to raise a `SyntaxError`)\r\n![image](https://user-images.githubusercontent.com/31050943/95003720-de2f7580-05af-11eb-81bd-2453e2c5c6f0.png)\r\n\r\n\r\n<!-- E.g.:\r\nRunning this code, `a` should be set to `10` and printed, but `a` is instead set to `20`. The expected behaviour can be found in the [ECMAScript specification][spec].\r\n\r\n[spec]: https://www.ecma-international.org/ecma-262/10.0/index.html#sec-variable-statement-runtime-semantics-evaluation\r\n-->\r\n\r\n**Build environment (please complete the following information):**\r\n\r\n- OS: Windows 10\r\n- Version: V1909, Build 18363.1082\r\n- Target triple: `x86_64-pc-windows-msvc` (also happens with the WASM example on the website)\r\n- Rustc version: `rustc 1.46.0 (04488afe3 2020-08-24)`\r\n\r\n**Additional context**\r\nIt's caused by an `.expect` in the `builtins/json/mod.rs` file.\r\n\r\nMore info on `JSON.parse`: [https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse)\r\n\r\n<!-- E.g.:\r\nYou can find more information in [MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/var).\r\n-->\r\n\n",
    "boa-dev__boa-782": "Throw TypeError if regex is passed to String.prototype.startsWith \nIn our implementation of `String.prototype.startsWith` we're not type checking the argument and blindly coercing it into a string.\r\nhttps://github.com/boa-dev/boa/blob/master/boa/src/builtins/string/mod.rs#L301\r\n\r\nWe should match on the value (or if let) and if its a regular expression throw a type error:\r\n\r\n```rust\r\nctx.throw_type_error(\"First argument to String.prototype.startsWith must not be a regular expression\")?;\r\n```\r\n\r\nThere should be a test also\r\n\r\nSame here: https://github.com/boa-dev/boa/blob/master/boa/src/builtins/string/mod.rs#L344\r\nand here: https://github.com/boa-dev/boa/blob/master/boa/src/builtins/string/mod.rs#L390\r\n\r\nExample JS\r\n```\r\nconst str1 = 'Saturday night plans';\r\nconsole.log(str1.startsWith(/saturday/));\r\n```\r\n\r\nContributing: https://github.com/boa-dev/boa/blob/master/CONTRIBUTING.md\r\nDebugging: https://github.com/boa-dev/boa/blob/master/docs/debugging.md\r\n\n",
    "boa-dev__boa-549": "label statement implementation\nfixes #549 \r\n\r\n@Razican it looks like the [Statement parse](https://github.com/boa-dev/boa/blob/master/boa/src/syntax/parser/statement/mod.rs#L93-L176) will need to be passed an optional `label` argument which then is also passed into all of the sub statements, what do you think? \r\n\r\n~Also what is the Output type for labelled Statement? As it technically, it is allowed to wrap any statement~ I think this could be Node\r\n\r\nTry with \r\n```js\r\nlet str = \"\";\r\n\r\nloop1: for (let i = 0; i < 5; i++) {\r\n  loop2: for (let b = 0; b < 5; b++) {\r\n    if (b === 2) {\r\n      break loop1;\r\n    }\r\n    str = str + b;\r\n  }\r\n  console.log(\"never reaches here\");\r\n  str = str + i;\r\n}\r\n\r\nconsole.log(str);\r\n// expected output: \"01\r\n```\n",
    "boa-dev__boa-535": "Adding Symbol() as a field's value\n**Describe the bug**\r\nAdding a `Symbol()` as a field's value panics with `parsing failed: ParseIntError { kind: InvalidDigit }`\r\n\r\n**To Reproduce**\r\nAdd the following to `tests/js/test.js`\r\n```javascript\r\n// tests/js/test.js\r\nconst obj = {\r\n  x: 1,\r\n  y: Symbol(),\r\n  z: 3\r\n};\r\n```\r\nand then run:\r\n```bash\r\n$ cargo run -- ./tests/js/test.js\r\n```\r\n\r\n**Expected behavior**\r\nI would expect that the code successfully parse and not panic.\r\n\r\n<!--\r\n[spec]: https://www.ecma-international.org/ecma-262/10.0/index.html#sec-variable-statement-runtime-semantics-evaluation\r\n-->\r\n\r\n**Build environment (please complete the following information):**\r\n - OS: Ubuntu Linux\r\n - Version: 18.04\r\n - Target triple: x86_64-unknown-linux-gnu\r\n - Rustc version: rustc 1.43.1 (8d69840ab 2020-05-04)\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n\r\n<!-- E.g.:\r\nYou can find more information in [MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/var).\r\n-->\r\n\n",
    "boa-dev__boa-506": "Unreachable statement\n**Describe the bug**\r\nFirst of all, I'd just like to say this project is really exciting, I can't wait to see it reach a usable state :)\r\n\r\nSo, I tried the online version and wrote a few functions that worked correctly, but then tried to run a simple Fibonacci function and got the following error in the console:\r\n\r\n```\r\nVM1040 errors.js:22 Uncaught Error: unreachable\r\n\r\nRuntimeError: unreachable\r\n    at std::panicking::rust_panic_with_hook::h5395f3796c27894a (/boa/fefc83080ce6a9a22427.module.wasm:wasm-function[4079]:0x36d471)\r\n    at rust_begin_unwind (/boa/fefc83080ce6a9a22427.module.wasm:wasm-function[13868]:0x46f89f)\r\n    at core::panicking::panic_fmt::h0dbc4ba05c77baa3 (/boa/fefc83080ce6a9a22427.module.wasm:wasm-function[16179]:0x48dc02)\r\n    at core::option::expect_failed::h6d3422f1d95e4ebe (/boa/fefc83080ce6a9a22427.module.wasm:wasm-function[9677]:0x425c3c)\r\n    at core::option::Option<T>::expect::h47516ce156c1e24c (/boa/fefc83080ce6a9a22427.module.wasm:wasm-function[7360]:0x3ec249)\r\n    at boa::builtins::function::Function::call::h4fe28ddf1172dfd6 (/boa/fefc83080ce6a9a22427.module.wasm:wasm-function[399]:0x1e2d75)\r\n    at boa::exec::Interpreter::call::hd8f2baa22109a189 (/boa/fefc83080ce6a9a22427.module.wasm:wasm-function[1443]:0x2a7d9a)\r\n    at <boa::exec::Interpreter as boa::exec::Executor>::run::h605b729b83560642 (/boa/fefc83080ce6a9a22427.module.wasm:wasm-function[7]:0x9593f)\r\n    at <boa::exec::Interpreter as boa::exec::Executor>::run::h605b729b83560642 (/boa/fefc83080ce6a9a22427.module.wasm:wasm-function[7]:0x8beb6)\r\n    at boa_wasm::evaluate::h75b1399c0202d4b7 (/boa/fefc83080ce6a9a22427.module.wasm:wasm-function[199]:0x18993b)\r\n    at eval (VM1040 errors.js:22)\r\n```\r\n\r\n**To Reproduce**\r\nHere is the source code:\r\n\r\n```js\r\nfunction fibonacci(num, memo) {\r\n  memo = memo || {};\r\n\r\n  if (memo[num]) return memo[num];\r\n  if (num <= 1) return 1;\r\n\r\n  return memo[num] = fibonacci(num - 1, memo) + fibonacci(num - 2, memo);\r\n}\r\n\r\nfibonacci(1)\r\n```\r\n\r\n<!-- E.g.:\r\nThis JavaScript code reproduces the issue:\r\n```javascript\r\nvar a = 10;\r\na;\r\n```\r\n-->\r\n\r\n**Expected behavior**\r\nThe code should compile and display `1`.\r\n\r\n**Build environment (please complete the following information):**\r\n - OS: Windows 10\r\n - Version: x64 ; May 2020 Update\r\n - Target triple: online demo (https://boa-dev.github.io/boa/)\r\n - Rustc version: online demo\n",
    "boa-dev__boa-485": "`ToObject` (`to_object`) throw `undefined` when converting `ValueData::Integer` to `Number` object\n<!--\r\nThank you for reporting a bug in Boa! This will make us improve the engine. But first, fill the following template so that we better understand what's happening. Feel free to add or remove sections as you feel appropriate.\r\n-->\r\n\r\n**Describe the bug**\r\n\r\nThe bug is here: <https://github.com/boa-dev/boa/blob/master/boa/src/exec/mod.rs#L384>. When the `ValueData` is `Integer` it returns `Err(undefined)` this is wrong. \r\n\r\nWe should have the same logic as the `Rational` case: <https://github.com/boa-dev/boa/blob/master/boa/src/exec/mod.rs#L398-L407>.\r\n\n",
    "boa-dev__boa-257": "Parser error returning from a function.\nthe is not parsing correctly if there is a empty return in a function.\r\n\r\n**POC:**\r\n\r\n```js\r\nfunction addClass(elem){\r\n    return\r\n}\r\n```\r\n\r\n```rust\r\nuse boa::syntax::lexer::Lexer;\r\nuse boa::syntax::parser::Parser;\r\nuse std::fs;\r\n\r\nfn main() {\r\n    let buffer = fs::read_to_string(\"test.js\").unwrap();\r\n    let mut lexer = Lexer::new(&buffer);\r\n    lexer.lex().expect(\"failed to lex\");\r\n    let mut parser = Parser::new(lexer.tokens);\r\n    println!(\"{:?}\", parser.parse_all());\r\n}\r\n```\r\n\r\n**Error:**\r\n```\r\nErr(Expected([], Token { data: Punctuator(CloseBlock), pos: Position { column_number: 1, line_number: 3 } }, \"script\"))\r\n```\r\n\n",
    "boa-dev__boa-245": "Number(<float>e<int>) should work\nIt looks like scientific notation numbers starting with a float compile to either `undefined` (positive float base) and when used in Number() triggers a panic.\r\n\r\nFor example:\r\n\r\n```js\r\nNumber(1e1) // Works\r\nNumber(-1e1) // Works\r\nNumber(1e-1) // Works\r\nNumber(-1e-1) // Works\r\nNumber(1.0e1) // Fails\r\nNumber(-1.0e1) // Fails\r\nNumber(1.0e-1) // Fails\r\nNumber(-1.0e-1) // Fails\r\n```\r\n\r\nThis behavior works in Node.js as expected:\r\n\r\n```js\r\n> Number(1.0e1)\r\n10\r\n> Number(1.0e-1)\r\n0.1\r\n> Number(-1.0e1)\r\n-10\r\n> Number(-1.0e-1)\r\n-0.1\r\n```\r\n\r\n`Number()` is able to parse String inputs correctly, but raw scientific notation numbers with a float base trigger a panic. This may be a parsing issue as the errors look like this:\r\n\r\n```\r\n$ cargo run # Parsing `Number(1.0e1)`\r\n    Finished dev [unoptimized + debuginfo] target(s) in 0.03s\r\n     Running `target/debug/boa`\r\nthread 'main' panicked at 'parsing failed: Expected([Punctuator(Comma), Punctuator(CloseParen)], Token { data: Identifier(\"e1\"), pos: Position { column_number: 9, line_number: 5 } }, \"function call arguments\")', src/libcore/result.rs:1084:5\r\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace.\r\n```\r\n\r\nrefs #182 implementing #34 \n",
    "boa-dev__boa-235": "Simple assignement with Number+\"+\" or Number+\"-\" does not work\nSimple assignement with addition does not work when there is no space between first operand and  \"+\" or \"-\":\r\n```\r\nlet a = 1+ 2;\r\n```\r\n\r\nThis works though:\r\n```\r\nlet a = 1 + 2;\r\n```\r\n\r\nSame with \"-\" binary operator.\r\n\r\n```\r\nthread 'main' panicked at 'Could not convert value to f64: ParseFloatError { kind: Invalid }', src/libcore/result.rs:1165:5\r\nstack backtrace:\r\n   0: backtrace::backtrace::libunwind::trace\r\n             at /cargo/registry/src/github.com-1ecc6299db9ec823/backtrace-0.3.37/src/backtrace/libunwind.rs:88\r\n   1: backtrace::backtrace::trace_unsynchronized\r\n             at /cargo/registry/src/github.com-1ecc6299db9ec823/backtrace-0.3.37/src/backtrace/mod.rs:66\r\n   2: std::sys_common::backtrace::_print_fmt\r\n             at src/libstd/sys_common/backtrace.rs:76\r\n   3: <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt\r\n             at src/libstd/sys_common/backtrace.rs:60\r\n   4: core::fmt::write\r\n             at src/libcore/fmt/mod.rs:1030\r\n   5: std::io::Write::write_fmt\r\n             at src/libstd/io/mod.rs:1412\r\n   6: std::sys_common::backtrace::_print\r\n             at src/libstd/sys_common/backtrace.rs:64\r\n   7: std::sys_common::backtrace::print\r\n             at src/libstd/sys_common/backtrace.rs:49\r\n   8: std::panicking::default_hook::{{closure}}\r\n             at src/libstd/panicking.rs:196\r\n   9: std::panicking::default_hook\r\n             at src/libstd/panicking.rs:210\r\n  10: std::panicking::rust_panic_with_hook\r\n             at src/libstd/panicking.rs:473\r\n  11: std::panicking::continue_panic_fmt\r\n             at src/libstd/panicking.rs:380\r\n  12: rust_begin_unwind\r\n             at src/libstd/panicking.rs:307\r\n  13: core::panicking::panic_fmt\r\n             at src/libcore/panicking.rs:85\r\n  14: core::result::unwrap_failed\r\n             at src/libcore/result.rs:1165\r\n  15: core::result::Result<T,E>::expect\r\n             at /rustc/4560ea788cb760f0a34127156c78e2552949f734/src/libcore/result.rs:960\r\n  16: boa::syntax::lexer::Lexer::lex\r\n             at src/lib/syntax/lexer.rs:401\r\n  17: boa::parser_expr\r\n             at src/lib/lib.rs:52\r\n  18: boa::forward\r\n             at src/lib/lib.rs:61\r\n  19: boa::exec\r\n             at src/lib/lib.rs:84\r\n  20: boa::main\r\n             at src/bin/bin.rs:57```\n",
    "boa-dev__boa-187": "Implement the Tilde operator\nCurrently the `~` operator causes a `parsing failed` exception.\r\n\r\n_Tilde_ performs a bitwise [NOT](https://en.wikipedia.org/wiki/Bitwise_operation#NOT).\r\n\r\n---\r\n\r\n**Example:**\r\n```javascript\r\nlet x = 0x01;\r\nx = ~x;\r\n\r\nconsole.log(x); // -2\r\n```\n",
    "boa-dev__boa-178": "Implement Array.prototype.findIndex()\nArray methods are implemented here, for e.g here's concat:\r\nhttps://github.com/jasonwilliams/boa/blob/master/src/lib/js/array.rs#L78-L109\r\n\r\n**Specification:**\r\nhttps://tc39.es/ecma262/#sec-array.prototype.findIndex\r\n\r\n**Contributing & Debugging**\r\nhttps://github.com/jasonwilliams/boa#contributing\r\nhttps://github.com/jasonwilliams/boa/blob/master/docs/debugging.md\n",
    "boa-dev__boa-173": "Block scope not being used on variable allocation\nWhen we step into a new function, we create a `new_function_environment` https://github.com/jasonwilliams/boa/blob/master/src/lib/exec.rs#L110\r\n\r\nBecause we don't do the same for blocks (if,while etc) any let values we create in blocks are added to the current environment, which will be the outer function most likely. This means the following JS works..\r\n\r\n```js\r\nfunction outer() {\r\n  var foo = \"foo\";\r\n  if (true) {\r\n    let bar = \"bar\";\r\n  }\r\n\r\n  return bar; // \"bar\"\r\n}\r\n```\r\n\r\n###  What does the specification say?\r\n_When a Block or CaseBlock is evaluated a new declarative Environment Record is created and bindings for each block scoped variable, constant, function, or class declared in the block are instantiated in the Environment Record._\r\n\r\nhttps://tc39.es/ecma262/#sec-blockdeclarationinstantiation\r\n\r\n### high level task\r\nThe process here is to create a `new_declarative_environment` when we hit a block and set that to the current environment, popping it off when we reach the end of our block. A potential bug this will cause is putting `var` declarations into the same scope, so we need to make sure `vars` still go into the function scope above.\r\n\r\n### low level\r\n\r\n- [new_declaration_environment](https://github.com/jasonwilliams/boa/blob/master/src/lib/environment/lexical_environment.rs#L157) is already exposed here. Bring it into exec.rs so that it can be used similar to how `new_function_environment` is used.\r\n- lexical_environment.rs will need a way of setting bindings to the nearest function environment, rather than the current environment (to support `var`)\r\n\r\n\n",
    "boa-dev__boa-157": "Implement Array.prototype.every()\nArray methods are implemented here, for e.g here's concat:\r\nhttps://github.com/jasonwilliams/boa/blob/master/src/lib/js/array.rs#L78-L109\r\n\r\n**Specification:**\r\nhttps://tc39.es/ecma262/#sec-array.prototype.every\r\n\r\n**Contributing & Debugging**\r\nhttps://github.com/jasonwilliams/boa#contributing\r\nhttps://github.com/jasonwilliams/boa/blob/master/docs/debugging.md\n",
    "boa-dev__boa-156": "Implement Array.prototype.find()\nArray methods are implemented here, for e.g here's concat:\r\nhttps://github.com/jasonwilliams/boa/blob/master/src/lib/js/array.rs#L78-L109\r\n\r\n**Specification:**\r\nhttps://tc39.es/ecma262/#sec-array.prototype.find\r\n\r\n**Contributing & Debugging**\r\nhttps://github.com/jasonwilliams/boa#contributing\r\nhttps://github.com/jasonwilliams/boa/blob/master/docs/debugging.md\n",
    "boa-dev__boa-138": "String.matchAll(regexp)\n`matchAll` function would need to be added to the string object here:\r\nhttps://github.com/jasonwilliams/boa/blob/master/src/lib/js/string.rs\r\n\r\nIt would be very similar to:\r\nhttps://github.com/jasonwilliams/boa/blob/master/src/lib/js/regexp.rs#L212-L251\r\n\r\nSpec:\r\nhttps://tc39.es/ecma262/#sec-string.prototype.matchAll\r\n\r\nNotes:\r\nhttps://github.com/jasonwilliams/boa/blob/master/docs/debugging.md\n",
    "boa-dev__boa-130": "implement exponentiation operator\nThe javascript built-in exponentiation operator (`**`) is missing in the implementation of the lexer. It is a shorthand for `Math.pow()` built-in.\r\n\r\nIt should probably be added to the lexer in this method, somewhere in the big match statement https://github.com/jasonwilliams/boa/blob/master/src/lib/syntax/lexer.rs#L207-L533\r\n\r\nThe operator's syntax and semantics is defined in this section here https://tc39.es/ecma262/#sec-exp-operator in the spec and does the same thing at runtime than `Math.pow()`, which is already implemented here https://github.com/jasonwilliams/boa/blob/master/src/lib/js/math.rs#L140-L148.\n",
    "boa-dev__boa-112": "Implementing native returns for constructor functions\nCalling `new String()` currently works however calling String() without `new` will fail. \r\nYou will be returned the global object which has everything in it and causes a stack overflow. This would be the equivalent of traversing every object and property of `window` in the browser.\r\n\r\nThe reason this happens is because String() is currently written to take the `this` value, and attach a primitiveValue field to the slice which is set to the native string. Because we're calling String() without new, there is no `this` passed in, and so `this` becomes the global object rather than a new object we pass\r\n\r\nThe pattern here is this\r\n`new Number()` returns an instance of Number\r\n`Number()` returns a primitive number\r\n\r\n`new String()` returns an instance of String\r\n`String()` returns a primitive string\r\n\r\n**Notes**\r\nhttps://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String\r\n\r\nSub issues:\r\n\r\n- [ ] String - https://github.com/jasonwilliams/boa/issues/100 \n",
    "boa-dev__boa-58": "Trailing commas in array assignments make the parser fail \n### Specification Link\r\nhttps://tc39.es/ecma262/#prod-ArrayAssignmentPattern\r\n\r\n### Example JS\r\n```js\r\nlet foo = [1, 2, 3,];\r\n```\r\n\r\n### Expected\r\nParser should ignore the trailing comma\r\n\r\n### Related to\r\nhttps://github.com/jasonwilliams/boa/pull/42/files#diff-9f9158af1c9e00d4a93319c5918d9b97R816\r\n\r\n### Contributing\r\nhttps://github.com/jasonwilliams/boa/blob/master/CONTRIBUTING.md\n",
    "boa-dev__boa-26": "return value of self.preview_next() needs changing to an Option type instead of Result\nA lot of errors happen because `preview_next()` gets called and unwraps an error when there's no more characters left.\r\nThis isn't really an error, its expected to happen at some point. all `self.preview_next()` calls should expect an option, and deal with the case of no characters individually.\r\n\r\nhttps://github.com/jasonwilliams/boa/blob/master/src/lib/syntax/lexer.rs\n",
    "boa-dev__boa-770": "Symbols cannot be defined as a property\n```js\r\nvar obj = {};\r\nvar s = Symbol('1');\r\nObject.defineProperty(obj, s);\r\n```\r\nOutputs: `Uncaught \"TypeError\": \"can't convert symbol to string\"`\r\n\r\nThe problem starts here:\r\nhttps://github.com/boa-dev/boa/blob/master/boa/src/builtins/object/mod.rs#L101 we try to coarce the key into a `string` type. We shouldn't need to do this as Property's already support Symbols as keys. We should pass the argument straight through to PropertyKey::from() and let it sort it out.\r\n\r\nPropertyKey is defined here:\r\nhttps://github.com/boa-dev/boa/blob/master/boa/src/property/mod.rs#L290-L294\r\n\r\nContributing: https://github.com/boa-dev/boa/blob/master/CONTRIBUTING.md\r\nDebugging: https://github.com/boa-dev/boa/blob/master/docs/debugging.md\n",
    "boa-dev__boa-746": "[builtins - Object]  Object.defineProperties() not implemented\nAlso, as per: https://github.com/boa-dev/boa/pull/543#discussion_r450857804 , after this is done, `Object.create` should be improved to handle second argument (the object properties) along with some tests.\n",
    "boa-dev__boa-711": "Parse error for unsigned right shift assignment\nHi,\r\n\r\nFollowing code results in parse error;\r\n```js\r\nlet a = 5; //  00000000000000000000000000000101\r\n\r\na >>>= 2;  //  00000000000000000000000000000001\r\nconsole.log(a);\r\n// expected output: 1\r\n\r\nlet b = -5; // -00000000000000000000000000000101\r\n\r\nb >>>= 2;   //  00111111111111111111111111111110\r\nconsole.log(b);\r\n// expected output: 1073741822\r\n```\r\nthanks\n",
    "boa-dev__boa-693": "Rename `Object::prototype()` and `Object::set_prototype()` to `Object::prototype_instance()` and `Object::set_prototype_instance()`\nThe `Object::prototype()` returns the prototype instance `__proto__`, so it makes more sense to call it `Object::prototype_instance()`. they are is located [here](https://github.com/boa-dev/boa/blob/master/boa/src/builtins/object/mod.rs#L432-L439)\n",
    "boa-dev__boa-667": "Calling a function that mutates itself causes borrow panic\nThis is caused when we call a function we borrow the function object and we do not release the hold until function ends. see `GcObject::call` / `GcObject::construct`\r\n\r\n**To Reproduce**\r\nSteps to reproduce the issue, or JavaScript code that causes this failure.\r\n\r\n```javascript\r\nfunction x() {\r\n\tx.y = 3;\r\n}\r\nx();\r\n```\r\n\r\n**Expected behavior**\r\nNot panic and x to have a property `y` with value `3`\r\n\r\n**Actual behavior**\r\nPanics:\r\n```\r\nthread 'main' panicked at 'Object already borrowed: BorrowMutError', boa/src/builtins/object/gcobject.rs:41:9\r\n```\n",
    "boa-dev__boa-4048": "RegExp /=/ not parsed as such in certain locations\n<!--\r\nThank you for reporting a bug in Boa! This will make us improve the engine. But first, fill the following template so that we better understand what's happening. Feel free to add or remove sections as you feel appropriate.\r\n-->\r\n\r\n**Describe the bug**\r\nThe code `() => /=/` (and certain other uses of the RegExp literal `/=/`) raises a SyntaxError.\r\n\r\n<!-- E.g.:\r\nThe variable statement is not working as expected, it always adds 10 when assigning a number to a variable\"\r\n-->\r\n\r\n**To Reproduce**\r\nExecute the following JavaScript:\r\n```javascript\r\n() => /=/\r\n```\r\n\r\n<!-- E.g.:\r\nThis JavaScript code reproduces the issue:\r\n```javascript\r\nvar a = 10;\r\na;\r\n```\r\n-->\r\n\r\n**Expected behavior**\r\nThis code should be parsed as an arrow function expression with no arguments that returns a RegExp that matches the character `=`. (semantically equivalent to `() => new RegExp(\"=\")`)\r\n\r\n<!-- E.g.:\r\nRunning this code, `a` should be set to `10` and printed, but `a` is instead set to `20`. The expected behaviour can be found in the [ECMAScript specification][spec].\r\n\r\n[spec]: https://tc39.es/ecma262/#sec-variable-statement-runtime-semantics-evaluation\r\n-->\r\n\r\n**Build environment (please complete the following information):**\r\n\r\n- OS: Artix Linux\r\n- Version: rolling\r\n- Target triple: `x86_64-unknown-linux-gnu`\r\n- Rustc version: `rustc 1.72.1 (d5c2e9c34 2023-09-13)`\r\n\r\n**Additional context**\r\nNotably, `return /=/` inside of an arrow function errors, but not inside of a `function` function.\r\n```javascript\r\n() => {return /=/} // error\r\n(function() {return /=/}) // fine!\r\n```\r\nOther uses of the literal `/=/` that error include:\r\n```javascript\r\nlet a = 5; /=/; // should construct RegExp and set a to 5, instead errors\r\n+/=/ // should evaluate to NaN\r\nclass A extends /=/ {} // should error out because /=/ is not a constructor, not because of syntax\r\n```\r\n\r\n<!-- E.g.:\r\nYou can find more information in [MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/var).\r\n-->\r\n\n",
    "boa-dev__boa-4047": "Slashes after assignments at the end of files are allowed\n<!--\r\nThank you for reporting a bug in Boa! This will make us improve the engine. But first, fill the following template so that we better understand what's happening. Feel free to add or remove sections as you feel appropriate.\r\n-->\r\n\r\n**Describe the bug**\r\nIf code in the form `<identifier> <assignment operator> <identifier> \"/\" <eof>` is passed to Boa, the code executes as if the \"/\" were not present; it should raise a SyntaxError.\r\n\r\nThis bug does not work if there are characters after the \"/\", including newlines or spaces. The \"/\" must be the last character in the input.\r\n\r\n<!-- E.g.:\r\nThe variable statement is not working as expected, it always adds 10 when assigning a number to a variable\"\r\n-->\r\n\r\n**To Reproduce**\r\nIn your shell, assuming GNU coreutils: `echo -n 'let a, b; a = b /' > test.js; boa test.js`\r\nNote that `echo -n` is required to avoid a trailing newline.\r\n\r\n<!-- E.g.:\r\nThis JavaScript code reproduces the issue:\r\n```javascript\r\nvar a = 10;\r\na;\r\n```\r\n-->\r\n\r\n**Expected behavior**\r\nThis code should throw a `SyntaxError`. The `/` character is unexpected and is not valid syntax.\r\n\r\n<!-- E.g.:\r\nRunning this code, `a` should be set to `10` and printed, but `a` is instead set to `20`. The expected behaviour can be found in the [ECMAScript specification][spec].\r\n\r\n[spec]: https://tc39.es/ecma262/#sec-variable-statement-runtime-semantics-evaluation\r\n-->\r\n\r\n**Build environment (please complete the following information):**\r\n\r\n- OS: Artix Linux\r\n- Version: rolling\r\n- Target triple: `x86_64-unknown-linux-gnu`\r\n- Rustc version: `rustc 1.72.1 (d5c2e9c34 2023-09-13)`\r\n\r\n**Additional context**\r\nThis bug works with most if not all of the assignment operators. For example, neither `a /= b /` nor `a += b /` raise a `SyntaxError` despite being invalid JavaScript.\r\n\r\n<!-- E.g.:\r\nYou can find more information in [MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/var).\r\n-->\r\n\n",
    "boa-dev__boa-3791": "`Context::get_active_script_or_module` should return a script or module when using import in a generator\nThis is a pretty hard problem to fix for me at the moment, as I lack a lot of the internal knowledge around realms and call frames.\r\n\r\nIn the test262 `test/language/expressions/dynamic-import/for-await-resolution-and-error-agen-yield.js`, the following code:\r\n\r\n```js\r\nasync function * agen1() {\r\n    yield import('./for-await-resolution-and-error-a_FIXTURE.js');\r\n    yield import('./for-await-resolution-and-error-b_FIXTURE.js');\r\n    yield import('./for-await-resolution-and-error-poisoned_FIXTURE.js');\r\n}\r\n```\r\n\r\nWill load the call `load_imported_module` with the right `Referrer` (this file) and its path, but the second and third `yield` will have a `Referrer` of `Realm` which means they'll have no path associated with them and thus cannot import with a relative path.\r\n\r\nThese tests were passing before but were a false positive as the path was always resolved from the root of the module loader (which in this case is the parent of the script being run).\n",
    "boa-dev__boa-3207": "Redeclaration of a const identifier in a for-loop initialiser leads to panic\n**Describe the bug**\r\nAny redeclaration of a const identifier in a for-loop initialiser leads to a panic, with any value.\r\n\r\n**To Reproduce**\r\n\r\n```javascript\r\nfor (const b = 1, b = 0; ; ) {\r\n}\r\n```\r\n\r\nYou can replace the assignment of b with any value.\r\n\r\n**Expected behavior**\r\nThis should trigger a syntax error:\r\n\r\n```\r\nfor (const b = 1, b = 0; ; ) {\r\n                  ^\r\n\r\nSyntaxError: Identifier 'b' has already been declared\r\n    at internalCompileFunction (node:internal/vm:73:18)\r\n    at wrapSafe (node:internal/modules/cjs/loader:1178:20)\r\n    at Module._compile (node:internal/modules/cjs/loader:1220:27)\r\n    at Module._extensions..js (node:internal/modules/cjs/loader:1310:10)\r\n    at Module.load (node:internal/modules/cjs/loader:1119:32)\r\n    at Module._load (node:internal/modules/cjs/loader:960:12)\r\n    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:81:12)\r\n    at node:internal/main/run_main_module:23:47\r\n\r\nNode.js v18.16.1\r\n```\r\n\r\n**Build environment (please complete the following information):**\r\nN/A\r\n\r\n**Additional context**\r\nDiscovered by `bytecompiler-implied` fuzzer.\n",
    "boa-dev__boa-3172": "Parser Idempotency issue: braces added every time after each pass\n<!--\r\nThank you for reporting a bug in Boa! This will make us improve the engine. But first, fill the following template so that we better understand what's happening. Feel free to add or remove sections as you feel appropriate.\r\n-->\r\n\r\n**Describe the bug**\r\nStarting and ending braces are added within an empty code block.\r\n\r\n<!-- E.g.:\r\nThe variable statement is not working as expected, it always adds 10 when assigning a number to a variable\"\r\n-->\r\n\r\n**To Reproduce**\r\n\r\nThis javascript \r\n```js\r\nwith (this) {{\r\n}}\r\n```\r\nis transformed to the following, after passing through the parser:\r\n```js\r\nwith (this) {{\r\n    {\r\n    }\r\n}}\r\n```\r\nAnd then to below, after another pass through:\r\n```js\r\nwith (this) {{\r\n    {\r\n        {\r\n        }\r\n    }\r\n}}\r\n```\r\n\r\n\r\n<!-- E.g.:\r\nThis JavaScript code reproduces the issue:\r\n```javascript\r\nvar a = 10;\r\na;\r\n```\r\n-->\r\n\r\n**Expected behavior**\r\nMultiple runs through the parser should result in the same output. \r\n\r\n<!-- E.g.:\r\nRunning this code, `a` should be set to `10` and printed, but `a` is instead set to `20`. The expected behaviour can be found in the [ECMAScript specification][spec].\r\n\r\n[spec]: https://tc39.es/ecma262/#sec-variable-statement-runtime-semantics-evaluation\r\n-->\r\n\r\n**Build environment (please complete the following information):**\r\n\r\n- OS: Ubuntu\r\n- Version: 20.04\r\n- Target triple: x86_64-unknown-linux-gnu\r\n- Rustc version: rustc 1.70.0\r\n\r\n**Additional context**\r\nFound by [#4822](https://github.com/astral-sh/ruff/pull/4822) \r\n\n",
    "boa-dev__boa-2931": "Keywords with Unicode escapes should throw syntax errors\n**Describe the bug**\r\nCurrently, if we use a keyword with an Unicode escape, it will just work, and interpret it as the keyword itself. This is a follow-up from #1117.\r\n\r\n**To Reproduce**\r\nThe following JavaScript code reproduces the issue:\r\n\r\n```javascript\r\nlet x = f\\u{61}lse;\r\n```\r\n\r\n**Expected behavior**\r\nThis should throw a syntax error. Instead, it just assigns the `false` boolean value to the `x` variable.\r\n\n",
    "boa-dev__boa-2907": "Default cases on switch statements not cascading to below cases\n**Describe the bug**\r\nThis is mainly a bug divided in possibly two separate, unintended behaviours:\r\n- `default` is assumed to always be the last case of a switch (which is not true), and automatically breaks out of the case statement. The correct behaviour should be to cascade to subsequent cases.\r\n- Cases that come after the `default` case are not tested for.\r\n\r\n**To Reproduce**\r\n```Javascript\r\nlet foo = 1;\r\nswitch (foo) {\r\n  case 2:\r\n    console.log(2);\r\n    break;\r\n  default:\r\n    console.log('default');\r\n  case 1:\r\n    console.log(1);\r\n}\r\n```\r\n\r\n**Expected behaviour**\r\nWhen foo is 1, it should only print `1`. When foo is neither 1 nor 2, it should print `default` and then `1`.\r\n\r\n**Current behaviour**\r\nWhen foo is not 2, it always prints `default`, even if foo is 1.\r\n\n",
    "boa-dev__boa-2904": "Some Test262 tests can cause a stack overflow\n**Describe the bug**\r\nWe are ignoring some Test262 tests because they cause a stack overflow in Boa. Here is the full list:\r\n\r\n - [`test/language/expressions/tagged-template/tco-call.js`](https://github.com/tc39/test262/blob/e793512b55c199de6abc392d1be4de7325dae544/test/language/expressions/tagged-template/tco-call.js)\r\n - [`test/language/expressions/tagged-template/tco-member.js`](https://github.com/tc39/test262/blob/e793512b55c199de6abc392d1be4de7325dae544/test/language/expressions/tagged-template/tco-member.js)\r\n\r\n**To Reproduce**\r\nYou can reproduce the behaviour by running the following command, after removing them from the `test_ignore.txt` file:\r\n\r\n```bash\r\ncargo run --release --bin boa_tester -- run -s {test_path}\r\n```\r\n\r\n**Expected behavior**\r\nThe expected behaviour is, obviously, for them not to overflow the stack.\n",
    "boa-dev__boa-1312": "`StatementList` display is broken\nCurrently, `StatementList`, `Node`, and all node types implement `fmt::Display`. This is meant to pretty-print the AST that was parsed from a JavaScript source file. Based on the current implementation, it looks like it is meant to generate javascript-like source code. However, it is very broken. Example:\r\n\r\nOriginal source:\r\n```js\r\na = 5\r\n\r\nfunction i_am_function(a, b) {\r\n  for (i = 0; i < 10; i++) {\r\n    a += b;\r\n  }\r\n  console.log(a);\r\n}\r\n\r\narr = [1, 2, 3];\r\n\r\nfor (a in arr) {\r\n  arr[1] = a;\r\n}\r\n\r\n```\r\nDisplay output (on `StatementList`):\r\n```js\r\n    function i_am_function(a, b) {{                    for (i = 0;i < 10;++i) {\r\n{\r\n                                            a += b;\r\n                }};\r\n                    console.log(a);\r\n}\r\n;\r\n    a = 5;\r\n    arr = [1, 2, 3];\r\n    for (a in arr) {{\r\n                            arr[1] = a;\r\n        }};\r\n```\r\n(I know this is nonsense code. I just needed an example)\r\n\r\nMost of this makes sense. The actual JavaScript it outputs almost matches what was inputted. However, it looks terrible.\r\n\r\nI am working on fixing this right now, and I'm just making this issue to make sure this is an acceptable feature. I plan to make a PR if it is something that should be fixed.\n",
    "boa-dev__boa-1079": "Octal escape sequence in string doesn't work\n<!--\r\nThank you for reporting a bug in Boa! This will make us improve the engine. But first, fill the following template so that we better understand what's happening. Feel free to add or remove sections as you feel appropriate.\r\n-->\r\n\r\n**Describe the bug**\r\nThe octal escape sequence in string literal (non-strict mode) doesn't work properly.\r\n\r\n<!-- E.g.:\r\nThe variable statement is not working as expected, it always adds 10 when assigning a number to a variable\"\r\n-->\r\n\r\n**To Reproduce**\r\n```javascript\r\n\"\\43\"; // should equal to \"#\"\r\n\"\\101\"; // should equal to \"A\"\r\n```\r\n\r\n<!-- E.g.:\r\nThis JavaScript code reproduces the issue:\r\n```javascript\r\nvar a = 10;\r\na;\r\n```\r\n-->\r\n\r\n\r\n**Additional context**\r\nNone\r\n\r\n<!-- E.g.:\r\nYou can find more information in [MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/var).\r\n-->\r\n\n",
    "boa-dev__boa-469": "builtinfun.length undefined\nI'm getting `undefined` when I do `'abc'.matchAll.length`. This is incompatible with Chrome's implementation (for example), where I get `1`.\r\n\r\nTesting with master with the following `tests.js`:\r\n\r\n```js\r\nconsole.log('abc'.matchAll.length);\r\n```\r\n\r\nHere's the output for `cargo run`:\r\n\r\n```\r\n$ cargo run\r\n   Compiling Boa v0.5.0 (/data/boa)\r\n    Finished dev [unoptimized + debuginfo] target(s) in 3.20s\r\n     Running `target/debug/boa`\r\nundefined\r\n[src/bin/bin.rs:57] exec(&buffer) = \"undefined\"\r\n```\r\n\r\nRelated to #193 and #206 \n",
    "boa-dev__boa-468": "Implement `BigInt` static methods\n<!--\r\nThank you for adding a feature request to Boa! As this is an experimental JavaScript engine, there will probably be many ECMAScript features left to implement. In order to understand the feature request as best as possible, please fill the following template. Feel free to add or remove sections as needed.\r\n-->\r\n\r\n**ECMASCript feature**\r\n\r\nImplement `BigInt` static methods:\r\n - [x] [`BigInt.asIntN()`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/BigInt/asIntN)\r\n - [x] [`BigInt.asUintN()`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/BigInt/asUntN)\r\n\r\nMore information:\r\n - [ECMAScript `BigInt` object](https://tc39.es/ecma262/#sec-bigint.asintn)\r\n - [MDN `BigInt` object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/BigInt)\n",
    "boa-dev__boa-444": "HasOwnProperty should call GetOwnProperty and not GetProperty\n**Describe the bug**\r\nAccording to the [spec](https://tc39.es/ecma262/#sec-hasownproperty), `HasOwnProperty` should be calling `GetOwnProperty`. However, Boa is calling `getProperty` as seen here: https://github.com/boa-dev/boa/blob/master/boa/src/builtins/object/mod.rs#L611\r\n\r\n**To Reproduce**\r\n```javascript\r\nvar x = { someProp: 1 };\r\nconsole.log(x.hasOwnProperty('someProp');\r\nconsole.log(x.hasOwnProperty('hasOwnProperty');\r\n```\r\n\r\n**Expected behavior**\r\nThe above code should return true and false, respectively. However, Boa is returning true for both.\r\n\r\n**Build environment (please complete the following information):**\r\n - OS: Ubuntu Linux\r\n - Version: 20.04\r\n - Target triple: x86_64-unknown-linux-gnu\r\n - Rustc version: 1.43.1 (8d69840ab 2020-05-04)\r\n\r\n**Additional context**\r\nYou can find more information on [MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/hasOwnProperty).\r\n\n",
    "boa-dev__boa-420": "Implement `Number` object constants\n<!--\r\nThank you for adding a feature request to Boa! As this is an experimental JavaScript engine, there will probably be many ECMAScript features left to implement. In order to understand the feature request as best as possible, please fill the following template. Feel free to add or remove sections as needed.\r\n-->\r\n\r\n**ECMASCript feature**\r\n\r\nImplement `Number` object constants:\r\n - [ ] `Number.EPSILON`\r\n - [ ] `Number.MAX_SAFE_INTEGER`\r\n - [ ] `Number.MIN_SAFE_INTEGER`\r\n - [ ] `Number.MAX_VALUE`\r\n - [ ] `Number.MIN_VALUE`\r\n - [ ] `Number.NEGATIVE_INFINITY`\r\n - [ ] `Number.POSITIVE_INFINITY`\r\n - [ ] `Number.NaN`\r\n\r\nThis should be very straightforward, to see how we implement constants on objects check [`Math`][math-implementation] object.\r\n\r\nFor more information check:\r\n - [MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)\r\n - [ECMAScript](https://tc39.es/ecma262/#sec-number-object)\r\n\r\n[math-implementation]: https://github.com/jasonwilliams/boa/blob/master/boa/src/builtins/math/mod.rs#L509\n",
    "boa-dev__boa-410": "Implement the optional `reviver` parameter in `JSON.parse( text [, reviver] )` \nCurrently the `JSON.parse( text[, reviver] )` method only supports the first parameter which takes in a `String` and converts into an `Object`.\r\nBut, there is an optional function argument that `JSON.parse( text[, reviver] )` method takes. It prescribes how the value originally produced by parsing is **transformed**, before being returned.\r\n\r\nExample:\r\n```javascript\r\nJSON.parse('{\"1\": 1, \"2\": 2, \"3\": {\"4\": 4, \"5\": {\"6\": 6}}}', (key, value) => {\r\n  console.log(key); // log the current property name, the last is \"\".\r\n  return value;     // return the unchanged property value.\r\n});\r\n```\r\n\r\nMore information:\r\n - [MDN documentation](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse)\r\n - [ECMAScript reference](https://tc39.es/ecma262/#sec-json.parse)\r\n\r\nYou can check the [`Array.prototype.every`](https://github.com/jasonwilliams/boa/blob/master/boa/src/builtins/array/mod.rs#L491) implementation to see how to deal with JavaScript callback functions.\n",
    "boa-dev__boa-390": "catch statement causes syntax error\n```javascript\r\ntry {\r\n        var x = 1;\r\n}\r\ncatch (e) { }\r\n```\r\n```\r\nParsingError: Expected token '(', got 'catch' in catch in try statement at line 4, col 1\r\n```\r\n\n",
    "boa-dev__boa-311": "Assignment operator not working in tests (a = a +1)\nWhile implementing `do..while` loop i've noticed strange boa behavior. This test\r\n\r\n```\r\n#[test]\r\nfn test_while_loop() {\r\n    let src = r#\"\r\n        let a = 0;\r\n        while (a < 10) a = a + 1;\r\n        a\r\n    \"#;\r\n    assert_eq!(exec(src), String::from(\"10\"));\r\n}\r\n```\r\nwill run forever. Changing loop body to `a += 1` makes test pass. Seems like using `a = a + 1` does not assign rvalue to lvalue. This test fails too:\r\n\r\n```\r\n#[test]\r\nfn test_addition() {\r\n    let src = r#\"\r\n        let a = 0;\r\n        a = a + 1;\r\n        a\r\n    \"#;\r\n    assert_eq!(exec(src), String::from(\"1\"));\r\n}\r\n```\r\n\r\nI haven't looked at it yet, as i have limited debug possibilities now (vs code in wsl remote mode does not support lldb and i can't build boa on native windows cause of some problem with jemalloc compilation). Waiting for wsl2.\r\n\r\nAnd second thought: maybe it would be interesting to implement some timeout in tests, i found something looking good here: https://users.rust-lang.org/t/limit-execution-time-of-test/6687/3\n",
    "bevyengine__bevy-15166": "Add missing insert APIs for predicates\n## What problem does this solve or what need does it fill?\r\n\r\nFor consistency, we are missing the following methods:\r\n- `insert_if_new_and`  (`insert_if_new` + `insert_if`)\r\n- `try_insert_if_new_and` (`try_insert` +`insert_if_new` + `insert_if`)\r\n\r\n\r\n## Additional context\r\n\r\nhttps://github.com/bevyengine/bevy/pull/14897 added the predicate methods, and we decided to leave these out for some naming bikeshed. This bikeshed happened on [Discord](https://discord.com/channels/691052431525675048/749335865876021248/1282499667619217529). This is a rather uncontroversial result that does not require any big changes.\nAdd missing insert APIs for predicates\n## What problem does this solve or what need does it fill?\r\n\r\nFor consistency, we are missing the following methods:\r\n- `insert_if_new_and`  (`insert_if_new` + `insert_if`)\r\n- `try_insert_if_new_and` (`try_insert` +`insert_if_new` + `insert_if`)\r\n\r\n\r\n## Additional context\r\n\r\nhttps://github.com/bevyengine/bevy/pull/14897 added the predicate methods, and we decided to leave these out for some naming bikeshed. This bikeshed happened on [Discord](https://discord.com/channels/691052431525675048/749335865876021248/1282499667619217529). This is a rather uncontroversial result that does not require any big changes.\n",
    "bevyengine__bevy-14631": "`Query::transmute`/`Query::transmute_filtered` accept any `&Components` parameter and this is unsound\n## Bevy version\r\n\r\nBoth 0.14.1 and c1c003d\r\n\r\n## What you did\r\n\r\n```rs\r\n#[derive(Component)]\r\nstruct A(u32);\r\n\r\n#[derive(Component)]\r\nstruct B(u32);\r\n\r\nlet mut world = World::new();\r\n\r\nworld.spawn((A(1), B(2)));\r\n\r\nlet mut world2 = World::new();\r\nworld2.init_component::<B>();\r\n\r\nlet mut query = world\r\n    .query::<(&A, &B)>()\r\n    .transmute::<&B>(world2.components());\r\n\r\nlet b = query.single(&world);\r\nassert_eq!(b.0, 2);\r\n```\r\n\r\n## What went wrong\r\n\r\nI expected either the `transmute` to fail due to a `&Components` passed from the wrong `World`, or the assert to pass, since the only `B` created contains a 2. \r\n\r\nInstead the assert fails due `b` containing 1, which was the content of the `A` however.\r\n\r\nThe issue is that the new query state is created using the component ids for `world2`, where `B` has the component id that `A` has in the original world.\r\n\r\nUltimately this allows to transmute a component to another, which is obviously unsound.\r\n\n",
    "bevyengine__bevy-14539": "Inconsistency between `Debug` and serialized representation of `Entity`\n## Bevy version\r\n\r\n0.13\r\n\r\n## What went wrong\r\n\r\nThere is an inconsistency between the `Debug` representation of an `Entity`:\r\n\r\n```rust\r\nimpl fmt::Debug for Entity {\r\n    fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {\r\n        write!(f, \"{}v{}\", self.index(), self.generation())\r\n    }\r\n}\r\n```\r\n\r\nAnd its `Serialize` representation:\r\n\r\n```rust\r\nimpl Serialize for Entity {\r\n    fn serialize<S>(&self, serializer: S) -> Result<S::Ok, S::Error>\r\n    where\r\n        S: serde::Serializer,\r\n    {\r\n        serializer.serialize_u64(self.to_bits())\r\n    }\r\n}\r\n```\r\n\r\nThis makes it difficult to debug serialized outputs, since the serialized entity IDs cannot be easily mapped to runtime entities via human inspection. Ideally, these representations should be consistent for easier debugging.\r\n\r\n## Additional information\r\n\r\nI wanted to just open a PR on this, but I think the issue warrants some discussion. Mainly on two points:\r\n\r\n- Which representation is \"correct\"?\r\n- If we swap to #v# format for serialized data, are we ok with invalidating existing scenes?\n",
    "bevyengine__bevy-14380": "bevy_reflect: Consider API for getting kind info\n## What problem does this solve or what need does it fill?\r\n\r\nLet's say I have this:\r\n\r\n```rust\r\nif let bevy_reflect::ReflectMut::Struct(s) = reflected.reflect_mut() {\r\n  let Some(bevy_reflect::TypeInfo::Struct(info)) = s.get_represented_type_info() else {\r\n    return;\r\n  }\r\n}\r\n```\r\n\r\nIn order to get the `StructInfo` type I need to do this extra match where I specifically ask for a `StructInfo`.\r\nBut since I already got `s` from `Struct(s)`, from a usage perspective it feels like it should be implied that I want a `StructInfo` and not an e.g. `EnumInfo`.\r\n\r\n## What solution would you like?\r\n\r\n```rust\r\nif let bevy_reflect::ReflectMut::Struct(s) = reflected.reflect_mut() {\r\n  let Some(info) = s.get_kind_info() else {\r\n    return;\r\n  }\r\n}\r\n```\r\n\r\nSomething along the lines of the above, but also for `MapInfo`, `ListInfo`, etc.\r\n\n",
    "bevyengine__bevy-8040": "Crash when setting background color via Color::Lcha\n## Bevy version\r\n\r\n0.10.0\r\n\r\n## \\[Optional\\] Relevant system information\r\nrustc 1.68.0\r\n\r\nSystemInfo { os: \"Linux 22.0.4 Manjaro Linux\", kernel: \"5.15.94-1-MANJARO\", cpu: \"AMD Ryzen 7 2700X Eight-Core Processor\", core_count: \"8\", memory: \"15.6 GiB\" }\r\nAdapterInfo { name: \"NVIDIA GeForce RTX 2070 SUPER\", vendor: 4318, device: 7812, device_type: DiscreteGpu, driver: \"NVIDIA\", driver_info: \"525.89.02\", backend: Vulkan }\r\n\r\n## What you did\r\n\r\nI set the background color in a project using `Color::Lcha {...}`.\r\n\r\nMinimal example:\r\n```rust\r\nfn main() {\r\n    App::new()\r\n        .insert_resource(\r\n            ClearColor(Color::Lcha {\r\n                lightness: 80.,\r\n                chroma: 20.,\r\n                hue: 100.,\r\n                alpha: 0.,\r\n            }), /*.as_rgba() makes the problem go away */\r\n        )\r\n        .add_plugins(DefaultPlugins)\r\n        .add_startup_system(setup)\r\n        .run();\r\n}\r\n\r\nfn setup(mut commands: Commands) {\r\n    commands.spawn(Camera2dBundle::default());\r\n}\r\n```\r\n## What went wrong\r\n\r\nWith great anticipation, I awaited the sight of a mesmerizing background color, one that would transport me to a world of beauty and wonder. Alas, my hopes were shattered as the app crashed before my very eyes, leaving me stranded in a void of disappointment and frustration.\r\n\r\n## Additional information\r\n\r\nConsole output:\r\n```txt\r\n2023-03-10T23:42:39.181041Z  INFO bevy_winit::system: Creating new window \"Bevy App\" (0v0)\r\n2023-03-10T23:42:39.181279Z  INFO winit::platform_impl::platform::x11::window: Guessed window scale factor: 1    \r\n2023-03-10T23:42:39.254333Z  INFO bevy_render::renderer: AdapterInfo { name: \"NVIDIA GeForce RTX 2070 SUPER\", vendor: 4318, device: 7812, device_type: DiscreteGpu, driver: \"NVIDIA\", driver_info: \"525.89.02\", backend: Vulkan }\r\n2023-03-10T23:42:39.818207Z  INFO bevy_diagnostic::system_information_diagnostics_plugin::internal: SystemInfo { os: \"Linux 22.0.4 Manjaro Linux\", kernel: \"5.15.94-1-MANJARO\", cpu: \"AMD Ryzen 7 2700X Eight-Core Processor\", core_count: \"8\", memory: \"15.6 GiB\" }\r\nthread '<unnamed>' panicked at 'internal error: entered unreachable code', /home/~/.cargo/registry/src/github.com-1ecc6299db9ec823/bevy_render-0.10.0/src/color/mod.rs:1155:13\r\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\r\nthread 'Compute Task Pool (2)' panicked at 'A system has panicked so the executor cannot continue.: RecvError', /home/~/.cargo/registry/src/github.com-1ecc6299db9ec823/bevy_ecs-0.10.0/src/schedule/executor/multi_threaded.rs:194:60\r\nthread '<unnamed>' panicked at 'called `Option::unwrap()` on a `None` value', /home/~/.cargo/registry/src/github.com-1ecc6299db9ec823/bevy_tasks-0.10.0/src/task_pool.rs:376:49\r\nthread 'Compute Task Pool (2)' panicked at 'called `Result::unwrap()` on an `Err` value: RecvError', /home/~/.cargo/registry/src/github.com-1ecc6299db9ec823/bevy_render-0.10.0/src/pipelined_rendering.rs:136:45\r\nthread 'main' panicked at 'called `Option::unwrap()` on a `None` value', /home/~/.cargo/registry/src/github.com-1ecc6299db9ec823/bevy_tasks-0.10.0/src/task_pool.rs:376:49\r\n```\r\n\r\nConverting the Lcha color to RGBA yielded the expected result, but I found the crash quit surprising, since all other variants of `Color` can be used to set the background color.\n",
    "bevyengine__bevy-8014": "Issue with specific reflect breaking after upgrading from 0.9-0.10\n## Bevy 0.10\r\n0.10\r\n\r\n## What you did\r\n\r\nUpgraded from bevy 0.9 -> 0.10\r\n\r\n## What went wrong\r\n\r\nThe following code has stopped compiling:\r\n\r\n```rust\r\nuse bevy::{reflect::Reflect, utils::HashSet};\r\n\r\n#[derive(Default, Clone, Reflect, serde::Serialize, serde::Deserialize)]\r\npub struct NetSet<T> where T: 'static + Send + Sync + Eq + Copy + core::hash::Hash {\r\n    set: HashSet<T>\r\n}\r\n```\r\n\r\nThere's an error for the reflect derive, \r\n```\r\nProc-macro derive produced unparseable tokens\r\n```\r\n\r\nand one for the HashSet\r\n```\r\nexpected one of `(`, `+`, `,`, `::`, `<`, or `{`, found `HashSet`\r\nunexpected token ...\r\n```\r\n\r\n## Additional information\r\n\r\nFull 0.9 version: <https://github.com/CoffeeVampir3/rusty_cg/blob/main/src/structures/netset.rs>\r\n\r\n![image](https://user-images.githubusercontent.com/48565901/223880834-07b45114-e878-4b5d-af2e-8f61d0fbc236.png)\r\n![image](https://user-images.githubusercontent.com/48565901/223880850-b4370c5a-5f19-4618-84b3-256aef498290.png)\r\n\r\nFully expanded proc macro:\r\n```rust\r\n// Recursive expansion of Reflect! macro\r\n// ======================================\r\n\r\n#[allow(unused_mut)]\r\nimpl <T>bevy::reflect::GetTypeRegistration for NetSet<T>where T:'static+Send+Sync+Eq+Copy+core::hash::Hash HashSet<T> :bevy::reflect::Reflect,{\r\n  fn get_type_registration() -> bevy::reflect::TypeRegistration {\r\n    let mut registration = bevy::reflect::TypeRegistration::of:: <NetSet<T> >();\r\n    registration.insert:: <bevy::reflect::ReflectFromPtr>(bevy::reflect::FromType:: <NetSet<T> > ::from_type());\r\n    let ignored_indices =  ::core::iter::IntoIterator::into_iter([]);\r\n    registration.insert:: <bevy::reflect::serde::SerializationData>(bevy::reflect::serde::SerializationData::new(ignored_indices));\r\n    registration\r\n  }\r\n\r\n  }\r\nimpl <T>bevy::reflect::Typed for NetSet<T>where T:'static+Send+Sync+Eq+Copy+core::hash::Hash HashSet<T> :bevy::reflect::Reflect,{\r\n  fn type_info() ->  &'static bevy::reflect::TypeInfo {\r\n    static CELL:bevy::reflect::utility::GenericTypeInfoCell = bevy::reflect::utility::GenericTypeInfoCell::new();\r\n    CELL.get_or_insert:: <Self,_>(||{\r\n      let fields = [bevy::reflect::NamedField::new:: <HashSet<T> >(\"set\"),];\r\n      let info = bevy::reflect::StructInfo::new:: <Self>(\"NetSet\", &fields);\r\n      bevy::reflect::TypeInfo::Struct(info)\r\n    })\r\n  }\r\n\r\n  }\r\nimpl <T>bevy::reflect::Struct for NetSet<T>where T:'static+Send+Sync+Eq+Copy+core::hash::Hash HashSet<T> :bevy::reflect::Reflect,{\r\n  fn field(&self,name: &str) ->  ::core::option::Option< &dyn bevy::reflect::Reflect>{\r\n    match name {\r\n      \"set\" =>  ::core::option::Option::Some(&self.set),\r\n      _ =>  ::core::option::Option::None,\r\n    \r\n      }\r\n  }\r\n  fn field_mut(&mut self,name: &str) ->  ::core::option::Option< &mut dyn bevy::reflect::Reflect>{\r\n    match name {\r\n      \"set\" =>  ::core::option::Option::Some(&mut self.set),\r\n      _ =>  ::core::option::Option::None,\r\n    \r\n      }\r\n  }\r\n  fn field_at(&self,index:usize) ->  ::core::option::Option< &dyn bevy::reflect::Reflect>{\r\n    match index {\r\n      0usize =>  ::core::option::Option::Some(&self.set),\r\n      _ =>  ::core::option::Option::None,\r\n    \r\n      }\r\n  }\r\n  fn field_at_mut(&mut self,index:usize) ->  ::core::option::Option< &mut dyn bevy::reflect::Reflect>{\r\n    match index {\r\n      0usize =>  ::core::option::Option::Some(&mut self.set),\r\n      _ =>  ::core::option::Option::None,\r\n    \r\n      }\r\n  }\r\n  fn name_at(&self,index:usize) ->  ::core::option::Option< &str>{\r\n    match index {\r\n      0usize =>  ::core::option::Option::Some(\"set\"),\r\n      _ =>  ::core::option::Option::None,\r\n    \r\n      }\r\n  }\r\n  fn field_len(&self) -> usize {\r\n    1usize\r\n  }\r\n  fn iter_fields(&self) -> bevy::reflect::FieldIter {\r\n    bevy::reflect::FieldIter::new(self)\r\n  }\r\n  fn clone_dynamic(&self) -> bevy::reflect::DynamicStruct {\r\n    let mut dynamic:bevy::reflect::DynamicStruct =  ::core::default::Default::default();\r\n    dynamic.set_name(::std::string::ToString::to_string(bevy::reflect::Reflect::type_name(self)));\r\n    dynamic.insert_boxed(\"set\",bevy::reflect::Reflect::clone_value(&self.set));\r\n    dynamic\r\n  }\r\n\r\n  }\r\nimpl <T>bevy::reflect::Reflect for NetSet<T>where T:'static+Send+Sync+Eq+Copy+core::hash::Hash HashSet<T> :bevy::reflect::Reflect,{\r\n  #[inline]\r\n  fn type_name(&self) ->  &str {\r\n    ::core::any::type_name:: <Self>()\r\n  }\r\n  #[inline]\r\n  fn get_type_info(&self) ->  &'static bevy::reflect::TypeInfo {\r\n    <Self as bevy::reflect::Typed> ::type_info()\r\n  }\r\n  #[inline]\r\n  fn into_any(self: ::std::boxed::Box<Self>) ->  ::std::boxed::Box<dyn ::core::any::Any>{\r\n    self\r\n  }\r\n  #[inline]\r\n  fn as_any(&self) ->  &dyn ::core::any::Any {\r\n    self\r\n  }\r\n  #[inline]\r\n  fn as_any_mut(&mut self) ->  &mut dyn ::core::any::Any {\r\n    self\r\n  }\r\n  #[inline]\r\n  fn into_reflect(self: ::std::boxed::Box<Self>) ->  ::std::boxed::Box<dyn bevy::reflect::Reflect>{\r\n    self\r\n  }\r\n  #[inline]\r\n  fn as_reflect(&self) ->  &dyn bevy::reflect::Reflect {\r\n    self\r\n  }\r\n  #[inline]\r\n  fn as_reflect_mut(&mut self) ->  &mut dyn bevy::reflect::Reflect {\r\n    self\r\n  }\r\n  #[inline]\r\n  fn clone_value(&self) ->  ::std::boxed::Box<dyn bevy::reflect::Reflect>{\r\n    ::std::boxed::Box::new(bevy::reflect::Struct::clone_dynamic(self))\r\n  }\r\n  #[inline]\r\n  fn set(&mut self,value: ::std::boxed::Box<dyn bevy::reflect::Reflect>) ->  ::core::result::Result<(), ::std::boxed::Box<dyn bevy::reflect::Reflect>>{\r\n    *self =  <dyn bevy::reflect::Reflect> ::take(value)? ;\r\n    ::core::result::Result::Ok(())\r\n  }\r\n  #[inline]\r\n  fn apply(&mut self,value: &dyn bevy::reflect::Reflect){\r\n    if let bevy::reflect::ReflectRef::Struct(struct_value) = bevy::reflect::Reflect::reflect_ref(value){\r\n      for(i,value)in::core::iter::Iterator::enumerate(bevy::reflect::Struct::iter_fields(struct_value)){\r\n        let name = bevy::reflect::Struct::name_at(struct_value,i).unwrap();\r\n        bevy::reflect::Struct::field_mut(self,name).map(|v|v.apply(value));\r\n      }\r\n    }else {\r\n      panic!(\"Attempted to apply non-struct type to struct type.\");\r\n    }\r\n  }\r\n  fn reflect_ref(&self) -> bevy::reflect::ReflectRef {\r\n    bevy::reflect::ReflectRef::Struct(self)\r\n  }\r\n  fn reflect_mut(&mut self) -> bevy::reflect::ReflectMut {\r\n    bevy::reflect::ReflectMut::Struct(self)\r\n  }\r\n  fn reflect_owned(self: ::std::boxed::Box<Self>) -> bevy::reflect::ReflectOwned {\r\n    bevy::reflect::ReflectOwned::Struct(self)\r\n  }\r\n  fn reflect_partial_eq(&self,value: &dyn bevy::reflect::Reflect) ->  ::core::option::Option<bool>{\r\n    bevy::reflect::struct_partial_eq(self,value)\r\n  }\r\n\r\n  }\r\n  ```\n",
    "bevyengine__bevy-8012": "WorldQuery derive State and Fetch types are still accidentally nameable\n## Bevy version\r\n\r\nLatest commit as of writing ([`7d9cb1c`](https://github.com/bevyengine/bevy/commit/7d9cb1c4ab210595c5228af0ed4ec7d095241db5))\r\n\r\n## What you did\r\n\r\n```rust\r\n#[derive(WorldQuery)]\r\npub struct Client<S: ClientState> {\r\n    pub state: &'static S,\r\n    // ...\r\n}\r\n\r\npub trait ClientState: Component {}\r\n```\r\n\r\n## What went wrong\r\n\r\n```rust\r\nerror[E0404]: expected trait, found struct `ClientState`\r\n  --> crates/example/src/client.rs:11:22\r\n   |\r\n11 | pub struct Client<S: ClientState> {\r\n   |                      ^^^^^^^^^^^ not a trait\r\n...\r\n35 | pub trait ClientState: Component {\r\n   |           ----------- you might have meant to refer to this trait\r\n   |\r\nhelp: consider importing this trait instead\r\n   |\r\n1  | use crate::client::ClientState;\r\n   |\r\n```\r\n\r\n## Additional information\r\n\r\nTo workaround it currently, we can prepend `self::` to the struct bound:\r\n```rust\r\n#[derive(WorldQuery)]\r\npub struct Client<S: self::ClientState> {\r\n    pub state: &'static S,\r\n    // ...\r\n}\r\n```\n",
    "bevyengine__bevy-7931": "Expose a public constructor for `Mut`\n## What problem does this solve or what need does it fill?\r\n\r\nWhile ordinarily `Mut` should not be constructed directly by users (and instead should be retrieved via querying), it can be very useful when writing bevy-external tests.\r\n\r\n## What solution would you like?\r\n\r\nCreate a `Mut::new(value: T, ticks: Ticks)` method.\r\n\r\nCarefully document that this is an advanced API, and explain how to correctly set the `Ticks` value (following the `set_last_changed` API).\r\n\r\n## What alternative(s) have you considered?\r\n\r\nUsers can already construct arbitrary `Mut` values directly, via APIs like `world.get_mut()`. This may involve creating a dummy world, which is wasteful, confusing and roundabout.\r\n\r\n## Additional context\r\n\r\nDiscussed [on Discord](https://discord.com/channels/691052431525675048/749332104487108618/1038856546869850232) in the context of testing asset code with @djeedai, @maniwani and @JoJoJet.\n",
    "bevyengine__bevy-7454": "bevy_reflect: Support Cow<'static, [T]>\n## What problem does this solve or what need does it fill?\r\n\r\nAt present, only `Cow<'static, str>` implements `Reflect`. However, `Cow` has another use: `Cow<'static, [T]>` for owned or borrowed lists.\r\n\r\n## What solution would you like?\r\n\r\nImplement `Reflect` and all other associated/required traits for `Cow<'static, [T]>`.\r\n\r\n## What alternative(s) have you considered?\r\n\r\nJust use a `Vec<T>`. However, `Vec`s don't work for const lists like arrays, and potentially use up more memory in the same way a `String` and `Cow<'static, str>` are compared.\n",
    "bevyengine__bevy-1070": "ButtonBundle starts up with Hovered Interaction.\n**Bevy version**\r\n\r\nbevy = { git = \"https://github.com/bevyengine/bevy\", version = \"0.3.0\" }\r\n\r\n**Operating system & version**\r\n\r\nWindows 10\r\n\r\n**What you did**\r\n\r\n```\r\nuse bevy::prelude::*;\r\n\r\nstruct Output {\r\n    msg: String,\r\n    msg_prev: String,\r\n}\r\n\r\nimpl Default for Output {\r\n    fn default() -> Self {\r\n        Output {\r\n            msg: String::new(),\r\n            msg_prev: String::new(),\r\n        }\r\n    }\r\n}\r\n\r\nfn main() {\r\n    App::build()\r\n        .add_plugins(DefaultPlugins)\r\n        .add_startup_system(setup)\r\n        .add_system(interaction)\r\n        .init_resource::<Output>()\r\n        .add_system(debug)\r\n        .run();\r\n}\r\nfn setup(cmds: &mut Commands) {\r\n    cmds.spawn(CameraUiBundle::default());\r\n    cmds.spawn(ButtonBundle {\r\n        style: Style {\r\n            size: Size::new(Val::Px(120.0), Val::Px(120.0)),\r\n            ..Default::default()\r\n        },\r\n        ..Default::default()\r\n    });\r\n}\r\nfn interaction(mut output: ResMut<Output>, i_query: Query<&Interaction>) {\r\n    for a in i_query.iter() {\r\n        match *a {\r\n            Interaction::Clicked => output.msg = \"Clicked\".to_string(),\r\n            Interaction::Hovered => output.msg = \"Hover\".to_string(),\r\n            Interaction::None => output.msg = \"Normal\".to_string(),\r\n        }\r\n    }\r\n}\r\nfn debug(mut mut_res: ResMut<Output>) {\r\n    if mut_res.msg != mut_res.msg_prev {\r\n        println!(\"{}\", mut_res.msg);\r\n        mut_res.msg_prev = mut_res.msg.clone();\r\n    }\r\n}\r\n```\r\n\r\n**What you expected to happen**\r\n\r\nI expected to start my application with `Interaction::None`.\r\n\r\n**What actually happened**\r\n\r\n> Normal\r\n> Dec 08 21:09:46.756  WARN wgpu_core::device: Failed to parse shader SPIR-V code: UnsupportedBuiltIn(4)\r\n> Dec 08 21:09:46.756  WARN wgpu_core::device: Shader module will not be validated\r\n> Hover\r\n\r\n**Additional information**\r\n\r\n- I am not sure if the **WARN** messages are relevant, though I found it odd that they show up between the change in state.\r\n- If setup is changed to add a second button, `Interaction::Hovered` never happens.\r\n- If the mouse is within the bounds of the window, `Interaction::Hovered` never happens.\r\n- If the mouse is within the bounds of the button, `Interaction::Hovered` occurs as expected.\r\n\r\n\r\n\n",
    "bevyengine__bevy-763": "Query  using the Or  operator do not provide .iter() method, only iter_mut().\n**Bevy version**\r\nFollowing version, containing changes on query:\r\n9cc6368b28a2df2dff652ae1a087f74fd0362a6a\r\n\r\n**Operating system & version**\r\nUbuntu 20.04\r\n\r\n**What you did**\r\nThe following query, that contains an Or, does not have the .iter() method, only iter_mut()\r\n```rust \r\nmut query_changed_camera: Query<(\r\n        &Camera,\r\n        Or<(Changed<OrthographicProjection>, Changed<Transform>)>,\r\n    )>,\r\n```\r\n```rust\r\nfor (camera, (camera_ortho, camera_transform)) in query_changed_camera.iter() {\r\n```\r\n\r\n**What you expected to happen**\r\nShould have compiled\r\n\r\n**What actually happened**\r\nCompilation failed:\r\n```rust \r\nerror[E0277]: the trait bound `bevy_hecs::query::FetchOr<(bevy_hecs::query::FetchChanged<bevy::render::camera::OrthographicProjection>, bevy_hecs::query::FetchChanged<bevy::prelude::Transform>)>: bevy::ecs::ReadOnlyFetch` is not satisfied\r\n  --> src/cursor_2dworld_pos_plugin.rs:62:76\r\n   |\r\n62 |     for (camera, (camera_ortho, camera_transform)) in query_changed_camera.iter() {\r\n   |                                                                            ^^^^ the trait `bevy::ecs::ReadOnlyFetch` is not implemented for `bevy_hecs::query::FetchOr<(bevy_hecs::query::FetchChanged<bevy::render::camera::OrthographicProjection>, bevy_hecs::query::FetchChanged<bevy::prelude::Transform>)>`\r\n   |\r\n   = note: required because of the requirements on the impl of `bevy::ecs::ReadOnlyFetch` for `(bevy_hecs::query::FetchRead<bevy::render::camera::Camera>, bevy_hecs::query::FetchOr<(bevy_hecs::query::FetchChanged<bevy::render::camera::OrthographicProjection>, bevy_hecs::query::FetchChanged<bevy::prelude::Transform>)>)`\r\n```\r\n\r\n**Additional information**\r\n\r\nUsing the .iter_mut() method works, so, nothing critical here.\r\n\r\nAs discussed in the discord, the culprit is the 'Or' , not the Changed.\r\n\r\nit can be the same issue as #753 , but we were not sure on discord, so filing another issue.\r\n\n",
    "bevyengine__bevy-543": "Added<X> not properly filtered in QueryOne.get() and Query.get() methods\nWith the following standalone testcase, after the second iteration when Added counting becomes 0, I think we should also see both boolean be false.\r\nThe second boolean, being based QueryOne.get() has been reported by @cart to behave incorrectly in #488.\r\nBut I suspect the first one, based onQuery.get()  should also return false ?\r\n\r\n```rust\r\nuse bevy::prelude::*;\r\n\r\nfn main() {\r\n    App::build()\r\n        .add_default_plugins()\r\n        .add_startup_system(startup_system.system())\r\n        .add_system(normal_system.system())\r\n        .run();\r\n}\r\n\r\nstruct Comp {}\r\n/// Startup systems are run exactly once when the app starts up.\r\n/// They run right before \"normal\" systems run.\r\nfn startup_system(mut commands: Commands) {\r\n    commands.spawn((Comp {},));\r\n    let entity = commands.current_entity().unwrap();\r\n    commands.insert_resource(entity);\r\n}\r\n\r\nfn normal_system(\r\n    entity: Res<Entity>,\r\n    mut query: Query<(&Comp,)>,\r\n    mut query_added: Query<(Added<Comp>,)>,\r\n) {\r\n    let mut n_comp = 0;\r\n    let mut n_added = 0;\r\n    for (_comp,) in &mut query.iter() {\r\n        n_comp += 1;\r\n    }\r\n    for (_comp,) in &mut query_added.iter() {\r\n        n_added += 1;\r\n    }\r\n    let found1 = query_added.get::<Comp>(*entity).is_some();\r\n    let mut one = query_added.entity(*entity).unwrap();\r\n    let found2 = one.get().is_some();\r\n    println!(\r\n        \"Count: {}, Added: {}, query.get {} query.entity.get {}\",\r\n        n_comp, n_added, found1, found2\r\n    );\r\n}\r\n```\n",
    "bevyengine__bevy-488": "Camera2dComponents spawned after frame 3 no more display anything.\nI reproduced the issue by modifying the sprite.rs example to not spawn on startup, but after X frames.\r\nIf X >=3 the bevy logo no more appear.\r\n\r\nIs there something that needs to be done to have the 2d camera work when spawned later in the life of the application ?\r\n\r\n```rust\r\nuse bevy::prelude::*;\r\nfn main() {\r\n    App::build()\r\n        .add_default_plugins()\r\n        .add_resource(1u32)\r\n        .add_system(setup.system())\r\n        .run();\r\n}\r\n\r\nconst FRAME_SPAWN: u32 = 3;\r\n\r\nfn setup(\r\n    mut commands: Commands,\r\n    count: Res<u32>,\r\n    asset_server: Res<AssetServer>,\r\n    mut materials: ResMut<Assets<ColorMaterial>>,\r\n) {\r\n    if *count <= FRAME_SPAWN {\r\n        println!(\"FRAME {}\", *count);\r\n        if *count == FRAME_SPAWN {\r\n            let texture_handle = asset_server.load(\"assets/branding/icon.png\").unwrap();\r\n            commands.spawn(Camera2dComponents::default());\r\n            commands.spawn(SpriteComponents {\r\n                material: materials.add(texture_handle.into()),\r\n                ..Default::default()\r\n            });\r\n            println!(\"Camera spawned\");\r\n        }\r\n        commands.insert_resource(*count + 1);\r\n    }\r\n}\r\n```\n",
    "bevyengine__bevy-404": "Mutating a component with insert(_one) doesn't trigger Mutated query filter\n## Expected Behavior\r\n\r\nI tried to make a small example and it should print \"Tag added\" once because the system with Added filter should be called once.\r\nOr maybe I'm wrong and there is another way to add a component to an entity.\r\n\r\n## Actual Behavior\r\n\r\n\"Tag added\" is never printed meaning the `print_added` function is never called.\r\n\r\n## Steps to Reproduce the Problem\r\n\r\n  1. Write a system inserting a component into an entity with insert_one or insert\r\n  1. Write a system using one of the three filter with the previous component\r\n  1. This system will not work as intented\r\n\r\n## Specifications\r\n\r\n  - Version: 0.1.3 rev=#f7131509b94b3f70eb29be092d4fd82971f547fa\r\n  - Platform: Linux (Manjaro)\r\n\r\n## Example\r\n\r\n```rust\r\nuse bevy::prelude::*;\r\n\r\nfn main() {\r\n    App::build()\r\n        .add_default_plugins()\r\n        .add_resource(PrintTimer(Timer::from_seconds(3.0, true)))\r\n        .add_startup_system(setup.system())\r\n        .add_system(add_tag_on_click.system())\r\n        .add_system(print_added.system())\r\n        .add_system(print_timed.system())\r\n        .run();\r\n}\r\n\r\nfn setup(mut commands: Commands, mut materials: ResMut<Assets<ColorMaterial>>) {\r\n    commands\r\n        .spawn(UiCameraComponents::default())\r\n        .spawn(ButtonComponents {\r\n            material: materials.add(Color::RED.into()),\r\n            style: Style {\r\n                size: Size::new(Val::Percent(100.0), Val::Percent(100.0)),\r\n                ..Default::default()\r\n            },\r\n            ..Default::default()\r\n        });\r\n}\r\n\r\nstruct Tag;\r\n\r\nfn add_tag_on_click(mut commands: Commands, mut query: Query<(Mutated<Interaction>, Entity)>) {\r\n    for (interaction, entity) in &mut query.iter() {\r\n        if let Interaction::Clicked = *interaction {\r\n            println!(\"Click on {:?}\", entity);\r\n            commands.insert_one(entity, Tag);\r\n            println!(\"Tag inserted\");\r\n        }\r\n    }\r\n}\r\n\r\nfn print_added(_: Added<Tag>) {\r\n    println!(\"Tag added\");\r\n}\r\n\r\nstruct PrintTimer(Timer);\r\n\r\nfn print_timed(time: Res<Time>, mut timer: ResMut<PrintTimer>, mut query: Query<&Tag>) {\r\n    timer.0.tick(time.delta_seconds);\r\n\r\n    if timer.0.finished {\r\n        for (i, _) in &mut query.iter().iter().enumerate() {\r\n            println!(\"I'm Tag #{}\", i);\r\n        }\r\n    }\r\n}\r\n```\n",
    "bevyengine__bevy-386": "Despawned Node Entities are not removed from their parent Node's Children\nAn entity that is despawned doesn't appear to be removed from the `Children` component of their parent Node.\r\n\r\nI'm not sure this is a bug, but I could see it eventually effective performance for a long running game that both spawns and despawns a lot of entities within a parent and iterates over the Children object a lot.\r\n\r\nI think this is related to #351.\r\n\r\n**Example Reproduction**\r\n\r\n```\r\nuse bevy::prelude::*;\r\n\r\n/// This example illustrates how to create a button that changes color and text based on its interaction state.\r\nfn main() {\r\n    App::build()\r\n        .add_default_plugins()\r\n        .init_resource::<ButtonMaterials>()\r\n        .init_resource::<ButtonCount>()\r\n        .add_startup_system(setup.system())\r\n        .add_system(button_system.system())\r\n        .run();\r\n}\r\n\r\nfn button_system(\r\n    mut commands: Commands,\r\n    button_materials: Res<ButtonMaterials>,\r\n    asset_server: Res<AssetServer>,\r\n    mut button_count: ResMut<ButtonCount>,\r\n    mut interaction_query: Query<(\r\n        Entity,\r\n        &Button,\r\n        Mutated<Interaction>,\r\n        &mut Handle<ColorMaterial>,\r\n        &Children,\r\n    )>,\r\n    mut root_query: Query<(Entity, &Root, &Children)>,\r\n) {\r\n    for (e, _, interaction, mut material, _) in &mut interaction_query.iter() {\r\n        match *interaction {\r\n            Interaction::Clicked => {\r\n                let font = asset_server\r\n                    .get_handle(\"assets/fonts/FiraMono-Medium.ttf\")\r\n                    .unwrap();\r\n\r\n                // we're going to remvoe the button\r\n                commands.despawn_recursive(e);\r\n\r\n                // spawn a new button in the same spot\r\n                for (parent, _, children) in &mut root_query.iter() {\r\n                    println!(\"Now have: {} children\", children.0.len());\r\n                    let e = spawn_button_node(\r\n                        &mut commands,\r\n                        &button_materials,\r\n                        font,\r\n                        &(format!(\"Button {}\", button_count.0))[..],\r\n                    );\r\n                    button_count.0 = button_count.0 + 1;\r\n                    commands.push_children(parent, &[e]);\r\n                    break;\r\n                }\r\n            }\r\n            Interaction::Hovered => {\r\n                *material = button_materials.hovered;\r\n            }\r\n            Interaction::None => {\r\n                *material = button_materials.normal;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfn setup(\r\n    mut commands: Commands,\r\n    asset_server: Res<AssetServer>,\r\n    button_materials: Res<ButtonMaterials>,\r\n) {\r\n    let font = asset_server\r\n        .load(\"assets/fonts/FiraMono-Medium.ttf\")\r\n        .unwrap();\r\n\r\n    let root = Entity::new();\r\n    commands\r\n        .spawn(UiCameraComponents::default())\r\n        .spawn_as_entity(\r\n            root,\r\n            NodeComponents {\r\n                style: Style {\r\n                    size: Size::new(Val::Percent(100.0), Val::Percent(100.0)),\r\n                    flex_direction: FlexDirection::ColumnReverse,\r\n                    justify_content: JustifyContent::FlexStart,\r\n                    align_items: AlignItems::Center,\r\n                    ..Default::default()\r\n                },\r\n                ..Default::default()\r\n            },\r\n        )\r\n        .with(Root);\r\n    let button = spawn_button_node(&mut commands, &button_materials, font, \"First button\");\r\n    commands.push_children(root, &[button]);\r\n}\r\n\r\nstruct ButtonMaterials {\r\n    normal: Handle<ColorMaterial>,\r\n    hovered: Handle<ColorMaterial>,\r\n    pressed: Handle<ColorMaterial>,\r\n}\r\n\r\nimpl FromResources for ButtonMaterials {\r\n    fn from_resources(resources: &Resources) -> Self {\r\n        let mut materials = resources.get_mut::<Assets<ColorMaterial>>().unwrap();\r\n        ButtonMaterials {\r\n            normal: materials.add(Color::rgb(0.02, 0.02, 0.02).into()),\r\n            hovered: materials.add(Color::rgb(0.05, 0.05, 0.05).into()),\r\n            pressed: materials.add(Color::rgb(0.1, 0.5, 0.1).into()),\r\n        }\r\n    }\r\n}\r\n\r\n#[derive(Default)]\r\nstruct ButtonCount(u32);\r\n\r\nstruct Root;\r\n\r\nfn spawn_button_node(\r\n    commands: &mut Commands,\r\n    mats: &Res<ButtonMaterials>,\r\n    font: Handle<Font>,\r\n    label: &str,\r\n) -> Entity {\r\n    let e = Entity::new();\r\n    commands\r\n        .spawn_as_entity(\r\n            e,\r\n            ButtonComponents {\r\n                style: Style {\r\n                    size: Size::new(Val::Px(300.0), Val::Px(65.0)),\r\n                    // center button\r\n                    margin: Rect::all(Val::Auto),\r\n                    // horizontally center child text\r\n                    justify_content: JustifyContent::Center,\r\n                    // vertically center child text\r\n                    align_items: AlignItems::Center,\r\n                    ..Default::default()\r\n                },\r\n                material: mats.normal,\r\n                ..Default::default()\r\n            },\r\n        )\r\n        .with_children(|parent| {\r\n            parent.spawn(TextComponents {\r\n                text: Text {\r\n                    value: label.to_string(),\r\n                    font: font,\r\n                    style: TextStyle {\r\n                        font_size: 28.0,\r\n                        color: Color::rgb(0.8, 0.8, 0.8),\r\n                    },\r\n                },\r\n                ..Default::default()\r\n            });\r\n        });\r\n\r\n    e\r\n}\r\n```\r\n\r\n**Result**\r\n```\r\n> cargo run\r\nNow have: 1 children\r\nNow have: 2 children\r\nNow have: 3 children\r\nNow have: 4 children\r\nNow have: 5 children\r\nNow have: 6 children\r\nNow have: 7 children\r\nNow have: 8 children\r\nNow have: 9 children\r\nNow have: 10 children\r\nNow have: 11 children\r\n```\r\n\r\nMy expectation is that despawned children are eventually removed from the `Parent` component. I don't expect it to be immediatey, so I wouldn't be surprised to occasionally see `3 children` in my Parent even if there's only 1 child still alive, but I do expect them to be removed eventually.\n",
    "bevyengine__bevy-13886": "Observers don't trigger for Sparse components\nBevy version: 0.14.0-rc.3\r\n\r\n`Trigger<OnAdd, C>`, `Trigger<OnUpdate, C>`, `Trigger<OnRemove, C>` don't seem to trigger if the component is Sparse, not Dense.\r\n\n",
    "bevyengine__bevy-13848": "OnEnter triggers twice and OnExit is not triggered\n## Bevy version\r\n\r\n0.13.2\r\n\r\n## \\[Optional\\] Relevant system information\r\n\r\nUbuntu 22.04.4 LTS 64-bit\r\n\r\n## Minimal project with the issue\r\n\r\n```rust\r\nuse bevy::prelude::*;\r\n\r\nfn main() {\r\n    App::new()\r\n        .add_plugins(DefaultPlugins)\r\n        .insert_state(AppState::A)\r\n        .insert_state(AppState::B)\r\n        .add_systems(OnEnter(AppState::A), setup_a)\r\n        .add_systems(OnEnter(AppState::B), setup_b)\r\n        .add_systems(OnExit(AppState::A), cleanup_a)\r\n        .add_systems(OnExit(AppState::B), cleanup_b)\r\n        .run();\r\n}\r\n\r\n#[derive(States, Debug, Clone, PartialEq, Eq, Hash)]\r\nenum AppState {\r\n    A,\r\n    B,\r\n}\r\n\r\nfn setup_a() {\r\n    info!(\"setting up A\");\r\n}\r\n\r\nfn setup_b() {\r\n    info!(\"setting up B\");\r\n}\r\n\r\nfn cleanup_a() {\r\n    info!(\"cleaning up A\");\r\n}\r\n\r\nfn cleanup_b() {\r\n    info!(\"cleaning up B\");\r\n}\r\n```\r\n\r\n## The Output\r\n\r\n```\r\n2024-06-14T14:30:43.872719Z  INFO minimalstateissue: setting up B\r\n2024-06-14T14:30:43.872759Z  INFO minimalstateissue: setting up B\r\n``` \r\n\r\n## Expected Output\r\n\r\n\r\n```\r\n2024-06-14T14:30:43.872719Z  INFO minimalstateissue: setting up A\r\n2024-06-14T14:30:43.872719Z  INFO minimalstateissue: cleaning up A\r\n2024-06-14T14:30:43.872759Z  INFO minimalstateissue: setting up B\r\n``` \r\n\r\nOR\r\n\r\n```\r\n2024-06-14T14:30:43.872759Z  INFO minimalstateissue: setting up B\r\n```\r\n\r\ndepending on the intended behaviour (I can say that what happens now is not intended behaviour).\n",
    "bevyengine__bevy-13817": "is_plugin_added is always true for Self \n## Bevy version\r\n\r\n0.14.0-rc.2\r\n\r\n## What you did\r\n\r\nThe following program panics in Bevy 0.14.0-rc.2, but runs successfully in 0.13.2\r\n\r\n```rust\r\nuse bevy::prelude::*;\r\n\r\nfn main() {\r\n    let app = App::new().add_plugins(Foo);\r\n}\r\n\r\npub struct Foo;\r\n\r\nimpl Plugin for Foo {\r\n    fn build(&self, app: &mut App) {\r\n        if app.is_plugin_added::<Self>() {\r\n            panic!()\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n## What went wrong\r\n\r\nEither the previous behavior should be restored, or we should document it in the migration guide. \r\n\r\n## Additional information\r\n\r\n\r\n\n",
    "bevyengine__bevy-13706": "Panic \"the given key does not support hashing\" should indicate the type.\nThe reflection panic \"the given key does not support hashing\" raised by insert_boxed needs to indicate the type that it is trying to use as a key. Otherwise, it is difficult to track down the source of the panic.\r\n\n",
    "bevyengine__bevy-13691": "Panic \"the given key does not support hashing\" should indicate the type.\nThe reflection panic \"the given key does not support hashing\" raised by insert_boxed needs to indicate the type that it is trying to use as a key. Otherwise, it is difficult to track down the source of the panic.\r\n\n",
    "bevyengine__bevy-13650": "`ReflectMapEntities` on Resources\n## Bevy version\r\n\r\n`0.12.1`\r\n\r\n## What you did\r\n\r\n```rust\r\n#[derive(Resource, Reflect, Clone, Default)]\r\n#[reflect(Resource, MapEntities)]\r\npub struct MyResource {\r\n    entity: Entity\r\n}\r\n\r\nimpl MapEntities for MyResource {\r\n    fn map_entities(&mut self, entity_mapper: &mut EntityMapper) {\r\n        *self.entity = entity_mapper.get_or_reserve(self.entity);\r\n    }\r\n}\r\n```\r\n\r\n## What went wrong\r\n\r\n```\r\nerror[E0277]: the trait bound `app::MyResource: bevy::prelude::Component` is not satisfied\r\n   --> src/main.rs:20:20\r\n    |\r\n500 | #[derive(Resource, Reflect, Clone, Default)]\r\n    |                    ^^^^^^^ the trait `bevy::prelude::Component` is not implemented for `app::MyResource`\r\n    |\r\n    = help: the following other types implement trait `bevy::prelude::Component`:\r\n              AccessibilityNode\r\n              bevy::prelude::Name\r\n              GlobalTransform\r\n              Transform\r\n              Children\r\n              SceneInstance\r\n              Parent\r\n            and 170 others\r\n    = note: required for `ReflectMapEntities` to implement `FromType<app::MyResource>`\r\n    = note: this error originates in the derive macro `Reflect` (in Nightly builds, run with -Z macro-backtrace for more info)\r\n```\r\n\r\n## Additional Information\r\n\r\nLooks like this is caused by `ReflectMapEntities` having a Component bound on `FromType`.\n",
    "bevyengine__bevy-13451": "slerp functions for directions (Vec2 and Vec3)\n## What problem does this solve or what need does it fill?\r\n\r\nLinear interpolation is unsuited for transitioning of directions.\r\n\r\n## What solution would you like?\r\n\r\nI would like a spherical interpolation function (slerp) for Vec2 and Vec3 directions.\r\n\r\n## Additional context\r\n\r\nThis is a common feature in existing game engines:\r\nhttps://docs.godotengine.org/en/stable/classes/class_vector3.html#class-vector3-method-slerp\r\nhttps://docs.unity3d.com/ScriptReference/Vector3.Slerp.html\r\n\n",
    "bevyengine__bevy-12997": "multi-threaded feature name is kebab case but all others are snake case\n## Bevy version\r\n\r\n0.14\r\n\r\n## What went wrong\r\n\r\nSee https://github.com/bevyengine/bevy/blob/62f2a73cac70237c83054345a26b19c9e0a0ee2f/Cargo.toml#L70\n",
    "bevyengine__bevy-15546": "AssetServer lifetimes can probably be simplified\n> I might be missing something, but I think these can be simplified. There's also other functions in the same file that has unused `'a` lifetimes.\r\n\r\n_Originally posted by @kristoff3r in https://github.com/bevyengine/bevy/pull/15533#pullrequestreview-2337163550_\r\n            \n",
    "bevyengine__bevy-15405": "Panic calling `DynamicScene::write_to_world` with `MapEntities` and `ComponentHooks`\n## Bevy version\r\n\r\n`0.14.0`\r\n\r\n## What you did\r\n\r\n- call `DynamicScene::write_to_world` with two components:\r\n  1. One that uses `MapEntities` \r\n  2. One that calls `world.commands().spawn_empty()` in `ComponentHooks::on_add`\r\n\r\n\r\n## What went wrong\r\n\r\nPanics at `bevy_ecs::entity::Entities::verify_flushed`, traced back to `scene::write_to_world`\r\n```\r\nthread 'main' panicked at C:\\work-ref\\bevy\\crates\\bevy_ecs\\src\\entity\\mod.rs:582:9:\r\nflush() needs to be called before this operation is legal\r\n```\r\n\r\n## Additional information\r\n\r\nI dont know enough about the ecs internals to understand whats happening, possibly commands from the DeferredWorld in `ComponentHooks::on_add` are being called at an inappropriate time?\r\n\r\n\r\n\r\n## Full reproducible\r\n\r\n```rust\r\nuse bevy::ecs::entity::MapEntities;\r\nuse bevy::ecs::reflect::ReflectMapEntities;\r\nuse bevy::prelude::*;\r\n\r\n#[derive(Default, Component, Reflect)]\r\n#[reflect(Component)]\r\nstruct CompA;\r\n#[derive(Component, Reflect)]\r\n// #[reflect(Component)]             // OK\r\n#[reflect(Component, MapEntities)]   // Breaks\r\nstruct CompB(pub Entity);\r\n\r\nimpl MapEntities for CompB {\r\n  fn map_entities<M: EntityMapper>(&mut self, entity_mapper: &mut M) {\r\n    self.0 = entity_mapper.map_entity(self.0);\r\n  }\r\n}\r\n\r\nfn main() {\r\n  let mut app = App::new();\r\n  app.register_type::<CompA>().register_type::<CompB>();\r\n  let world = app.world_mut();\r\n  world\r\n    .register_component_hooks::<CompA>()\r\n    .on_add(|mut world, _, _| {\r\n      world\r\n        .commands()\r\n        .spawn_empty();\r\n    });\r\n  world.spawn((CompB(Entity::PLACEHOLDER), CompA));\r\n\r\n  let scene = DynamicScene::from_world(world);\r\n  scene.write_to_world(world, &mut default()).unwrap();\r\n}\r\n\r\n```\r\n\n",
    "bevyengine__bevy-15398": "Panic when a despawning `Entity`'s observer spawns an `Entity`\n## Bevy version\r\n\r\n`0.14.0`\r\n\r\n## What you did\r\n\r\n```rust\r\nuse bevy::prelude::*;\r\n\r\nfn main() {\r\n    App::new()\r\n        .add_plugins(MinimalPlugins)\r\n        .add_systems(Startup, startup)\r\n        .add_systems(Update, update)\r\n        .run();\r\n}\r\n\r\n#[derive(Component)]\r\nstruct Marker;\r\n\r\nfn startup(mut commands: Commands) {\r\n    commands.spawn(Marker).observe(|_: Trigger<OnRemove, Marker>, mut commands: Commands| {\r\n        commands.spawn_empty();\r\n    });\r\n}\r\n\r\nfn update(\r\n    query: Query<Entity, With<Marker>>,\r\n    mut commands: Commands\r\n) {\r\n    for entity in &query {\r\n        commands.entity(entity).despawn();\r\n    }\r\n}\r\n```\r\n\r\n## What went wrong\r\n### What were you expecting?\r\n1. Entity with `Marker` component gets queued for despawning.\r\n2. Its observer runs and queues the spawning of a new entity.\r\n3. End result is the entity with `Marker` being despawned, and a new empty entity being spawned.\r\n4. App continues to run.\r\n### What actually happened?\r\n```\r\nthread 'main' panicked at F:\\packages\\cargo\\registry\\src\\index.crates.io-6f17d22bba15001f\\bevy_ecs-0.14.0\\src\\entity\\mod.rs:582:9:\r\nflush() needs to be called before this operation is legal\r\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\r\nEncountered a panic when applying buffers for system `flush_panic_repro::update`!\r\nEncountered a panic in system `bevy_app::main_schedule::Main::run_main`!\r\nerror: process didn't exit successfully: `target\\debug\\flush_panic_repro.exe` (exit code: 101)\r\n```\r\n\r\n## Additional information\r\n\r\n#14300 runs into the same panic, but involves component hooks, `MapEntities`, and `DynamicScene`. I don't know enough about Bevy's internals to know if these are ultimately the same bug, or just coincidentally panic in the same spot.\r\n\r\n---\r\nIf just the `Marker` component is removed without despawning its entity, the observer still runs (as expected) but there is no panic:\r\n```rust\r\nfn update(\r\n    query: Query<Entity, With<Marker>>,\r\n    mut commands: Commands\r\n) {\r\n    for entity in &query {\r\n        commands.entity(entity).remove::<Marker>(); // Does NOT panic.\r\n    }\r\n}\r\n// Rest of code is unchanged.\r\n```\r\n\r\n---\r\nHere's what seems like the most relevant part of the panic backtrace:\r\n```\r\n2: bevy_ecs::entity::Entities::verify_flushed\r\n   at F:\\packages\\cargo\\registry\\src\\index.crates.io-6f17d22bba15001f\\bevy_ecs-0.14.0\\src\\entity\\mod.rs:582\r\n3: bevy_ecs::entity::Entities::free\r\n   at F:\\packages\\cargo\\registry\\src\\index.crates.io-6f17d22bba15001f\\bevy_ecs-0.14.0\\src\\entity\\mod.rs:680\r\n4: bevy_ecs::world::entity_ref::EntityWorldMut::despawn\r\n   at F:\\packages\\cargo\\registry\\src\\index.crates.io-6f17d22bba15001f\\bevy_ecs-0.14.0\\src\\world\\entity_ref.rs:1235\r\n5: bevy_ecs::world::World::despawn\r\n   at F:\\packages\\cargo\\registry\\src\\index.crates.io-6f17d22bba15001f\\bevy_ecs-0.14.0\\src\\world\\mod.rs:1105\r\n6: bevy_ecs::system::commands::despawn\r\n   at F:\\packages\\cargo\\registry\\src\\index.crates.io-6f17d22bba15001f\\bevy_ecs-0.14.0\\src\\system\\commands\\mod.rs:1241\r\n```\n",
    "bevyengine__bevy-12867": "Default tetrahedron origin should be at (0, 0, 0)\n              I think the default tet should be centered on the origin. It's going to rotate strangely when people mesh it and apply transforms. I believe all other default primitives have their center of mass more or less at the origin.\r\n\r\n_Originally posted by @NthTensor in https://github.com/bevyengine/bevy/pull/12688#pullrequestreview-1971768933_\r\n            \n",
    "bevyengine__bevy-12842": "Missing `remove_by_id`\nThe untyped API seems to be missing the comparable `EntityMut::remove_by_id` or `EntityCommands::remove_by_id` methods. There are, however, `World::remove_resource_by_id` and `World::remove_non_send_by_id` for some reason.\n",
    "bevyengine__bevy-12816": "Panic with UI hierarchy when no camera is present\n## Bevy version\r\n\r\nmain, 0.13\r\n\r\nbisected to #10559\r\n\r\n## Relevant system information\r\n\r\n```\r\nAdapterInfo { name: \"Apple M1 Max\", vendor: 0, device: 0, device_type: IntegratedGpu, driver: \"\", driver_info: \"\", backend: Metal }\r\nSystemInfo { os: \"MacOS 14.2.1 \", kernel: \"23.2.0\", cpu: \"Apple M1 Max\", core_count: \"10\", memory: \"64.0 GiB\" }\r\n```\r\n\r\n## What you did\r\n\r\nI noticed this while writing some doc examples which were accidentally not `no_run`.\r\n\r\nThis is the most minimal repro I can make, but I also see this panic in e.g. the `button` example modified with no camera.\r\n\r\n```rust\r\nuse bevy::prelude::*;\r\n\r\nfn main() {\r\n    App::new()\r\n        .add_plugins(DefaultPlugins)\r\n        .add_systems(Startup, setup)\r\n        .run();\r\n}\r\n\r\nfn setup(mut commands: Commands) {\r\n    commands\r\n        .spawn(NodeBundle::default())\r\n        .with_children(|parent| {\r\n            parent.spawn(NodeBundle::default());\r\n        });\r\n}\r\n```\r\n\r\n## What went wrong\r\n\r\nReceived a warning about a camera not being present, which I suppose makes sense.\r\n\r\nReceived a warning about an \"unstyled child in a UI entity hierarchy\" which does not make sense as far as I can tell.\r\n\r\nFinally, panicked on an `unwrap` which doesn't seem desirable.\r\n\r\n```\r\n2024-02-28T15:05:02.776557Z  WARN bevy_ui::layout: No camera found to render UI to. To fix this, add at least one camera to the scene.\r\n2024-02-28T15:05:02.776596Z  WARN bevy_ui::layout: Unstyled child in a UI entity hierarchy. You are using an entity without UI components as a child of an entity with UI components, results may be unexpected.\r\nthread 'Compute Task Pool (0)' panicked at crates/bevy_ui/src/layout/mod.rs:131:60:\r\ncalled `Option::unwrap()` on a `None` value\r\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\r\nEncountered a panic in system `bevy_ui::layout::ui_layout_system`!\r\nEncountered a panic in system `bevy_app::main_schedule::Main::run_main`!\r\nthread 'main' panicked at /Users/me/.cargo/registry/src/index.crates.io-6f17d22bba15001f/winit-0.29.11/src/platform_impl/macos/app_state.rs:387:33:\r\ncalled `Result::unwrap()` on an `Err` value: PoisonError { .. }\r\n```\r\n\n",
    "bevyengine__bevy-12738": "Sprite with rect and custom anchor doesn't render when it should\n## Bevy version\r\n\r\n0.13.0 and b7ab1466c7ac2c6f20a37e47db9b8d889a940611\r\n\r\n## Relevant system information\r\n\r\n```ignore\r\n`AdapterInfo { name: \"Intel(R) Xe Graphics (TGL GT2)\", vendor: 32902, device: 39497, device_type: Integrate\r\ndGpu, driver: \"Intel open-source Mesa driver\", driver_info: \"Mesa 22.2.5-0ubuntu0.1~22.04.3\", backend: Vulkan }`\r\n```\r\n\r\n## What you did\r\n\r\nI have a sprite that has both a custom anchor (outside of the range -0.5..0.5) and a rect. See this minimal example:\r\n\r\n```rs\r\nuse bevy::{prelude::*, sprite::Anchor};\r\n\r\nfn main() {\r\n    App::new()\r\n        .add_plugins(DefaultPlugins)\r\n        .add_systems(Startup, setup)\r\n        .add_systems(Update, update_camera)\r\n        .run();\r\n}\r\n\r\nfn setup(mut commands: Commands, asset_server: Res<AssetServer>) {\r\n    commands.spawn(Camera2dBundle::default());\r\n    commands.spawn(SpriteBundle {\r\n        texture: asset_server.load(\"branding/bevy_bird_dark.png\"),\r\n        sprite: Sprite {\r\n            anchor: Anchor::Custom(Vec2::new(1., 1.)),\r\n            rect: Some(Rect::new(0.0, 0.0, 150., 150.)),\r\n            ..default()\r\n        },\r\n        ..default()\r\n    });\r\n}\r\n\r\nfn update_camera(\r\n    keyboard: Res<ButtonInput<KeyCode>>,\r\n    time: Res<Time>,\r\n    mut listeners: Query<&mut Transform, With<Camera>>,\r\n) {\r\n    let mut transform = listeners.single_mut();\r\n\r\n    let speed = 200.;\r\n\r\n    if keyboard.pressed(KeyCode::ArrowRight) {\r\n        transform.translation.x += speed * time.delta_seconds();\r\n    }\r\n    if keyboard.pressed(KeyCode::ArrowLeft) {\r\n        transform.translation.x -= speed * time.delta_seconds();\r\n    }\r\n    if keyboard.pressed(KeyCode::ArrowUp) {\r\n        transform.translation.y += speed * time.delta_seconds();\r\n    }\r\n    if keyboard.pressed(KeyCode::ArrowDown) {\r\n        transform.translation.y -= speed * time.delta_seconds();\r\n    }\r\n}\r\n```\r\n\r\n## What went wrong\r\n\r\nIt doesn't render the sprite when the camera is almost out of view of the sprite.\r\n\n",
    "bevyengine__bevy-12469": "Inconsistency between `Debug` and serialized representation of `Entity`\n## Bevy version\r\n\r\n0.13\r\n\r\n## What went wrong\r\n\r\nThere is an inconsistency between the `Debug` representation of an `Entity`:\r\n\r\n```rust\r\nimpl fmt::Debug for Entity {\r\n    fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {\r\n        write!(f, \"{}v{}\", self.index(), self.generation())\r\n    }\r\n}\r\n```\r\n\r\nAnd its `Serialize` representation:\r\n\r\n```rust\r\nimpl Serialize for Entity {\r\n    fn serialize<S>(&self, serializer: S) -> Result<S::Ok, S::Error>\r\n    where\r\n        S: serde::Serializer,\r\n    {\r\n        serializer.serialize_u64(self.to_bits())\r\n    }\r\n}\r\n```\r\n\r\nThis makes it difficult to debug serialized outputs, since the serialized entity IDs cannot be easily mapped to runtime entities via human inspection. Ideally, these representations should be consistent for easier debugging.\r\n\r\n## Additional information\r\n\r\nI wanted to just open a PR on this, but I think the issue warrants some discussion. Mainly on two points:\r\n\r\n- Which representation is \"correct\"?\r\n- If we swap to #v# format for serialized data, are we ok with invalidating existing scenes?\nInconsistency between `Debug` and serialized representation of `Entity`\n## Bevy version\r\n\r\n0.13\r\n\r\n## What went wrong\r\n\r\nThere is an inconsistency between the `Debug` representation of an `Entity`:\r\n\r\n```rust\r\nimpl fmt::Debug for Entity {\r\n    fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {\r\n        write!(f, \"{}v{}\", self.index(), self.generation())\r\n    }\r\n}\r\n```\r\n\r\nAnd its `Serialize` representation:\r\n\r\n```rust\r\nimpl Serialize for Entity {\r\n    fn serialize<S>(&self, serializer: S) -> Result<S::Ok, S::Error>\r\n    where\r\n        S: serde::Serializer,\r\n    {\r\n        serializer.serialize_u64(self.to_bits())\r\n    }\r\n}\r\n```\r\n\r\nThis makes it difficult to debug serialized outputs, since the serialized entity IDs cannot be easily mapped to runtime entities via human inspection. Ideally, these representations should be consistent for easier debugging.\r\n\r\n## Additional information\r\n\r\nI wanted to just open a PR on this, but I think the issue warrants some discussion. Mainly on two points:\r\n\r\n- Which representation is \"correct\"?\r\n- If we swap to #v# format for serialized data, are we ok with invalidating existing scenes?\n",
    "bevyengine__bevy-12399": "Add hue rotation traits\n              Nit for future PR: We should add hue rotation traits to make this cleaner.\r\n\r\n_Originally posted by @bushrat011899 in https://github.com/bevyengine/bevy/pull/12163#discussion_r1506997793_\r\n            \r\n            \r\nMuch like the `Alpha` trait, we should provide easy ways to \"rotate\" the hue of colors: shifting them by a provided number of degrees to rotate the metaphorical color wheel.\r\n\r\nThis trait should only be implemented for the color models (types) with an explicit hue element: other color types should be converted to one of those spaces first.\r\n\r\n\r\nOnce basic hue rotation is added, we can add nice color theory options: things like \"complementary colors\" (rotate by 180 degrees), \"triadic colors\" (rotate by 120 degrees), analogous colors and so on.\n",
    "bevyengine__bevy-16910": "`EaseFunction::ExponentialIn` jumps at the beginning\n## Bevy version\n\n2024-12-05 https://github.com/bevyengine/bevy/commit/bc572cd27\n\n## What you did\n\nCalled `ExponentialIn.eval(0)`, expecting it to be essentially 0, but it returned about 1\u2030 instead.\n\nSee tests in https://github.com/bevyengine/bevy/pull/16675/files#diff-91e5390dd7a24ce92750ba40df5ef8d7a2466401ef7d3e50eb3d8861b8bc52d6R486-R501\n```\nEaseFunction.ExponentialIn(0) was 0.0009765625\n```\n\n## Additional information\n\nIt's only the `Exponential*` functions that fail these tests; the rest of them all pass.\n\nTBH, the definition feels very arbitrary to me in comparison to the other things:\n\nhttps://github.com/bevyengine/bevy/blob/72f096c91ea1056c41f2da821d310765c4482c00/crates/bevy_math/src/curve/easing.rs#L327-L330\n\nWhy `10`, for example?\n\nIt makes me wonder if it should be something more like <https://en.wikipedia.org/wiki/Non-analytic_smooth_function#Smooth_transition_functions> instead.\n",
    "bevyengine__bevy-16747": "Add support to the `animated_field!` macro for tuple structs\n## What problem does this solve or what need does it fill?\n\nComponents like `TextColor` and `BackgroundColor` cannot currently be easily animated without creating a custom `AnimatableProperty`.\n\n## What solution would you like?\n\nAdd support to the `animated_field!` macro (and consequently `AnimatedField`) for tuple structs. I'm not sure what the cleanest way to do this is from an implementation perspective, since the `$ident` pattern doesn't match tuple struct field indices and I'm not sure if it makes sense to use `$literal`, as that matches more than just field indices.\n\n## What alternative(s) have you considered?\n\n- Add an alternative easy way to animate tuple structs (e.g. a separate macro/type)\n- Maybe something could be done with `Deref` and a blanket implementation of `AnimatableProperty`? But this puts the burden on components to implement `Deref`, only works for tuple structs with single fields, and also introduces potential conflicts with trait implementations because it would be a blanket implementation\n\n## Additional context\n\nI was specifically trying to animate UI color alpha when I ran into this, and I wonder if it's worth considering if there should be easy ways to get a `&mut` to a `Color`'s alpha and also possibly animate individual fields of a component's fields (e.g. animating `Transform::translation::x`), but that's a separate issue and probably a little more complicated.\n\n",
    "bevyengine__bevy-16499": "Hook and observer ordering for `on_remove`/`on_replace` should be inverted\n## Bevy version\n\n0.15.0-rc.3 (exists before as well)\n\n## What you did\n\nWhen adding a component, the order of hooks and observers are:\n- on_add hook\n- on_add observers\n- on_insert hook\n- on_insert observers\n\nWhen removing a component, the order of hooks and observers are:\n- on_replace hook\n- on_replace observers\n- on_remove hook\n- on_remove observers\n\n## What went wrong\n\nThe remove ordering matches the add ordering, while it would be more natural for it to be inverted \u2013 running observers before hooks, that is.\n\n## Additional information\n\nNote that this bug is to provoke **discussion**. The current behaviour may be considered correct as well. So this bug should be used to discuss the matter and make a decision so that the decision is then documented for posterity.\n",
    "bevyengine__bevy-16475": "Calling `Image::get_color_at` panics\nOn #16388, we are using `Image::get_color_at` to determine a pixel's alpha value. There is no unwrap occuring, so we expect there to be no panics, however another user noted the following:\r\n\r\nTesting the changes got this error after a crash:\r\n```\r\n2024-11-22T07:39:32.137594Z  INFO bevy_winit::system: Creating new window \"App\" (0v1#4294967296)\r\n2024-11-22T07:39:32.137772Z  INFO winit::platform_impl::platform::x11::window: Guessed window scale factor: 1\r\n2024-11-22T07:39:32.326951Z  WARN bevy_render::view::window: Couldn't get swap chain texture after configuring. Cause: 'The underlying surface has changed, and therefore the swap chain must be updated'\r\nthread 'Compute Task Pool (4)' panicked at /home/adrian/bevy_testing/bevy/crates/bevy_image/src/image.rs:974:36:\r\nrange end index 8 out of range for slice of length 4\r\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\r\nEncountered a panic in system `bevy_sprite::picking_backend::sprite_picking`!\r\nEncountered a panic in system `bevy_app::main_schedule::Main::run_main`!\r\n```\r\nI'm using 0.15 release branch with the changes applied on top. Running the sprite_picking example\r\nThe sprite on the right works fine, but the squares and bevy logos works quite bad and make the app crash.\r\nThe test run on linux with x11 as you can see in the errors\r\n\r\n_Originally posted by @MonforteAdrian in https://github.com/bevyengine/bevy/issues/16388#issuecomment-2493084194_\n",
    "bevyengine__bevy-16441": "Runtime required components do not work correctly for components added through `#[require(...)]`\n## Bevy version\n\nBevy 0.15.0-rc.3\n\n## What you did\n\nI have a component, let's say `A`, that requires another component `B` using `#[require(B)]`. `B` then requires another component `C`, but the requirement is registered in a plugin using `app.register_required_components::<B, C>()`.\n\n## What went wrong\n\nWhen I spawn an entity with `A`, `C` is not added!\n\nHere's a simple test that fails:\n\n```rust\n#[test]\nfn runtime_required_components() {\n    // `A` requires `B` directly.\n    #[derive(Component)]\n    #[require(B)]\n    struct A;\n\n    #[derive(Component, Default)]\n    struct B;\n\n    #[derive(Component, Default)]\n    struct C;\n\n    let mut world = World::new();\n\n    // `B` requires `C` with runtime registration.\n    // This *fails*, but not when using `#[require(C)]` for `B`.\n    world.register_required_components::<B, C>();\n\n    // Adding runtime registration for `A -> B` also doesn't help if done after `B -> C`,\n    // but it *does* work if done before.\n    let _ = world.try_register_required_components::<A, B>();\n\n    let entity = world.spawn(A).id();\n    assert!(world.entity(entity).get::<C>().is_some());\n}\n```\n\nIf the entity is spawned with `B` directly, it *does* work:\n\n```rust\n#[test]\nfn runtime_required_components_2() {\n    #[derive(Component)]\n    #[require(B)]\n    struct A;\n\n    #[derive(Component, Default)]\n    struct B;\n\n    #[derive(Component, Default)]\n    struct C;\n\n    let mut world = World::new();\n\n    world.register_required_components::<B, C>();\n\n    let _ = world.try_register_required_components::<A, B>();\n\n    let id = world.spawn(B).id();\n    assert!(world.entity(id).get::<C>().is_some());\n}\n```\n\nThis implies that the problem is related to runtime requirements not being properly propagated up the inheritance tree if the higher levels use `#[require(...)]`, or if the higher level requirement is added after the lower level requirement.\n",
    "bevyengine__bevy-16264": "Text doesn't respond correctly to scale changes\n## Bevy version\n\nBevy 0.15.0-rc.2\n\n## What you did\n\nI spawned a `Text2d` during `Setup`\n\n## What went wrong\n\nThe text gets a different size and position at a scale factor of 2 compared to a scale factor of 1.\n\n## Additional information\n\nText that is updated after the scale factor is applied seems to behave as expected.\n\nScale factor 1:\n![Image](https://github.com/user-attachments/assets/79d7dff2-0816-4bea-b3f0-2fb06144442b)\n\nScale factor 2:\n![Image](https://github.com/user-attachments/assets/845cadd3-ae1b-488a-8255-8aeefde78ed2)\n\nThe FPS text is updated each frame and thus avoids this issue.\n",
    "bevyengine__bevy-11167": "BlobVec::push is linear\n```rust\r\n    #[test]\r\n    fn test_quadratic() {\r\n        unsafe {\r\n            let mut vec = BlobVec::new(Layout::new::<u64>(), None, 0);\r\n            for i in 0..100_000_000 {\r\n                if i % 1_000_000 == 0 {\r\n                    println!(\"{i}\");\r\n                }\r\n                OwningPtr::make(i, |ptr| {\r\n                    vec.push(ptr);\r\n                });\r\n                hint::black_box(&mut vec);\r\n            }\r\n        }\r\n    }\r\n\r\n    #[test]\r\n    fn test_quadratic_vec() {\r\n        let mut vec = Vec::new();\r\n        for i in 0..100_000_000 {\r\n            if i % 1_000_000 == 0 {\r\n                println!(\"{i}\");\r\n            }\r\n            vec.push(i);\r\n            hint::black_box(&mut vec);\r\n        }\r\n    }\r\n```\r\n\r\nSecond test finishes in a second.\r\n\r\nFirst test never finishes, and shows it gets slower with each iteration.\r\n\r\nIt is not noticable in typical application because:\r\n* `reserve_exact` before `push` (which is how `BlobVec` is used) makes effect less visible (yet keeping insertion kind of quadratic)\r\n* on small `BlobVec` `realloc` often reallocates in place or reallocates to double size, making `push` effectively constant even with unnecessary call to `realloc`. But on larger allocations malloc no longer doubles the size making `push` very expensive.\n",
    "bevyengine__bevy-10627": "`insert_reflect` panics when inserting component\n## Bevy version\r\n\r\n0.12.0\r\n\r\n## What you did\r\n\r\nRegistered a type, create it from somewhere and then send it by event.\r\n```rust\r\nbullet_ec.insert_reflect(event.bullet_type.clone_value());\r\n```\r\n\r\n## What went wrong\r\n\r\n```\r\nthread 'main' panicked at T:\\packages\\cargo\\registry\\src\\index.crates.io-6f17d22bba15001f\\bevy_ecs-0.12.0\\src\\reflect\\entity_commands.rs:197:9:\r\nCould not get type registration (for component type bevy_reflect::DynamicStruct) because it doesn't exist in the TypeRegistry.\r\n```\r\n\r\n## Additional information\r\n\r\nYou won't always get the real type path from `reflect_type_path`. The `clone_value()` overrides type info into \"bevy_reflect::DynamicStruct\". \r\n\r\n```rust\r\nprintln!(\"origin: {:?}, cloned: {:?}\", bullet_type.reflect_type_path(), bullet_type.clone_value().reflect_type_path());\r\n\r\n// prints\r\n// origin: \"rogue_shooting::bullets::LaneShot\", cloned: \"bevy_reflect::DynamicStruct\"\r\n```\r\n\r\nOne feasible workaround is [dyn-clone](https://docs.rs/dyn-clone/latest/dyn_clone/). \r\n```rust\r\ntrait CloneReflect: Reflect + DynClone {}\r\ndyn_clone::clone_trait_object!(CloneReflect);\r\n```\r\nImplement this for your component. They will be perfectly cloned now by using `.clone()`.\n",
    "bevyengine__bevy-10103": "Potential reflect issue: DynamicStruct not registered\n## Bevy version\r\n\r\nversion: current main branch\r\n\r\n## What you did\r\n\r\nWhile migrating my crate to the current bevy main, I am facing the current error: \"No registration found for bevy_reflect::DynamicStruct\" when deserializing a reflected component.\r\nThis worked in bevy 0.11.\r\n\r\nThe current branch where I'm working, and my test failing is: https://github.com/raffaeleragni/bevy_sync/blob/bevy_0_12/src/proto_serde.rs#L122\n",
    "bevyengine__bevy-9551": "`#[deref]` fails when properties have other attributes or doc comments: \"unexpected token in attribute\"\n## Bevy version\r\n\r\n0.11.2\r\n\r\n## What you did\r\n\r\nI have a struct with several properties and would like to use the `#[deref]` attribute for one of them.\r\nHowever, this doesn't work if any of the struct's fields have documentation comments or other attributes.\r\n\r\nMinimal reproduction:\r\n\r\n```rust\r\n#[derive(Component, Deref, DerefMut)]\r\nstruct MyComponent {\r\n    #[deref]\r\n    foo: bool,\r\n    /// Important documentation. (throws error)\r\n    pub bar: bool,\r\n}\r\n```\r\n\r\n## What went wrong\r\n\r\nI get the error `unexpected token in attribute`. The publicity or type of the properties doesn't seem to matter, and I think it happens with all attribute types.\r\n\r\n## Additional information\r\n\r\nMy use case for this is bevy_xpbd's components like `ExternalForce`. It has multiple documented fields, but I want to deref the actual force property so that you can do e.g. `*force = Vec3::Y` instead of `force.force = Vec3::Y`. I can do (and currently do) this manually, but for ergonomics it would be nice if `#[deref]` worked properly.\n",
    "bevyengine__bevy-9530": "Enable subgroups for PluginGroups\nThe primary place I see this being used is for DefaultPlugins.\r\nWould allow bevies' default plugins to to take advantage of PluginGroups with only a PluginGroup instead of a Plugin + PluginGroup.\r\n\r\nExample API:\r\n```rust\r\n// Implements Plugin\r\npub struct FooPlugin;\r\n// Implements Plugin\r\npub struct BarPlugin;\r\n// Implements PluginGroup\r\npub struct CowPlugins;\r\n\r\n// Example plugin group\r\npub struct ExamplePlugins;\r\n\r\nimpl PluginGroup for ExamplePlugins {\r\n    fn build(&mut self, group: &mut PluginGroupBuilder) {\r\n        group\r\n            .add(FooPlugin)\r\n            .add_group(CowPlugins)\r\n            .add(BarPlugin);\r\n    }\r\n}\r\n```\r\n\n",
    "bevyengine__bevy-8691": "Add `get_at_mut` to `Map` trait\n## What problem does this solve or what need does it fill?\r\n\r\nCurrently the solution to getting a mutable reference to the key/value at an index of a map is to get the key and value immutably, clone the key, then use that to index the map. This is unnecessarily inefficient and could easily be avoided.\r\n\r\n## What solution would you like?\r\n\r\nA `get_at_mut` method that works like `get_at`, but returns mutable references.\r\n\r\nI might PR this myself later if I remember.\n",
    "bevyengine__bevy-8476": "`despawn_descendants` does not clear `Children` component on parent entity\n## Bevy version\r\n\r\n0.10\r\n\r\n## What you did\r\n\r\nCall `.despawn_descendants` either via `Commands` or directly on the `World` via `.entity_mut()`.\r\n\r\n## What went wrong\r\n\r\nThe parent's `Children` component is not cleared.\r\n\r\n## Additional information\r\n\r\nThese methods are defined [here](https://github.com/bevyengine/bevy/blob/abf12f3b3be0a537484aa3ce0adc625f627c413a/crates/bevy_hierarchy/src/hierarchy.rs#L120)\n",
    "bevyengine__bevy-8467": "Setting the timer duration to zero panicks\n## Bevy version\r\nbevy 0.10.1\r\n\r\n## What you did\r\n\r\nI set a repeating timers duration to 0. I did so accidentally using the egui_inspector, but is also reproducible if setting it via code. \r\n\r\n## What went wrong\r\n\r\nBevy panicked, because it can't divide by 0.\r\n\r\nthread 'Compute Task Pool (3)' panicked at 'attempt to divide by zero', C:\\<redacted>\\.cargo\\registry\\src\\index.crates.io-6f17d22bba15001f\\bevy_time-0.10.1\\src\\timer.rs:228:21\r\n\r\nCaused by this line of code:\r\n```\r\n                self.times_finished_this_tick =\r\n                    (self.elapsed().as_nanos() / self.duration().as_nanos()) as u32;```\r\n\r\n## Additional information\r\n\r\nWhile in my case it happened for a repeating timer, similar panics can and will happen if for example the percent function of the timer is used, while the duration is set to 0.\n",
    "imsnif__bandwhich-23": "Listen on all interfaces\n`what` now listens on the interface given by the `-i` flag. The default behaviour should probably be \"listen on all interfaces\", with the -i flag being an optional override.\r\n\r\nThings that are needed to do this:\r\n1. The OS layer (eg. `os/linux.rs`) needs to be adjusted.\r\n2. The `OsInputOutput` struct needs to be adjusted to get multiple network interfaces.\r\n3. The UI needs to be adjusted to display the name of the local interface where relevant (mostly in the connections table). Maybe something like `<eth0>:12345 => 1.1.1.1:54321` *shrug emoji*\n",
    "imsnif__bandwhich-118": "Option to change the default 'window' when terminal is small\nIs it possible to implement an option for default 'window' to display when the terminal size is small?\r\n\r\nI'd love to be able to get 'Utilization by connection' as default information, for example, instead of 'Utilization by process name'.\r\nAnd even more, an option to always display only that 'window'.\n",
    "rust-fuzz__cargo-fuzz-388": "Fuzzing Windows DLL (cdylib) - Unresolved External Symbol Main\nHi cargo-fuzz devs! I am working on fuzzing a Windows DLL with cargo-fuzz and have been hitting a wall with a particular linker error. I've reproduced the problem in a small & simple Cargo project to demonstrate the issue.\r\n\r\n## Problem Description\r\n\r\nThe issue arises when the to-be-fuzzed Cargo project defines its `crate-type` as `[\"cdylib\"]`, specifically on Windows (it will compile into a DLL). The `Cargo.toml` looks something like this:\r\n```toml\r\n[package]\r\nname = \"simplelib\"\r\nversion = \"0.1.0\"\r\nedition = \"2021\"\r\n# ...\r\n[lib]\r\ncrate-type = [\"cdylib\"]\r\n# ...\r\n[dependencies.windows]\r\nversion = \"0.58.0\"\r\nfeatures = [ \"Win32\" ]\r\n# ...\r\n```\r\n\r\nA very basic DLL `DllMain` function in `lib.rs` looks like this:\r\n\r\n```rust\r\nuse windows::Win32::Foundation::*;\r\n\r\n#[export_name = \"DllMain\"]\r\nextern \"system\" fn dll_main(_: HINSTANCE, _: u32, _: *mut ()) -> bool\r\n{\r\n    true\r\n}\r\n```\r\n\r\nAfter running `cargo fuzz init` to initialize a basic fuzzing sub-project, the command `cargo fuzz build` (or `cargo fuzz run`) will fail during building with the following linker error:\r\n\r\n```\r\n  = note:    Creating library C:\\Users\\USERNAME\\dev\\simplelib\\fuzz\\target\\x86_64-pc-windows-msvc\\release\\deps\\simplelib.dll.lib and object C:\\Users\\USERNAME\\dev\\simplelib\\fuzz\\target\\x86_64-pc-windows-msvc\\release\\deps\\simplelib.dll.exp\r\n          LINK : error LNK2001: unresolved external symbol main\r\n          C:\\Users\\USERNAME\\dev\\simplelib\\fuzz\\target\\x86_64-pc-windows-msvc\\release\\deps\\simplelib.dll : fatal error LNK1120: 1 unresolved externals\r\n```\r\n\r\n### Steps to Reproduce\r\n\r\n1. On a Windows system (with Rust/Cargo installed), open PowerShell\r\n2. `cargo init --lib ./simplelib`\r\n3. (edit Cargo.toml to have the above information)\r\n4. `cargo fuzz init`\r\n5. `cargo fuzz build`\r\n\r\n## Problem Analysis\r\n\r\nI spent time digging through the various options passed to the Rust compiler by cargo-fuzz, and found [this commit](https://github.com/rust-fuzz/cargo-fuzz/commit/34ca3fbd9d7e99c1db20abf21039f17f8fa74f5c), which adds the `/include:main` linker argument for builds using the `msvc` triple. Based on the comment left with that line of code, and reading up on the [/include option](https://learn.microsoft.com/en-us/cpp/build/reference/include-force-symbol-references), I understand the intention is to force libraries compiled on Windows to include the `main` symbol, so it can be found within LibFuzzer.\r\n\r\nI also found #281, and based on the discussion there it seems like `crate-type = [\"cdylib\"]` may not be supported by cargo-fuzz. If I'm thinking about this problem correctly, I understand why `cdylib` crates cause issues: DLLs/shared libraries, by nature, are loaded at runtime and don't have (don't *need*) prior knowledge of a `main` function. But, as it sits now, it appears that Cargo projects that can only build as `cdylibs` aren't able to be built by cargo-fuzz. (Please correct me if I am wrong)\r\n\r\n## Possible Solution\r\n\r\nWould it be possible to modify the cargo-fuzz building routine to build & instrument DLLs *without* the `main` function? This would allow the DLL to be built and instrumented in the same way as the fuzzing targets, but it would then be up to the user as to where the DLL should be dropped, so it can be loaded during fuzzing. (Since the DLL would be built with Sanitizer Coverage instrumentation, LibFuzzer should still be able to detect code coverage changes when the fuzzing target loads it in at runtime and invokes the DLL's functions.)\r\n\r\nPerhaps something like this:\r\n\r\n```rust\r\nif build.triple.contains(\"-msvc\") && !build.crate_type.ne(\"cdylib\") {\r\n    // The entrypoint is in the bundled libfuzzer rlib, this gets the linker to find it.\r\n    // (Do not do this if we're building a DLL; instead let it build & be instrumented without `main`)\r\n    rustflags.push_str(\" -Clink-arg=/include:main\");\r\n}\r\n```\r\n\r\nI've been testing this theory locally (modifying my local copy of cargo-fuzz's code by commenting out the `rustflags.push_str(\" -Clink-arg=/include:main\")` when building the DLL), and it's building successfully with instrumentation. After it's built, I drop it into a location where my fuzzing target can pick it up for loading, and when I run `cargo fuzz run my_fuzz_target`, LibFuzzer appears to be quickly discovering a set of cascading if-statements and a bug I inserted inside the DLL.\n",
    "rust-fuzz__cargo-fuzz-344": "Detect when code is reproducing a crash vs when it is fuzzing\nHi all,\r\n\r\nI have a lot of fun using `cargo fuzz` on my projects! It lowers the barrier enough that fuzzing becomes simple, so well done :+1: \r\n\r\nWhen I find a crash, I often need to debug it by adding extra `dbg!` or `eprintln!` calls to my code. Is there a way for me to leave this debug code in my fuzzer, but only activate it when I'm reproducing a crash?\r\n\r\nI saw the `#[cfg(fuzzing)]` flag, but it is enabled equally in both cases (as it should be since reproducing the crash could rely on it). I looked at the command line arguments, but the only difference seems to be if the last argument is a directory or not. When I run `cargo fuzz run backends_rust_generate` I see:\r\n```rust\r\n[fuzz_targets/backends_rust_generate.rs:7] std::env::args().collect::<Vec<_>>() = [\r\n    \"fuzz/target/x86_64-unknown-linux-gnu/release/backends_rust_generate\",\r\n    \"-artifact_prefix=/home/mgeisler/src/pdl/fuzz/artifacts/backends_rust_generate/\",\r\n    \"/home/mgeisler/src/pdl/fuzz/corpus/backends_rust_generate\",\r\n]\r\n\r\n```\r\n\r\nvs when reproducing a crash with `cargo fuzz run backends_rust_generate fuzz/artifacts/backends_rust_generate/crash-a3d9424297fe7b773102352b48b7bdd6b0457430`:\r\n\r\n```rust\r\n[fuzz_targets/backends_rust_generate.rs:7] std::env::args().collect::<Vec<_>>() = [\r\n    \"fuzz/target/x86_64-unknown-linux-gnu/release/backends_rust_generate\",\r\n    \"-artifact_prefix=/home/mgeisler/src/pdl/fuzz/artifacts/backends_rust_generate/\",\r\n    \"fuzz/artifacts/backends_rust_generate/crash-c9b96795bcb23158a324f38824d56e24f04b6426\",\r\n]\r\n```\r\n\r\nIdeally, there would be another `cfg` value I can use to completely compile away the debug prints when fuzzing. Does that exist?\n",
    "rust-fuzz__cargo-fuzz-264": "[`fuzz run`] Bad discovered input should display custom fuzz dir \nCurrently, when `fuzz run someTarget` discovers a bad input, it doesn't take into consideration custom `--fuzz-dir` directories.\r\n\r\nActual:\r\n```\r\nRUST_BACKTRACE=1 cargo fuzz run --fuzz-dir someDirectory someTarget\r\n\r\n...\r\n\r\nReproduce with:\r\n\r\n\tcargo fuzz run someTarget someDirectory/artifacts/someTarget/crash-bleh-bleh-bleh\r\n\r\nMinimize test case with:\r\n\r\n\tcargo fuzz tmin someTarget someDirectory/artifacts/someTarget/crash-blah-blah-blah\r\n```\r\n\r\nExpected:\r\n```\r\nRUST_BACKTRACE=1 cargo fuzz run --fuzz-dir someDirectory someTarget\r\n\r\n...\r\n\r\nReproduce with:\r\n\r\n\tcargo fuzz run --fuzz-dir someDirectory someTarget someDirectory/artifacts/someTarget/crash-bleh-bleh-bleh\r\n\r\nMinimize test case with:\r\n\r\n\tcargo fuzz tmin --fuzz-dir someDirectory someTarget someDirectory/artifacts/someTarget/crash-blah-blah-blah\r\n```\n",
    "rust-fuzz__cargo-fuzz-262": "Support for non-standard project directories\n`fuzz` is currently the only possible directory name and it would be nice to have something like `cargo fuzz run --path some_fuzz_project_dir someTarget`\n",
    "rust-fuzz__cargo-fuzz-234": "Recommended reproduction command ignores arguments\nWhen running the fuzzer with specific sanitizer, time or memory settings and an issue is found then the output for reproduction is not complete. In particular the recommended command line for reproducing the issue misses any of these parameters as well as the used `cargo` version. Abbreviated example below.\r\n\r\n```sh\r\n$ cargo +nightly fuzz run some_fuzzer -sanitizer=memory\r\n# ...\r\nSUMMARY: MemorySanitizer: use-of-uninitialized-value (...)\r\nExiting\r\n# ...\r\nReproduce with:\r\n\r\n    cargo fuzz run some_fuzzer fuzz/artifacts/parser/crash-hash\r\n```\r\n\r\nWhen it should instead print:\r\n\r\n```sh\r\nReproduce with:\r\n\r\n    cargo +nightly fuzz run some_fuzzer -sanitizer=memory fuzz/artifacts/parser/crash-hash\r\n```\n",
    "rust-fuzz__cargo-fuzz-231": "Fuzzing with default settings is much slower than it needs to be\n`cargo fuzz run` currently defaults to debug mode with Address Sanitizer. Debug mode in Rust is needlessly slow, easily 20x slower than release mode, and for fuzzing performance is critical. It would be a much better idea to default to release mode, but with debug assertions and overflow checks enabled.\r\n\r\nThe only reason to invoke actual debug mode is when reproducing the testcase and actually trying to debug it. So it'd be nice to add a flag `--debug` that forces debug mode and print it in the crash output, but this should be a non-breaking change in all other respects.\n",
    "rust-lang__chalk-75": "fallback clauses considered harmful / how to handle projection equality\nIn working on https://github.com/rust-lang-nursery/chalk/pull/73, I encountered a problem with the concept of a \"fallback clause\", which is currently a key part of how we handle normalization. The idea of a fallback clause is that it is a clause that we use if no other clauses apply. That seems fine but it's actually too weak: we wind up coming up with \"unique\" solutions that are not in fact unique.\r\n\r\nConsider this example:\r\n\r\n```\r\ntrait Iterator { type Item; }\r\nstruct Foo { }\r\nstruct Vec<T> { }\r\na\r\n```\r\n\r\nand this goal:\r\n\r\n```\r\nforall<T> {\r\n    if (T: Iterator) {\r\n        exists<U> {\r\n            exists<V> {\r\n                U: Iterator<Item = V>\r\n}   }   }   }\r\n```\r\n\r\nHere, there are two values for `U` and `V`:\r\n\r\n- `exists<W> { U = Vec<W>, V = W }`\r\n- `U = T, V = T::Item`\r\n\r\nHowever, our current system will select the first one and be satisfied. This is because the second one is considered a \"fallback\" option, and hence since the first one is satisfied, it never gets considered. This is not true of the SLG solver, since I never could figure out how to integrate fallback into that solver -- for good reasons, I think.\r\n\r\nI have a branch [de-fallback](https://github.com/nikomatsakis/chalk-ndm/tree/de-fallback) that adresses this problem by removing the notion of fallback clauses. Instead, we have a new domain goal, \"projection equality\", which replaces normalization in a way (though normalization, as we will see, plays a role). When we attempt to unify two types T and U where at least one of those types is a projection, we \"rewrite\" to projection equality (really, we could rewrite all of unification into clauses, but I chose the more limited path here, since otherwise we'd have to handle higher-ranked types and substitution in the logic code).\r\n\r\nProjection equality is defined by two clauses per associated item, which are defined when lowering the trait (well, when lowering the declaration of the associated item found in the trait). The first clause is what we used to call the \"fallback\" rule, basically covering the \"skolemized\" case:\r\n\r\n```\r\nforall<T> {\r\n    ProjectionEq(<T as Iterator>::Item = (Iterator::Item)<T>)\r\n}\r\n```\r\n\r\nThe second clause uses a revised concept of *normalization*. Normalization in this setup is limited to applying an impl to rewrite a projection to the type found in the impl (whereas before it included the fallback case):\r\n\r\n```\r\nforall<T, U> {\r\n    ProjectionEq(<T as Iterator>::Item = U) :-\r\n        Normalizes(<T as Iterator>::Item -> U)\r\n}\r\n```\r\n\r\nBoth of these rules are created when lowering the trait. When lowering the **impl**, we would make a rule like:\r\n\r\n```\r\nforall<T> {\r\n    Normalizes(<Vec<T> as Iterator>::Item -> T) :-\r\n        (Vec<T>: Iterator).\r\n}\r\n```\r\n\r\nThis all seems to work pretty well. Note that `ProjectionEq` can never \"guess\" the right hand side unless normalization is impossible: that is `exists<X> { ProjectionEq(<Vec<i32> as Iterator>::Item = X) }` is still ambiguous. But if you want to force normalize, you can use the `Normalizes` relation (which would only be defined, in that example, wen `X = i32`). \r\n\r\n*However,* the tests are currently failing because we are running into problems with the implied bounds elaborations and the limitations of the recursive solver. (The SLG solver handles it fine.) In particular, there is a rule that looks something like this:\r\n\r\n```\r\nforall<T, U> {\r\n    (T: Iterator) :-\r\n        ProjectionEq(<T as Iterator>::Item = U)\r\n}\r\n```\r\n\r\nThis is basically saying, if we *know* (somehow) that `T::Item` is equal to `U`, then we know that `T` must implement `Iterator`. It's reasonable, but it winds up causing us a problem. This is because, in the recursive solver, when we are doing normalization, we apply the normalization clause cited above, and then must prove that `(Vec<T>: Iterator)`. To do that, we turn to our full set of clauses, which includes a clause from the impl (which is the right one) and the clause above. The reverse elaboration clause always yields **ambiguous** -- this is because there is no unique answer to `ProjectionEq`, and `U` is unconstrained.\r\n\r\nI'm not 100% sure how to resolve this problem right now, so I thought I'd open the issue for a bit of discussion.\r\n\r\ncc @scalexm @aturon \r\n\n",
    "rust-lang__chalk-55": "refactor occurs check into a folder\nThe occurs check code in `src/solve/infer/unify.rs` (specifically, the methods defined on `OccursCheck`) follows a very folder-like pattern. Unfortunately, it can't quite use the `Folder` trait (as defined in `fold.rs`) because that trait only contains \"callback methods\" for processing free lifetime/type/krate variables. The occurs check needs to be able intercept all types, at least, as well as names that live in a universe and a few other things. We could add callback methods for those things to `Folder`. \r\n\r\nI imagine the resulting trait would look like:\r\n\r\n```rust\r\npub trait Folder {\r\n    // Methods today:\r\n    fn fold_free_var(&mut self, depth: usize, binders: usize) -> Result<Ty>;\r\n    fn fold_free_lifetime_var(&mut self, depth: usize, binders: usize) -> Result<Lifetime>;\r\n    fn fold_free_krate_var(&mut self, depth: usize, binders: usize) -> Result<Krate>;\r\n\r\n    // Methods we need:\r\n    fn fold_ty(&mut self, ty: &Ty, binders: usize) -> Result<Ty>;\r\n    fn fold_lifetime(&mut self, lifetime: &Lifetime, binders: usize) -> Result<Lifetime>;\r\n}\r\n```\r\n\r\nOne thing that I'm not crazy about is that `fold_ty` invokes `fold_free_var` etc, at least in its default incarnation, so putting them into the same trait might mean that if you override `fold_ty` you would not need the other methods. So it might be better to have `Folder` just include the higher-level methods (e.g., `fold_ty`) and then have a new trait `VarFolder` where we define a bridge impl like `impl<T: VarFolder> Folder for T`. Or something like that.\n",
    "rust-lang__chalk-282": "unification under binders is broken\nThe current logic for unifying under binders as broken in two ways. First off, it's specific (rather unnecessarily) to `for<'a>` types, when it should be applicable to any zippable things. Secondly, it only tests one half of the necessary conditions! In fact, we've got a comment to this effect, somehow:\r\n\r\nhttps://github.com/rust-lang/chalk/blob/3ea7a60b73e202f2799efa8d711b633ed55b276a/chalk-solve/src/infer/unify.rs#L201-L209\r\n\r\nWhat I think we should do is two things.\r\n\r\nFirst, we need to instantiate in *both* directions, as the comment suggests. We should be able to add a \"sibling test\" to this existing test\r\n\r\nhttps://github.com/rust-lang/chalk/blob/3ea7a60b73e202f2799efa8d711b633ed55b276a/src/test/unify.rs#L122-L123\r\n\r\nthat looks like this one:\r\n\r\n```rust\r\n#[test]\r\nfn equality_binder2() {\r\n    test! {\r\n        program {\r\n            struct Ref<'a, 'b> { }\r\n        }\r\n\r\n        goal {\r\n            for<'b, 'c> Ref<'b, 'c> = for<'a> Ref<'a, 'a>\r\n        } yields {\r\n            \"Unique; substitution [], lifetime constraints [InEnvironment { environment: Env([]), goal: '!1_1 == '!1_0 }]\"\r\n        }\r\n\r\n        goal {\r\n            for<'a> Ref<'a, 'a> = for<'b, 'c> Ref<'b, 'c>\r\n        } yields {\r\n            \"Unique; substitution [], lifetime constraints [InEnvironment { environment: Env([]), goal: '!1_1 == '!1_0 }]\"\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nRight now, the second test fails for me -- I get `lifetime constraints []`, which is clearly wrong. We want to be generating constraints like the ones above, which are in fact not reconcilable. (Those constraints say \"this is equal if `'b == 'c`\", which cannot be proven.)\r\n\r\nSecond, move this logic to `zip_binders` and remove [`unify_forall_tys`](https://github.com/rust-lang/chalk/blob/3ea7a60b73e202f2799efa8d711b633ed55b276a/chalk-solve/src/infer/unify.rs#L196-L200) (or make it just invoke `zip` on its arguments).:\r\n\r\nhttps://github.com/rust-lang/chalk/blob/3ea7a60b73e202f2799efa8d711b633ed55b276a/chalk-solve/src/infer/unify.rs#L384-L389\r\n\r\nThis should then allow us to support zipping the binders and things inside `dyn` and `impl` types using the same routines.\r\n\r\nFinally, third, if we like, we could optimize the case where you are zipping two `forall` with a **single** argument -- in that case, we could just instantiate with a placeholder on both sides and skip the existentials, I believe. But that's just an optimization.\r\n\r\n\n",
    "rust-lang__chalk-237": "Normalization doesn't take into account which impl actually applied\nSplit off from #234:\r\n```rust\r\n#[test]\r\nfn normalize_into_iterator() {\r\n    test! {\r\n        program {\r\n            trait IntoIterator { type Item; }\r\n            trait Iterator { type Item; }\r\n            struct Vec<T> { }\r\n            struct u32 { }\r\n            impl<T> IntoIterator for Vec<T> {\r\n                type Item = T;\r\n            }\r\n            impl<T> IntoIterator for T where T: Iterator {\r\n                type Item = <T as Iterator>::Item;\r\n            }\r\n        }\r\n\r\n        goal {\r\n            forall<T> {\r\n                exists<U> {\r\n                    Normalize(<Vec<T> as IntoIterator>::Item -> U)\r\n                }\r\n            }\r\n        } yields {\r\n            \"Unique\"\r\n        }\r\n    }\r\n}\r\n```\r\nI'd expect this test to pass because the second IntoIterator impl should not have any effect at all here, but the result is instead ambiguous, because apparently the Normalize rule from the second impl applies too, because it just checks that the type implements IntoIterator, and not that it does so with that impl. That seems really wrong.\r\n\r\nNiko:\r\n\r\n> We wind up with these two program clauses:\r\n```\r\nfor<type> Normalize(<Vec<^0> as IntoIterator>::Item -> ^0) :- \r\n    Implemented(Vec<^0>: IntoIterator)\r\n\r\nfor<type> Normalize(<^0 as IntoIterator>::Item -> <^0 as Iterator>::Item) :- \r\n    Implemented(^0: IntoIterator)\r\n```\r\n> I think what I'd expect is something like\r\n```\r\nfor<type> Normalize(<Vec<^0> as IntoIterator>::Item -> ^0)\r\n\r\nfor<type> Normalize(<^0 as IntoIterator>::Item -> <^0 as Iterator>::Item) :- \r\n    Implemented(^0: Iterator)\r\n```\r\n> In particular, inlining the where-clauses and conditions of the impl into the rule. @scalexm -- do you recall why we set things up the way we did?\r\n\r\nscalexm:\r\n> I don\u2019t think there\u2019s any good reason why the where clauses are not inlined.\r\n> I probably thought it was equivalent because there would be a \u00ab perfect match \u00bb with the impl, but of course two impls can have a non-empty intersection with respect to their receiver type.\nNormalization doesn't take into account which impl actually applied\nSplit off from #234:\r\n```rust\r\n#[test]\r\nfn normalize_into_iterator() {\r\n    test! {\r\n        program {\r\n            trait IntoIterator { type Item; }\r\n            trait Iterator { type Item; }\r\n            struct Vec<T> { }\r\n            struct u32 { }\r\n            impl<T> IntoIterator for Vec<T> {\r\n                type Item = T;\r\n            }\r\n            impl<T> IntoIterator for T where T: Iterator {\r\n                type Item = <T as Iterator>::Item;\r\n            }\r\n        }\r\n\r\n        goal {\r\n            forall<T> {\r\n                exists<U> {\r\n                    Normalize(<Vec<T> as IntoIterator>::Item -> U)\r\n                }\r\n            }\r\n        } yields {\r\n            \"Unique\"\r\n        }\r\n    }\r\n}\r\n```\r\nI'd expect this test to pass because the second IntoIterator impl should not have any effect at all here, but the result is instead ambiguous, because apparently the Normalize rule from the second impl applies too, because it just checks that the type implements IntoIterator, and not that it does so with that impl. That seems really wrong.\r\n\r\nNiko:\r\n\r\n> We wind up with these two program clauses:\r\n```\r\nfor<type> Normalize(<Vec<^0> as IntoIterator>::Item -> ^0) :- \r\n    Implemented(Vec<^0>: IntoIterator)\r\n\r\nfor<type> Normalize(<^0 as IntoIterator>::Item -> <^0 as Iterator>::Item) :- \r\n    Implemented(^0: IntoIterator)\r\n```\r\n> I think what I'd expect is something like\r\n```\r\nfor<type> Normalize(<Vec<^0> as IntoIterator>::Item -> ^0)\r\n\r\nfor<type> Normalize(<^0 as IntoIterator>::Item -> <^0 as Iterator>::Item) :- \r\n    Implemented(^0: Iterator)\r\n```\r\n> In particular, inlining the where-clauses and conditions of the impl into the rule. @scalexm -- do you recall why we set things up the way we did?\r\n\r\nscalexm:\r\n> I don\u2019t think there\u2019s any good reason why the where clauses are not inlined.\r\n> I probably thought it was equivalent because there would be a \u00ab perfect match \u00bb with the impl, but of course two impls can have a non-empty intersection with respect to their receiver type.\n",
    "rust-lang__chalk-780": "Unable to deduce projection types of dyn types from supertrait bounds\nContext: https://github.com/rust-lang/rust-analyzer/issues/13169\r\n\r\nIt seems chalk is unable to deduce projection type of trait object types when it's not specified in `dyn` notation but the trait has supertrait with its projection type specified.\r\n\r\nI expect the following tests to succeed but all three fail. This is because according to the rules described in #203, chalk yields `AliasEq(<dyn Trait as Base>::Output = usize)` as a subgoal but there's no \"fact\" clause for that to prove it. Shouldn't the `AliasEq` clause be also produced as a fact under these circumstances, or should we explicitly pass the `AliasEq` clause?\r\n\r\n```rust\r\ntest! {\r\n    program {\r\n        trait Base { type Output; }\r\n        trait Trait where Self: Base<Output = usize> {}\r\n    }\r\n\r\n    goal {\r\n        forall<'s> {\r\n            dyn Trait + 's: Trait\r\n        }\r\n    } yields[SolverChoice::recursive_default()] {\r\n        expect![[r#\"Unique\"#]] // fails: \"No possible solution\"\r\n    }\r\n\r\n    goal {\r\n        forall<'s> {\r\n            dyn Trait + 's: Base<Output = usize>\r\n        }\r\n    } yields[SolverChoice::recursive_default()] {\r\n        expect![[r#\"Unique\"#]] // fails: \"No possible solution\"\r\n    }\r\n\r\n    goal {\r\n        forall<'s> {\r\n            exists<T> {\r\n                dyn Trait + 's: Base<Output = T>\r\n            }\r\n        }\r\n    } yields[SolverChoice::recursive_default()] {\r\n        // fails: \"Unique; substitution [?0 := (Base::Output)<dyn for<type> [for<> Implemented(^1.0: Trait)] + '!1_0>]\"\r\n        expect![[r#\"Unique; substitution [?0 := Uint(Usize)]\"#]]\r\n    }\r\n}\r\n```\n",
    "rust-lang__chalk-755": "Auto traits are not handled for generic closures \nThe following test fails with both solvers (returning ambiguous).\n\n```rust\nprogram {\n      #[auto]\n      trait Send { }\n\n      closure with_ty<T>(self,) { T }\n}\n\ngoal {\n    forall<T> { if (T: Send) { with_ty<T>: Send } }\n} yields {\n    \"Unique\"\n}\n ```\n \nThe empty substs here seem suspicious.\n https://github.com/rust-lang/chalk/blob/e0c94db8a497eee4ed1f49534fb0714801cb90e8/chalk-solve/src/clauses.rs#L167\n\n<!-- TRIAGEBOT_START -->\n\n<!-- TRIAGEBOT_ASSIGN_START -->\n\n<!-- TRIAGEBOT_ASSIGN_DATA_START$${\"user\":\"shamatar\"}$$TRIAGEBOT_ASSIGN_DATA_END -->\n\n<!-- TRIAGEBOT_ASSIGN_END -->\n<!-- TRIAGEBOT_END -->\n",
    "rust-lang__chalk-392": "deferred: can we / should we truncate the environment, and how to avoid loops?\nIn https://github.com/rust-lang/chalk/pull/294, we opted to stop truncating the environment. The problem was due to an infinite loop that arose in some rust-analyzer cases. The scenario [was described on Zulip](https://rust-lang.zulipchat.com/#narrow/stream/144729-wg-traits/topic/design.20meeting.202019.2E12.2E09/near/182989871) recently but is also covered in #280 and #289.\r\n\r\nIn short, we would truncate a projection `Foo::Bar` from the environment and replace it with an inference variable `?X`. When we get back an answer, we would unify `Foo::Bar` with the value inferred for `?X` -- which would up being a fresh inference variable. This would create a projection goal, but that projection goal includes the same environment that we started with, and hence that same environment would get truncated again. This would result in the cycle beginning anew.\r\n\r\nFor now, we opted to just stop truncating the environment, because it isn't really needed at the moment -- Rust doesn't generate queries that grow the environment in indefinite ways. But we may want to revisit this with another fix, or -- depending on how we resolve normalization -- this may become a non-issue in the future. \n\n<!-- TRIAGEBOT_START -->\n\n<!-- TRIAGEBOT_ASSIGN_START -->\nThis issue has been assigned to @zaharidichev via [this comment](https://github.com/rust-lang/chalk/issues/306#issuecomment-612038103).\n<!-- TRIAGEBOT_ASSIGN_DATA_START$${\"user\":\"zaharidichev\"}$$TRIAGEBOT_ASSIGN_DATA_END -->\n\n<!-- TRIAGEBOT_ASSIGN_END -->\n<!-- TRIAGEBOT_END -->\n",
    "atuinsh__atuin-747": "Bash history import issues\nI spotted two issues while trying to import my Bash history:\r\n\r\n1. Import ordering is incorrectly reversed.\r\n2. `.bash_history` can be configured to store timestamps, a case not handled.\r\n\r\n---\r\n\r\n## Ordering\r\n\r\nIn the following snippet, lines from the top of the file will receive the newest timestamp:\r\n\r\nhttps://github.com/cyqsimon/atuin/blob/d46e3ad47d03e53232269973806fb9da2248ba19/atuin-client/src/import/bash.rs#L42-L67\r\n\r\nThis is incorrect for `.bash_history` - new items are appended to the end of the file, not the start. So the first lines are in fact the oldest commands.\r\n\r\n## Stored timestamps\r\n\r\nThe current import code for Bash assumes that each line is a command. However if `HISTTIMEFORMAT` is set, then a timestamp is recorded for each command (see `man bash`). So `.bash_history` would look something like this:\r\n\r\n```\r\n#1672918999\r\ngit reset\r\n#1672919006\r\ngit clean -dxf\r\n#1672919020\r\ncd ../\r\n```\r\n\r\nThis case is currently not handled, so the timestamp lines are getting falsely-imported as commands.\r\n\r\n---\r\n\r\nI am working on a patch that will fix both these issues, so give me a little while and I'll submit a PR.\r\n\r\nThe reason I'm posing this issue mostly concerns the extent of the ordering problem. Did it happen because\r\n- the original author used a different shell that does store the newest commands at the start of its history file, and wrongly assumed the same for Bash?\r\n- or the original author made a simple arithmetic mistake, and this is an issue for the import code of all shells?\r\n\r\nIn other words, I'm not that familiar with other shells, so does the import code for them need fixing as well?\n",
    "atuinsh__atuin-1238": "atuin hangs at first start in bad network environments\nThis issue can be reproduced with the following preconditions:\r\n\r\n- a really (as in awfully) bad network environment with a rather large-ish (>=98%) packet loss rate\r\n- using atuin to browse the history the first time after boot\r\n\r\nAtuin hangs for an indefinite amount of time while trying to make a request to atuin.sh:\r\n\r\n```\r\nconnect(13, {sa_family=AF_INET, sin_port=htons(443), sin_addr=inet_addr(\"104.21.80.213\")}, 16) = -1 EINPROGRESS (Operation now in progress)\r\nepoll_ctl(5, EPOLL_CTL_ADD, 13, {events=EPOLLIN|EPOLLOUT|EPOLLRDHUP|EPOLLET, data={u32=1, u64=1}}) = 0\r\nwrite(4, \"\\1\\0\\0\\0\\0\\0\\0\\0\", 8)         = 8\r\nepoll_wait(3, [{events=EPOLLIN, data={u32=2147483648, u64=2147483648}}], 1024, 249) = 1\r\nepoll_wait(3, [], 1024, 249)            = 0\r\nepoll_wait(3, [], 1024, 51)             = 0\r\nwrite(4, \"\\1\\0\\0\\0\\0\\0\\0\\0\", 8)         = 8\r\nsocket(AF_INET6, SOCK_STREAM|SOCK_CLOEXEC, IPPROTO_TCP) = 14\r\nfcntl(14, F_GETFL)                      = 0x2 (flags O_RDWR)\r\nfcntl(14, F_SETFL, O_RDWR|O_NONBLOCK)   = 0\r\nconnect(14, {sa_family=AF_INET6, sin6_port=htons(443), sin6_flowinfo=htonl(0), inet_pton(AF_INET6, \"2606:4700:3037::6815:50d5\", &sin6_addr), sin6_scope_id=0}, 28) = -1 ENETUNREACH (Network is unreachable)\r\nclose(14)                               = 0\r\nsocket(AF_INET6, SOCK_STREAM|SOCK_CLOEXEC, IPPROTO_TCP) = 14\r\nfcntl(14, F_GETFL)                      = 0x2 (flags O_RDWR)\r\nfcntl(14, F_SETFL, O_RDWR|O_NONBLOCK)   = 0\r\nconnect(14, {sa_family=AF_INET6, sin6_port=htons(443), sin6_flowinfo=htonl(0), inet_pton(AF_INET6, \"2606:4700:3030::ac43:9a5a\", &sin6_addr), sin6_scope_id=0}, 28) = -1 ENETUNREACH (Network is unreachable)\r\nclose(14)                               = 0\r\nepoll_wait(3, [{events=EPOLLIN, data={u32=2147483648, u64=2147483648}}], 1024, 523979) = 1\r\nepoll_wait(3, 0x564d2b85abe0, 1024, 523979) = -1 EINTR (Interrupted system call)\r\n```\r\n\r\nI have configured atuin for offline usage (e.g. am not using the sync server at atuin.sh) so I suspect this happens while querying what the latest version is, calling `latest_version()` as defined in `api_client.rs`. I haven't spend too much time debugging this yet, but suspect that letting the requests timeout after a few seconds should mitigate this issue.\n",
    "atuinsh__atuin-2058": "[Bug]: atuin stats panics when faced with unusual string in history\n### What did you expect to happen?\n\nNo panic! ;]\n\n### What happened?\n\nWhen running `atuin stats` it panics with:\r\n\r\n```\r\n\u276f RUST_BACKTRACE=1 atuin stats\r\nthread 'main' panicked at atuin/src/command/client/stats.rs:56:41:\r\nbegin <= end (1 <= 0) when slicing `| awk '{print $1}' | R --no-echo -e 'x <- scan(file=\"stdin\", quiet=TRUE); summary(x)'`\r\nstack backtrace:\r\n   0: _rust_begin_unwind\r\n   1: core::panicking::panic_fmt\r\n   2: core::str::slice_error_fail_rt\r\n   3: core::str::slice_error_fail\r\n   4: atuin::command::client::stats::compute_stats\r\n   5: atuin::command::client::Cmd::run_inner::{{closure}}\r\n   6: tokio::runtime::scheduler::current_thread::Context::enter\r\n   7: tokio::runtime::context::set_scheduler\r\n   8: tokio::runtime::scheduler::current_thread::CoreGuard::block_on\r\n   9: tokio::runtime::context::runtime::enter_runtime\r\n  10: tokio::runtime::runtime::Runtime::block_on\r\n  11: atuin::main\r\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\r\n```\r\n\r\nNow that string `| awk '{print $1}' | R --no-echo -e 'x <- scan(file=\"stdin\", quiet=TRUE); summary(x)'` is actually in my history like that (it's the \"entire\" command), so obviously some copy-pasta failure on my part, but I don't think it should make `atuin` panic (maybe due to starting with a `|`?).\n\n### Atuin doctor output\n\n```yaml\nAtuin Doctor\r\nChecking for diagnostics\r\n\r\n\r\nPlease include the output below with any bug reports or issues\r\n\r\natuin:\r\n  version: 18.1.0\r\n  sync:\r\n    cloud: false\r\n    records: true\r\n    auto_sync: true\r\n    last_sync: 2024-03-14 18:05:58.081633 +00:00:00\r\nshell:\r\n  name: zsh\r\n  plugins:\r\n  - atuin\r\nsystem:\r\n  os: Darwin\r\n  arch: x86_64\r\n  version: 14.3.1\r\n  disks:\r\n  - name: Macintosh HD\r\n    filesystem: apfs\r\n  - name: Macintosh HD\r\n    filesystem: apfs\n```\n\n\n### Code of Conduct\n\n- [X] I agree to follow this project's Code of Conduct\n",
    "atuinsh__atuin-1739": "Enable multiple command stats to be shown\nThese changes extend the `stats` subcommand with an `--ngram-size` argument, which supports providing statistics for combinations of commands. I have found this useful for identifying the most common combinations of commands as candidates for further automation.\n",
    "atuinsh__atuin-1722": "`ignore_commands` option for stats\nWould you be open to having an `ignore_commands` option for `atuin stats`?  `cd`, `ls`, and `vi` are my three top commands by nearly an order of  and I don't find this particularly informative; I'd be interested in filtering these out entirely from my stats.\r\n\r\nIf you're interested in this, I'd be willing to take a stab at a PR for it.\n",
    "BurntSushi__ripgrep-2626": "`rg --unknown-switch` panics on broken pipe error\n#### What version of ripgrep are you using?\r\n\r\n```console\r\n$ ./target/debug/rg --version\r\nripgrep 13.0.0 (rev 9b01a8f9ae)\r\n-SIMD -AVX (compiled)\r\n+SIMD +AVX (runtime)\r\n```\r\n\r\n#### How did you install ripgrep?\r\n\r\nCompiled from source.\r\n\r\n```console\r\n$ git rev-parse HEAD\r\n9b01a8f9ae53ebcd05c27ec21843758c2c1e823f\r\n```\r\n\r\n#### What operating system are you using ripgrep on?\r\n\r\nmacOS Big Sur 11.5.1 (20G80)\r\n\r\n#### Describe your bug.\r\n\r\nripgrep panics when printing a clap error to stderr if stderr is closed.\r\n\r\n#### What are the steps to reproduce the behavior?\r\n\r\nApply this diff to ripgrep:\r\n\r\n```diff\r\ndiff --git a/crates/core/main.rs b/crates/core/main.rs\r\nindex 47385de..f3d9889 100644\r\n--- a/crates/core/main.rs\r\n+++ b/crates/core/main.rs\r\n@@ -46,10 +46,14 @@ static ALLOC: jemallocator::Jemalloc = jemallocator::Jemalloc;\r\n type Result<T> = ::std::result::Result<T, Box<dyn error::Error>>;\r\n\r\n fn main() {\r\n-    if let Err(err) = Args::parse().and_then(try_main) {\r\n-        eprintln!(\"{}\", err);\r\n-        process::exit(2);\r\n-    }\r\n+    let f = std::panic::catch_unwind(std::panic::AssertUnwindSafe(|| {\r\n+        if let Err(err) = Args::parse().and_then(try_main) {\r\n+            eprintln!(\"{}\", err);\r\n+            process::exit(2);\r\n+        }\r\n+    }));\r\n+    println!(\"panicked? - {}\", f.is_err());\r\n+    process::exit(1);\r\n }\r\n\r\n fn try_main(args: Args) -> Result<()> {\r\n```\r\n\r\nThen:\r\n\r\n```console\r\n$ cargo build\r\n$ ./target/debug/rg --unknown-switch 3>&1 1>&2 2>&3 | head -c 0 # swap stdout and stderr, close stdout\r\nhead: illegal byte count -- 0\r\npanicked? - true\r\n$ echo $?\r\n1\r\n```\r\n\r\nI'm not sure how I could observe this panic without the patch since rust writes the panic to stderr. Maybe if ripgrep is compiled with `panic = abort`?\r\n\r\n#### What is the actual behavior?\r\n\r\nripgrep panics if stderr is closed despite going to great lengths to avoid panicking when writing to stdout.\r\n\r\n#### What is the expected behavior?\r\n\r\nripgrep does not panic.\r\n",
    "BurntSushi__ripgrep-2610": "Option to print file paths as file URLs\nPrinting file paths as `file` URLs is very handy since you can click on them and the file will open. This happens in Konsole at least.",
    "BurntSushi__ripgrep-2576": "Incomplete matches when using the `--word-regexp` flag\n#### What version of ripgrep are you using?\r\nripgrep 13.0.0\r\n-SIMD -AVX (compiled)\r\n\r\n#### How did you install ripgrep?\r\n`wget https://github.com/BurntSushi/ripgrep/releases/download/13.0.0/ripgrep-13.0.0-x86_64-unknown-linux-musl.tar.gz`\r\n\r\n#### What operating system are you using ripgrep on?\r\nMac and Linux\r\n\r\n#### Describe your bug.\r\nAccording to the manual: \r\n```\r\n-w, --word-regexp\r\n            Only show matches surrounded by word boundaries. This is roughly equivalent to\r\n            putting \\b before and after all of the search patterns.\r\n```\r\n\r\nI'm using this text as a sample file:\r\n```\r\nsome.domain.com\r\nsome.domain.com/x\r\nsome.domain.com\r\n```\r\n\r\nAnd here is some very naive regex that searches for \"domains\" (not really, but it is enough to show the problem):\r\n`\"([\\w]+[.])*domain[.](\\w)+`\r\n\r\nRunning this regex with the `-w` flag (`rg -w \"([\\w]+[.])*domain[.](\\w)+\"`) matches the first and third strings properly (`some.domain.com`), but for the second one **starts capturing from the second char onwards**, meaning it matches `ome.domain.com`.\r\n\r\nIf I change the execution, remove the `-w` flag and wrap the regex with `\\b` (`rg \"\\b([\\w]+[.])*domain[.](\\w)+\\b\"`), then all lines are matched properly (`some.domain.com` is matched).\r\n\r\n#### What are the steps to reproduce the behavior?\r\nExplained above.\r\n\r\n#### What is the actual behavior?\r\nhttps://gist.github.com/ilia-cy/396f43f57057e42723d4a3dc87d4e994\r\nThe matches aren't shown here because they are highlighted in the terminal, so i'm adding a screenshot:\r\n\r\n<img width=\"270\" alt=\"image\" src=\"https://github.com/BurntSushi/ripgrep/assets/60312091/04a73a38-4829-4c16-8497-9f53a5219ac5\">\r\n\r\n\r\n#### What is the expected behavior?\r\nI would expect that the flag usage would work similarly as wrapping the pattern with `\\b` (as the manual indicates), so that all the `some.domain.com` instances will be matched.\r\n",
    "BurntSushi__ripgrep-2488": "Patterns may affect each other when multiple patterns are provided\n#### What version of ripgrep are you using?\r\n13.0.0\r\n\r\n#### How did you install ripgrep?\r\nbrew \r\n\r\n#### What operating system are you using ripgrep on?\r\nMacOS M1\r\n\r\n#### Describe your bug.\r\nWhen providing multiple patterns via either `-e` or `-f`,\r\nspecified flags affect all following patterns. \r\n\r\n#### What are the steps to reproduce the behavior?\r\n```$ echo 'MyText' | rg -o -e '(?i)notintext' -e 'text'\r\nText\r\n```\r\n\r\n#### What is the actual behavior?\r\nrg respect the case-insensitive flag `(?i)` from the first pattern in the second pattern as well.\r\n```$ echo 'MyText' | rg -o --debug -e '(?i)notintext' -e 'text'\r\nDEBUG|globset|crates/globset/src/lib.rs:421: built glob set; 0 literals, 0 basenames, 12 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes\r\nText\r\n```\r\n\r\nSame goes for:\r\n`echo 'MyText' | rg -f <(printf '(?i)notintext\\ntext')`\r\n\r\n\r\n#### What is the expected behavior?\r\nEmpty result (the case-insensitive flag should not affect the second pattern).\r\n\r\n#### What do you think ripgrep should have done?\r\nTreat each pattern independently.\r\nSpecifically, for these pattern, I'd expect the merged pattern to be:\r\n`'(?:(?i)notintext')|(?:'text')`\r\nrather than:\r\n`'(?i)notintext'|'text'`\r\n\r\n#### Side notes:\r\n1. Works as expected if I manually wrap each pattern as `(?:PATTERN)`\r\n2. Works as expected if I replace the first pattern with `(?i:notintext)`\r\n3. Works as expected if I replace the order of the patterns (because the effect of the flag only applies \"to the right\")",
    "BurntSushi__ripgrep-2295": "Only some ignores applied when searching a sub-directory\n#### What version of ripgrep are you using?\r\n\r\n```\r\nripgrep 12.1.1\r\n-SIMD -AVX (compiled)\r\n+SIMD +AVX (runtime)\r\n```\r\n\r\n#### How did you install ripgrep?\r\n\r\nSystem package https://www.archlinux.org/packages/community/x86_64/ripgrep/\r\n\r\n#### What operating system are you using ripgrep on?\r\n\r\nArch Linux\r\n\r\n#### Describe your bug.\r\n\r\nWhen giving a sub-directory of the current directory to search as a second command-line argument to ripgrep, only some patterns of `.ignore` in the current directory are applied.\r\n\r\n#### What are the steps to reproduce the behavior?\r\n\r\n```sh\r\nmkdir tmp\r\ncd tmp\r\nmkdir rust\r\nmkdir rust/target\r\necho needle > rust/source.rs\r\necho needle > rust/target/rustdoc-output.html\r\necho rust/target > .ignore\r\nrg --files-with-matches needle\r\nrg --files-with-matches needle rust\r\necho target >> .ignore\r\nrg --files-with-matches needle rust\r\n```\r\n\r\n#### What is the actual behavior?\r\n\r\nThe first and third `rg` commands only print `rust/source.rs` as expected. However the second one prints both `rust/source.rs` and `rust/target/rustdoc-output.html`.\r\n\r\nWith `--debug` added, and `-j1` for more readable output:\r\n\r\n\r\n```\r\n$ rg --files-with-matches needle --debug -j1\r\nDEBUG|grep_regex::literal|crates/regex/src/literal.rs:58: literal prefixes detected: Literals { lits: [Complete(needle)], limit_size: 250, limit_class: 10 }\r\nDEBUG|globset|crates/globset/src/lib.rs:431: built glob set; 0 literals, 0 basenames, 12 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes\r\nDEBUG|globset|crates/globset/src/lib.rs:431: built glob set; 1 literals, 0 basenames, 0 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes\r\nDEBUG|ignore::walk|crates/ignore/src/walk.rs:1730: ignoring ./.ignore: Ignore(IgnoreMatch(Hidden))\r\nrust/source.rs\r\nDEBUG|ignore::walk|crates/ignore/src/walk.rs:1730: ignoring ./rust/target: Ignore(IgnoreMatch(Gitignore(Glob { from: Some(\"./.ignore\"), original: \"rust/target\", actual: \"rust/target\", is_whitelist: false, is_only_dir: false })))\r\n\r\n```\r\n```\r\n$ rg --files-with-matches needle rust --debug -j1\r\nDEBUG|grep_regex::literal|crates/regex/src/literal.rs:58: literal prefixes detected: Literals { lits: [Complete(needle)], limit_size: 250, limit_class: 10 }\r\nDEBUG|globset|crates/globset/src/lib.rs:431: built glob set; 0 literals, 0 basenames, 12 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes\r\nDEBUG|globset|crates/globset/src/lib.rs:431: built glob set; 1 literals, 0 basenames, 0 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes\r\nrust/source.rs\r\nrust/target/rustdoc-output.html\r\n```\r\n\r\nAfter `echo target >> .ignore`:\r\n\r\n```\r\n$ rg --files-with-matches needle rust --debug -j1\r\nDEBUG|grep_regex::literal|crates/regex/src/literal.rs:58: literal prefixes detected: Literals { lits: [Complete(needle)], limit_size: 250, limit_class: 10 }\r\nDEBUG|globset|crates/globset/src/lib.rs:431: built glob set; 0 literals, 0 basenames, 12 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes\r\nDEBUG|globset|crates/globset/src/lib.rs:431: built glob set; 1 literals, 1 basenames, 0 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes\r\nrust/source.rs\r\nDEBUG|ignore::walk|crates/ignore/src/walk.rs:1730: ignoring rust/target: Ignore(IgnoreMatch(Gitignore(Glob { from: Some(\"/tmp/tmp/.ignore\"), original: \"target\", actual: \"**/target\", is_whitelist: false, is_only_dir: false })))\r\n```\r\n\r\n#### What is the expected behavior?\r\n\r\nEach command should only print `rust/source.rs`, as the HTML file should be ignored.\r\n\r\nOne might imagine that when searching a sub-directory only `.ignore` files under that sub-directory are considered, but the third command shows that is not the case. (The more general ignore pattern is not the desired one, it only serves to show that the `.ignore` file is indeed read.)\r\n\r\n#### Work-around\r\n\r\nI\u2019ve managed to find a set up that does what I want by creating a `.ignore` file in the `rust` sub-directory of the project instead, with a `/target` pattern.\r\n\r\n#### Other suggestion\r\n\r\nAfter trying a few things and seeing unexpected results I wanted to find out details of the syntax of `.ignore` files. For example, is an initial slash meaningful?\r\n\r\nI had to dig to find the answer in https://docs.rs/ignore/0.4.17/ignore/struct.WalkBuilder.html:\r\n\r\n> `.ignore` files have the same semantics as `gitignore` files \r\n\r\nand\r\n\r\n> `.gitignore` files have match semantics as described in the `gitignore` man page.\r\n\r\nIt would be good to repeat these two facts in ripgrep\u2019s own docs.\r\n",
    "BurntSushi__ripgrep-2209": "Adding --replace to a --multiline search can expand what content is matched\n#### What version of ripgrep are you using?\r\n\r\n```\r\nripgrep 13.0.0\r\n-SIMD -AVX (compiled)\r\n+SIMD +AVX (runtime)\r\n```\r\n\r\n#### How did you install ripgrep?\r\n\r\n`apt`:\r\n\r\n```\r\nripgrep:\r\n  Installed: 13.0.0-2\r\n  Candidate: 13.0.0-2\r\n  Version table:\r\n *** 13.0.0-2 500\r\n        500 http://us.archive.ubuntu.com/ubuntu jammy/universe amd64 Packages\r\n        100 /var/lib/dpkg/status\r\n```\r\n\r\n#### What operating system are you using ripgrep on?\r\n\r\n`Pop!_OS 22.04 LTS`\r\n\r\n#### Describe your bug.\r\n\r\nI have a multiline (not dot-all) search with capture groups that works as expected without `--replace`, but with it, the last capture group seems to capture more content unexpectedly.\r\n\r\n#### What are the steps to reproduce the behavior?\r\n\r\nContent to search, `patternfuncs.zsh`:\r\n```bash\r\n# Compile requirements.txt files from all found or specified requirements.in files (compile).\r\n# Use -h to include hashes, -u dep1,dep2... to upgrade specific dependencies, and -U to upgrade all.\r\npipc () {  # [-h] [-U|-u <pkgspec>[,<pkgspec>...]] [<reqs-in>...] [-- <pip-compile-arg>...]\r\n    emulate -L zsh\r\n    unset REPLY\r\n    if [[ $1 == --help ]] { zpy $0; return }\r\n    [[ $ZPY_PROCS ]] || return\r\n\r\n    local gen_hashes upgrade upgrade_csv\r\n    while [[ $1 == -[hUu] ]] {\r\n        if [[ $1 == -h ]] { gen_hashes=--generate-hashes; shift   }\r\n        if [[ $1 == -U ]] { upgrade=1;                    shift   }\r\n        if [[ $1 == -u ]] { upgrade=1; upgrade_csv=$2;    shift 2 }\r\n    }\r\n}\r\n```\r\n\r\n```console\r\n$ rg --no-config --color never -NU -r '$usage' '^(?P<predoc>\\n?(# .*\\n)*)(alias (?P<aname>pipc)=\"[^\"]+\"|(?P<fname>pipc) \\(\\) \\{)(  #(?P<usage> .+))?' patternfuncs.zsh\r\n```\r\n\r\n#### What is the actual behavior?\r\n\r\n```console\r\n$ rg --no-config --debug --color never -NU -r '$usage' '^(?P<predoc>\\n?(# .*\\n)*)(alias (?P<aname>pipc)=\"[^\"]+\"|(?P<fname>pipc) \\(\\) \\{)(  #(?P<usage> .+))?' patternfuncs.zsh\r\n```\r\n```shell\r\nDEBUG|rg::args|crates/core/args.rs:527: not reading config files because --no-config is present\r\nDEBUG|globset|/usr/share/cargo/registry/ripgrep-13.0.0/debian/cargo_registry/globset-0.4.8/src/lib.rs:421: built glob set; 0 literals, 0 basenames, 12 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes\r\nDEBUG|globset|/usr/share/cargo/registry/ripgrep-13.0.0/debian/cargo_registry/globset-0.4.8/src/lib.rs:421: built glob set; 1 literals, 0 basenames, 0 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes\r\n [-h] [-U|-u <pkgspec>[,<pkgspec>...]] [<reqs-in>...] [-- <pip-compile-arg>...]\r\n    emulate -L zsh\r\n    unset REPLY\r\n    if [[ $1 == --help ]] { zpy $0; return }\r\n    [[ $ZPY_PROCS ]] || return\r\n\r\n    local gen_ha\r\n```\r\n\r\nThe above output includes content which is not present when not using `-r`:\r\n\r\n```console\r\n$ rg --no-config --debug --color never -NU '^(?P<predoc>\\n?(# .*\\n)*)(alias (?P<aname>pipc)=\"[^\"]+\"|(?P<fname>pipc) \\(\\) \\{)(  #(?P<usage> .+))?' patternfuncs.zsh\r\n```\r\n```shell\r\nDEBUG|rg::args|crates/core/args.rs:527: not reading config files because --no-config is present\r\nDEBUG|globset|/usr/share/cargo/registry/ripgrep-13.0.0/debian/cargo_registry/globset-0.4.8/src/lib.rs:421: built glob set; 0 literals, 0 basenames, 12 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes\r\nDEBUG|globset|/usr/share/cargo/registry/ripgrep-13.0.0/debian/cargo_registry/globset-0.4.8/src/lib.rs:421: built glob set; 1 literals, 0 basenames, 0 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes\r\n# Compile requirements.txt files from all found or specified requirements.in files (compile).\r\n# Use -h to include hashes, -u dep1,dep2... to upgrade specific dependencies, and -U to upgrade all.\r\npipc () {  # [-h] [-U|-u <pkgspec>[,<pkgspec>...]] [<reqs-in>...] [-- <pip-compile-arg>...]\r\n```\r\n\r\n#### What is the expected behavior?\r\n\r\nI'd expect the command with `-r '$usage'` to output only the first line of its current output, that is:\r\n\r\n```shell\r\n [-h] [-U|-u <pkgspec>[,<pkgspec>...]] [<reqs-in>...] [-- <pip-compile-arg>...]\r\n```",
    "BurntSushi__ripgrep-1980": "Support apply smart case to each individual search pattern separately\n#### Describe your feature request\r\n\r\nripgrep support to search several patterns together by `-e` or listing patterns in a file and using `-f` to specify the file. \r\nMeanwhile, `--smart-case` option can judge search pattern if it needs a case sensitive searching. But, for now, all patterns are treated together to match the smart case rule. i.e. if I use `rg -S -e Abc -e bcd`, search pattern `bcd` also be treated as case sensitive. \r\nSo, I think it's better to support apply smart case rule to every search pattern separately, especially in the `-f` usage. But I am not sure if patterns in a single regex should support this.\r\n\r\nI think ripgrep's man page for this change would be like:\r\n```\r\n -S, --smart-case\r\n            Searches case insensitively if the pattern is all lowercase. Search case\r\n            sensitively otherwise. Every individual search pattern follow this rule \r\n            by itself, including PATTERN specified by -e and patterns in PATTERNFILE\r\n            specified by -f.\r\n```",
    "BurntSushi__ripgrep-1642": "Search does not stop with --max-count and --context with matches in the context lines\n#### What version of ripgrep are you using?\r\n\r\nripgrep 11.0.2\r\n-SIMD -AVX (compiled)\r\n+SIMD -AVX (runtime)\r\n\r\n#### How did you install ripgrep?\r\n\r\nGithub binary release\r\n\r\n#### What operating system are you using ripgrep on?\r\n\r\nLinux, RHEL 7.7\r\n\r\n#### Describe your question, feature request, or bug.\r\n\r\nUnexpected behavior when combining --max-count with --context, if there are additional matches in the context. This is not really a bug, more like inconsistent behavior.\r\n\r\nI am searching for the first match in one file and want to print the next _n_ lines.\r\nIf there are no additional matches in the context, then the search output stops after the first result and prints the next _n_ lines.\r\nIf there is an additional match within the next _n_ lines, then (it seems like) rg treats this as a match and restarts its internal context line counter, printing an additional _n_ lines. \r\n\r\nI am aware that --max-count is a limit on per-line matches. But it _works_ for some input files and it does not work for some other files, which is unexpected. Also, it appears somewhat similar to #402.\r\n\r\n#### If this is a bug, what are the steps to reproduce the behavior?\r\n```\r\n> cat rgtest.txt\r\na\r\nb\r\nc\r\nd\r\ne\r\nd\r\ne\r\nd\r\ne\r\nd\r\ne\r\n```\r\n\r\n#### If this is a bug, what is the actual behavior?\r\n\r\nWorking as expected: Print first result and next line:\r\n```\r\n> rg -m 1 -A 1 d rgtest.txt\r\n4:d\r\n5-e\r\n```\r\nWorking as expected: Do \"print first result and next line\" twice:\r\n```\r\n> rg -m 2 -A 1 d rgtest.txt\r\n4:d\r\n5-e\r\n6:d\r\n7-e\r\n```\r\n\r\nUnexpected: Print first result and next two lines\r\n```\r\n> rg -m 1 -A 2 d rgtest.txt\r\n4:d\r\n5-e\r\n6:d\r\n7-e\r\n8:d\r\n9-e\r\n10:d\r\n11-e\r\n12-\r\n```\r\nExpected result:\r\n```\r\n4:d\r\n5-e\r\n6:d\r\n```\r\n\r\n#### If this is a bug, what is the expected behavior?\r\nNot a bug, but a wish for consistency (i.e. _please fix it for my specific use case_)",
    "BurntSushi__ripgrep-1367": "match bug\n```\r\n$ rg --version\r\nripgrep 11.0.1 (rev 7bf7ceb5d3)\r\n-SIMD -AVX (compiled)\r\n+SIMD +AVX (runtime)\r\n```\r\n\r\nThis matches:\r\n\r\n```\r\n$ echo 'CCAGCTACTCGGGAGGCTGAGGCTGGAGGATCGCTTGAGTCCAGGAGTTC' | egrep 'CCAGCTACTCGGGAGGCTGAGGCTGGAGGATCGCTTGAGTCCAGGAG[ATCG]{2}C'\r\nCCAGCTACTCGGGAGGCTGAGGCTGGAGGATCGCTTGAGTCCAGGAGTTC\r\n```\r\n\r\nBut this doesn't:\r\n\r\n```\r\n$ echo 'CCAGCTACTCGGGAGGCTGAGGCTGGAGGATCGCTTGAGTCCAGGAGTTC' | rg 'CCAGCTACTCGGGAGGCTGAGGCTGGAGGATCGCTTGAGTCCAGGAG[ATCG]{2}C'\r\n```\r\n\r\nTo minimize, this doesn't match:\r\n\r\n```\r\n$ rg 'TTGAGTCCAGGAG[ATCG]{2}C' /tmp/subject\r\n```\r\n\r\nBut this does:\r\n\r\n```\r\n$ rg 'TGAGTCCAGGAG[ATCG]{2}C' /tmp/subject\r\n1:CCAGCTACTCGGGAGGCTGAGGCTGGAGGATCGCTTGAGTCCAGGAGTTC\r\n```\r\n\r\nThe only difference between the latter two is that the latter removes the first\r\n`T` from the regex.\r\n\r\nFrom inspecting the `--trace` output, I note that from the former regex, it\r\nsays this:\r\n\r\n```\r\nDEBUG|grep_regex::literal|grep-regex/src/literal.rs:105: required literals found: [Complete(TTGAGTCCAGGAGAC), Complete(TTGAGTCCAGGAGCC), Complete(TTGAGTCCAGGAGGC), Complete(TTGAGTCCAGGAGTC)]\r\nTRACE|grep_regex::matcher|grep-regex/src/matcher.rs:52: extracted fast line regex: (?-u:TTGAGTCCAGGAGAC|TTGAGTCCAGGAGCC|TTGAGTCCAGGAGGC|TTGAGTCCAGGAGTC)\r\n```\r\n\r\nBut in the latter regex (the one that works), we have this:\r\n\r\n```\r\nDEBUG|grep_regex::literal|grep-regex/src/literal.rs:59: literal prefixes detected: Literals { lits: [Complete(TGAGTCCAGGAGAAC), Complete(TGAGTCCAGGAGCAC), Complete(TGAGTCCAGGAGGAC), Complete(TGAGTCC\r\nAGGAGTAC), Complete(TGAGTCCAGGAGACC), Complete(TGAGTCCAGGAGCCC), Complete(TGAGTCCAGGAGGCC), Complete(TGAGTCCAGGAGTCC), Complete(TGAGTCCAGGAGAGC), Complete(TGAGTCCAGGAGCGC), Complete(TGAGTCCAGGAGGGC)\r\n, Complete(TGAGTCCAGGAGTGC), Complete(TGAGTCCAGGAGATC), Complete(TGAGTCCAGGAGCTC), Complete(TGAGTCCAGGAGGTC), Complete(TGAGTCCAGGAGTTC)], limit_size: 250, limit_class: 10 }\r\n```\r\n\r\nTherefore, this is almost certainly a bug in literal extraction. Moreover,\r\nthis Rust program correctly prints `true`:\r\n\r\n```rust\r\nfn main() {\r\n    let pattern = r\"CCAGCTACTCGGGAGGCTGAGGCTGGAGGATCGCTTGAGTCCAGGAG[ATCG]{2}C\";\r\n    let haystack = \"CCAGCTACTCGGGAGGCTGAGGCTGGAGGATCGCTTGAGTCCAGGAGTTC\";\r\n\r\n    let re = regex::Regex::new(pattern).unwrap();\r\n    println!(\"{:?}\", re.is_match(haystack));\r\n}\r\n```\r\n\r\nWhich points the finger at `grep-regex`'s inner literal extraction. Sigh.",
    "BurntSushi__ripgrep-1294": "For to --iglob even if -g\n#### What version of ripgrep are you using?\r\n\r\nripgrep 11.0.1\r\n-SIMD -AVX (compiled)\r\n+SIMD +AVX (runtime)\r\n\r\n\r\n#### How did you install ripgrep?\r\n\r\nbrew install\r\n\r\n#### What operating system are you using ripgrep on?\r\n\r\nMac OSx lastest\r\n\r\n#### Describe your question, feature request, or bug.\r\n\r\nHow do I force --iglob for all my searches even if I specify -g ..\r\nI would like to avoid having to write a custom function/wrapper\r\n\r\nThanks",
    "BurntSushi__ripgrep-954": "use different exit codes for \"no match\" and \"error\"\n#### What version of ripgrep are you using?\r\n\r\n0.8.1\r\n\r\n#### How did you install ripgrep?\r\n\r\nHomebrew\r\n\r\n#### What operating system are you using ripgrep on?\r\n\r\nmacOS 10.13.5\r\n\r\n#### Describe your question, feature request, or bug.\r\n\r\nHi!\r\n\r\nI am using ripgrep from within a node.js program using `child_process.exec()`. I've noticed that when I don't find anyhting in a search, ripgrep terminates with a non-zero exit code thus informing `child_process.exec()` that \"something went wrong\".\r\n\r\nI'd simply like to know, if there is any flag one can use or other measure to prevent a non-zero exit code during the aforementioned circumstances. I can solve the issue from with the node.js program, but would think \"manipulating\" the exit code would be a more elegant solution.",
    "BurntSushi__ripgrep-727": "Suggest --fixed-strings on invalid regexps\n```\r\n$ rg \"foo(\"\r\nError parsing regex near 'foo(' at character offset 3: Unclosed parenthesis.\r\n```\r\n\r\nI think ripgrep should suggest the `--fixed-strings` argument if there's a regex syntax error.",
    "BurntSushi__ripgrep-723": "Fixed width line numbers\nIt would be nice to be able to see the indentation level of searched text line up. One way to do this would be to have fixed width line numbers in search results. This could be accomplished through an option flag and left-padding with either spaces or zeroes when the flag is active.\r\n\r\nAs this is primarily of interest for matches within a file, only the matches within a file need be considered for how wide the line numbers should be. Alternatively, one could have a pre-determined width (i.e. 6) and overflow larger line numbers.\r\n\r\nImplemented, this could look either like this:\r\n```\r\n$ rg needle --fixed-width-line-numbers\r\nhaystack.txt:\r\n 12:    needle {\r\n144:      needle {\r\n\r\nsilo.txt:\r\n  16:  } needle {\r\n 256:    } // needle 1\r\n 512:    } // needle 2\r\n1024:  } // needles\r\n\r\nwarehouse.txt:\r\n   1234:  - needle ( 5 boxes )\r\n1234567:  - needle ( 20 boxes ) \r\n```\r\n\r\nOr like this:\r\n```\r\n$ rg needle --fixed-width-line-numbers\r\nhaystack.txt:\r\n    12:    needle {\r\n   144:      needle {\r\n\r\nsilo.txt:\r\n    16:  } needle {\r\n   256:    } // needle 1\r\n   512:    } // needle 2\r\n  1024:  } // needles\r\n\r\nwarehouse.txt:\r\n  1234:  - needle (5 boxes)\r\n1234567:  - needle (20 boxes)\r\n```",
    "BurntSushi__ripgrep-454": "`--only-matching` only prints first match of matched line N times\nTake [this](https://gist.githubusercontent.com/s3rb31/3eea5bb61414f37968ac1d79a554e137/raw/d8768ae3147520581cc84fb23e892fae5795804f/ripgrep%2520test%2520file) file as test data. If I do the following with good old `grep`:\r\n\r\n`grep -Po \"\\/get\\/v\\/\\d*\" fgi.txt`\r\n\r\nI get the following result:\r\n\r\n```\r\n/get/v/19670\r\n/get/v/19637\r\n/get/v/19632\r\n/get/v/19600\r\n/get/v/19598\r\n/get/v/19574\r\n/get/v/19523\r\n/get/v/19521\r\n/get/v/19463\r\n/get/v/19457\r\n/get/v/19433\r\n/get/v/19425\r\n/get/v/19392\r\n/get/v/19390\r\n/get/v/19363\r\n/get/v/19358\r\n/get/v/19337\r\n/get/v/19317\r\n/get/v/19295\r\n/get/v/19278\r\n/get/v/19243\r\n/get/v/19241\r\n/get/v/19208\r\n/get/v/19186\r\n/get/v/19128\r\n/get/v/19126\r\n```\r\n\r\nBut if I try to achive the same result with rg:\r\n\r\n`rg -o \"/get/v/\\d*\" fgi.txt -N`\r\n\r\n```\r\n/get/v/19670\r\n/get/v/19670\r\n/get/v/19670\r\n/get/v/19670\r\n/get/v/19670\r\n/get/v/19670\r\n/get/v/19670\r\n/get/v/19670\r\n/get/v/19670\r\n/get/v/19670\r\n/get/v/19670\r\n/get/v/19670\r\n/get/v/19670\r\n/get/v/19670\r\n/get/v/19670\r\n/get/v/19670\r\n/get/v/19670\r\n/get/v/19670\r\n/get/v/19670\r\n/get/v/19670\r\n/get/v/19670\r\n/get/v/19670\r\n/get/v/19670\r\n/get/v/19670\r\n/get/v/19670\r\n/get/v/19670\r\n```\r\n\r\nI think that behaviour ist really odd and cannot be intended. If I am not mistaken this also violates the documentation (manpage):\r\n\r\n```\r\n-o, --only-matching\r\n    Print only the matched (non-empty) parts of a matching line, with each such part on a separate output line.\r\n```\r\n\r\nBut it does not print all the parts. It just prints the first match N times, where N _is_ actually the correct number of matched parts. \r\n\r\nI hope this can get fixed. I may create a PR myself if it is not too complicated and someone can lead me the right direction.\r\n\r\nGreetings",
    "clap-rs__clap-5873": "Default value not filled in on ignored error\n### Please complete the following tasks\n\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\n- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues\n\n### Rust Version\n\nrustc 1.83.0 (90b35a623 2024-11-26)\n\n### Clap Version\n\n4.5.23\n\n### Minimal reproducible code\n\n```rust\r\n#!/usr/bin/env -S cargo +nightly -Zscript\r\n---\r\n[dependencies]\r\nclap = { version = \"4.5.23\", features = [\"derive\"] }\r\n---\r\n\r\nuse clap::{parser::ValueSource, CommandFactory};\r\n\r\n#[derive(clap::Parser, Clone, Debug)]\r\npub struct Args {\r\n    #[command(flatten)]\r\n    global_args: GlobalArgs,\r\n}\r\n\r\n#[derive(clap::Args, Clone, Debug)]\r\nstruct GlobalArgs {\r\n    #[arg(long)]\r\n    ignore_immutable: bool,\r\n}\r\n\r\nfn get_value_source_of_ignore_immutable(args: &[&str]) -> ValueSource {\r\n    let app = Args::command();\r\n    let arg_matches = app\r\n        .clone()\r\n        .disable_version_flag(true)\r\n        .disable_help_flag(true)\r\n        .ignore_errors(true)\r\n        .try_get_matches_from(args)\r\n        .unwrap();\r\n    arg_matches.value_source(\"ignore_immutable\").unwrap()\r\n}\r\n\r\nfn main() {\r\n    // --i is not parsed as ignore-immutable, so far so expected\r\n    let source = get_value_source_of_ignore_immutable(&[\"jj\", \"--i\"]);\r\n    assert_eq!(source, ValueSource::DefaultValue);\r\n\r\n    // This will fail, the actual value is ValueSource::CommandLine\r\n    // \r\n    // --ig is somehow parsed as ignore-immutable? But the value is actually not set.\r\n    // This prevents the default value from being set and results in an error later:\r\n    //\r\n    // \"The following required argument was not provided: ignore_immutable\"\r\n    //\r\n    let source = get_value_source_of_ignore_immutable(&[\"jj\", \"--ig\"]);\r\n    assert_eq!(source, ValueSource::DefaultValue);\r\n}\r\n```\r\n\n\n### Steps to reproduce the bug with the above code\n\ncopy code to file, make file executable, execute file\n\n### Actual Behaviour\n\n```\r\nthread 'main' panicked at .../main.rs:47:5:\r\nassertion `left == right` failed\r\n  left: CommandLine\r\n right: DefaultValue\r\n```\n\n### Expected Behaviour\n\nasserts don't fail, `ignore_immutable` is properly filled in with default value.\n\n### Additional Context\n\nI think this is related to #5813 \r\n\r\nI've run into the problem in a similar place as the original discussion there. But the error occors only when a global flag (e.g. `--ignore-immutable`) is _partially_ present.\n\n### Debug Output\n\n```\r\n[clap_builder::builder::command]Command::_do_parse\r\n[clap_builder::builder::command]Command::_build: name=\"main\"\r\n[clap_builder::builder::command]Command::_propagate:main\r\n[clap_builder::builder::command]Command::_check_help_and_version:main expand_help_tree=false\r\n[clap_builder::builder::command]Command::long_help_exists\r\n[clap_builder::builder::command]Command::_propagate_global_args:main\r\n[clap_builder::builder::debug_asserts]Command::_debug_asserts\r\n[clap_builder::builder::debug_asserts]Arg::_debug_asserts:ignore_immutable\r\n[clap_builder::builder::debug_asserts]Command::_verify_positionals\r\n[clap_builder::parser::parser]Parser::get_matches_with\r\n[clap_builder::parser::parser]Parser::parse\r\n[clap_builder::parser::parser]Parser::get_matches_with: Begin parsing '\"--i\"'\r\n[clap_builder::parser::parser]Parser::possible_subcommand: arg=Ok(\"--i\")\r\n[clap_builder::parser::parser]Parser::get_matches_with: sc=None\r\n[clap_builder::parser::parser]Parser::parse_long_arg\r\n[clap_builder::parser::parser]Parser::parse_long_arg: Does it contain '='...\r\n[clap_builder::parser::parser]Parser::possible_long_flag_subcommand: arg=\"i\"\r\n[clap_builder::parser::parser]Parser::get_matches_with: After parse_long_arg NoMatchingArg { arg: \"i\" }\r\n[clap_builder::parser::parser]Parser::did_you_mean_error: arg=i\r\n[clap_builder::parser::parser]Parser::did_you_mean_error: longs=[\"ignore-immutable\"]\r\n[ clap_builder::output::usage]Usage::create_usage_with_title\r\n[ clap_builder::output::usage]Usage::create_usage_no_title\r\n[ clap_builder::output::usage]Usage::write_help_usage\r\n[ clap_builder::output::usage]Usage::write_arg_usage; incl_reqs=true\r\n[ clap_builder::output::usage]Usage::needs_options_tag\r\n[ clap_builder::output::usage]Usage::needs_options_tag:iter: f=ignore_immutable\r\n[clap_builder::builder::command]Command::groups_for_arg: id=\"ignore_immutable\"\r\n[ clap_builder::output::usage]Usage::needs_options_tag:iter:iter: grp_s=\"GlobalArgs\"\r\n[ clap_builder::output::usage]Usage::needs_options_tag:iter: [OPTIONS] required\r\n[ clap_builder::output::usage]Usage::write_args: incls=[]\r\n[ clap_builder::output::usage]Usage::get_args: unrolled_reqs=[]\r\n[ clap_builder::output::usage]Usage::write_subcommand_usage\r\n[ clap_builder::output::usage]Usage::create_usage_with_title: usage=Usage: jj [OPTIONS]\r\n[clap_builder::builder::command]Command::color: Color setting...\r\n[clap_builder::builder::command]Auto\r\n[clap_builder::builder::command]Command::color: Color setting...\r\n[clap_builder::builder::command]Auto\r\n[clap_builder::parser::parser]Parser::add_defaults\r\n[clap_builder::parser::parser]Parser::add_defaults:iter:ignore_immutable:\r\n[clap_builder::parser::parser]Parser::add_default_value: doesn't have conditional defaults\r\n[clap_builder::parser::parser]Parser::add_default_value:iter:ignore_immutable: has default vals\r\n[clap_builder::parser::parser]Parser::add_default_value:iter:ignore_immutable: wasn't used\r\n[clap_builder::parser::parser]Parser::react action=SetTrue, identifier=None, source=DefaultValue\r\n[clap_builder::parser::arg_matcher]ArgMatcher::start_custom_arg: id=\"ignore_immutable\", source=DefaultValue\r\n[clap_builder::parser::parser]Parser::push_arg_values: [\"false\"]\r\n[clap_builder::parser::parser]Parser::add_single_val_to_arg: cur_idx:=1\r\n[clap_builder::builder::command]Command::_do_parse: ignoring error: error: unexpected argument '--i' found\r\n\r\nUsage: jj [OPTIONS]\r\n\r\nBacktrace:\r\n   0: clap_builder::error::Backtrace::new\r\n             at /home/remo/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/clap_builder-4.5.23/src/error/mod.rs:901:19\r\n   1: clap_builder::error::Error<F>::new\r\n             at /home/remo/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/clap_builder-4.5.23/src/error/mod.rs:140:28\r\n   2: clap_builder::error::Error<F>::unknown_argument\r\n             at /home/remo/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/clap_builder-4.5.23/src/error/mod.rs:716:23\r\n   3: clap_builder::parser::parser::Parser::did_you_mean_error\r\n             at /home/remo/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/clap_builder-4.5.23/src/parser/parser.rs:1602:9\r\n   4: clap_builder::parser::parser::Parser::parse\r\n             at /home/remo/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/clap_builder-4.5.23/src/parser/parser.rs:183:40\r\n   5: clap_builder::parser::parser::Parser::get_matches_with\r\n             at /home/remo/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/clap_builder-4.5.23/src/parser/parser.rs:57:13\r\n   6: clap_builder::builder::command::Command::_do_parse\r\n             at /home/remo/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/clap_builder-4.5.23/src/builder/command.rs:4281:29\r\n   7: clap_builder::builder::command::Command::try_get_matches_from_mut\r\n             at /home/remo/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/clap_builder-4.5.23/src/builder/command.rs:857:9\r\n   8: clap_builder::builder::command::Command::try_get_matches_from\r\n             at /home/remo/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/clap_builder-4.5.23/src/builder/command.rs:767:9\r\n   9: main::get_value_source_of_ignore_immutable\r\n             at /home/remo/.cargo/target/93/ed3cdf6ba59cec/main.rs:24:23\r\n  10: main::main\r\n             at /home/remo/.cargo/target/93/ed3cdf6ba59cec/main.rs:36:18\r\n  11: core::ops::function::FnOnce::call_once\r\n             at /rustc/3f43b1a636738f41c48df073c5bcb97a97bf8459/library/core/src/ops/function.rs:250:5\r\n  12: std::sys::backtrace::__rust_begin_short_backtrace\r\n             at /rustc/3f43b1a636738f41c48df073c5bcb97a97bf8459/library/std/src/sys/backtrace.rs:152:18\r\n  13: std::rt::lang_start::{{closure}}\r\n             at /rustc/3f43b1a636738f41c48df073c5bcb97a97bf8459/library/std/src/rt.rs:195:18\r\n  14: core::ops::function::impls::<impl core::ops::function::FnOnce<A> for &F>::call_once\r\n             at /rustc/3f43b1a636738f41c48df073c5bcb97a97bf8459/library/core/src/ops/function.rs:284:13\r\n      std::panicking::try::do_call\r\n             at /rustc/3f43b1a636738f41c48df073c5bcb97a97bf8459/library/std/src/panicking.rs:584:40\r\n      std::panicking::try\r\n             at /rustc/3f43b1a636738f41c48df073c5bcb97a97bf8459/library/std/src/panicking.rs:547:19\r\n      std::panic::catch_unwind\r\n             at /rustc/3f43b1a636738f41c48df073c5bcb97a97bf8459/library/std/src/panic.rs:358:14\r\n      std::rt::lang_start_internal::{{closure}}\r\n             at /rustc/3f43b1a636738f41c48df073c5bcb97a97bf8459/library/std/src/rt.rs:174:48\r\n      std::panicking::try::do_call\r\n             at /rustc/3f43b1a636738f41c48df073c5bcb97a97bf8459/library/std/src/panicking.rs:584:40\r\n      std::panicking::try\r\n             at /rustc/3f43b1a636738f41c48df073c5bcb97a97bf8459/library/std/src/panicking.rs:547:19\r\n      std::panic::catch_unwind\r\n             at /rustc/3f43b1a636738f41c48df073c5bcb97a97bf8459/library/std/src/panic.rs:358:14\r\n      std::rt::lang_start_internal\r\n             at /rustc/3f43b1a636738f41c48df073c5bcb97a97bf8459/library/std/src/rt.rs:174:20\r\n  15: std::rt::lang_start\r\n             at /rustc/3f43b1a636738f41c48df073c5bcb97a97bf8459/library/std/src/rt.rs:194:17\r\n  16: main\r\n  17: __libc_start_call_main\r\n  18: __libc_start_main_alias_1\r\n  19: _start\r\n\r\n\r\n[clap_builder::parser::arg_matcher]ArgMatcher::get_global_values: global_arg_vec=[]\r\n[clap_builder::builder::command]Command::_do_parse\r\n[clap_builder::builder::command]Command::_build: name=\"main\"\r\n[clap_builder::builder::command]Command::_propagate:main\r\n[clap_builder::builder::command]Command::_check_help_and_version:main expand_help_tree=false\r\n[clap_builder::builder::command]Command::long_help_exists\r\n[clap_builder::builder::command]Command::_propagate_global_args:main\r\n[clap_builder::builder::debug_asserts]Command::_debug_asserts\r\n[clap_builder::builder::debug_asserts]Arg::_debug_asserts:ignore_immutable\r\n[clap_builder::builder::debug_asserts]Command::_verify_positionals\r\n[clap_builder::parser::parser]Parser::get_matches_with\r\n[clap_builder::parser::parser]Parser::parse\r\n[clap_builder::parser::parser]Parser::get_matches_with: Begin parsing '\"--ig\"'\r\n[clap_builder::parser::parser]Parser::possible_subcommand: arg=Ok(\"--ig\")\r\n[clap_builder::parser::parser]Parser::get_matches_with: sc=None\r\n[clap_builder::parser::parser]Parser::parse_long_arg\r\n[clap_builder::parser::parser]Parser::parse_long_arg: Does it contain '='...\r\n[clap_builder::parser::parser]Parser::possible_long_flag_subcommand: arg=\"ig\"\r\n[clap_builder::parser::parser]Parser::get_matches_with: After parse_long_arg NoMatchingArg { arg: \"ig\" }\r\n[clap_builder::parser::parser]Parser::did_you_mean_error: arg=ig\r\n[clap_builder::parser::parser]Parser::did_you_mean_error: longs=[\"ignore-immutable\"]\r\n[clap_builder::parser::parser]Parser::remove_overrides: id=\"ignore_immutable\"\r\n[clap_builder::parser::arg_matcher]ArgMatcher::start_custom_arg: id=\"ignore_immutable\", source=CommandLine\r\n[clap_builder::builder::command]Command::groups_for_arg: id=\"ignore_immutable\"\r\n[clap_builder::parser::arg_matcher]ArgMatcher::start_custom_arg: id=\"GlobalArgs\", source=CommandLine\r\n[ clap_builder::output::usage]Usage::create_usage_with_title\r\n[ clap_builder::output::usage]Usage::create_usage_no_title\r\n[ clap_builder::output::usage]Usage::create_smart_usage\r\n[ clap_builder::output::usage]Usage::write_arg_usage; incl_reqs=true\r\n[ clap_builder::output::usage]Usage::write_args: incls=[\"ignore_immutable\", \"GlobalArgs\"]\r\n[ clap_builder::output::usage]Usage::get_args: unrolled_reqs=[]\r\n[clap_builder::builder::command]Command::unroll_args_in_group: group=\"GlobalArgs\"\r\n[clap_builder::builder::command]Command::unroll_args_in_group:iter: entity=\"ignore_immutable\"\r\n[clap_builder::builder::command]Command::unroll_args_in_group:iter: this is an arg\r\n[clap_builder::builder::command]Command::unroll_args_in_group: group=\"GlobalArgs\"\r\n[clap_builder::builder::command]Command::unroll_args_in_group:iter: entity=\"ignore_immutable\"\r\n[clap_builder::builder::command]Command::unroll_args_in_group:iter: this is an arg\r\n[ clap_builder::output::usage]Usage::create_usage_with_title: usage=Usage: jj <--ignore-immutable>\r\n[clap_builder::builder::command]Command::color: Color setting...\r\n[clap_builder::builder::command]Auto\r\n[clap_builder::builder::command]Command::color: Color setting...\r\n[clap_builder::builder::command]Auto\r\n[clap_builder::parser::parser]Parser::add_defaults\r\n[clap_builder::parser::parser]Parser::add_defaults:iter:ignore_immutable:\r\n[clap_builder::parser::parser]Parser::add_default_value: doesn't have conditional defaults\r\n[clap_builder::parser::parser]Parser::add_default_value:iter:ignore_immutable: has default vals\r\n[clap_builder::parser::parser]Parser::add_default_value:iter:ignore_immutable: was used\r\n[clap_builder::builder::command]Command::_do_parse: ignoring error: error: unexpected argument '--ig' found\r\n\r\n  tip: a similar argument exists: '--ignore-immutable'\r\n\r\nUsage: jj <--ignore-immutable>\r\n\r\nBacktrace:\r\n   0: clap_builder::error::Backtrace::new\r\n             at /home/remo/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/clap_builder-4.5.23/src/error/mod.rs:901:19\r\n   1: clap_builder::error::Error<F>::new\r\n             at /home/remo/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/clap_builder-4.5.23/src/error/mod.rs:140:28\r\n   2: clap_builder::error::Error<F>::unknown_argument\r\n             at /home/remo/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/clap_builder-4.5.23/src/error/mod.rs:716:23\r\n   3: clap_builder::parser::parser::Parser::did_you_mean_error\r\n             at /home/remo/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/clap_builder-4.5.23/src/parser/parser.rs:1602:9\r\n   4: clap_builder::parser::parser::Parser::parse\r\n             at /home/remo/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/clap_builder-4.5.23/src/parser/parser.rs:183:40\r\n   5: clap_builder::parser::parser::Parser::get_matches_with\r\n             at /home/remo/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/clap_builder-4.5.23/src/parser/parser.rs:57:13\r\n   6: clap_builder::builder::command::Command::_do_parse\r\n             at /home/remo/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/clap_builder-4.5.23/src/builder/command.rs:4281:29\r\n   7: clap_builder::builder::command::Command::try_get_matches_from_mut\r\n             at /home/remo/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/clap_builder-4.5.23/src/builder/command.rs:857:9\r\n   8: clap_builder::builder::command::Command::try_get_matches_from\r\n             at /home/remo/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/clap_builder-4.5.23/src/builder/command.rs:767:9\r\n   9: main::get_value_source_of_ignore_immutable\r\n             at /home/remo/.cargo/target/93/ed3cdf6ba59cec/main.rs:24:23\r\n  10: main::main\r\n             at /home/remo/.cargo/target/93/ed3cdf6ba59cec/main.rs:46:18\r\n  11: core::ops::function::FnOnce::call_once\r\n             at /rustc/3f43b1a636738f41c48df073c5bcb97a97bf8459/library/core/src/ops/function.rs:250:5\r\n  12: std::sys::backtrace::__rust_begin_short_backtrace\r\n             at /rustc/3f43b1a636738f41c48df073c5bcb97a97bf8459/library/std/src/sys/backtrace.rs:152:18\r\n  13: std::rt::lang_start::{{closure}}\r\n             at /rustc/3f43b1a636738f41c48df073c5bcb97a97bf8459/library/std/src/rt.rs:195:18\r\n  14: core::ops::function::impls::<impl core::ops::function::FnOnce<A> for &F>::call_once\r\n             at /rustc/3f43b1a636738f41c48df073c5bcb97a97bf8459/library/core/src/ops/function.rs:284:13\r\n      std::panicking::try::do_call\r\n             at /rustc/3f43b1a636738f41c48df073c5bcb97a97bf8459/library/std/src/panicking.rs:584:40\r\n      std::panicking::try\r\n             at /rustc/3f43b1a636738f41c48df073c5bcb97a97bf8459/library/std/src/panicking.rs:547:19\r\n      std::panic::catch_unwind\r\n             at /rustc/3f43b1a636738f41c48df073c5bcb97a97bf8459/library/std/src/panic.rs:358:14\r\n      std::rt::lang_start_internal::{{closure}}\r\n             at /rustc/3f43b1a636738f41c48df073c5bcb97a97bf8459/library/std/src/rt.rs:174:48\r\n      std::panicking::try::do_call\r\n             at /rustc/3f43b1a636738f41c48df073c5bcb97a97bf8459/library/std/src/panicking.rs:584:40\r\n      std::panicking::try\r\n             at /rustc/3f43b1a636738f41c48df073c5bcb97a97bf8459/library/std/src/panicking.rs:547:19\r\n      std::panic::catch_unwind\r\n             at /rustc/3f43b1a636738f41c48df073c5bcb97a97bf8459/library/std/src/panic.rs:358:14\r\n      std::rt::lang_start_internal\r\n             at /rustc/3f43b1a636738f41c48df073c5bcb97a97bf8459/library/std/src/rt.rs:174:20\r\n  15: std::rt::lang_start\r\n             at /rustc/3f43b1a636738f41c48df073c5bcb97a97bf8459/library/std/src/rt.rs:194:17\r\n  16: main\r\n  17: __libc_start_call_main\r\n  18: __libc_start_main_alias_1\r\n  19: _start\r\n\r\n\r\n[clap_builder::parser::arg_matcher]ArgMatcher::get_global_values: global_arg_vec=[]\r\n\r\nthread 'main' panicked at /home/remo/.cargo/target/93/ed3cdf6ba59cec/main.rs:47:5:\r\nassertion `left == right` failed\r\n  left: CommandLine\r\n right: DefaultValue\r\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\r\n```",
    "clap-rs__clap-5527": "`num_args = 2..` does not error with 0 args and error has incorrect wording with 1 arg\n### Please complete the following tasks\n\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\n- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues\n\n### Rust Version\n\nrustc 1.78.0 (9b00956e5 2024-04-29)\n\n### Clap Version\n\n4.5.6\n\n### Minimal reproducible code\n\n```rust\r\nuse clap::Parser;\r\n\r\n#[derive(Parser)]\r\nstruct Cli {\r\n    /// Args\r\n    #[arg(value_name = \"ARG\", num_args = 2..)]\r\n    args: Vec<String>,\r\n}\r\n\r\nfn main() {\r\n    let cli = Cli::parse();\r\n    println!(\"{:#?}\", cli.args);\r\n}\r\n```\n\n### Steps to reproduce the bug with the above code\n\n```bash\r\ncargo new clap-num-args-issue\r\ncd clap-num-args-issue\r\ncargo add clap -F derive\r\ncat <<EOF >src/main.rs\r\nuse clap::Parser;\r\n\r\n#[derive(Parser)]\r\nstruct Cli {\r\n    /// Args\r\n    #[arg(value_name = \"ARG\", num_args = 2..)]\r\n    args: Vec<String>,\r\n}\r\n\r\nfn main() {\r\n    let cli = Cli::parse();\r\n    println!(\"{:#?}\", cli.args);\r\n}\r\nEOF\r\ncargo run # false negative: prints \"[]\\n\" instead of an error because len 0 < minimum of 2\r\ncargo run -- asdf # error is not grammatically correct; see below\r\ncargo run -- asdf blah # good: prints \"[\\n    \\\"asdf\\\",\\n    \\\"blah\\\",\\n]\\n\"\r\ncargo run -- asdf blah spam # good: prints \"[\\n    \\\"asdf\\\",\\n    \\\"blah\\\",\\n    \\\"spam\\\",\\n]\\n\"\r\n```\r\n\r\nError when running `cargo run -- asdf`:\r\n\r\n```text\r\nerror: 2 more values required by '[ARG] [ARG]...'; only 1 was provided\r\n```\r\n\r\nShouldn't it say either of the following?\r\n\r\n1. `error: 1 more value required by '[ARG] [ARG]...'; only 1 was provided`\r\n2. `error: 2 values required by '[ARG] [ARG]...'; only 1 was provided` (my personal preference is for this one)\n\n### Actual Behaviour\n\nThere are 2 issues:\r\n\r\n1. With num_args set to `2..` and user gives 0, it does **not** produce an error as it should because the minimum number of args is 2\r\n2. If the user gives 1 arg, it errors, but the message says it needs \"2 *more* args\" which is wrong; it needs a minimum of 2 args and 1 was given, so it needs 1 more arg not 2\n\n### Expected Behaviour\n\n1. With num_args set to `2..` and user gives 0, it should produce an error saying that it requires 2 args and 0 were given\r\n2. If the user gives 1 arg, it should say it requires 2 args and 1 was given\r\n    - (or alternatively it could say it needs 1 more arg and 1 was given; but I feel this is less precise and requires calculating the diff)\n\n### Additional Context\n\n1. Unsure root cause on this one... a quick search did not find it... but I imagine that somewhere it tests the len against the num_args range (?)\r\n2. https://github.com/clap-rs/clap/blob/2f645d3e81c783a4e76ad17f1ccf283a58b75660/clap_builder/src/error/format.rs#L340:\r\n\r\n    should be:\r\n\r\n    ```rust\r\n    \"{}{min_values}{} values required by '{}{invalid_arg}{}'; only {}{actual_num_values}{}{were_provided}\",\r\n    ```\r\n\r\n    *remove the word \"more\"*\n\n### Debug Output\n\n```text\r\n$ cargo run -- asdf\r\n    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.02s\r\n     Running `target/debug/clap-num-args-issue asdf`\r\n[clap_builder::builder::command]Command::_do_parse\r\n[clap_builder::builder::command]Command::_build: name=\"clap-num-args-issue\"\r\n[clap_builder::builder::command]Command::_propagate:clap-num-args-issue\r\n[clap_builder::builder::command]Command::_check_help_and_version:clap-num-args-issue expand_help_tree=false\r\n[clap_builder::builder::command]Command::long_help_exists\r\n[clap_builder::builder::command]Command::_check_help_and_version: Building default --help\r\n[clap_builder::builder::command]Command::_propagate_global_args:clap-num-args-issue\r\n[clap_builder::builder::debug_asserts]Command::_debug_asserts\r\n[clap_builder::builder::debug_asserts]Arg::_debug_asserts:args\r\n[clap_builder::builder::debug_asserts]Arg::_debug_asserts:help\r\n[clap_builder::builder::debug_asserts]Command::_verify_positionals\r\n[clap_builder::parser::parser]Parser::get_matches_with\r\n[clap_builder::parser::parser]Parser::get_matches_with: Begin parsing '\"asdf\"'\r\n[clap_builder::parser::parser]Parser::possible_subcommand: arg=Ok(\"asdf\")\r\n[clap_builder::parser::parser]Parser::get_matches_with: sc=None\r\n[clap_builder::parser::parser]Parser::get_matches_with: Positional counter...1\r\n[clap_builder::parser::parser]Parser::get_matches_with: Low index multiples...false\r\n[clap_builder::parser::parser]Parser::resolve_pending: id=\"args\"\r\n[clap_builder::parser::parser]Parser::react action=Append, identifier=Some(Index), source=CommandLine\r\n[ clap_builder::output::usage]Usage::create_usage_with_title\r\n[ clap_builder::output::usage]Usage::create_usage_no_title\r\n[ clap_builder::output::usage]Usage::write_help_usage\r\n[ clap_builder::output::usage]Usage::write_arg_usage; incl_reqs=true\r\n[ clap_builder::output::usage]Usage::needs_options_tag\r\n[ clap_builder::output::usage]Usage::needs_options_tag:iter: f=help\r\n[ clap_builder::output::usage]Usage::needs_options_tag:iter Option is built-in\r\n[ clap_builder::output::usage]Usage::needs_options_tag: [OPTIONS] not required\r\n[ clap_builder::output::usage]Usage::write_args: incls=[]\r\n[ clap_builder::output::usage]Usage::get_args: unrolled_reqs=[]\r\n[ clap_builder::output::usage]Usage::write_subcommand_usage\r\n[ clap_builder::output::usage]Usage::create_usage_with_title: usage=Usage: clap-num-args-issue [ARG] [ARG]...\r\n[clap_builder::builder::command]Command::color: Color setting...\r\n[clap_builder::builder::command]Auto\r\n[clap_builder::builder::command]Command::color: Color setting...\r\n[clap_builder::builder::command]Auto\r\nerror: 2 more values required by '[ARG] [ARG]...'; only 1 was provided\r\n\r\nUsage: clap-num-args-issue [ARG] [ARG]...\r\n\r\nFor more information, try '--help'.\r\n```",
    "clap-rs__clap-5520": "`exclusive` fails to take priority over `required_unless_present` flags\n### Please complete the following tasks\r\n\r\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\r\n- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues\r\n\r\n### Rust Version\r\n\r\nrustc 1.77.2 (25ef9e3d8 2024-04-09)\r\n\r\n### Clap Version\r\n\r\n4.5.4\r\n\r\n### Minimal reproducible code\r\n\r\nThe flags I have found to eschew `exclusive` are:\r\n\r\n* `required_unless_present`\r\n\r\n    ```rust\r\n    #[derive(clap::Parser)]\r\n    struct Args {\r\n        #[arg(required_unless_present(\"alternative_arg\"))]\r\n        required_arg: Option<String>,\r\n        alternative_arg: Option<String>,\r\n\r\n        #[arg(exclusive = true, long, default_value_t = false)]\r\n        exclusive_arg: bool\r\n    }\r\n\r\n    fn main() {\r\n        let _args: Args = clap::Parser::parse();\r\n    }\r\n    ```\r\n\r\n* `required_unless_present_any`\r\n\r\n    ```rust\r\n    #[derive(clap::Parser)]\r\n    struct Args {\r\n        #[arg(required_unless_present_any([\"alternative_arg\"]))]\r\n        required_arg: Option<String>,\r\n        alternative_arg: Option<String>,\r\n\r\n        #[arg(exclusive = true, long, default_value_t = false)]\r\n        exclusive_arg: bool\r\n    }\r\n\r\n    fn main() {\r\n        let _args: Args = clap::Parser::parse();\r\n    }\r\n    ```\r\n\r\n* `required_unless_present_all`\r\n\r\n    ```rust\r\n    #[derive(clap::Parser)]\r\n    struct Args {\r\n        #[arg(required_unless_present_all([\"alternative_arg\"]))]\r\n        required_arg: Option<String>,\r\n        alternative_arg: Option<String>,\r\n\r\n        #[arg(exclusive = true, long, default_value_t = false)]\r\n        exclusive_arg: bool\r\n    }\r\n\r\n    fn main() {\r\n        let _args: Args = clap::Parser::parse();\r\n    }\r\n    ```\r\n\r\n### Steps to reproduce the bug with the above code\r\n\r\n`cargo run -- --exclusive-arg`\r\n\r\n### Actual Behaviour\r\n\r\nClap fails to recognize that an exclusive argument has been supplied, and still requires the required arguments with an error message akin to:\r\n\r\n```\r\nerror: the following required arguments were not provided:\r\n  <REQUIRED_ARG>\r\n\r\nUsage: clap-test.exe --exclusive-arg <REQUIRED_ARG> [ALTERNATIVE_ARG]\r\n\r\nFor more information, try '--help'.\r\n```\r\n\r\n### Expected Behaviour\r\n\r\nThe exclusive argument should take priority, and allow not supplying the required arguments. (If it doesn't, it makes `exclusive` useless in these cases \u2013 since it's impossible to use the exclusive argument without adding the required arguments, and if you add the required arguments, you get an error due to supplying arguments along with the exclusive one.)\r\n\r\n### Additional Context\r\n\r\nUsing [the `exclusive` flag](https://docs.rs/clap/4.5.4/clap/struct.Arg.html#method.exclusive) for an argument allows it to override required arguments, as long as those arguments can be initialized without. This code that sets `required = true` on an argument still runs without error if `--exclusive-arg` is specified:\r\n\r\n```rust\r\n#[derive(clap::Parser)]\r\nstruct Args {\r\n    #[arg(required = true)]\r\n    required_arg: Option<String>,\r\n\r\n    #[arg(exclusive = true, long, default_value_t = false)]\r\n    exclusive_arg: bool\r\n}\r\n\r\nfn main() {\r\n    let _args: Args = clap::Parser::parse();\r\n}\r\n```\r\n\r\nTo match this, the same should be true for the other, more specified ways to require an argument!\r\n\r\nNote that the `required_unless_present` and `required_unless_present_any` (though crucially, *not* `required_unless_present_all`) cases can be worked around by adding a special case \u2013 for example, switching out `required_unless_present(\"blah\")` for `required_unless_present_any([\"blah\", \"exclusive\"])`.\r\n\r\n### Debug Output\r\n\r\n_No response_",
    "clap-rs__clap-5489": "Optional option-argument parsing is incorrect\n### Please complete the following tasks\r\n\r\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\r\n- [X] I have searched the existing issues\r\n\r\n### Rust Version\r\n\r\nrustc 1.56.0 (09c42c458 2021-10-18)\r\n\r\n### Clap Version\r\n\r\nmaster\r\n\r\n### Minimal reproducible code\r\n\r\n```rust\r\nuse clap::Parser;\r\n#[derive(Parser, Debug)]\r\nstruct Opt {\r\n    #[clap(short,long)]\r\n    foo: Option<Option<String>>,\r\n    input: String,\r\n}\r\n\r\nfn main() {\r\n    let opt = Opt::parse();\r\n    println!(\"{:?}\", opt);\r\n}\r\n```\r\n\r\n\r\n### Steps to reproduce the bug with the above code\r\n\r\n```\r\ncargo run -- -f input\r\n```\r\nor\r\n```\r\ncargo run -- --foo input\r\n```\r\n\r\n### Actual Behaviour\r\n\r\n```\r\nerror: The following required arguments were not provided:\r\n    <INPUT>\r\n\r\nUSAGE:\r\n    clap-test --foo <FOO> <INPUT>\r\n\r\nFor more information try --help\r\n```\r\n\r\n### Expected Behaviour\r\n\r\n```\r\nOpt { foo: Some(None), input: \"input\" }\r\n```\r\n\r\n### Additional Context\r\n\r\nThere needs to be some special handling of options with optional arguments. \r\n\r\n#### Optional option-arguments are bad\r\n\r\nFirst of all, users really need to be discouraged (if we ever add some lint-like feature, e.g. `#[clap(enable-warnings)`). \r\n\r\n[POSIX](https://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap12.html) says:\r\n\r\n>Option-arguments should not be optional.\r\n\r\n[Solaris](https://docs.oracle.com/cd/E23824_01/html/821-1461/intro-1.html) says:\r\n\r\n> Option-arguments cannot be optional.\r\n\r\n#### Parsing\r\n\r\nI know some people have a preference for `-f OptArg` over `-fOptArg`, but if the option-argument is optional, then only the latter is correct. If there is a space, it means the optional argument is not there.\r\n\r\nFrom [POSIX.1-2017 - Ch. 12: Utility Conventions](https://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap12.html):\r\n> a conforming application shall place any option-argument for that option directly adjacent to the option in the same argument string, without intervening `<blank>` characters\r\n\r\n> If the utility receives an argument containing only the option, it shall behave as specified in its description for an omitted option-argument; it shall not treat the next argument (if any) as the option-argument for that option.\r\n\r\nSame thing with the long option, which is a GNU extension.\r\n\r\nFrom [GNU C Library Reference Manual - Ch. 25.1.1: Program Argument Syntax Conventions](https://www.gnu.org/software/libc/manual/html_node/Argument-Syntax.html#Argument-Syntax):\r\n\r\n> To specify an argument for a long option, write `--name=value`. This syntax enables a long option to accept an argument that is itself optional.\r\n\r\nSee this SO question about how `getopt` handles this: [`getopt` does not parse optional arguments to parameters](https://stackoverflow.com/questions/1052746/getopt-does-not-parse-optional-arguments-to-parameters).\r\n\r\nIn clap terms, these are saying we should only allow\r\n- `--long`\r\n- `--long=value`\r\n- `-s`\r\n- `-svalue`\r\n\r\nIn contrast, clap supports\r\n- Default:\r\n  - `--long`\r\n  - `--long=value`\r\n  - `--long value`\r\n  - `-s`\r\n  - `-s value`\r\n  - `-s=value`\r\n  - `-svalue`\r\n- `requires_equals(true)`\r\n  - `--long`\r\n  - `--long=value`\r\n  - `-s`\r\n  - `-s=value`\r\n\r\n### Debug Output\r\n\r\n```\r\n[            clap::build::app] \tApp::_do_parse\r\n[            clap::build::app] \tApp::_build\r\n[            clap::build::app] \tApp::_propagate:clap-test\r\n[            clap::build::app] \tApp::_check_help_and_version\r\n[            clap::build::app] \tApp::_check_help_and_version: Removing generated version\r\n[            clap::build::app] \tApp::_propagate_global_args:clap-test\r\n[            clap::build::app] \tApp::_derive_display_order:clap-test\r\n[clap::build::app::debug_asserts] \tApp::_debug_asserts\r\n[clap::build::arg::debug_asserts] \tArg::_debug_asserts:help\r\n[clap::build::arg::debug_asserts] \tArg::_debug_asserts:foo\r\n[clap::build::arg::debug_asserts] \tArg::_debug_asserts:input\r\n[         clap::parse::parser] \tParser::get_matches_with\r\n[         clap::parse::parser] \tParser::_build\r\n[         clap::parse::parser] \tParser::_verify_positionals\r\n[         clap::parse::parser] \tParser::get_matches_with: Begin parsing 'RawOsStr(\"-f\")' ([45, 102])\r\n[         clap::parse::parser] \tParser::get_matches_with: Positional counter...1\r\n[         clap::parse::parser] \tParser::get_matches_with: Low index multiples...false\r\n[         clap::parse::parser] \tParser::possible_subcommand: arg=RawOsStr(\"-f\")\r\n[         clap::parse::parser] \tParser::get_matches_with: sc=None\r\n[         clap::parse::parser] \tParser::parse_short_arg: short_arg=RawOsStr(\"f\")\r\n[         clap::parse::parser] \tParser::parse_short_arg:iter:f\r\n[         clap::parse::parser] \tParser::parse_short_arg:iter:f: cur_idx:=1\r\n[         clap::parse::parser] \tParser::parse_short_arg:iter:f: Found valid opt or flag\r\n[         clap::parse::parser] \tParser::parse_short_arg:iter:f: val=RawOsStr(\"\") (bytes), val=[] (ascii), short_arg=RawOsStr(\"f\")\r\n[         clap::parse::parser] \tParser::parse_opt; opt=foo, val=None\r\n[         clap::parse::parser] \tParser::parse_opt; opt.settings=ArgFlags(TAKES_VAL)\r\n[         clap::parse::parser] \tParser::parse_opt; Checking for val...\r\n[         clap::parse::parser] \tParser::parse_opt: More arg vals required...\r\n[    clap::parse::arg_matcher] \tArgMatcher::inc_occurrence_of: arg=foo\r\n[            clap::build::app] \tApp::groups_for_arg: id=foo\r\n[            clap::build::app] \tApp::groups_for_arg: id=foo\r\n[         clap::parse::parser] \tParser::get_matches_with: After parse_short_arg Opt(foo)\r\n[         clap::parse::parser] \tParser::get_matches_with: Begin parsing 'RawOsStr(\"input\")' ([105, 110, 112, 117, 116])\r\n[         clap::parse::parser] \tParser::get_matches_with: Positional counter...1\r\n[         clap::parse::parser] \tParser::get_matches_with: Low index multiples...false\r\n[         clap::parse::parser] \tParser::add_val_to_arg; arg=foo, val=RawOsStr(\"input\")\r\n[         clap::parse::parser] \tParser::add_val_to_arg; trailing_values=false, DontDelimTrailingVals=false\r\n[         clap::parse::parser] \tParser::add_single_val_to_arg: adding val...\"input\"\r\n[         clap::parse::parser] \tParser::add_single_val_to_arg: cur_idx:=2\r\n[            clap::build::app] \tApp::groups_for_arg: id=foo\r\n[    clap::parse::arg_matcher] \tArgMatcher::needs_more_vals: o=foo\r\n[    clap::parse::arg_matcher] \tArgMatcher::needs_more_vals: max_vals...1\r\n[         clap::parse::parser] \tParser::remove_overrides\r\n[         clap::parse::parser] \tParser::remove_overrides:iter:foo\r\n[      clap::parse::validator] \tValidator::validate\r\n[         clap::parse::parser] \tParser::add_env: Checking arg `--help`\r\n[         clap::parse::parser] \tParser::add_env: Skipping existing arg `--foo <FOO>`\r\n[         clap::parse::parser] \tParser::add_env: Checking arg `<INPUT>`\r\n[         clap::parse::parser] \tParser::add_defaults\r\n[         clap::parse::parser] \tParser::add_defaults:iter:foo:\r\n[         clap::parse::parser] \tParser::add_value: doesn't have conditional defaults\r\n[         clap::parse::parser] \tParser::add_value:iter:foo: doesn't have default vals\r\n[         clap::parse::parser] \tParser::add_value:iter:foo: doesn't have default missing vals\r\n[         clap::parse::parser] \tParser::add_defaults:iter:input:\r\n[         clap::parse::parser] \tParser::add_value: doesn't have conditional defaults\r\n[         clap::parse::parser] \tParser::add_value:iter:input: doesn't have default vals\r\n[         clap::parse::parser] \tParser::add_value:iter:input: doesn't have default missing vals\r\n[      clap::parse::validator] \tValidator::validate_conflicts\r\n[      clap::parse::validator] \tValidator::validate_exclusive\r\n[      clap::parse::validator] \tValidator::validate_exclusive:iter:foo\r\n[      clap::parse::validator] \tValidator::gather_conflicts\r\n[      clap::parse::validator] \tValidator::gather_conflicts:iter: id=foo\r\n[            clap::build::app] \tApp::groups_for_arg: id=foo\r\n[      clap::parse::validator] \tValidator::validate_required: required=ChildGraph([Child { id: input, children: [] }])\r\n[      clap::parse::validator] \tValidator::gather_requirements\r\n[      clap::parse::validator] \tValidator::gather_requirements:iter:foo\r\n[      clap::parse::validator] \tValidator::validate_required:iter:aog=input\r\n[      clap::parse::validator] \tValidator::validate_required:iter: This is an arg\r\n[      clap::parse::validator] \tValidator::is_missing_required_ok: input\r\n[      clap::parse::validator] \tValidator::validate_arg_conflicts: a=\"input\"\r\n[      clap::parse::validator] \tValidator::missing_required_error; incl=[]\r\n[      clap::parse::validator] \tValidator::missing_required_error: reqs=ChildGraph([Child { id: input, children: [] }])\r\n[         clap::output::usage] \tUsage::get_required_usage_from: incls=[], matcher=true, incl_last=true\r\n[         clap::output::usage] \tUsage::get_required_usage_from: unrolled_reqs={input}\r\n[         clap::output::usage] \tUsage::get_required_usage_from:iter:input\r\n[         clap::output::usage] \tUsage::get_required_usage_from: ret_val=[\"<INPUT>\"]\r\n[      clap::parse::validator] \tValidator::missing_required_error: req_args=[\r\n    \"<INPUT>\",\r\n]\r\n[         clap::output::usage] \tUsage::create_usage_with_title\r\n[         clap::output::usage] \tUsage::create_usage_no_title\r\n[         clap::output::usage] \tUsage::create_smart_usage\r\n[         clap::output::usage] \tUsage::get_required_usage_from: incls=[foo], matcher=false, incl_last=true\r\n[         clap::output::usage] \tUsage::get_required_usage_from: unrolled_reqs={input}\r\n[         clap::output::usage] \tUsage::get_required_usage_from:iter:foo\r\n[         clap::output::usage] \tUsage::get_required_usage_from:iter:input\r\n[         clap::output::usage] \tUsage::get_required_usage_from: ret_val=[\"--foo <FOO>\", \"<INPUT>\"]\r\n[            clap::build::app] \tApp::color: Color setting...\r\n[            clap::build::app] \tAuto\r\n[           clap::output::fmt] \tis_a_tty: stderr=true\r\n```",
    "clap-rs__clap-5298": "Subcommand flags can't conflict with arguments\n### Please complete the following tasks\n\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\n- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues\n\n### Rust Version\n\n1.75.0\n\n### Clap Version\n\n4.4.14\n\n### Minimal reproducible code\n\n```rs\r\nuse clap::{Arg, ArgAction, Command};\r\nuse std::process::exit;\r\n\r\nfn main() {\r\n    let matches = Command::new(\"cmd\")\r\n        .args_conflicts_with_subcommands(true)\r\n        .arg(\r\n            Arg::new(\"foo\")\r\n                .short('f')\r\n                .long(\"foo\")\r\n                .action(ArgAction::SetTrue)\r\n                .exclusive(true),\r\n        )\r\n        .subcommand(\r\n            Command::new(\"bar\").short_flag('B').long_flag(\"bar\").arg(\r\n                Arg::new(\"baz\")\r\n                    .short('b')\r\n                    .long(\"baz\")\r\n                    .action(ArgAction::Append)\r\n                    .num_args(1..),\r\n            ),\r\n        )\r\n        .get_matches();\r\n\r\n    if matches.get_flag(\"foo\") {\r\n        println!(\"-f is used\")\r\n    };\r\n    println!(\r\n        \"{:?}\",\r\n        matches\r\n            .subcommand_matches(\"bar\")\r\n            .unwrap_or_else(|| {\r\n                println!(\"Bar subcommand is not used\");\r\n                exit(0)\r\n            })\r\n            .get_many::<String>(\"baz\").unwrap().map(|x|x.to_string()).collect::<Vec<String>>()\r\n    );\r\n}\r\n```\n\n### Steps to reproduce the bug with the above code\n\ncargo run -- -f -Bb 1 2\n\n### Actual Behaviour\n\n```\r\n-f is used\r\n[\"1\", \"2\"]\r\n```\n\n### Expected Behaviour\n\n```\r\nerror: -f can not be used with -B subcommand \r\n\r\nexample:\r\n     -f <foo>\r\n```\r\n\n\n### Additional Context\n\nUsing it with/without`.subcommand_precedence_over_arg(true)` won't make any difference\r\n\n\n### Debug Output\n\n```\r\n[clap_builder::builder::command]Command::_do_parse\r\n[clap_builder::builder::command]Command::_build: name=\"cmd\"\r\n[clap_builder::builder::command]Command::_propagate:cmd\r\n[clap_builder::builder::command]Command::_check_help_and_version:cmd expand_help_tree=false\r\n[clap_builder::builder::command]Command::long_help_exists\r\n[clap_builder::builder::command]Command::_check_help_and_version: Building default --help\r\n[clap_builder::builder::command]Command::_check_help_and_version: Building help subcommand\r\n[clap_builder::builder::command]Command::_propagate_global_args:cmd\r\n[clap_builder::builder::debug_asserts]Command::_debug_asserts\r\n[clap_builder::builder::debug_asserts]Arg::_debug_asserts:foo\r\n[clap_builder::builder::debug_asserts]Arg::_debug_asserts:help\r\n[clap_builder::builder::debug_asserts]Command::_verify_positionals\r\n[clap_builder::parser::parser]Parser::get_matches_with\r\n[clap_builder::parser::parser]Parser::get_matches_with: Begin parsing '\"-f\"'\r\n[clap_builder::parser::parser]Parser::possible_subcommand: arg=Ok(\"-f\")\r\n[clap_builder::parser::parser]Parser::get_matches_with: sc=None\r\n[clap_builder::parser::parser]Parser::parse_short_arg: short_arg=ShortFlags { inner: \"f\", utf8_prefix: CharIndices { front_offset: 0, iter: Chars(['f']) }, invalid_suffix: None }\r\n[clap_builder::parser::parser]Parser::parse_short_arg:iter:f\r\n[clap_builder::parser::parser]Parser::parse_short_arg:iter:f: Found valid opt or flag\r\n[clap_builder::parser::parser]Parser::react action=SetTrue, identifier=Some(Short), source=CommandLine\r\n[clap_builder::parser::parser]Parser::react: has default_missing_vals\r\n[clap_builder::parser::parser]Parser::remove_overrides: id=\"foo\"\r\n[clap_builder::parser::arg_matcher]ArgMatcher::start_custom_arg: id=\"foo\", source=CommandLine\r\n[clap_builder::builder::command]Command::groups_for_arg: id=\"foo\"\r\n[clap_builder::parser::parser]Parser::push_arg_values: [\"true\"]\r\n[clap_builder::parser::parser]Parser::add_single_val_to_arg: cur_idx:=1\r\n[clap_builder::parser::parser]Parser::get_matches_with: After parse_short_arg ValuesDone\r\n[clap_builder::parser::parser]Parser::get_matches_with: Begin parsing '\"-Bb\"'\r\n[clap_builder::parser::parser]Parser::possible_subcommand: arg=Ok(\"-Bb\")\r\n[clap_builder::parser::parser]Parser::get_matches_with: sc=None\r\n[clap_builder::parser::parser]Parser::parse_short_arg: short_arg=ShortFlags { inner: \"Bb\", utf8_prefix: CharIndices { front_offset: 0, iter: Chars(['B', 'b']) }, invalid_suffix: None }\r\n[clap_builder::parser::parser]Parser::parse_short_arg:iter:B\r\n[clap_builder::parser::parser]Parser::parse_short_arg:iter:B: subcommand=bar\r\n[clap_builder::parser::parser]Parser::parse_short_arg: cur_idx:=2\r\n[clap_builder::parser::parser]Parser::get_matches_with: After parse_short_arg FlagSubCommand(\"bar\")\r\n[clap_builder::parser::parser]Parser::get_matches_with:FlagSubCommandShort: subcmd_name=bar, keep_state=true, flag_subcmd_skip=1\r\n[clap_builder::parser::parser]Parser::parse_subcommand\r\n[clap_builder::builder::command]Command::_build_subcommand Setting bin_name of bar to \"args bar\"\r\n[clap_builder::builder::command]Command::_build_subcommand Setting display_name of bar to \"cmd-bar\"\r\n[clap_builder::builder::command]Command::_build: name=\"bar\"\r\n[clap_builder::builder::command]Command::_propagate:bar\r\n[clap_builder::builder::command]Command::_check_help_and_version:bar expand_help_tree=false\r\n[clap_builder::builder::command]Command::long_help_exists\r\n[clap_builder::builder::command]Command::_check_help_and_version: Building default --help\r\n[clap_builder::builder::command]Command::_propagate_global_args:bar\r\n[clap_builder::builder::debug_asserts]Command::_debug_asserts\r\n[clap_builder::builder::debug_asserts]Arg::_debug_asserts:baz\r\n[clap_builder::builder::debug_asserts]Arg::_debug_asserts:help\r\n[clap_builder::builder::debug_asserts]Command::_verify_positionals\r\n[clap_builder::parser::parser]Parser::parse_subcommand: About to parse sc=bar\r\n[clap_builder::parser::parser]Parser::get_matches_with\r\n[clap_builder::parser::parser]Parser::get_matches_with: Begin parsing '\"-Bb\"'\r\n[clap_builder::parser::parser]Parser::possible_subcommand: arg=Ok(\"-Bb\")\r\n[clap_builder::parser::parser]Parser::get_matches_with: sc=None\r\n[clap_builder::parser::parser]Parser::parse_short_arg: short_arg=ShortFlags { inner: \"Bb\", utf8_prefix: CharIndices { front_offset: 0, iter: Chars(['B', 'b']) }, invalid_suffix: None }\r\n[clap_builder::parser::parser]Parser::parse_short_arg:iter:b\r\n[clap_builder::parser::parser]Parser::parse_short_arg:iter:b: Found valid opt or flag\r\n[clap_builder::parser::parser]Parser::parse_short_arg:iter:b: val=\"\", short_arg=ShortFlags { inner: \"Bb\", utf8_prefix: CharIndices { front_offset: 2, iter: Chars([]) }, invalid_suffix: None }\r\n[clap_builder::parser::parser]Parser::parse_opt_value; arg=baz, val=None, has_eq=false\r\n[clap_builder::parser::parser]Parser::parse_opt_value; arg.settings=ArgFlags(0)\r\n[clap_builder::parser::parser]Parser::parse_opt_value; Checking for val...\r\n[clap_builder::parser::parser]Parser::parse_opt_value: More arg vals required...\r\n[clap_builder::parser::parser]Parser::get_matches_with: After parse_short_arg Opt(\"baz\")\r\n[clap_builder::parser::parser]Parser::get_matches_with: Begin parsing '\"1\"'\r\n[clap_builder::parser::arg_matcher]ArgMatcher::needs_more_vals: o=baz, pending=1\r\n[clap_builder::parser::arg_matcher]ArgMatcher::needs_more_vals: expected=1..=18446744073709551615, actual=1\r\n[clap_builder::parser::parser]Parser::get_matches_with: Begin parsing '\"2\"'\r\n[clap_builder::parser::arg_matcher]ArgMatcher::needs_more_vals: o=baz, pending=2\r\n[clap_builder::parser::arg_matcher]ArgMatcher::needs_more_vals: expected=1..=18446744073709551615, actual=2\r\n[clap_builder::parser::parser]Parser::resolve_pending: id=\"baz\"\r\n[clap_builder::parser::parser]Parser::react action=Append, identifier=Some(Short), source=CommandLine\r\n[clap_builder::parser::parser]Parser::react: cur_idx:=3\r\n[clap_builder::parser::parser]Parser::remove_overrides: id=\"baz\"\r\n[clap_builder::parser::arg_matcher]ArgMatcher::start_custom_arg: id=\"baz\", source=CommandLine\r\n[clap_builder::builder::command]Command::groups_for_arg: id=\"baz\"\r\n[clap_builder::parser::parser]Parser::push_arg_values: [\"1\", \"2\"]\r\n[clap_builder::parser::parser]Parser::add_single_val_to_arg: cur_idx:=4\r\n[clap_builder::parser::parser]Parser::add_single_val_to_arg: cur_idx:=5\r\n[clap_builder::parser::arg_matcher]ArgMatcher::needs_more_vals: o=baz, pending=0\r\n[clap_builder::parser::arg_matcher]ArgMatcher::needs_more_vals: expected=1..=18446744073709551615, actual=0\r\n[clap_builder::parser::parser]Parser::react not enough values passed in, leaving it to the validator to complain\r\n[clap_builder::parser::parser]Parser::add_defaults\r\n[clap_builder::parser::parser]Parser::add_defaults:iter:baz:\r\n[clap_builder::parser::parser]Parser::add_default_value: doesn't have conditional defaults\r\n[clap_builder::parser::parser]Parser::add_default_value:iter:baz: doesn't have default vals\r\n[clap_builder::parser::parser]Parser::add_defaults:iter:help:\r\n[clap_builder::parser::parser]Parser::add_default_value: doesn't have conditional defaults\r\n[clap_builder::parser::parser]Parser::add_default_value:iter:help: doesn't have default vals\r\n[clap_builder::parser::validator]Validator::validate\r\n[clap_builder::builder::command]Command::groups_for_arg: id=\"baz\"\r\n[clap_builder::parser::validator]Conflicts::gather_direct_conflicts id=\"baz\", conflicts=[]\r\n[clap_builder::parser::validator]Validator::validate: needs_val_of=\"baz\"\r\n[clap_builder::parser::validator]Validator::validate_conflicts\r\n[clap_builder::parser::validator]Validator::validate_exclusive\r\n[clap_builder::parser::validator]Validator::validate_conflicts::iter: id=\"baz\"\r\n[clap_builder::parser::validator]Conflicts::gather_conflicts: arg=\"baz\"\r\n[clap_builder::parser::validator]Conflicts::gather_conflicts: conflicts=[]\r\n[clap_builder::parser::validator]Validator::validate_required: required=ChildGraph([])\r\n[clap_builder::parser::validator]Validator::gather_requires\r\n[clap_builder::parser::validator]Validator::gather_requires:iter:\"baz\"\r\n[clap_builder::parser::validator]Validator::validate_required: is_exclusive_present=false\r\n[clap_builder::parser::parser]Parser::add_defaults\r\n[clap_builder::parser::parser]Parser::add_defaults:iter:foo:\r\n[clap_builder::parser::parser]Parser::add_default_value: doesn't have conditional defaults\r\n[clap_builder::parser::parser]Parser::add_default_value:iter:foo: has default vals\r\n[clap_builder::parser::parser]Parser::add_default_value:iter:foo: was used\r\n[clap_builder::parser::parser]Parser::add_defaults:iter:help:\r\n[clap_builder::parser::parser]Parser::add_default_value: doesn't have conditional defaults\r\n[clap_builder::parser::parser]Parser::add_default_value:iter:help: doesn't have default vals\r\n[clap_builder::parser::validator]Validator::validate\r\n[clap_builder::builder::command]Command::groups_for_arg: id=\"foo\"\r\n[clap_builder::parser::validator]Conflicts::gather_direct_conflicts id=\"foo\", conflicts=[]\r\n[clap_builder::parser::validator]Validator::validate_conflicts\r\n[clap_builder::parser::validator]Validator::validate_exclusive\r\n[clap_builder::parser::validator]Validator::validate_conflicts::iter: id=\"foo\"\r\n[clap_builder::parser::validator]Conflicts::gather_conflicts: arg=\"foo\"\r\n[clap_builder::parser::validator]Conflicts::gather_conflicts: conflicts=[]\r\n[clap_builder::parser::arg_matcher]ArgMatcher::get_global_values: global_arg_vec=[]\r\n```",
    "clap-rs__clap-5228": "`flatten_help` shows a `hide(true)` annotated subcommand in the overview\n### Please complete the following tasks\r\n\r\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\r\n- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues\r\n\r\n### Rust Version\r\n\r\nrustc 1.72.1 (d5c2e9c34 2023-09-13)\r\n\r\n### Clap Version\r\n\r\n4.4.8\r\n\r\n### Minimal reproducible code\r\n\r\n```rust\r\nuse clap::{Parser, Subcommand};\r\n\r\n#[derive(Subcommand, Debug)]\r\nenum Command {\r\n    Public,\r\n    #[clap(hide(true))]\r\n    Hidden,\r\n}\r\n\r\n#[derive(Parser, Debug)]\r\n#[command(flatten_help = true)]\r\nstruct Opts {\r\n    #[command(subcommand)]\r\n    command: Command,\r\n}\r\n\r\nfn main() {\r\n    let args = Opts::parse();\r\n    println!(\"{:#?}\", args);\r\n}\r\n```\r\n\r\n\r\n### Steps to reproduce the bug with the above code\r\n\r\ncargo run\r\n\r\n### Actual Behaviour\r\n\r\nPrints:\r\n```\r\nUsage: clap-flatten-help public\r\n       clap-flatten-help hidden\r\n       clap-flatten-help help [COMMAND]...\r\n\r\nOptions:\r\n  -h, --help  Print help\r\n\r\nclap-flatten-help public:\r\n  -h, --help  Print help\r\n\r\nclap-flatten-help help:\r\n  [COMMAND]...  Print help for the subcommand(s)\r\n```\r\n\r\n### Expected Behaviour\r\n\r\nLeaves out the hidden subcommand in the overview:\r\n```\r\nUsage: clap-flatten-help public\r\n       clap-flatten-help help [COMMAND]...\r\n\r\nOptions:\r\n  -h, --help  Print help\r\n\r\nclap-flatten-help public:\r\n  -h, --help  Print help\r\n\r\nclap-flatten-help help:\r\n  [COMMAND]...  Print help for the subcommand(s)\r\n```\r\n\r\n### Additional Context\r\n\r\n_No response_\r\n\r\n### Debug Output\r\n\r\n<details>\r\n  <summary>Click to expand</summary>\r\n\r\n```\r\n[clap_builder::builder::command]Command::_do_parse\r\n[clap_builder::builder::command]Command::_build: name=\"clap-flatten-help\"\r\n[clap_builder::builder::command]Command::_propagate:clap-flatten-help\r\n[clap_builder::builder::command]Command::_check_help_and_version:clap-flatten-help expand_help_tree=false\r\n[clap_builder::builder::command]Command::long_help_exists\r\n[clap_builder::builder::command]Command::_check_help_and_version: Building default --help\r\n[clap_builder::builder::command]Command::_check_help_and_version: Building help subcommand\r\n[clap_builder::builder::command]Command::_propagate_global_args:clap-flatten-help\r\n[clap_builder::builder::debug_asserts]Command::_debug_asserts\r\n[clap_builder::builder::debug_asserts]Arg::_debug_asserts:help\r\n[clap_builder::builder::debug_asserts]Command::_verify_positionals\r\n[clap_builder::parser::parser]Parser::get_matches_with\r\n[clap_builder::parser::parser]Parser::add_defaults\r\n[clap_builder::parser::parser]Parser::add_defaults:iter:help:\r\n[clap_builder::parser::parser]Parser::add_default_value: doesn't have conditional defaults\r\n[clap_builder::parser::parser]Parser::add_default_value:iter:help: doesn't have default vals\r\n[clap_builder::parser::validator]Validator::validate\r\n[clap_builder::builder::command]Command::write_help_err: clap-flatten-help, use_long=false\r\n[  clap_builder::output::help]write_help\r\n[clap_builder::output::help_template]HelpTemplate::new cmd=clap-flatten-help, use_long=false\r\n[clap_builder::output::help_template]should_show_arg: use_long=false, arg=help\r\n[clap_builder::output::help_template]HelpTemplate::write_templated_help\r\n[clap_builder::output::help_template]HelpTemplate::write_before_help\r\n[ clap_builder::output::usage]Usage::create_usage_no_title\r\n[ clap_builder::output::usage]Usage::create_usage_no_title\r\n[ clap_builder::output::usage]Usage::write_help_usage\r\n[clap_builder::builder::command]Command::_build: name=\"clap-flatten-help\"\r\n[clap_builder::builder::command]Command::_build: already built\r\n[clap_builder::builder::command]Command::_build: name=\"public\"\r\n[clap_builder::builder::command]Command::_propagate:public\r\n[clap_builder::builder::command]Command::_check_help_and_version:public expand_help_tree=true\r\n[clap_builder::builder::command]Command::long_help_exists\r\n[clap_builder::builder::command]Command::_check_help_and_version: Building default --help\r\n[clap_builder::builder::command]Command::_propagate_global_args:public\r\n[clap_builder::builder::debug_asserts]Command::_debug_asserts\r\n[clap_builder::builder::debug_asserts]Arg::_debug_asserts:help\r\n[clap_builder::builder::debug_asserts]Command::_verify_positionals\r\n[clap_builder::builder::command]Command::_build: name=\"hidden\"\r\n[clap_builder::builder::command]Command::_propagate:hidden\r\n[clap_builder::builder::command]Command::_check_help_and_version:hidden expand_help_tree=true\r\n[clap_builder::builder::command]Command::long_help_exists\r\n[clap_builder::builder::command]Command::_check_help_and_version: Building default --help\r\n[clap_builder::builder::command]Command::_propagate_global_args:hidden\r\n[clap_builder::builder::debug_asserts]Command::_debug_asserts\r\n[clap_builder::builder::debug_asserts]Arg::_debug_asserts:help\r\n[clap_builder::builder::debug_asserts]Command::_verify_positionals\r\n[clap_builder::builder::command]Command::_build: name=\"help\"\r\n[clap_builder::builder::command]Command::_propagate:help\r\n[clap_builder::builder::command]Command::_check_help_and_version:help expand_help_tree=true\r\n[clap_builder::builder::command]Command::long_help_exists\r\n[clap_builder::builder::command]Command::_propagate_global_args:help\r\n[clap_builder::builder::debug_asserts]Command::_debug_asserts\r\n[clap_builder::builder::debug_asserts]Arg::_debug_asserts:subcommand\r\n[clap_builder::builder::debug_asserts]Command::_verify_positionals\r\n[clap_builder::builder::command]Command::_build_bin_names\r\n[ clap_builder::output::usage]Usage::get_required_usage_from: incls=[], matcher=false, incl_last=true\r\n[ clap_builder::output::usage]Usage::get_required_usage_from: unrolled_reqs=[]\r\n[ clap_builder::output::usage]Usage::get_required_usage_from: ret_val=[]\r\n[clap_builder::builder::command]Command::_build_bin_names:iter: bin_name set...\r\n[clap_builder::builder::command]Command::_build_bin_names:iter: Setting usage_name of public to \"clap-flatten-help public\"\r\n[clap_builder::builder::command]Command::_build_bin_names:iter: Setting bin_name of public to \"clap-flatten-help public\"\r\n[clap_builder::builder::command]Command::_build_bin_names:iter: Setting display_name of public to \"clap-flatten-help-public\"\r\n[clap_builder::builder::command]Command::_build_bin_names\r\n[ clap_builder::output::usage]Usage::get_required_usage_from: incls=[], matcher=false, incl_last=true\r\n[ clap_builder::output::usage]Usage::get_required_usage_from: unrolled_reqs=[]\r\n[ clap_builder::output::usage]Usage::get_required_usage_from: ret_val=[]\r\n[clap_builder::builder::command]Command::_build_bin_names:iter: bin_name set...\r\n[clap_builder::builder::command]Command::_build_bin_names:iter: Setting usage_name of hidden to \"clap-flatten-help hidden\"\r\n[clap_builder::builder::command]Command::_build_bin_names:iter: Setting bin_name of hidden to \"clap-flatten-help hidden\"\r\n[clap_builder::builder::command]Command::_build_bin_names:iter: Setting display_name of hidden to \"clap-flatten-help-hidden\"\r\n[clap_builder::builder::command]Command::_build_bin_names\r\n[ clap_builder::output::usage]Usage::get_required_usage_from: incls=[], matcher=false, incl_last=true\r\n[ clap_builder::output::usage]Usage::get_required_usage_from: unrolled_reqs=[]\r\n[ clap_builder::output::usage]Usage::get_required_usage_from: ret_val=[]\r\n[clap_builder::builder::command]Command::_build_bin_names:iter: bin_name set...\r\n[clap_builder::builder::command]Command::_build_bin_names:iter: Setting usage_name of help to \"clap-flatten-help help\"\r\n[clap_builder::builder::command]Command::_build_bin_names:iter: Setting bin_name of help to \"clap-flatten-help help\"\r\n[clap_builder::builder::command]Command::_build_bin_names:iter: Setting display_name of help to \"clap-flatten-help-help\"\r\n[clap_builder::builder::command]Command::_build_bin_names\r\n[ clap_builder::output::usage]Usage::get_required_usage_from: incls=[], matcher=false, incl_last=true\r\n[ clap_builder::output::usage]Usage::get_required_usage_from: unrolled_reqs=[]\r\n[ clap_builder::output::usage]Usage::get_required_usage_from: ret_val=[]\r\n[ clap_builder::output::usage]Usage::create_usage_no_title\r\n[ clap_builder::output::usage]Usage::write_help_usage\r\n[ clap_builder::output::usage]Usage::write_arg_usage; incl_reqs=true\r\n[ clap_builder::output::usage]Usage::needs_options_tag\r\n[ clap_builder::output::usage]Usage::needs_options_tag:iter: f=help\r\n[ clap_builder::output::usage]Usage::needs_options_tag:iter Option is built-in\r\n[ clap_builder::output::usage]Usage::needs_options_tag: [OPTIONS] not required\r\n[ clap_builder::output::usage]Usage::write_args: incls=[]\r\n[ clap_builder::output::usage]Usage::get_args: unrolled_reqs=[]\r\n[ clap_builder::output::usage]Usage::write_subcommand_usage\r\n[ clap_builder::output::usage]Usage::create_usage_no_title\r\n[ clap_builder::output::usage]Usage::write_help_usage\r\n[ clap_builder::output::usage]Usage::write_arg_usage; incl_reqs=true\r\n[ clap_builder::output::usage]Usage::needs_options_tag\r\n[ clap_builder::output::usage]Usage::needs_options_tag:iter: f=help\r\n[ clap_builder::output::usage]Usage::needs_options_tag:iter Option is built-in\r\n[ clap_builder::output::usage]Usage::needs_options_tag: [OPTIONS] not required\r\n[ clap_builder::output::usage]Usage::write_args: incls=[]\r\n[ clap_builder::output::usage]Usage::get_args: unrolled_reqs=[]\r\n[ clap_builder::output::usage]Usage::write_subcommand_usage\r\n[ clap_builder::output::usage]Usage::create_usage_no_title\r\n[ clap_builder::output::usage]Usage::write_help_usage\r\n[ clap_builder::output::usage]Usage::write_arg_usage; incl_reqs=true\r\n[ clap_builder::output::usage]Usage::needs_options_tag\r\n[ clap_builder::output::usage]Usage::needs_options_tag: [OPTIONS] not required\r\n[ clap_builder::output::usage]Usage::write_args: incls=[]\r\n[ clap_builder::output::usage]Usage::get_args: unrolled_reqs=[]\r\n[ clap_builder::output::usage]Usage::write_subcommand_usage\r\n[ clap_builder::output::usage]Usage::create_usage_no_title: usage=clap-flatten-help public\r\n       clap-flatten-help hidden\r\n       clap-flatten-help help [COMMAND]...\r\n[clap_builder::output::help_template]HelpTemplate::write_all_args\r\n[clap_builder::output::help_template]should_show_arg: use_long=false, arg=help\r\n[clap_builder::output::help_template]HelpTemplate::write_args Options\r\n[clap_builder::output::help_template]should_show_arg: use_long=false, arg=help\r\n[clap_builder::output::help_template]HelpTemplate::write_args: arg=\"help\" longest=6\r\n[clap_builder::output::help_template]should_show_arg: use_long=false, arg=help\r\n[clap_builder::output::help_template]HelpTemplate::spec_vals: a=--help\r\n[clap_builder::output::help_template]HelpTemplate::spec_vals: a=--help\r\n[clap_builder::output::help_template]HelpTemplate::short\r\n[clap_builder::output::help_template]HelpTemplate::long\r\n[clap_builder::output::help_template]HelpTemplate::align_to_about: arg=help, next_line_help=false, longest=6\r\n[clap_builder::output::help_template]HelpTemplate::align_to_about: positional=false arg_len=6, spaces=2\r\n[clap_builder::output::help_template]HelpTemplate::help\r\n[clap_builder::output::help_template]HelpTemplate::help: help_width=14, spaces=10, avail=86\r\n[clap_builder::builder::command]Command::_build: name=\"clap-flatten-help\"\r\n[clap_builder::builder::command]Command::_build: already built\r\n[clap_builder::builder::command]Command::_build: name=\"public\"\r\n[clap_builder::builder::command]Command::_propagate:public\r\n[clap_builder::builder::command]Command::_check_help_and_version:public expand_help_tree=true\r\n[clap_builder::builder::command]Command::long_help_exists\r\n[clap_builder::builder::command]Command::_check_help_and_version: Building default --help\r\n[clap_builder::builder::command]Command::_propagate_global_args:public\r\n[clap_builder::builder::debug_asserts]Command::_debug_asserts\r\n[clap_builder::builder::debug_asserts]Arg::_debug_asserts:help\r\n[clap_builder::builder::debug_asserts]Command::_verify_positionals\r\n[clap_builder::builder::command]Command::_build: name=\"hidden\"\r\n[clap_builder::builder::command]Command::_propagate:hidden\r\n[clap_builder::builder::command]Command::_check_help_and_version:hidden expand_help_tree=true\r\n[clap_builder::builder::command]Command::long_help_exists\r\n[clap_builder::builder::command]Command::_check_help_and_version: Building default --help\r\n[clap_builder::builder::command]Command::_propagate_global_args:hidden\r\n[clap_builder::builder::debug_asserts]Command::_debug_asserts\r\n[clap_builder::builder::debug_asserts]Arg::_debug_asserts:help\r\n[clap_builder::builder::debug_asserts]Command::_verify_positionals\r\n[clap_builder::builder::command]Command::_build: name=\"help\"\r\n[clap_builder::builder::command]Command::_propagate:help\r\n[clap_builder::builder::command]Command::_check_help_and_version:help expand_help_tree=true\r\n[clap_builder::builder::command]Command::long_help_exists\r\n[clap_builder::builder::command]Command::_propagate_global_args:help\r\n[clap_builder::builder::debug_asserts]Command::_debug_asserts\r\n[clap_builder::builder::debug_asserts]Arg::_debug_asserts:subcommand\r\n[clap_builder::builder::debug_asserts]Command::_verify_positionals\r\n[clap_builder::builder::command]Command::_build_bin_names\r\n[ clap_builder::output::usage]Usage::get_required_usage_from: incls=[], matcher=false, incl_last=true\r\n[ clap_builder::output::usage]Usage::get_required_usage_from: unrolled_reqs=[]\r\n[ clap_builder::output::usage]Usage::get_required_usage_from: ret_val=[]\r\n[clap_builder::builder::command]Command::_build_bin_names:iter: bin_name set...\r\n[clap_builder::builder::command]Command::_build_bin_names:iter: Setting usage_name of public to \"clap-flatten-help public\"\r\n[clap_builder::builder::command]Command::_build_bin_names:iter: Setting bin_name of public to \"clap-flatten-help public\"\r\n[clap_builder::builder::command]Command::_build_bin_names:iter: Setting display_name of public to \"clap-flatten-help-public\"\r\n[clap_builder::builder::command]Command::_build_bin_names\r\n[ clap_builder::output::usage]Usage::get_required_usage_from: incls=[], matcher=false, incl_last=true\r\n[ clap_builder::output::usage]Usage::get_required_usage_from: unrolled_reqs=[]\r\n[ clap_builder::output::usage]Usage::get_required_usage_from: ret_val=[]\r\n[clap_builder::builder::command]Command::_build_bin_names:iter: bin_name set...\r\n[clap_builder::builder::command]Command::_build_bin_names:iter: Setting usage_name of hidden to \"clap-flatten-help hidden\"\r\n[clap_builder::builder::command]Command::_build_bin_names:iter: Setting bin_name of hidden to \"clap-flatten-help hidden\"\r\n[clap_builder::builder::command]Command::_build_bin_names:iter: Setting display_name of hidden to \"clap-flatten-help-hidden\"\r\n[clap_builder::builder::command]Command::_build_bin_names\r\n[ clap_builder::output::usage]Usage::get_required_usage_from: incls=[], matcher=false, incl_last=true\r\n[ clap_builder::output::usage]Usage::get_required_usage_from: unrolled_reqs=[]\r\n[ clap_builder::output::usage]Usage::get_required_usage_from: ret_val=[]\r\n[clap_builder::builder::command]Command::_build_bin_names:iter: bin_name set...\r\n[clap_builder::builder::command]Command::_build_bin_names:iter: Setting usage_name of help to \"clap-flatten-help help\"\r\n[clap_builder::builder::command]Command::_build_bin_names:iter: Setting bin_name of help to \"clap-flatten-help help\"\r\n[clap_builder::builder::command]Command::_build_bin_names:iter: Setting display_name of help to \"clap-flatten-help-help\"\r\n[clap_builder::builder::command]Command::_build_bin_names\r\n[ clap_builder::output::usage]Usage::get_required_usage_from: incls=[], matcher=false, incl_last=true\r\n[ clap_builder::output::usage]Usage::get_required_usage_from: unrolled_reqs=[]\r\n[ clap_builder::output::usage]Usage::get_required_usage_from: ret_val=[]\r\n[clap_builder::output::help_template]HelpTemplate::write_flat_subcommands, cmd=clap-flatten-help, first=false\r\n[clap_builder::output::help_template]should_show_arg: use_long=false, arg=help\r\n[clap_builder::output::help_template]HelpTemplate::write_args clap-flatten-help public\r\n[clap_builder::output::help_template]should_show_arg: use_long=false, arg=help\r\n[clap_builder::output::help_template]HelpTemplate::write_args: arg=\"help\" longest=6\r\n[clap_builder::output::help_template]should_show_arg: use_long=false, arg=help\r\n[clap_builder::output::help_template]HelpTemplate::spec_vals: a=--help\r\n[clap_builder::output::help_template]HelpTemplate::spec_vals: a=--help\r\n[clap_builder::output::help_template]HelpTemplate::short\r\n[clap_builder::output::help_template]HelpTemplate::long\r\n[clap_builder::output::help_template]HelpTemplate::align_to_about: arg=help, next_line_help=false, longest=6\r\n[clap_builder::output::help_template]HelpTemplate::align_to_about: positional=false arg_len=6, spaces=2\r\n[clap_builder::output::help_template]HelpTemplate::help\r\n[clap_builder::output::help_template]HelpTemplate::help: help_width=14, spaces=10, avail=86\r\n[clap_builder::output::help_template]should_show_arg: use_long=false, arg=subcommand\r\n[clap_builder::output::help_template]HelpTemplate::write_args clap-flatten-help help\r\n[clap_builder::output::help_template]should_show_arg: use_long=false, arg=subcommand\r\n[clap_builder::output::help_template]HelpTemplate::write_args: arg=\"subcommand\" longest=12\r\n[clap_builder::output::help_template]should_show_arg: use_long=false, arg=subcommand\r\n[clap_builder::output::help_template]HelpTemplate::spec_vals: a=[COMMAND]...\r\n[clap_builder::output::help_template]HelpTemplate::spec_vals: a=[COMMAND]...\r\n[clap_builder::output::help_template]HelpTemplate::short\r\n[clap_builder::output::help_template]HelpTemplate::long\r\n[clap_builder::output::help_template]HelpTemplate::align_to_about: arg=subcommand, next_line_help=false, longest=12\r\n[clap_builder::output::help_template]HelpTemplate::align_to_about: positional=true arg_len=12, spaces=2\r\n[clap_builder::output::help_template]HelpTemplate::help\r\n[clap_builder::output::help_template]HelpTemplate::help: help_width=16, spaces=32, avail=84\r\n[clap_builder::output::help_template]HelpTemplate::write_after_help\r\n[clap_builder::builder::command]Command::color: Color setting...\r\n[clap_builder::builder::command]Auto\r\n[clap_builder::builder::command]Command::color: Color setting...\r\n[clap_builder::builder::command]Auto\r\nUsage: clap-flatten-help public\r\n       clap-flatten-help hidden\r\n       clap-flatten-help help [COMMAND]...\r\n\r\nOptions:\r\n  -h, --help  Print help\r\n\r\nclap-flatten-help public:\r\n  -h, --help  Print help\r\n\r\nclap-flatten-help help:\r\n  [COMMAND]...  Print help for the subcommand(s)\r\n```\r\n</details>",
    "clap-rs__clap-5227": "`flatten_help` ignores `about` on subcommands and repeats top-level `about`\n### Please complete the following tasks\n\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\n- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues\n\n### Rust Version\n\nrustc 1.72.1 (d5c2e9c34 2023-09-13)\n\n### Clap Version\n\n4.4.8\n\n### Minimal reproducible code\n\n```rust\r\nuse clap::{Parser, Subcommand};\r\n\r\n#[derive(Subcommand, Debug)]\r\nenum Command {\r\n    #[command(about = \"Hello!\")]\r\n    Public,\r\n}\r\n\r\n#[derive(Parser, Debug)]\r\n#[command(about = \"Our beautiful tool tagline\", flatten_help = true)]\r\nstruct Opts {\r\n    #[command(subcommand)]\r\n    command: Command,\r\n}\r\n\r\nfn main() {\r\n    let args = Opts::parse();\r\n    println!(\"{:#?}\", args);\r\n}\r\n```\r\n\n\n### Steps to reproduce the bug with the above code\n\ncargo run\r\ncargo run -- help public\n\n### Actual Behaviour\n\nFirst command output:\r\n```\r\nOur beautiful tool tagline\r\n\r\nUsage: clap-flatten-help public\r\n       clap-flatten-help help [COMMAND]...\r\n\r\nOptions:\r\n  -h, --help  Print help\r\n\r\nclap-flatten-help public:\r\nOur beautiful tool tagline\r\n  -h, --help  Print help\r\n\r\nclap-flatten-help help:\r\nOur beautiful tool tagline\r\n  [COMMAND]...  Print help for the subcommand(s)\r\n```\r\nSecond command output:\r\n```\r\nHello!\r\n\r\nUsage: clap-flatten-help public\r\n\r\nOptions:\r\n  -h, --help  Print help\r\n```\n\n### Expected Behaviour\n\nFirst command output:\r\n```\r\nOur beautiful tool tagline\r\n\r\nUsage: clap-flatten-help public\r\n       clap-flatten-help help [COMMAND]...\r\n\r\nOptions:\r\n  -h, --help  Print help\r\n\r\nclap-flatten-help public:\r\nHello!\r\n  -h, --help  Print help\r\n\r\nclap-flatten-help help:\r\n  [COMMAND]...  Print help for the subcommand(s)\r\n```\r\nSecond command output:\r\n```\r\nHello!\r\n\r\nUsage: clap-flatten-help public\r\n\r\nOptions:\r\n  -h, --help  Print help\r\n```\n\n### Additional Context\n\nNote there are *two* differences in the expected behaviour:\r\n1. The top-level about \"Our beautiful tool tagline\" should not be repeated in the `public` subcommand, I expect the about \"Hello!\" to show instead.\r\n2. The top-level about should not be repeated in the `help` subcommand, that one shouldn't have any such line.\n\n### Debug Output\n\n<details><summary>First command output</summary>\r\n\r\n```\r\n[clap_builder::builder::command]Command::_do_parse\r\n[clap_builder::builder::command]Command::_build: name=\"clap-flatten-help\"\r\n[clap_builder::builder::command]Command::_propagate:clap-flatten-help\r\n[clap_builder::builder::command]Command::_check_help_and_version:clap-flatten-help expand_help_tree=false\r\n[clap_builder::builder::command]Command::long_help_exists\r\n[clap_builder::builder::command]Command::_check_help_and_version: Building default --help\r\n[clap_builder::builder::command]Command::_check_help_and_version: Building help subcommand\r\n[clap_builder::builder::command]Command::_propagate_global_args:clap-flatten-help\r\n[clap_builder::builder::debug_asserts]Command::_debug_asserts\r\n[clap_builder::builder::debug_asserts]Arg::_debug_asserts:help\r\n[clap_builder::builder::debug_asserts]Command::_verify_positionals\r\n[clap_builder::parser::parser]Parser::get_matches_with\r\n[clap_builder::parser::parser]Parser::get_matches_with: Begin parsing '\"help\"'\r\n[clap_builder::parser::parser]Parser::possible_subcommand: arg=Ok(\"help\")\r\n[clap_builder::parser::parser]Parser::get_matches_with: sc=Some(\"help\")\r\n[clap_builder::parser::parser]Parser::parse_help_subcommand\r\n[clap_builder::builder::command]Command::long_help_exists: false\r\n[clap_builder::builder::command]Command::write_help_err: clap-flatten-help, use_long=false\r\n[clap_builder::builder::command]Command::long_help_exists: false\r\n[  clap_builder::output::help]write_help\r\n[clap_builder::output::help_template]HelpTemplate::new cmd=clap-flatten-help, use_long=false\r\n[clap_builder::output::help_template]should_show_arg: use_long=false, arg=help\r\n[clap_builder::output::help_template]HelpTemplate::write_templated_help\r\n[clap_builder::output::help_template]HelpTemplate::write_before_help\r\n[ clap_builder::output::usage]Usage::create_usage_no_title\r\n[ clap_builder::output::usage]Usage::create_usage_no_title\r\n[ clap_builder::output::usage]Usage::write_help_usage\r\n[clap_builder::builder::command]Command::_build: name=\"clap-flatten-help\"\r\n[clap_builder::builder::command]Command::_build: already built\r\n[clap_builder::builder::command]Command::_build: name=\"public\"\r\n[clap_builder::builder::command]Command::_propagate:public\r\n[clap_builder::builder::command]Command::_check_help_and_version:public expand_help_tree=true\r\n[clap_builder::builder::command]Command::long_help_exists\r\n[clap_builder::builder::command]Command::_check_help_and_version: Building default --help\r\n[clap_builder::builder::command]Command::_propagate_global_args:public\r\n[clap_builder::builder::debug_asserts]Command::_debug_asserts\r\n[clap_builder::builder::debug_asserts]Arg::_debug_asserts:help\r\n[clap_builder::builder::debug_asserts]Command::_verify_positionals\r\n[clap_builder::builder::command]Command::_build: name=\"help\"\r\n[clap_builder::builder::command]Command::_propagate:help\r\n[clap_builder::builder::command]Command::_check_help_and_version:help expand_help_tree=true\r\n[clap_builder::builder::command]Command::long_help_exists\r\n[clap_builder::builder::command]Command::_propagate_global_args:help\r\n[clap_builder::builder::debug_asserts]Command::_debug_asserts\r\n[clap_builder::builder::debug_asserts]Arg::_debug_asserts:subcommand\r\n[clap_builder::builder::debug_asserts]Command::_verify_positionals\r\n[clap_builder::builder::command]Command::_build_bin_names\r\n[ clap_builder::output::usage]Usage::get_required_usage_from: incls=[], matcher=false, incl_last=true\r\n[ clap_builder::output::usage]Usage::get_required_usage_from: unrolled_reqs=[]\r\n[ clap_builder::output::usage]Usage::get_required_usage_from: ret_val=[]\r\n[clap_builder::builder::command]Command::_build_bin_names:iter: bin_name set...\r\n[clap_builder::builder::command]Command::_build_bin_names:iter: Setting usage_name of public to \"clap-flatten-help public\"\r\n[clap_builder::builder::command]Command::_build_bin_names:iter: Setting bin_name of public to \"clap-flatten-help public\"\r\n[clap_builder::builder::command]Command::_build_bin_names:iter: Setting display_name of public to \"clap-flatten-help-public\"\r\n[clap_builder::builder::command]Command::_build_bin_names\r\n[ clap_builder::output::usage]Usage::get_required_usage_from: incls=[], matcher=false, incl_last=true\r\n[ clap_builder::output::usage]Usage::get_required_usage_from: unrolled_reqs=[]\r\n[ clap_builder::output::usage]Usage::get_required_usage_from: ret_val=[]\r\n[clap_builder::builder::command]Command::_build_bin_names:iter: bin_name set...\r\n[clap_builder::builder::command]Command::_build_bin_names:iter: Setting usage_name of help to \"clap-flatten-help help\"\r\n[clap_builder::builder::command]Command::_build_bin_names:iter: Setting bin_name of help to \"clap-flatten-help help\"\r\n[clap_builder::builder::command]Command::_build_bin_names:iter: Setting display_name of help to \"clap-flatten-help-help\"\r\n[clap_builder::builder::command]Command::_build_bin_names\r\n[ clap_builder::output::usage]Usage::get_required_usage_from: incls=[], matcher=false, incl_last=true\r\n[ clap_builder::output::usage]Usage::get_required_usage_from: unrolled_reqs=[]\r\n[ clap_builder::output::usage]Usage::get_required_usage_from: ret_val=[]\r\n[ clap_builder::output::usage]Usage::create_usage_no_title\r\n[ clap_builder::output::usage]Usage::write_help_usage\r\n[ clap_builder::output::usage]Usage::write_arg_usage; incl_reqs=true\r\n[ clap_builder::output::usage]Usage::needs_options_tag\r\n[ clap_builder::output::usage]Usage::needs_options_tag:iter: f=help\r\n[ clap_builder::output::usage]Usage::needs_options_tag:iter Option is built-in\r\n[ clap_builder::output::usage]Usage::needs_options_tag: [OPTIONS] not required\r\n[ clap_builder::output::usage]Usage::write_args: incls=[]\r\n[ clap_builder::output::usage]Usage::get_args: unrolled_reqs=[]\r\n[ clap_builder::output::usage]Usage::write_subcommand_usage\r\n[ clap_builder::output::usage]Usage::create_usage_no_title\r\n[ clap_builder::output::usage]Usage::write_help_usage\r\n[ clap_builder::output::usage]Usage::write_arg_usage; incl_reqs=true\r\n[ clap_builder::output::usage]Usage::needs_options_tag\r\n[ clap_builder::output::usage]Usage::needs_options_tag: [OPTIONS] not required\r\n[ clap_builder::output::usage]Usage::write_args: incls=[]\r\n[ clap_builder::output::usage]Usage::get_args: unrolled_reqs=[]\r\n[ clap_builder::output::usage]Usage::write_subcommand_usage\r\n[ clap_builder::output::usage]Usage::create_usage_no_title: usage=clap-flatten-help public\r\n       clap-flatten-help help [COMMAND]...\r\n[clap_builder::output::help_template]HelpTemplate::write_all_args\r\n[clap_builder::output::help_template]should_show_arg: use_long=false, arg=help\r\n[clap_builder::output::help_template]HelpTemplate::write_args Options\r\n[clap_builder::output::help_template]should_show_arg: use_long=false, arg=help\r\n[clap_builder::output::help_template]HelpTemplate::write_args: arg=\"help\" longest=6\r\n[clap_builder::output::help_template]should_show_arg: use_long=false, arg=help\r\n[clap_builder::output::help_template]HelpTemplate::spec_vals: a=--help\r\n[clap_builder::output::help_template]HelpTemplate::spec_vals: a=--help\r\n[clap_builder::output::help_template]HelpTemplate::short\r\n[clap_builder::output::help_template]HelpTemplate::long\r\n[clap_builder::output::help_template]HelpTemplate::align_to_about: arg=help, next_line_help=false, longest=6\r\n[clap_builder::output::help_template]HelpTemplate::align_to_about: positional=false arg_len=6, spaces=2\r\n[clap_builder::output::help_template]HelpTemplate::help\r\n[clap_builder::output::help_template]HelpTemplate::help: help_width=14, spaces=10, avail=86\r\n[clap_builder::builder::command]Command::_build: name=\"clap-flatten-help\"\r\n[clap_builder::builder::command]Command::_build: already built\r\n[clap_builder::builder::command]Command::_build: name=\"public\"\r\n[clap_builder::builder::command]Command::_propagate:public\r\n[clap_builder::builder::command]Command::_check_help_and_version:public expand_help_tree=true\r\n[clap_builder::builder::command]Command::long_help_exists\r\n[clap_builder::builder::command]Command::_check_help_and_version: Building default --help\r\n[clap_builder::builder::command]Command::_propagate_global_args:public\r\n[clap_builder::builder::debug_asserts]Command::_debug_asserts\r\n[clap_builder::builder::debug_asserts]Arg::_debug_asserts:help\r\n[clap_builder::builder::debug_asserts]Command::_verify_positionals\r\n[clap_builder::builder::command]Command::_build: name=\"help\"\r\n[clap_builder::builder::command]Command::_propagate:help\r\n[clap_builder::builder::command]Command::_check_help_and_version:help expand_help_tree=true\r\n[clap_builder::builder::command]Command::long_help_exists\r\n[clap_builder::builder::command]Command::_propagate_global_args:help\r\n[clap_builder::builder::debug_asserts]Command::_debug_asserts\r\n[clap_builder::builder::debug_asserts]Arg::_debug_asserts:subcommand\r\n[clap_builder::builder::debug_asserts]Command::_verify_positionals\r\n[clap_builder::builder::command]Command::_build_bin_names\r\n[ clap_builder::output::usage]Usage::get_required_usage_from: incls=[], matcher=false, incl_last=true\r\n[ clap_builder::output::usage]Usage::get_required_usage_from: unrolled_reqs=[]\r\n[ clap_builder::output::usage]Usage::get_required_usage_from: ret_val=[]\r\n[clap_builder::builder::command]Command::_build_bin_names:iter: bin_name set...\r\n[clap_builder::builder::command]Command::_build_bin_names:iter: Setting usage_name of public to \"clap-flatten-help public\"\r\n[clap_builder::builder::command]Command::_build_bin_names:iter: Setting bin_name of public to \"clap-flatten-help public\"\r\n[clap_builder::builder::command]Command::_build_bin_names:iter: Setting display_name of public to \"clap-flatten-help-public\"\r\n[clap_builder::builder::command]Command::_build_bin_names\r\n[ clap_builder::output::usage]Usage::get_required_usage_from: incls=[], matcher=false, incl_last=true\r\n[ clap_builder::output::usage]Usage::get_required_usage_from: unrolled_reqs=[]\r\n[ clap_builder::output::usage]Usage::get_required_usage_from: ret_val=[]\r\n[clap_builder::builder::command]Command::_build_bin_names:iter: bin_name set...\r\n[clap_builder::builder::command]Command::_build_bin_names:iter: Setting usage_name of help to \"clap-flatten-help help\"\r\n[clap_builder::builder::command]Command::_build_bin_names:iter: Setting bin_name of help to \"clap-flatten-help help\"\r\n[clap_builder::builder::command]Command::_build_bin_names:iter: Setting display_name of help to \"clap-flatten-help-help\"\r\n[clap_builder::builder::command]Command::_build_bin_names\r\n[ clap_builder::output::usage]Usage::get_required_usage_from: incls=[], matcher=false, incl_last=true\r\n[ clap_builder::output::usage]Usage::get_required_usage_from: unrolled_reqs=[]\r\n[ clap_builder::output::usage]Usage::get_required_usage_from: ret_val=[]\r\n[clap_builder::output::help_template]HelpTemplate::write_flat_subcommands, cmd=clap-flatten-help, first=false\r\n[clap_builder::output::help_template]should_show_arg: use_long=false, arg=help\r\n[clap_builder::output::help_template]HelpTemplate::write_args clap-flatten-help public\r\n[clap_builder::output::help_template]should_show_arg: use_long=false, arg=help\r\n[clap_builder::output::help_template]HelpTemplate::write_args: arg=\"help\" longest=6\r\n[clap_builder::output::help_template]should_show_arg: use_long=false, arg=help\r\n[clap_builder::output::help_template]HelpTemplate::spec_vals: a=--help\r\n[clap_builder::output::help_template]HelpTemplate::spec_vals: a=--help\r\n[clap_builder::output::help_template]HelpTemplate::short\r\n[clap_builder::output::help_template]HelpTemplate::long\r\n[clap_builder::output::help_template]HelpTemplate::align_to_about: arg=help, next_line_help=false, longest=6\r\n[clap_builder::output::help_template]HelpTemplate::align_to_about: positional=false arg_len=6, spaces=2\r\n[clap_builder::output::help_template]HelpTemplate::help\r\n[clap_builder::output::help_template]HelpTemplate::help: help_width=14, spaces=10, avail=86\r\n[clap_builder::output::help_template]should_show_arg: use_long=false, arg=subcommand\r\n[clap_builder::output::help_template]HelpTemplate::write_args clap-flatten-help help\r\n[clap_builder::output::help_template]should_show_arg: use_long=false, arg=subcommand\r\n[clap_builder::output::help_template]HelpTemplate::write_args: arg=\"subcommand\" longest=12\r\n[clap_builder::output::help_template]should_show_arg: use_long=false, arg=subcommand\r\n[clap_builder::output::help_template]HelpTemplate::spec_vals: a=[COMMAND]...\r\n[clap_builder::output::help_template]HelpTemplate::spec_vals: a=[COMMAND]...\r\n[clap_builder::output::help_template]HelpTemplate::short\r\n[clap_builder::output::help_template]HelpTemplate::long\r\n[clap_builder::output::help_template]HelpTemplate::align_to_about: arg=subcommand, next_line_help=false, longest=12\r\n[clap_builder::output::help_template]HelpTemplate::align_to_about: positional=true arg_len=12, spaces=2\r\n[clap_builder::output::help_template]HelpTemplate::help\r\n[clap_builder::output::help_template]HelpTemplate::help: help_width=16, spaces=32, avail=84\r\n[clap_builder::output::help_template]HelpTemplate::write_after_help\r\n[clap_builder::builder::command]Command::color: Color setting...\r\n[clap_builder::builder::command]Auto\r\n[clap_builder::builder::command]Command::color: Color setting...\r\n[clap_builder::builder::command]Auto\r\nOur beautiful tool tagline\r\n\r\nUsage: clap-flatten-help public\r\n       clap-flatten-help help [COMMAND]...\r\n\r\nOptions:\r\n  -h, --help  Print help\r\n\r\nclap-flatten-help public:\r\nOur beautiful tool tagline\r\n  -h, --help  Print help\r\n\r\nclap-flatten-help help:\r\nOur beautiful tool tagline\r\n  [COMMAND]...  Print help for the subcommand(s)\r\n```\r\n</details>\r\n<details><summary>Second command output</summary>\r\n\r\n```\r\n[clap_builder::builder::command]Command::_do_parse\r\n[clap_builder::builder::command]Command::_build: name=\"clap-flatten-help\"\r\n[clap_builder::builder::command]Command::_propagate:clap-flatten-help\r\n[clap_builder::builder::command]Command::_check_help_and_version:clap-flatten-help expand_help_tree=false\r\n[clap_builder::builder::command]Command::long_help_exists\r\n[clap_builder::builder::command]Command::_check_help_and_version: Building default --help\r\n[clap_builder::builder::command]Command::_check_help_and_version: Building help subcommand\r\n[clap_builder::builder::command]Command::_propagate_global_args:clap-flatten-help\r\n[clap_builder::builder::debug_asserts]Command::_debug_asserts\r\n[clap_builder::builder::debug_asserts]Arg::_debug_asserts:help\r\n[clap_builder::builder::debug_asserts]Command::_verify_positionals\r\n[clap_builder::parser::parser]Parser::get_matches_with\r\n[clap_builder::parser::parser]Parser::get_matches_with: Begin parsing '\"help\"'\r\n[clap_builder::parser::parser]Parser::possible_subcommand: arg=Ok(\"help\")\r\n[clap_builder::parser::parser]Parser::get_matches_with: sc=Some(\"help\")\r\n[clap_builder::parser::parser]Parser::parse_help_subcommand\r\n[ clap_builder::output::usage]Usage::get_required_usage_from: incls=[], matcher=false, incl_last=true\r\n[ clap_builder::output::usage]Usage::get_required_usage_from: unrolled_reqs=[]\r\n[ clap_builder::output::usage]Usage::get_required_usage_from: ret_val=[]\r\n[clap_builder::builder::command]Command::_build_subcommand Setting bin_name of public to \"clap-flatten-help public\"\r\n[clap_builder::builder::command]Command::_build_subcommand Setting display_name of public to \"clap-flatten-help-public\"\r\n[clap_builder::builder::command]Command::_build: name=\"public\"\r\n[clap_builder::builder::command]Command::_propagate:public\r\n[clap_builder::builder::command]Command::_check_help_and_version:public expand_help_tree=false\r\n[clap_builder::builder::command]Command::long_help_exists\r\n[clap_builder::builder::command]Command::_check_help_and_version: Building default --help\r\n[clap_builder::builder::command]Command::_propagate_global_args:public\r\n[clap_builder::builder::debug_asserts]Command::_debug_asserts\r\n[clap_builder::builder::debug_asserts]Arg::_debug_asserts:help\r\n[clap_builder::builder::debug_asserts]Command::_verify_positionals\r\n[clap_builder::builder::command]Command::long_help_exists: false\r\n[clap_builder::builder::command]Command::write_help_err: clap-flatten-help-public, use_long=false\r\n[clap_builder::builder::command]Command::long_help_exists: false\r\n[  clap_builder::output::help]write_help\r\n[clap_builder::output::help_template]HelpTemplate::new cmd=public, use_long=false\r\n[clap_builder::output::help_template]should_show_arg: use_long=false, arg=help\r\n[clap_builder::output::help_template]HelpTemplate::write_templated_help\r\n[clap_builder::output::help_template]HelpTemplate::write_before_help\r\n[ clap_builder::output::usage]Usage::create_usage_no_title\r\n[ clap_builder::output::usage]Usage::create_usage_no_title\r\n[ clap_builder::output::usage]Usage::write_help_usage\r\n[ clap_builder::output::usage]Usage::write_arg_usage; incl_reqs=true\r\n[ clap_builder::output::usage]Usage::needs_options_tag\r\n[ clap_builder::output::usage]Usage::needs_options_tag:iter: f=help\r\n[ clap_builder::output::usage]Usage::needs_options_tag:iter Option is built-in\r\n[ clap_builder::output::usage]Usage::needs_options_tag: [OPTIONS] not required\r\n[ clap_builder::output::usage]Usage::write_args: incls=[]\r\n[ clap_builder::output::usage]Usage::get_args: unrolled_reqs=[]\r\n[ clap_builder::output::usage]Usage::write_subcommand_usage\r\n[ clap_builder::output::usage]Usage::create_usage_no_title: usage=clap-flatten-help public\r\n[clap_builder::output::help_template]HelpTemplate::write_all_args\r\n[clap_builder::output::help_template]should_show_arg: use_long=false, arg=help\r\n[clap_builder::output::help_template]HelpTemplate::write_args Options\r\n[clap_builder::output::help_template]should_show_arg: use_long=false, arg=help\r\n[clap_builder::output::help_template]HelpTemplate::write_args: arg=\"help\" longest=6\r\n[clap_builder::output::help_template]should_show_arg: use_long=false, arg=help\r\n[clap_builder::output::help_template]HelpTemplate::spec_vals: a=--help\r\n[clap_builder::output::help_template]HelpTemplate::spec_vals: a=--help\r\n[clap_builder::output::help_template]HelpTemplate::short\r\n[clap_builder::output::help_template]HelpTemplate::long\r\n[clap_builder::output::help_template]HelpTemplate::align_to_about: arg=help, next_line_help=false, longest=6\r\n[clap_builder::output::help_template]HelpTemplate::align_to_about: positional=false arg_len=6, spaces=2\r\n[clap_builder::output::help_template]HelpTemplate::help\r\n[clap_builder::output::help_template]HelpTemplate::help: help_width=14, spaces=10, avail=86\r\n[clap_builder::output::help_template]HelpTemplate::write_after_help\r\n[clap_builder::builder::command]Command::color: Color setting...\r\n[clap_builder::builder::command]Auto\r\n[clap_builder::builder::command]Command::color: Color setting...\r\n[clap_builder::builder::command]Auto\r\nHello!\r\n\r\nUsage: clap-flatten-help public\r\n\r\nOptions:\r\n  -h, --help  Print help\r\n```\r\n</details>",
    "clap-rs__clap-5206": "Display help for all subcommands at the same time\n**Maintainer's note: Proposed solution**\r\n\r\nSetting:\r\n- `help_includes_subcommands` or `help_shows_subcommands`\r\n  - trying to keep what the setting impacts first, otherwise I would have done `flatten_subcommands_in_help`\r\n  - not starting with `subcommand` because this is set on the parent of the subcommands rather than a subcommand itself\r\n\r\nHelp output:\r\n- USAGE includes regular usage and usage for each subcommand that is visible in short help\r\n- Show current command's subcommand and arguments like normal\r\n  - Even if parent has `help_includes_subcommands` set (this diverges from `git stash <command> -h` which shows `git stash -h`)\r\n- After current command's arguments, for each subcommand visible in short help\r\n  - Show a header for the subcommand\r\n  - Show short-help arguments under the above heading (ie ignore help headings)\r\n    - Ideally, hide all generated and global arguments\r\n  - Do not list subcommands\r\n\r\nMan page:\r\n- Same as above but show long-help\r\n- This will actually be split out into a separate issue\r\n\r\nOpen question:\r\n- Do we recurse?\r\n  - If so, we should elide intermediate subcommands that only have generated arguments\r\n\r\nImplementation:\r\n- Usage generation will need to be refactored so we can request the parts of it that we need\r\n\r\n---\r\nThe API is very large and I've struggled to find any examples or hints pointing to this possibility. Is it possible for the help page for a program to list the help pages of all subcommands at the same time, rather than just the current scope? That way the user does not need to also request for the help info from each subcommand.",
    "clap-rs__clap-5084": "custom {all-args} help output - first line wrong indent\n### Please complete the following tasks\n\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\n- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues\n\n### Rust Version\n\nrustc 1.71.1 (eb26296b5 2023-08-03)\n\n### Clap Version\n\n4.3.23\n\n### Minimal reproducible code\n\n```rust\r\nuse clap::{Parser, Subcommand, Args};\r\n\r\n#[derive(Debug, Args)]\r\n#[command(help_template = \"{all-args}\")]\r\npub struct Param {  }\r\n\r\n#[derive(Debug, Subcommand)]\r\n#[command(help_template = \"{all-args}\", disable_help_subcommand=true)]\r\nenum SubCommands {\r\n    #[command(name = \"test1\", alias = \"t1\", about = \"command1\")]\r\n    Test1(Param),\r\n    #[command(name = \"test2\", alias = \"t2\", about = \"command2\")]\r\n    Test2(Param),\r\n    #[command(name = \"test3\", alias = \"t3\", about = \"command3\")]\r\n    Test3(Param),\r\n}\r\n\r\n#[derive(Debug, Parser)]\r\n#[command(help_template = \"{subcommands}\")]\r\nstruct Cmd {\r\n    #[command(subcommand)]\r\n    command: SubCommands,\r\n}\r\n\r\nfn main() {\r\n    let parsed = Cmd::parse();\r\n    println!(\"{parsed:#?}\");\r\n}\r\n```\r\n\n\n### Steps to reproduce the bug with the above code\n\ncargo run\n\n### Actual Behaviour\n\n```\r\ntest1  command1\r\n  test2  command2\r\n  test3  command3\r\n```\n\n### Expected Behaviour\n\n```\r\n  test1  command1\r\n  test2  command2\r\n  test3  command3\r\n```\n\n### Additional Context\n\n_No response_\n\n### Debug Output\n\n```\r\n[clap_builder::builder::command]Command::_do_parse\r\n[clap_builder::builder::command]Command::_build: name=\"testcode\"\r\n[clap_builder::builder::command]Command::_propagate:testcode\r\n[clap_builder::builder::command]Command::_check_help_and_version:testcode expand_help_tree=false\r\n[clap_builder::builder::command]Command::long_help_exists\r\n[clap_builder::builder::command]Command::_check_help_and_version: Building default --help\r\n[clap_builder::builder::command]Command::_propagate_global_args:testcode\r\n[clap_builder::builder::debug_asserts]Command::_debug_asserts\r\n[clap_builder::builder::debug_asserts]Arg::_debug_asserts:help\r\n[clap_builder::builder::debug_asserts]Command::_verify_positionals\r\n[clap_builder::parser::parser]Parser::get_matches_with\r\n[clap_builder::parser::parser]Parser::add_defaults\r\n[clap_builder::parser::parser]Parser::add_defaults:iter:help:\r\n[clap_builder::parser::parser]Parser::add_default_value: doesn't have conditional defaults\r\n[clap_builder::parser::parser]Parser::add_default_value:iter:help: doesn't have default vals\r\n[clap_builder::parser::validator]Validator::validate\r\n[clap_builder::builder::command]Command::write_help_err: testcode, use_long=false\r\n[  clap_builder::output::help]write_help\r\n[clap_builder::output::help_template]HelpTemplate::new cmd=testcode, use_long=false\r\n[clap_builder::output::help_template]HelpTemplate::write_templated_help\r\n[clap_builder::output::help_template]HelpTemplate::write_subcommands\r\n[clap_builder::output::help_template]HelpTemplate::write_subcommands longest = 5\r\n[clap_builder::output::help_template]HelpTemplate::sc_spec_vals: a=test1\r\n[clap_builder::output::help_template]HelpTemplate::sc_spec_vals: a=test2\r\n[clap_builder::output::help_template]HelpTemplate::sc_spec_vals: a=test3\r\n[clap_builder::output::help_template]HelpTemplate::write_subcommand\r\n[clap_builder::output::help_template]HelpTemplate::sc_spec_vals: a=test1\r\n[clap_builder::output::help_template]HelpTemplate::help\r\n[clap_builder::output::help_template]HelpTemplate::help: help_width=13, spaces=8, avail=87\r\n[clap_builder::output::help_template]HelpTemplate::write_subcommand\r\n[clap_builder::output::help_template]HelpTemplate::sc_spec_vals: a=test2\r\n[clap_builder::output::help_template]HelpTemplate::help\r\n[clap_builder::output::help_template]HelpTemplate::help: help_width=13, spaces=8, avail=87\r\n[clap_builder::output::help_template]HelpTemplate::write_subcommand\r\n[clap_builder::output::help_template]HelpTemplate::sc_spec_vals: a=test3\r\n[clap_builder::output::help_template]HelpTemplate::help\r\n[clap_builder::output::help_template]HelpTemplate::help: help_width=13, spaces=8, avail=87\r\n[clap_builder::builder::command]Command::color: Color setting...\r\n[clap_builder::builder::command]Command::color: Color setting...\r\ntest1  command1\r\n  test2  command2\r\n  test3  command3\r\n\r\n```",
    "clap-rs__clap-5080": "`UnknownArgumentValueParser` eagerly errors out\n### Please complete the following tasks\n\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\n- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues\n\n### Rust Version\n\nrustc 1.72.0-beta.8 (598a0a3cb 2023-08-12)\n\n### Clap Version\n\n4.3.22\n\n### Minimal reproducible code\n\n```rust\r\n#!/usr/bin/env -S cargo +nightly -Zscript\r\n\r\n//! ```cargo\r\n//! [dependencies]\r\n//! clap = \"=4.3.22\"\r\n//! ```\r\n\r\nfn main() {\r\n    let _cmd = clap::Command::new(\"test\")\r\n        .args([\r\n            clap::Arg::new(\"ignore-rust-version\")\r\n                .long(\"ignore-rust-version\")\r\n                .action(clap::ArgAction::SetTrue),\r\n            clap::Arg::new(\"libtest-ignore\")\r\n                .long(\"ignored\")\r\n                .action(clap::ArgAction::SetTrue)\r\n                .value_parser(\r\n                    clap::builder::UnknownArgumentValueParser::suggest_arg(\"-- --ignored\")\r\n                        .and_suggest(\"not much else to say\"),\r\n                )\r\n                .hide(true),\r\n        ])\r\n        .get_matches();\r\n}\r\n```\n\n### Steps to reproduce the bug with the above code\n\nSee above cargo script.\n\n### Actual Behaviour\n\n```console\r\n$ cargo +nightly -Zscript clap-unknown-suggest-bug.rs\r\n\r\nerror: unexpected argument '--ignored' found\r\n\r\n  tip: a similar argument exists: '-- --ignored'\r\n  tip: not much else to say\r\n\r\nUsage: clap-unknown-suggest-bug [OPTIONS]\r\n\r\nFor more information, try '--help'.\r\n```\n\n### Expected Behaviour\n\nShould not fail\n\n### Additional Context\n\ncc https://github.com/clap-rs/clap/pull/5075\r\n\r\nSorry I wasn't familiar with codebase enough to detect this bug during the review \ud83d\ude1e.\n\n### Debug Output\n\n_No response_",
    "clap-rs__clap-5075": "Support custom suggested fix messages for specific flags\n### Please complete the following tasks\r\n\r\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\r\n- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues\r\n\r\n### Clap Version\r\n\r\n4.1.4\r\n\r\n### Describe your use case\r\n\r\nClap has a good fix suggestion mechanism when a user types something wrong. It seems to be based on [Jaro distance](https://github.com/clap-rs/clap/blob/ad5d67623a89415c7f5f7e1f7a47bf5abdfd0b6c/src/parser/features/suggestions.rs#L20). \r\n\r\nA developer sometimes wants to provide an additional context on a specific situation to users. In order to do so, clap needs to support things like **\u201cwhen a user passes a non-existent flag/command/value/whatever, suggest a flag with this custom message instead.\u201d**\r\n\r\n### Describe the solution you'd like\r\n\r\nThere are lots of different ways and layers to support this feature. \r\n\r\nI'll try to dump only one silly idea here: Clap seems to have [several kinds of suggested fix](https://docs.rs/clap/4.1.4/clap/?search=suggested). I don't have any knowledge of clap internals, but feel like at least `Arg` and `Command` can have a method, say `suggests`, accepting a flag name and an alternate message, such as\r\n\r\n```diff\r\n Arg::new(\"directory\")\r\n     .help(\"Change to DIRECTORY before doing anything\")\r\n     .short('C')\r\n     .value_name(\"DIRECTORY\")\r\n+   .suggests(\"--cwd\", \"long flag --cwd is not yet supported. Please use `-C` instead\")\r\n```\r\n\r\nNot a good idea but you've got the gist.\r\n\r\n\r\n\r\n\r\n### Alternatives, if applicable\r\n\r\nDo it manually on application-side. Like\r\n\r\n- https://github.com/rust-lang/cargo/blob/39c13e67a5962466cc7253d41bc1099bbcb224c3/src/bin/cargo/commands/tree.rs#L230-L235\r\n- https://github.com/rust-lang/cargo/blob/39c13e67a5962466cc7253d41bc1099bbcb224c3/src/bin/cargo/commands/read_manifest.rs#L4-L13\r\n\r\nThey are not really in the same situation of this feature requests, as Cargo keeps a stable flag way longer than usual. However, if Cargo decide to remove those subcommand/flags, it may utilize this feature to provide good suggestions.\r\n\r\n### Additional Context\r\n\r\nThis idea was originally from <https://github.com/rust-lang/cargo/issues/11702>",
    "clap-rs__clap-5025": "infer_subcommands should not fail if the ambiguity is over aliases\n### Please complete the following tasks\r\n\r\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\r\n- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues\r\n\r\n### Rust Version\r\n\r\nrustc 1.70.0 (90c541806 2023-05-31) (built from a source tarball)\r\n\r\n### Clap Version\r\n\r\n4.3.12\r\n\r\n### Minimal reproducible code\r\n\r\n```rust\r\nuse clap::{Parser, Subcommand};\r\n\r\n#[derive(Parser, Debug)]\r\n#[command(infer_subcommands = true)]\r\nstruct TestCli {\r\n    #[command(subcommand)]\r\n    command: Commands,\r\n}\r\n\r\n#[derive(Debug, Subcommand)]\r\nenum Commands {\r\n    #[command(alias = \"config\")]\r\n    Cfg,\r\n}\r\n\r\nfn main() {\r\n    let cli = TestCli::parse();\r\n    println!(\"{:?}\", cli);\r\n}\r\n```\r\n\r\n### Steps to reproduce the bug with the above code\r\n\r\n```\r\ncargo run -- c\r\n```\r\n\r\n### Actual Behaviour\r\n\r\nIt recognises the ambiguity between `config` and `cfg`:\r\n\r\n```\r\nerror: unrecognized subcommand 'c'\r\n\r\n  tip: some similar subcommands exist: 'config', 'cfg'\r\n  tip: to pass 'c' as a value, use 'example -- c'\r\n\r\nUsage: example <COMMAND>\r\n\r\nFor more information, try '--help'.\r\n```\r\n\r\n### Expected Behaviour\r\n\r\nWhen an ambiguity only spans a single subcommand and its aliases, then it should resolve to that subcommand:\r\n\r\n```\r\nTestCli { command: Cfg }\r\n```\r\n\r\n### Additional Context\r\n\r\n`infer_long_args` may also have the same behaviour; I haven't checked.\r\n\r\n### Debug Output\r\n\r\n```\r\n[clap_builder::builder::command]Command::_do_parse\r\n[clap_builder::builder::command]Command::_build: name=\"example\"\r\n[clap_builder::builder::command]Command::_propagate:example\r\n[clap_builder::builder::command]Command::_check_help_and_version:example expand_help_tree=false\r\n[clap_builder::builder::command]Command::long_help_exists\r\n[clap_builder::builder::command]Command::_check_help_and_version: Building default --help\r\n[clap_builder::builder::command]Command::_check_help_and_version: Building help subcommand\r\n[clap_builder::builder::command]Command::_propagate_global_args:example\r\n[clap_builder::builder::debug_asserts]Command::_debug_asserts\r\n[clap_builder::builder::debug_asserts]Arg::_debug_asserts:help\r\n[clap_builder::builder::debug_asserts]Command::_verify_positionals\r\n[clap_builder::parser::parser]Parser::get_matches_with\r\n[clap_builder::parser::parser]Parser::get_matches_with: Begin parsing '\"c\"'\r\n[clap_builder::parser::parser]Parser::possible_subcommand: arg=Ok(\"c\")\r\n[clap_builder::parser::parser]Parser::get_matches_with: sc=None\r\n[clap_builder::parser::parser]Parser::get_matches_with: Positional counter...1\r\n[clap_builder::parser::parser]Parser::get_matches_with: Low index multiples...false\r\n[ clap_builder::output::usage]Usage::create_usage_with_title\r\n[ clap_builder::output::usage]Usage::create_usage_no_title\r\n[ clap_builder::output::usage]Usage::create_help_usage; incl_reqs=true\r\n[ clap_builder::output::usage]Usage::needs_options_tag\r\n[ clap_builder::output::usage]Usage::needs_options_tag:iter: f=help\r\n[ clap_builder::output::usage]Usage::needs_options_tag:iter Option is built-in\r\n[ clap_builder::output::usage]Usage::needs_options_tag: [OPTIONS] not required\r\n[ clap_builder::output::usage]Usage::get_args: incls=[]\r\n[ clap_builder::output::usage]Usage::get_args: unrolled_reqs=[]\r\n[ clap_builder::output::usage]Usage::get_args: ret_val=[]\r\n[ clap_builder::output::usage]Usage::create_help_usage: usage=example <COMMAND>\r\n[clap_builder::builder::command]Command::color: Color setting...\r\n[clap_builder::builder::command]Auto\r\n[clap_builder::builder::command]Command::color: Color setting...\r\n[clap_builder::builder::command]Auto\r\n```",
    "clap-rs__clap-5015": "how to enable `-h` / `--help` (short help) + `--help-all` (long help)\n### Please complete the following tasks\n\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\n- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues\n\n### Clap Version\n\n4.1.4\n\n### Describe your use case\n\nI've found #3405 which hints at the same idea, but I wasn't able to follow whether this was implemented or not\r\n\r\nI have this, which is *close* but doesn't satisfy the \"--help gives short help\" (mostly, I find `clap`'s choice of `-h` and `--help` an odd one, and not one I've found precedence for elsewhere, the more common approach I've seen is `--help-all` or `--help-full` or `--help-{thing}` to give additional help for specific areas). \r\n\r\n```rs\r\nuse clap::Parser;\r\n\r\n#[derive(Parser, Debug)]\r\n#[command(author, version, about, long_about = None)]\r\n#[command(propagate_version = true)]\r\n#[clap(disable_help_flag = true)]\r\nstruct Cli {\r\n    /// Should always be shown in all helps\r\n    #[arg(long)]\r\n    someopt: String,\r\n    /// Secret option, should only be shown in --help-all\r\n    #[arg(long, hide_short_help = true)]\r\n    wacky: String,\r\n    /// Print help\r\n    #[arg(short, long, action = clap::ArgAction::Help)]\r\n    help: bool,\r\n    /// Print help, including uncommon options\r\n    #[arg(long, action = clap::ArgAction::Help)]\r\n    help_all: bool,\r\n}\r\n\r\n\r\nfn main() {\r\n    let args = Cli::parse();\r\n    println!(\"Hello, world!, {:?}\", args);\r\n}\r\n```\n\n### Describe the solution you'd like\n\nmaybe something like this?\r\n\r\n```rust\r\n    /// Print help\r\n    #[arg(short, long, action = clap::ArgAction::HelpShort)]\r\n    help: bool,\r\n    /// Print help, including uncommon options\r\n    #[arg(long, action = clap::ArgAction::HelpLong)]\r\n    help_all: bool,\r\n```\r\n\r\n(`HelpShort` / `HelpLong`)\n\n### Alternatives, if applicable\n\nI am very new to `clap`, so I'd be happy enough if there's already a solution to this\n\n### Additional Context\n\nfor example, `python`'s help:\r\n\r\n```console\r\n$ python3.12 --help\r\nusage: python3.12 [option] ... [-c cmd | -m mod | file | -] [arg] ...\r\nOptions (and corresponding environment variables):\r\n-b     : issue warnings about str(bytes_instance), str(bytearray_instance)\r\n         and comparing bytes/bytearray with str. (-bb: issue errors)\r\n...\r\n--help-env      : print help about Python environment variables and exit\r\n--help-xoptions : print help about implementation-specific -X options and exit\r\n--help-all      : print complete help information and exit\r\nArguments:\r\nfile   : program read from script file\r\n-      : program read from stdin (default; interactive mode if a tty)\r\narg ...: arguments passed to program in sys.argv[1:]\r\n```",
    "clap-rs__clap-4909": "Using index_of()/indices_of() with optional arguments that take optional values\n### Please complete the following tasks\n\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\n- [X] I have searched the existing issues\n\n### Describe your use case\n\nI have multiple optional arguments with optional values. If several of them were specified *without* passing a value, I want to determine the indices of the arguments so I can find out which one was specified first. However, it seems that this is one of the few cases where `Arg::index_of()`/`Arg::indices_of()` *doesn't* work.\r\n\r\nA simple example can be found below.\n\n### Describe the solution you'd like\n\nIdeally, `Arg::index_of()` would work for arguments with optional values.\n\n### Alternatives, if applicable\n\nPerhaps a new method, say `Args::index_of_opt()` (which would return the index of the flag like `-a` or --all`, instead of the value) could be added?\n\n### Additional Context\n\nI'm using `structopt`, but I've translated this to `clap` code.\n\nExample with clap 2.33:\r\n\r\n```rust\r\nfn main() {\r\n    use clap::{Arg, App};\r\n    \r\n    let app = App::new(\"Basic Test\")\r\n        .arg(Arg::with_name(\"abc\")\r\n            .short(\"a\")\r\n            .long(\"abc\")\r\n            .takes_value(true)\r\n            .multiple(false)\r\n            .min_values(0)\r\n            .max_values(1));\r\n\r\n    // I can get the index in all of these cases (because clap returns the index of the value)\r\n\r\n    let matches = app.clone().get_matches_from(&[\"\", \"-a1\"]);\r\n    println!(\"{:?}\", matches.index_of(\"abc\"));\r\n\r\n    let matches = app.clone().get_matches_from(&[\"\", \"--abc=1\"]);\r\n    println!(\"{:?}\", matches.index_of(\"abc\"));\r\n\r\n    let matches = app.clone().get_matches_from(&[\"\", \"-a\", \"1\"]);\r\n    println!(\"{:?}\", matches.index_of(\"abc\"));\r\n\r\n    let matches = app.clone().get_matches_from(&[\"\", \"--abc\", \"1\"]);\r\n    println!(\"{:?}\", matches.index_of(\"abc\"));\r\n\r\n    // But I can't get the index in these cases (which is when I really need it!)\r\n\r\n    let matches = app.clone().get_matches_from(&[\"\", \"-a\"]);\r\n    println!(\"{:?}\", matches.index_of(\"abc\"));\r\n\r\n    let matches = app.clone().get_matches_from(&[\"\", \"--abc\"]);\r\n    println!(\"{:?}\", matches.index_of(\"abc\"));\r\n}\r\n```\r\n\r\nThis produces the following output:\r\n```\r\nSome(2)\r\nSome(2)\r\nSome(2)\r\nSome(2)\r\nNone\r\nNone\r\n```\r\n\r\n<details>\r\n<summary>Updated for clap 3 (produces the same output as the above version when run against the latest master):</summary>\r\n\r\n```rust\r\nfn main() {\r\n    use clap::{Arg, App};\r\n    \r\n    let app = App::new(\"Basic Test\")\r\n        .arg(Arg::new(\"abc\")\r\n            .short('a')\r\n            .long(\"abc\")\r\n            .takes_value(true)\r\n            .multiple(false)\r\n            .min_values(0)\r\n            .max_values(1));\r\n\r\n    // I can get the index in all of these cases (because clap returns the index of the value)\r\n\r\n    let matches = app.clone().get_matches_from(&[\"\", \"-a1\"]);\r\n    println!(\"{:?}\", matches.index_of(\"abc\"));\r\n\r\n    let matches = app.clone().get_matches_from(&[\"\", \"--abc=1\"]);\r\n    println!(\"{:?}\", matches.index_of(\"abc\"));\r\n\r\n    let matches = app.clone().get_matches_from(&[\"\", \"-a\", \"1\"]);\r\n    println!(\"{:?}\", matches.index_of(\"abc\"));\r\n\r\n    let matches = app.clone().get_matches_from(&[\"\", \"--abc\", \"1\"]);\r\n    println!(\"{:?}\", matches.index_of(\"abc\"));\r\n\r\n    // But I can't get the index in these cases (which is when I really need it!)\r\n\r\n    let matches = app.clone().get_matches_from(&[\"\", \"-a\"]);\r\n    println!(\"{:?}\", matches.index_of(\"abc\"));\r\n\r\n    let matches = app.clone().get_matches_from(&[\"\", \"--abc\"]);\r\n    println!(\"{:?}\", matches.index_of(\"abc\"));\r\n}\r\n```\r\n</details>",
    "clap-rs__clap-4902": "Show subcommand `about` on same line, even in `--help`\n### Please complete the following tasks\r\n\r\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\r\n- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues\r\n\r\n### Clap Version\r\n\r\nmaster\r\n\r\n### Describe your use case\r\n\r\nIt's easier to read, of course when long_about (not just the summary) is used, putting it on the same line is less than desirable, but this always shows the summary anyway.\r\n\r\nExample:\r\n```\r\nUsage: a <X> <COMMAND>\r\n\r\nCommands:\r\n  lol   This, however - since it's only showing the summary, it may be easier to digest if it's on the same line, or just cleaner (ok, that isn't a summary...)\r\n  help  Print this message or the help of the given subcommand(s)\r\n\r\nArguments:\r\n  <X>\r\n          Really short summary\r\n          \r\n          Very long and descriptive, perhaps overly descriptive explanation of what\r\n          this code does and utterly every little detail of it...\r\n          \r\n          Since this is NOT just the summary, it's ok to put this on multiple lines.\r\n\r\nOptions:\r\n  -h, --help\r\n          Print help (see a summary with '-h')\r\n```\r\n\r\n### Describe the solution you'd like\r\n\r\nCurrently, line 898 in help_template.rs (or, somewhere in `write_subcommands`): \r\n```rs\r\nself.write_subcommand(sc_str, sc, next_line_help, longest);\r\n```\r\nSwitch this to:\r\n```rs\r\nself.write_subcommand(sc_str, sc, false, longest);\r\n```\r\nThis will cause clap to always show subcommands on the same line.\r\n\r\nAlas, **This is not future proof.**\r\n\r\n### Alternatives, if applicable\r\n\r\n#1334, or just no changes. It's fine currently.\r\n\r\n### Additional Context\r\n\r\nSince it only ever shows `about` and not `long_about` for subcommands in particular, it makes sense for it to (by default) show it on the same line, since it's the summary. `-h` does this, and so does `--help` too - unless `long_about` is provided on anything.\r\n\r\nif `next_line_help(true)` is passed, then it should preserve the current behavior of course.",
    "clap-rs__clap-4667": "Singular used even when multiple suggestions exist `note: subcommand 'foo', 'bar' exist`\n### Please complete the following tasks\r\n\r\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\r\n- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues\r\n\r\n### Rust Version\r\n\r\n1.66.1\r\n\r\n### Clap Version\r\n\r\nmaster\r\n\r\n### Minimal reproducible code\r\n\r\nThere already exists a test that expects the wrong grammar (intentionally?):\r\n\r\nhttps://github.com/clap-rs/clap/blob/90c042eeaef36ef6a1718b19cc9ea213ac249f6e/tests/builder/subcommands.rs#L123 directly\r\n\r\nThis can be confusing, as the user could think that usage of singular has meaning and starts to think about why singular is used.\r\n\r\n### Steps to reproduce the bug with the above code\r\n\r\nNA\r\n\r\n### Actual Behaviour\r\n\r\n```\r\nnote: subcommand 'test', 'temp' exists\r\n```\r\n\r\n### Expected Behaviour\r\n\r\n```\r\nnote: subcommands 'test', 'temp' exist\r\n```\r\n\r\n-> Add a suffix `-s` `subcommand` and get rid of `exists` suffix `-s`\r\n\r\n### Additional Context\r\n\r\nPossible fix could be in https://github.com/clap-rs/clap/blob/90c042eeaef36ef6a1718b19cc9ea213ac249f6e/src/error/format.rs#L70-L85\r\n\r\nThough this would require a bit of extra code = increased complexity.\r\n\r\nInterestingly, the plural/singular of the `exist`/`exists` part is correctly implemented already in  https://github.com/clap-rs/clap/blob/90c042eeaef36ef6a1718b19cc9ea213ac249f6e/src/error/format.rs#L440-L460\r\n\r\n### Debug Output\r\n\r\n_No response_",
    "clap-rs__clap-4635": "Stablize `ArgMatches::grouped_value_of` Tracking Issue\nOriginal request: https://github.com/clap-rs/clap/issues/1026\r\n\r\nOriginal PR: https://github.com/clap-rs/clap/pull/2297\r\n\r\nFeature flag: `unstable-grouped`\r\n\r\nKnown issues\r\n- [x] Open question: how should this be exposed in `clap_derive` (see also #1772)\r\n- [x] Open question: update for new `get`/`remove` API (#4372)\r\n- [x] Evaluate new names as this can be confusing with `ArgGroup`, `occurrence` is normally what we call this\r\n- [x] Function is not documented (#3551)",
    "clap-rs__clap-4601": "Help text for `-h` is too long for two-column short help\n### Please complete the following tasks\n\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\n- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues\n\n### Rust Version\n\nrustc 1.64.0 (Fedora 1.64.0-1.fc36)\n\n### Clap Version\n\n4.0.17\n\n### Minimal reproducible code\n\n```rust\r\nuse clap::Parser;\r\n\r\n#[derive(Parser)]\r\npub struct Cmd {\r\n    /// Process an integer\r\n    ///\r\n    /// Convert an integer into a more pleasing format.\r\n    #[clap(long, value_name = \"INTEGER\")]\r\n    process_int: Option<i64>,\r\n\r\n    /// Process a string\r\n    ///\r\n    /// Convert an integer into a more pleasing format.\r\n    #[clap(long, value_name = \"STRING\")]\r\n    process_string: Option<String>,\r\n}\r\n\r\nfn main() {\r\n    Cmd::parse();\r\n}\r\n```\r\n\r\nCargo.toml:\r\n```toml\r\n[package]\r\nname = \"clap-help\"\r\nversion = \"0.0.0\"\r\nedition = \"2021\"\r\n\r\n[dependencies]\r\nclap = { version = \"4\", features = [\"derive\", \"wrap_help\"] }\r\n```\n\n### Steps to reproduce the bug with the above code\n\n```\r\ncargo run -- -h\r\n```\n\n### Actual Behaviour\n\nOn an 80-column terminal, short help uses multiple lines per option:\r\n\r\n```\r\nUsage: clap-help [OPTIONS]\r\n\r\nOptions:\r\n      --process-int <INTEGER>\r\n          Process an integer\r\n      --process-string <STRING>\r\n          Process a string\r\n  -h, --help\r\n          Print help information (use `--help` for more detail)\r\n```\n\n### Expected Behaviour\n\nShort help uses two-column format:\r\n\r\n```\r\nUsage: clap-help [OPTIONS]\r\n\r\nOptions:\r\n      --process-int <INTEGER>    Process an integer\r\n      --process-string <STRING>  Process a string\r\n  -h, --help                     Print help ('--help' for more)\r\n```\n\n### Additional Context\n\nApplications may want to constrain their short help to use the two-column format so the `-h` output is as compact as possible.  They might do this by optimizing short help texts to fit within the right-hand column on 80-character terminals, and then providing long help texts with more info.  However, #4159 made the short help text for `-h`/`--help` much longer when the short and long help are different, forcing short help to wrap to the multiple-line format if medium-sized option/value names are used.\r\n\r\nProposed fix in https://github.com/clap-rs/clap/pull/4408.\n\n### Debug Output\n\n_No response_",
    "clap-rs__clap-4573": "Required field inside a struct that conflicts with another arg is still demanded \n### Please complete the following tasks\n\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\n- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues\n\n### Rust Version\n\nrustc 1.66.0 (69f9c33d7 2022-12-12)\n\n### Clap Version\n\n4.0.30\n\n### Minimal reproducible code\n\n```rust\r\nuse std::path::PathBuf;\r\nuse clap::Parser;\r\n\r\n#[derive(Parser, Debug, PartialEq, Default)]\r\n#[command(about, version)]\r\npub struct Args {\r\n    #[arg(short, long, conflicts_with = \"ExplicitConfig\")]\r\n    config: Option<PathBuf>,\r\n    #[command(flatten)]\r\n    explicit: Option<ExplicitConfig>,\r\n}\r\n\r\n#[derive(clap::Args, Debug, PartialEq, Default)]\r\n#[command(about, version)]\r\npub struct ExplicitConfig {\r\n    #[arg(required = true)]\r\n    connection: Vec<String>,\r\n}\r\n\r\nfn main() {\r\n    let args = Args::parse_from([\"main\", \"--config\", \"foo.toml\"]);\r\n    let expected = Args {\r\n        config: Some(PathBuf::from(\"foo.toml\")),\r\n        ..Default::default()\r\n    };\r\n    assert_eq!(args, expected);\r\n}\r\n```\r\n\n\n### Steps to reproduce the bug with the above code\n\nrun it\n\n### Actual Behaviour\n\n```\r\nerror: The following required arguments were not provided:\r\n  <CONNECTION>...\r\n\r\nUsage: main --config <CONFIG> <CONNECTION>...\r\n\r\nFor more information try '--help'\r\n\r\nProcess finished with exit code 2\r\n```\n\n### Expected Behaviour\n\nshould pass\n\n### Additional Context\n\nFiling per @epage suggestion in a [discussion](https://github.com/clap-rs/clap/discussions/4562#discussioncomment-4453976).\n\n### Debug Output\n\n```\r\n/home/nyurik/.cargo/bin/cargo run --color=always --package tmp --bin tmp\r\n    Finished dev [unoptimized + debuginfo] target(s) in 0.03s\r\n     Running `target/debug/tmp`\r\n[      clap::builder::command] \tCommand::_do_parse\r\n[      clap::builder::command] \tCommand::_build: name=\"tmp\"\r\n[      clap::builder::command] \tCommand::_propagate:tmp\r\n[      clap::builder::command] \tCommand::_check_help_and_version:tmp expand_help_tree=false\r\n[      clap::builder::command] \tCommand::long_help_exists\r\n[      clap::builder::command] \tCommand::_check_help_and_version: Building default --help\r\n[      clap::builder::command] \tCommand::_check_help_and_version: Building default --version\r\n[      clap::builder::command] \tCommand::_propagate_global_args:tmp\r\n[clap::builder::debug_asserts] \tCommand::_debug_asserts\r\n[clap::builder::debug_asserts] \tArg::_debug_asserts:config\r\n[clap::builder::debug_asserts] \tArg::_debug_asserts:connection\r\n[clap::builder::debug_asserts] \tArg::_debug_asserts:help\r\n[clap::builder::debug_asserts] \tArg::_debug_asserts:version\r\n[clap::builder::debug_asserts] \tCommand::_verify_positionals\r\n[        clap::parser::parser] \tParser::get_matches_with\r\n[        clap::parser::parser] \tParser::get_matches_with: Begin parsing 'RawOsStr(\"--config\")' ([45, 45, 99, 111, 110, 102, 105, 103])\r\n[        clap::parser::parser] \tParser::possible_subcommand: arg=Ok(\"--config\")\r\n[        clap::parser::parser] \tParser::get_matches_with: sc=None\r\n[        clap::parser::parser] \tParser::parse_long_arg\r\n[        clap::parser::parser] \tParser::parse_long_arg: Does it contain '='...\r\n[        clap::parser::parser] \tParser::parse_long_arg: Found valid arg or flag '--config <CONFIG>'\r\n[        clap::parser::parser] \tParser::parse_long_arg(\"config\"): Found an arg with value 'None'\r\n[        clap::parser::parser] \tParser::parse_opt_value; arg=config, val=None, has_eq=false\r\n[        clap::parser::parser] \tParser::parse_opt_value; arg.settings=ArgFlags(NO_OP)\r\n[        clap::parser::parser] \tParser::parse_opt_value; Checking for val...\r\n[        clap::parser::parser] \tParser::parse_opt_value: More arg vals required...\r\n[        clap::parser::parser] \tParser::get_matches_with: After parse_long_arg Opt(\"config\")\r\n[        clap::parser::parser] \tParser::get_matches_with: Begin parsing 'RawOsStr(\"foo.toml\")' ([102, 111, 111, 46, 116, 111, 109, 108])\r\n[   clap::parser::arg_matcher] \tArgMatcher::needs_more_vals: o=config, pending=1\r\n[   clap::parser::arg_matcher] \tArgMatcher::needs_more_vals: expected=1, actual=1\r\n[        clap::parser::parser] \tParser::resolve_pending: id=\"config\"\r\n[        clap::parser::parser] \tParser::react action=Set, identifier=Some(Long), source=CommandLine\r\n[        clap::parser::parser] \tParser::react: cur_idx:=1\r\n[        clap::parser::parser] \tParser::remove_overrides: id=\"config\"\r\n[   clap::parser::arg_matcher] \tArgMatcher::start_custom_arg: id=\"config\", source=CommandLine\r\n[      clap::builder::command] \tCommand::groups_for_arg: id=\"config\"\r\n[        clap::parser::parser] \tParser::push_arg_values: [\"foo.toml\"]\r\n[        clap::parser::parser] \tParser::add_single_val_to_arg: cur_idx:=2\r\n[   clap::parser::arg_matcher] \tArgMatcher::needs_more_vals: o=config, pending=0\r\n[   clap::parser::arg_matcher] \tArgMatcher::needs_more_vals: expected=1, actual=0\r\n[        clap::parser::parser] \tParser::react not enough values passed in, leaving it to the validator to complain\r\n[        clap::parser::parser] \tParser::add_defaults\r\n[        clap::parser::parser] \tParser::add_defaults:iter:config:\r\n[        clap::parser::parser] \tParser::add_default_value: doesn't have conditional defaults\r\n[        clap::parser::parser] \tParser::add_default_value:iter:config: doesn't have default vals\r\n[        clap::parser::parser] \tParser::add_defaults:iter:connection:\r\n[        clap::parser::parser] \tParser::add_default_value: doesn't have conditional defaults\r\n[        clap::parser::parser] \tParser::add_default_value:iter:connection: doesn't have default vals\r\n[        clap::parser::parser] \tParser::add_defaults:iter:help:\r\n[        clap::parser::parser] \tParser::add_default_value: doesn't have conditional defaults\r\n[        clap::parser::parser] \tParser::add_default_value:iter:help: doesn't have default vals\r\n[        clap::parser::parser] \tParser::add_defaults:iter:version:\r\n[        clap::parser::parser] \tParser::add_default_value: doesn't have conditional defaults\r\n[        clap::parser::parser] \tParser::add_default_value:iter:version: doesn't have default vals\r\n[     clap::parser::validator] \tValidator::validate\r\n[     clap::parser::validator] \tValidator::validate_conflicts\r\n[     clap::parser::validator] \tValidator::validate_exclusive\r\n[     clap::parser::validator] \tValidator::validate_conflicts::iter: id=\"config\"\r\n[     clap::parser::validator] \tConflicts::gather_conflicts: arg=\"config\"\r\n[     clap::parser::validator] \tConflicts::gather_conflicts: conflicts=[]\r\n[     clap::parser::validator] \tValidator::validate_required: required=ChildGraph([Child { id: \"connection\", children: [] }])\r\n[     clap::parser::validator] \tValidator::gather_requires\r\n[     clap::parser::validator] \tValidator::gather_requires:iter:\"config\"\r\n[     clap::parser::validator] \tValidator::validate_required: is_exclusive_present=false\r\n[     clap::parser::validator] \tValidator::validate_required:iter:aog=\"connection\"\r\n[     clap::parser::validator] \tValidator::validate_required:iter: This is an arg\r\n[     clap::parser::validator] \tValidator::is_missing_required_ok: connection\r\n[     clap::parser::validator] \tConflicts::gather_conflicts: arg=\"connection\"\r\n[      clap::builder::command] \tCommand::groups_for_arg: id=\"connection\"\r\n[     clap::parser::validator] \tConflicts::gather_direct_conflicts id=\"connection\", conflicts=[]\r\n[      clap::builder::command] \tCommand::groups_for_arg: id=\"config\"\r\n[     clap::parser::validator] \tConflicts::gather_direct_conflicts id=\"config\", conflicts=[\"ExplicitConfig\"]\r\n[     clap::parser::validator] \tConflicts::gather_conflicts: conflicts=[]\r\n[     clap::parser::validator] \tValidator::validate_required:iter: Missing \"connection\"\r\n[     clap::parser::validator] \tValidator::missing_required_error; incl=[\"connection\"]\r\n[     clap::parser::validator] \tValidator::missing_required_error: reqs=ChildGraph([Child { id: \"connection\", children: [] }])\r\n[         clap::output::usage] \tUsage::get_required_usage_from: incls=[\"connection\"], matcher=true, incl_last=true\r\n[         clap::output::usage] \tUsage::get_required_usage_from: unrolled_reqs=[\"connection\"]\r\n[         clap::output::usage] \tUsage::get_required_usage_from:iter:\"connection\" arg is_present=false\r\n[         clap::output::usage] \tUsage::get_required_usage_from:iter:\"connection\" arg is_present=false\r\n[         clap::output::usage] \tUsage::get_required_usage_from: ret_val=[StyledStr { pieces: [(Some(Placeholder), \"<CONNECTION>...\")] }]\r\n[     clap::parser::validator] \tValidator::missing_required_error: req_args=[\r\n    \"<CONNECTION>...\",\r\n]\r\n[         clap::output::usage] \tUsage::create_usage_with_title\r\n[         clap::output::usage] \tUsage::create_usage_no_title\r\n[         clap::output::usage] \tUsage::create_smart_usage\r\n[         clap::output::usage] \tUsage::get_args: incls=[\"config\", \"connection\"]\r\n[         clap::output::usage] \tUsage::get_args: unrolled_reqs=[\"connection\"]\r\n[         clap::output::usage] \tUsage::get_args: ret_val=[StyledStr { pieces: [(Some(Literal), \"--\"), (Some(Literal), \"config\"), (Some(Placeholder), \" \"), (Some(Placeholder), \"<CONFIG>\")] }, StyledStr { pieces: [(Some(Placeholder), \"<CONNECTION>...\")] }]\r\n[      clap::builder::command] \tCommand::color: Color setting...\r\n[      clap::builder::command] \tAuto\r\n[      clap::builder::command] \tCommand::color: Color setting...\r\n[      clap::builder::command] \tAuto\r\nerror: The following required arguments were not provided:\r\n  <CONNECTION>...\r\n\r\nUsage: main --config <CONFIG> <CONNECTION>...\r\n\r\nFor more information try '--help'\r\n\r\nProcess finished with exit code 2\r\n```",
    "clap-rs__clap-4523": "`requires` is bypassed when using `conflicts_with` a certain way\n### Please complete the following tasks\n\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\n- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues\n\n### Rust Version\n\n1.65.0\n\n### Clap Version\n\n4.0.26\n\n### Minimal reproducible code\n\n```rust\r\nuse clap::Parser;\r\n\r\n#[derive(Parser, Debug)]\r\nstruct Cli {\r\n    #[clap(long)]\r\n    destroy: bool,\r\n    #[clap(long, conflicts_with = \"destroy\" )]\r\n    enhance: bool,\r\n    /// Let's assume, `--dry_run` is only implemented for the `--enhance`\r\n    /// functionality for some reason\r\n    /// Attempting to use `--dry-run --destroy` should fail and inform the user\r\n    /// that these arguments conflict.\r\n    /// The last thing we would want would be to go ahead and destroy their\r\n    /// system when they're thinking only a dry run is going to happen.\r\n    /// This fiction is inspired by real events :p\r\n    #[clap(long, requires = \"enhance\" )]\r\n    dry_run: bool,\r\n}\r\n\r\nfn main() {\r\n    let res = Cli::try_parse_from(vec![\"cli\", \"--destroy\", \"--dry-run\"]);\r\n    // *Unexpectedly*, this assertion fails.\r\n    // One would think that because `--dry-run` requires `--enhance`, the result\r\n    // would be an error complaining that this combination cannot be used\r\n    // together.\r\n    // In actuality, clap will happily parse this.\r\n    assert!(res.is_err());\r\n}\r\n```\r\n\n\n### Steps to reproduce the bug with the above code\n\nSee [the surprising code](https://play.rust-lang.org/?version=stable&mode=debug&edition=2021&gist=63c32cc6b859b83898ad0f196c09bb8a) in the rust playground.\n\n### Actual Behaviour\n\nThe last assertion fails: clap is happy to let the user pass the `--dry-run` flag with the `--destroy` flag and without the `--enhance` flag, bypassing the fact that `--dry-run` should require `--enhance`.\n\n### Expected Behaviour\n\nThe last assertion should pass: clap should report to the user that `--dry-run` can only be used in combination with the `--enhance` flag.\n\n### Additional Context\n\nThis issue can be worked around by adding an explicit `conflicts_with` configuration like so:\r\n```rust\r\n    #[clap(long, requires = \"enhance\", conflicts_with = \"destroy\")]\r\n    dry_run: bool,\r\n```\r\nbut I find it surprising that this is needed to obtain the expected behaviour.\n\n### Debug Output\n\n_No response_",
    "clap-rs__clap-4474": "Panics on invalid utf8 for unknown arguments\n```rust\r\nfn main() {\r\n    let app = clap::builder::Command::new(\"test\");\r\n    let matches = app.try_get_matches();\r\n    eprintln!(\"matches = {:?}\", matches);\r\n}\r\n```\r\n\r\nIf I run this \"empty\" app with an unexpected arg, which is also invalid utf8, I get a panic: \r\n\r\n```console\r\n\u03bb cargo run -- --flag \\XFF\r\n    Finished dev [unoptimized + debuginfo] target(s) in 0.01s\r\n     Running `target/debug/clap-clap --flag '\ufffd'`\r\nthread 'main' panicked at 'unexpected invalid UTF-8 code point', /home/matklad/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-4.0.22/src/parser/parser.rs:176:53\r\nstack backtrace:\r\n   0: rust_begin_unwind\r\n             at /rustc/e080cc5a659fb760c0bc561b722a790dad35b5e1/library/std/src/panicking.rs:575:5\r\n   1: core::panicking::panic_fmt\r\n             at /rustc/e080cc5a659fb760c0bc561b722a790dad35b5e1/library/core/src/panicking.rs:65:14\r\n   2: core::panicking::panic_display\r\n             at /rustc/e080cc5a659fb760c0bc561b722a790dad35b5e1/library/core/src/panicking.rs:139:5\r\n   3: core::panicking::panic_str\r\n             at /rustc/e080cc5a659fb760c0bc561b722a790dad35b5e1/library/core/src/panicking.rs:123:5\r\n   4: core::option::expect_failed\r\n             at /rustc/e080cc5a659fb760c0bc561b722a790dad35b5e1/library/core/src/option.rs:1879:5\r\n   5: core::option::Option<T>::expect\r\n             at /rustc/e080cc5a659fb760c0bc561b722a790dad35b5e1/library/core/src/option.rs:741:21\r\n   6: clap::parser::parser::Parser::get_matches_with::{{closure}}\r\n             at /home/matklad/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-4.0.22/src/parser/parser.rs:176:42\r\n   7: core::iter::adapters::map::map_fold::{{closure}}\r\n             at /rustc/e080cc5a659fb760c0bc561b722a790dad35b5e1/library/core/src/iter/adapters/map.rs:84:28\r\n   8: core::iter::adapters::map::map_fold::{{closure}}\r\n             at /rustc/e080cc5a659fb760c0bc561b722a790dad35b5e1/library/core/src/iter/adapters/map.rs:84:21\r\n   9: core::iter::traits::iterator::Iterator::fold\r\n             at /rustc/e080cc5a659fb760c0bc561b722a790dad35b5e1/library/core/src/iter/traits/iterator.rs:2414:21\r\n  10: <core::iter::adapters::map::Map<I,F> as core::iter::traits::iterator::Iterator>::fold\r\n             at /rustc/e080cc5a659fb760c0bc561b722a790dad35b5e1/library/core/src/iter/adapters/map.rs:124:9\r\n  11: <core::iter::adapters::map::Map<I,F> as core::iter::traits::iterator::Iterator>::fold\r\n             at /rustc/e080cc5a659fb760c0bc561b722a790dad35b5e1/library/core/src/iter/adapters/map.rs:124:9\r\n  12: core::iter::traits::iterator::Iterator::for_each\r\n             at /rustc/e080cc5a659fb760c0bc561b722a790dad35b5e1/library/core/src/iter/traits/iterator.rs:831:9\r\n  13: <alloc::vec::Vec<T,A> as alloc::vec::spec_extend::SpecExtend<T,I>>::spec_extend\r\n             at /rustc/e080cc5a659fb760c0bc561b722a790dad35b5e1/library/alloc/src/vec/spec_extend.rs:40:17\r\n  14: <alloc::vec::Vec<T> as alloc::vec::spec_from_iter_nested::SpecFromIterNested<T,I>>::from_iter\r\n             at /rustc/e080cc5a659fb760c0bc561b722a790dad35b5e1/library/alloc/src/vec/spec_from_iter_nested.rs:62:9\r\n  15: <alloc::vec::Vec<T> as alloc::vec::spec_from_iter::SpecFromIter<T,I>>::from_iter\r\n             at /rustc/e080cc5a659fb760c0bc561b722a790dad35b5e1/library/alloc/src/vec/spec_from_iter.rs:33:9\r\n  16: <alloc::vec::Vec<T> as core::iter::traits::collect::FromIterator<T>>::from_iter\r\n             at /rustc/e080cc5a659fb760c0bc561b722a790dad35b5e1/library/alloc/src/vec/mod.rs:2757:9\r\n  17: core::iter::traits::iterator::Iterator::collect\r\n             at /rustc/e080cc5a659fb760c0bc561b722a790dad35b5e1/library/core/src/iter/traits/iterator.rs:1836:9\r\n  18: clap::parser::parser::Parser::get_matches_with\r\n             at /home/matklad/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-4.0.22/src/parser/parser.rs:174:58\r\n  19: clap::builder::command::Command::_do_parse\r\n             at /home/matklad/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-4.0.22/src/builder/command.rs:3794:29\r\n  20: clap::builder::command::Command::try_get_matches_from_mut\r\n             at /home/matklad/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-4.0.22/src/builder/command.rs:708:9\r\n  21: clap::builder::command::Command::try_get_matches_from\r\n             at /home/matklad/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-4.0.22/src/builder/command.rs:624:9\r\n  22: clap::builder::command::Command::try_get_matches\r\n             at /home/matklad/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-4.0.22/src/builder/command.rs:548:9\r\n  23: clap_clap::main\r\n             at ./src/main.rs:3:19\r\n  24: core::ops::function::FnOnce::call_once\r\n             at /rustc/e080cc5a659fb760c0bc561b722a790dad35b5e1/library/core/src/ops/function.rs:251:5\r\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\r\n```\r\n\r\n\r\nSeems pre-existing since clap 2.0",
    "clap-rs__clap-4465": "help for `help` says \"Print this message or the help of the given subcommand(s)\" but only takes one subcommand\nThe help text for the `help` subcommand says:\r\n```\r\n  help   Print this message or the help of the given subcommand(s)\r\n```\r\nThat phrasing makes it *sound* like `help` could show help for multiple subcommands at once (e.g. `cmd help subcmd1 subcmd2 subcmd3`). However, the `help` subcommand only takes one subcommand to show help for, not multiple. Given that, I think the help should be:\r\n```\r\n  help   Print this message or the help of the given subcommand\r\n```\r\n\r\nThe output of `help help` says:\r\n```\r\n  [COMMAND]...  The subcommand whose help message to display\r\n```\r\nWhich seems more correct: it says \"The subcommand\", singular.",
    "clap-rs__clap-4408": "Help text for `-h` is too long for two-column short help\n### Please complete the following tasks\n\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\n- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues\n\n### Rust Version\n\nrustc 1.64.0 (Fedora 1.64.0-1.fc36)\n\n### Clap Version\n\n4.0.17\n\n### Minimal reproducible code\n\n```rust\r\nuse clap::Parser;\r\n\r\n#[derive(Parser)]\r\npub struct Cmd {\r\n    /// Process an integer\r\n    ///\r\n    /// Convert an integer into a more pleasing format.\r\n    #[clap(long, value_name = \"INTEGER\")]\r\n    process_int: Option<i64>,\r\n\r\n    /// Process a string\r\n    ///\r\n    /// Convert an integer into a more pleasing format.\r\n    #[clap(long, value_name = \"STRING\")]\r\n    process_string: Option<String>,\r\n}\r\n\r\nfn main() {\r\n    Cmd::parse();\r\n}\r\n```\r\n\r\nCargo.toml:\r\n```toml\r\n[package]\r\nname = \"clap-help\"\r\nversion = \"0.0.0\"\r\nedition = \"2021\"\r\n\r\n[dependencies]\r\nclap = { version = \"4\", features = [\"derive\", \"wrap_help\"] }\r\n```\n\n### Steps to reproduce the bug with the above code\n\n```\r\ncargo run -- -h\r\n```\n\n### Actual Behaviour\n\nOn an 80-column terminal, short help uses multiple lines per option:\r\n\r\n```\r\nUsage: clap-help [OPTIONS]\r\n\r\nOptions:\r\n      --process-int <INTEGER>\r\n          Process an integer\r\n      --process-string <STRING>\r\n          Process a string\r\n  -h, --help\r\n          Print help information (use `--help` for more detail)\r\n```\n\n### Expected Behaviour\n\nShort help uses two-column format:\r\n\r\n```\r\nUsage: clap-help [OPTIONS]\r\n\r\nOptions:\r\n      --process-int <INTEGER>    Process an integer\r\n      --process-string <STRING>  Process a string\r\n  -h, --help                     Print help ('--help' for more)\r\n```\n\n### Additional Context\n\nApplications may want to constrain their short help to use the two-column format so the `-h` output is as compact as possible.  They might do this by optimizing short help texts to fit within the right-hand column on 80-character terminals, and then providing long help texts with more info.  However, #4159 made the short help text for `-h`/`--help` much longer when the short and long help are different, forcing short help to wrap to the multiple-line format if medium-sized option/value names are used.\r\n\r\nProposed fix in https://github.com/clap-rs/clap/pull/4408.\n\n### Debug Output\n\n_No response_",
    "clap-rs__clap-4248": "Return help message as String for Command\n### Please complete the following tasks\n\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\n- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues\n\n### Clap Version\n\n3.1.18\n\n### Describe your use case\n\nThe only way I could find to use the help message is to print out it to `Stdout`. In my use case I would like to get the help message as a String as I intend to not print it to `Stdout` directly.\n\n### Describe the solution you'd like\n\nA function that returns the help message as a String.\n\n### Alternatives, if applicable\n\n_No response_\n\n### Additional Context\n\n_No response_",
    "clap-rs__clap-4159": "Short/long help distinction seems unclear to the end-user\n    FLAGS:\n        -h, --help       Prints help information\n        -V, --version    Prints version information\n\nThis default help message, produced by `clap` version 2.25.1, seems to\nme to imply that `-h` and `--help` do the same thing, when they don't\nnecessarily. For [`Arg`]s defined with both `help` and `long_help`,\n`--help` may provide much more information than `-h`, but as far as I\ncan tell there is nothing to make the end-user aware of this, which\nseems problematic to me.\n\n[`Arg`]: <https://docs.rs/clap/2.25.1/clap/struct.Arg.html>\n\n\n",
    "clap-rs__clap-4151": "Don't collapse optional positional arguments into `[ARGS]` in the usage string\n### Rust Version\r\n\r\nrustc 1.15.0-nightly (daf8c1dfc 2016-12-05)\r\n\r\n### Affected Version of clap\r\n\r\n2.19.1\r\n\r\n### Expected Behavior Summary\r\n\r\nIf I have one required and two optional positional arguments, I expect the usage string to say:\r\n\r\n```\r\nUSAGE:\r\n    clap-test <FILE> [<WIDTH> [<HEIGHT>]]\r\n```\r\n\r\nto properly represent the order in which the arguments need to be given.\r\n\r\n### Actual Behavior Summary\r\n\r\nThe optional positional arguments are collapsed into a single `[ARGS]` placeholder, and I have to look at the `ARGS` block and know it tells me the required order.\r\n\r\n```\r\nUSAGE:\r\n    clap-test <FILE> [ARGS]\r\n\r\nFLAGS:\r\n        --help       Prints help information\r\n    -V, --version    Prints version information\r\n\r\nARGS:\r\n    <FILE>      the configuration file\r\n    <WIDTH>     texture width [default: 512]\r\n    <HEIGHT>    texture height [default: 512]\r\n```\r\n\r\n### Steps to Reproduce the issue\r\n\r\nRun the program with `--help`.\r\n\r\n### Sample Code or Link to Sample Code\r\n\r\n```rust\r\nextern crate clap;\r\nuse clap::{Arg, App};\r\n\r\nfn main() {\r\n    let matches = App::new(\"My  app\")\r\n        .version(\"0.1\")\r\n        .author(\"Me <me@ma.il>\")\r\n        .about(\"Does stuff\")\r\n        .arg(Arg::with_name(\"config\")\r\n             .value_name(\"FILE\")\r\n             .help(\"the configuration file\")\r\n             .required(true)\r\n             .takes_value(true)\r\n             .index(1))\r\n        .arg(Arg::with_name(\"width\")\r\n             .value_name(\"WIDTH\")\r\n             .help(\"texture width\")\r\n             .takes_value(true)\r\n             .default_value(\"512\")\r\n             .index(2))\r\n        .arg(Arg::with_name(\"height\")\r\n             .value_name(\"HEIGHT\")\r\n             .help(\"texture height\")\r\n             .takes_value(true)\r\n             .default_value(\"512\")\r\n             .index(3))\r\n        .get_matches();\r\n}\r\n```\r\n",
    "clap-rs__clap-4103": "Consider accepting a Cow instead of Into<&'b str> in App::about\nI find the signature of methods like [`App::about`](https://docs.rs/clap-v3/3.0.0-beta.1/clap_v3/struct.App.html#method.about) not super useful. It's probably fine when doing everything statically, because you could easily make sure that the string provided outlives the `App` object (because most of the time you have a 'static string anyway as everything is defined statically in the code). But consider the case where you'd want to add subcommands dynamically at runtime. It gets unnecessarily unwieldy now, in my opinion, because of the lifetime requirement.\r\n\r\nCouldn't you instead accept a `Cow<'b, str>`? This way, users that do something more dynamic would at least have the possibility to fudge that with a dynamic memory allocation at the call site, instead of doing some dance to make the generated string outlive the `App` object or even boxing the string up just to leak it.",
    "clap-rs__clap-4101": "Help subcommand argument should not have ellipsis\n### Please complete the following tasks\n\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\n- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues\n\n### Rust Version\n\nrustc 1.62.0 (a8314ef7d 2022-06-27)\n\n### Clap Version\n\n3.2.17\n\n### Minimal reproducible code\n\n```rust\r\nfn main() {\r\n    let app = clap::Command::new(\"app\").subcommand(clap::Command::new(\"sub\"));\r\n\r\n    app.get_matches_from([\"program\", \"help\", \"help\"]);\r\n}\r\n```\r\n\n\n### Steps to reproduce the bug with the above code\n\n`cargo run`\n\n### Actual Behaviour\n\nThe output is:\r\n```\r\nprogram-help \r\nPrint this message or the help of the given subcommand(s)\r\n\r\nUSAGE:\r\n    program help [SUBCOMMAND]...\r\n\r\nARGS:\r\n    <SUBCOMMAND>...    The subcommand whose help message to display\r\n```\r\nI believe it is incorrect to have the ellipsis after `[SUBCOMMAND]` and `<SUBCOMMAND>` because the value for the `help` subcommand can be specified at most once. \n\n### Expected Behaviour\n\nThe output should be:\r\n```\r\nprogram-help \r\nPrint this message or the help of the given subcommand(s)\r\n\r\nUSAGE:\r\n    program help [SUBCOMMAND]\r\n\r\nARGS:\r\n    <SUBCOMMAND>    The subcommand whose help message to display\r\n```\n\n### Additional Context\n\nI have a prepared a fix [here](https://github.com/patrick-gu/clap).\n\n### Debug Output\n\n```\r\n[      clap::builder::command]  Command::_do_parse\r\n[      clap::builder::command]  Command::_build: name=\"app\"\r\n[      clap::builder::command]  Command::_propagate:app\r\n[      clap::builder::command]  Command::_check_help_and_version: app\r\n[      clap::builder::command]  Command::_check_help_and_version: Removing generated version     \r\n[      clap::builder::command]  Command::_check_help_and_version: Building help subcommand       \r\n[      clap::builder::command]  Command::_propagate_global_args:app\r\n[      clap::builder::command]  Command::_propagate removing sub's help\r\n[      clap::builder::command]  Command::_propagate pushing help to sub\r\n[      clap::builder::command]  Command::_propagate removing help's help\r\n[      clap::builder::command]  Command::_propagate pushing help to help\r\n[      clap::builder::command]  Command::_derive_display_order:app\r\n[      clap::builder::command]  Command::_derive_display_order:sub\r\n[      clap::builder::command]  Command::_derive_display_order:help\r\n[clap::builder::debug_asserts]  Command::_debug_asserts\r\n[clap::builder::debug_asserts]  Arg::_debug_asserts:help\r\n[clap::builder::debug_asserts]  Command::_verify_positionals\r\n[        clap::parser::parser]  Parser::get_matches_with\r\n[        clap::parser::parser]  Parser::get_matches_with: Begin parsing 'RawOsStr(\"help\")' ([104, 101, 108, 112])\r\n[        clap::parser::parser]  Parser::possible_subcommand: arg=Ok(\"help\")\r\n[        clap::parser::parser]  Parser::get_matches_with: sc=Some(\"help\")\r\n[        clap::parser::parser]  Parser::parse_help_subcommand\r\n[         clap::output::usage]  Usage::get_required_usage_from: incls=[], matcher=false, incl_last=true\r\n[         clap::output::usage]  Usage::get_required_usage_from: unrolled_reqs={}\r\n[         clap::output::usage]  Usage::get_required_usage_from: ret_val={}\r\n[      clap::builder::command]  Command::_build_subcommand Setting bin_name of help to \"program help\"\r\n[      clap::builder::command]  Command::_build_subcommand Setting display_name of help to \"app-help\"\r\n[      clap::builder::command]  Command::_build: name=\"help\"\r\n[      clap::builder::command]  Command::_propagate:help\r\n[      clap::builder::command]  Command::_check_help_and_version: help\r\n[      clap::builder::command]  Command::_check_help_and_version: Removing generated help        \r\n[      clap::builder::command]  Command::_check_help_and_version: Removing generated version     \r\n[      clap::builder::command]  Command::_propagate_global_args:help\r\n[      clap::builder::command]  Command::_derive_display_order:help\r\n[clap::builder::debug_asserts]  Command::_debug_asserts\r\n[clap::builder::debug_asserts]  Arg::_debug_asserts:subcommand\r\n[clap::builder::debug_asserts]  Command::_verify_positionals\r\n[      clap::builder::command]  Command::use_long_help\r\n[      clap::builder::command]  Parser::write_help_err: use_long=false, stream=Stdout\r\n[      clap::builder::command]  Command::use_long_help\r\n[      clap::builder::command]  Command::color: Color setting...\r\n[      clap::builder::command]  Auto\r\n[          clap::output::help]  Help::new cmd=help, use_long=false\r\n[          clap::output::help]  Help::write_help\r\n[          clap::output::help]  should_show_arg: use_long=false, arg=subcommand\r\n[          clap::output::help]  Help::write_templated_help\r\n[          clap::output::help]  Help::write_before_help\r\n[          clap::output::help]  Help::write_bin_name\r\n[         clap::output::usage]  Usage::create_usage_no_title\r\n[         clap::output::usage]  Usage::create_help_usage; incl_reqs=true\r\n[         clap::output::usage]  Usage::get_required_usage_from: incls=[], matcher=false, incl_last=false\r\n[         clap::output::usage]  Usage::get_required_usage_from: unrolled_reqs={}\r\n[         clap::output::usage]  Usage::get_required_usage_from: ret_val={}\r\n[         clap::output::usage]  Usage::needs_options_tag\r\n[         clap::output::usage]  Usage::needs_options_tag: [OPTIONS] not required\r\n[         clap::output::usage]  Usage::get_args_tag; incl_reqs = true\r\n[         clap::output::usage]  Usage::get_args_tag:iter:subcommand\r\n[      clap::builder::command]  Command::groups_for_arg: id=subcommand\r\n[         clap::output::usage]  Usage::get_args_tag:iter: 1 Args not required or hidden\r\n[      clap::builder::command]  Command::groups_for_arg: id=subcommand\r\n[         clap::output::usage]  Usage::get_args_tag:iter: Exactly one, returning 'subcommand'    \r\n[          clap::builder::arg]  Arg::name_no_brackets:subcommand\r\n[          clap::builder::arg]  Arg::name_no_brackets: val_names=[\r\n    \"SUBCOMMAND\",\r\n]\r\n[         clap::output::usage]  Usage::create_help_usage: usage=program help [SUBCOMMAND]...     \r\n[          clap::output::help]  Help::write_all_args\r\n[          clap::output::help]  should_show_arg: use_long=false, arg=subcommand\r\n[          clap::output::help]  Help::write_args_unsorted\r\n[          clap::output::help]  should_show_arg: use_long=false, arg=subcommand\r\n[          clap::output::help]  Help::write_args_unsorted: arg=\"subcommand\" longest=15\r\n[          clap::output::help]  should_show_arg: use_long=false, arg=subcommand\r\n[          clap::output::help]  Help::spec_vals: a=<SUBCOMMAND>...\r\n[          clap::output::help]  Help::spec_vals: a=<SUBCOMMAND>...\r\n[          clap::output::help]  Help::short\r\n[          clap::output::help]  Help::long\r\n[          clap::output::help]  Help::val: arg=subcommand\r\n[          clap::output::help]  Help::align_to_about: arg=subcommand, next_line_help=false, longest=15\r\n[          clap::output::help]  Help::align_to_about: positional=true arg_len=15, spaces=4       \r\n[          clap::output::help]  Help::help\r\n[          clap::output::help]  Help::help: Next Line...false\r\n[          clap::output::help]  Help::help: Too long...\r\n[          clap::output::help]  No\r\n[          clap::output::help]  Help::write_after_help\r\n[      clap::builder::command]  Command::color: Color setting...\r\n[      clap::builder::command]  Auto\r\nprogram-help\r\nPrint this message or the help of the given subcommand(s)\r\n\r\nUSAGE:\r\n    program help [SUBCOMMAND]...\r\n\r\nARGS:\r\n    <SUBCOMMAND>...    The subcommand whose help message to display\r\n```",
    "clap-rs__clap-4081": "Loosen requirement on using `&[]` to pass into builder functions\n### Please complete the following tasks\n\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\n- [X] I have searched the existing issues\n\n### Rust Version\n\nrustc 1.53.0 (53cb7b09b 2021-06-17)\n\n### Clap Version\n\nv3.0.0-beta.4\n\n### Minimal reproducible code\n\nSee #2857\n\n### Steps to reproduce the bug with the above code\n\nSee #2857\n\n### Actual Behaviour\n\nBuilders only accept `&[]`\n\n### Expected Behaviour\n\nBuilders accept an `IntoIterator`\n\n### Additional Context\n\nPrior attempts\r\n- #2414 \r\n- #2857 \r\n\r\nIn #1041 I proposed we use `kstring` crate for our strings.  `kstring::KString` is like a `Cow<'static, str>` with small-string optimization.  This removes lifetimes from our types but more relevant to here, offers us more `Into` flexibility that makes it so we can trivial implement the API we want (see #2857 for some of the problems).\r\n\r\nBlocked on #1041\n\n### Debug Output\n\n_No response_",
    "clap-rs__clap-4080": "Iterating over `ArgMatches`\nMaintainer's notes\r\n- This is blocked on https://github.com/clap-rs/clap/issues/1041 / https://github.com/clap-rs/clap/issues/2150 where we move away from opaque, non-public `Id`s for arguments to something the user can programmatically act on\r\n\r\n---\r\n\r\nHi, I am using Clap in a little side project and I would like to suggest a minor feature. I am ready to implement it myself and send a PR if needed, I just need a few pointers. The feature at hand is an ordered iterator over `ArgMatches`: as far as my understanding goes, Clap doesn't allow to freely iterate over the parsed arguments. What if my application APIs are dependent upon the order of the arguments? GNU `find` comes to my mind. Calling `index_of` for every argument can be expensive if you have a lot of them.\r\n\r\nIf this feature were to be implemented, what would the return type and name of the method be?",
    "clap-rs__clap-4077": "Add completion support for `help` subcommand in all shells\nMaintainer's notes\r\n- Remember that you can do `cmd help sub1 sub2` which should be supported\r\n\r\n---\r\nSequoia's `sq` uses clap to generate bash bindings.\r\n\r\n`sq` has a subcommand interface, including the subcommand `help`.  `sq help` behaves the way that `sq --help` does.\r\n\r\nThat is, you can do `sq help inspect` (`inspect` is one of the `sq` subcommands).\r\n\r\nThe tab completion when a bash user types `sq help <TAB><TAB>` does *not* show the list of subcommands the way that `sq --help <TAB><TAB>` does.  Rather, it only shows the options like `-h`, `-V`, `--version`, etc. \r\n\r\nI [reported this concern to sequoia](https://gitlab.com/sequoia-pgp/sequoia/-/issues/656) and they indicated that it is a bug in clap.\r\n\r\n### Versions\r\n\r\n* **Rust**: 1.48.0\r\n* **Clap**: 2.33.3\r\n",
    "clap-rs__clap-4072": "ArgGroups values don't work well with get_many\nWhen adding args, we also add them to their groups in `ArgMatches` but with #3732, we fail if the group has disparate types.\r\n\r\nAs an aside, people are paying for this issue when most aren't using it (especially derive).\r\n\r\nWe should improve this situation",
    "clap-rs__clap-4059": "Inconsistent on inferring Help/Version action\nAs of at least #4056 in master, \r\n- `arg!(--help)` will implicitly get `ArgAction::Help`\r\n- `Arg::new(\"help\").long(\"help\")` will implicitly get `ArgAction::Help`\r\n- `#[clap(long)] help: bool` will implicitly get `ArgAction::SetTrue`\r\n\r\nQuestions\r\n- Should these all be consistent?\r\n- Which direction should these all go?\r\n\r\nConsiderations\r\n- Work for creating a help/version flag after #4056 \r\n- Ability to document default action behavior",
    "clap-rs__clap-4056": "Adding help alias modifies help command argument rendering?\nAdding `#[clap(mut_arg(\"help\", |arg| arg.short_alias('?')))]` changes the way the help command is rendered. See this diff: https://github.com/SUPERCILEX/ftzz/commit/6daf6aa7cc59b6c72a97ab34e3a76983691fee61. Seems like a bug that adding the alias makes the help command show up inside itself. Or not (as long as its consistent I don't mind).",
    "clap-rs__clap-4039": "Document external subcommands\n### Discussed in https://github.com/clap-rs/clap/discussions/3863\r\n\r\n<div type='discussions-op-text'>\r\n\r\n<sup>Originally posted by **cd-work** June 22, 2022</sup>\r\nI'd like to write an external subcommand that accepts any parameter and forwards it, however it should also still be documented as subcommand.\r\n\r\nI think this is probably a pretty common scenario, since you usually have some way to know which external subcommands are available even if you do not know their exact parameters. I do **not** want to allow just any subcommand, I have a list which I want to accept with generic parameters, everything else should still cause a failure.\r\n\r\nI've tried using `ignore_errors(true)`, but that only seems to work globally and not on the subcommands themselves. Otherwise it could be used to just accept parameters.\r\n\r\nI've also used various combinations of allowing hyphen values and multiple values, but none of them seem to allow for the first argument to have two hyphens.\r\n\r\nI only care about the subcommands documentation and description on the toplevel, since `bin subcommand --help` should already be forwarded to the subcommand and not handled by clap. This is also a scenario where built-in subcommands and flags exist already, so it's not **only** external subcommands I'm worried about.</div>",
    "clap-rs__clap-4032": "Remove magic arg type in `Args`\n### Discussed in https://github.com/clap-rs/clap/discussions/2674\r\n\r\n<div type='discussions-op-text'>\r\n\r\n<sup>Originally posted by **epage** August  9, 2021</sup>\r\n- `Arg::new()` creates a positional argument that `takes_value(true)`\r\n- `Args::new().long()` creates a named flag (`takes_value(false)`)\r\n- `Args::new().long().takes_value(true)` is required to created a named arg / option\r\n\r\nThis requires us to guess the users intent at various stages.  kbknapp  explained this when trying to explain existing challenges with `values` vs `occurrences`:\r\n\r\n> Keeping in mind that clap has some implied rules that at times contradict one-another in subtle ways. For example Arg::new effectively creates a positional value, i.e. an argument that accepts a single value with flags/switches. Adding either short or long actually removes the value, and turns it into a flag (i.e. switch with no associated value). Then adding takes_value (or any of the value associated methods) implicitly turns it into an option (combined flag/switch with an associated value), so giving it a value again.\r\n> \r\n> Because of how these rules/settings combine, it turns out there are multiple ways to end up at the same final product; some just more explicit while others passively allow the rules to combine. As in the Arg::new example above, that's all that's required to create a positional argument, but doing Arg::new(\"foo\").takes_value(true).index(1) works just as well.\r\n> \r\n> Because of this, clap sometimes has to infer if the user meant to allow the rules to combine. This primarily comes out around the multiple values/occurrences. In other words clap has a default state for many of the settings, and we need to ensure that when a user only sets one (or a few) settings the remaining defaults don't combine to do something surprising.\r\n\r\nI'm even running into a problem I'm debugging for #751 that I think comes from this.\r\n\r\nJust a small tweak would make clap less brittle for change and I believe make the user experience better, if we switch to\r\n- `Arg::new()` creates a positional argument that `takes_value(true)`\r\n- `Args::new().long()` creates a named arg / option (ie `takes_value(true)`)\r\n- `Args::new().long().takes_value(false)` is required to created a flag\r\n\r\n@kbknapp was open to changing this, though with a different approach (this was before clarifying the approach above, see below for his thoughts on each approach)\r\n\r\n> I\u2019m not against removing changing the default behavior of Arg::new, the only reason it hasn\u2019t been done before is the only other sensible thing to do (IMO) is to have Arg::new result in a \u201cuseless\u201d argument,  Further methods would be required to determine this. This would accomplish what you\u2019re speaking about, and solve a few of the issues related to ambiguities. The only reason I didn\u2019t do that before, was I tend to lean towards a contractor should at least make the struct usable to some extent\u2026but I can see how in this case that may not be the case.\r\n\r\nWe could fix the \"always valid object\" problem by instead making some helper constructors (`positional`, `flag`, and `option` where the latter take long names since 99% of the time, they are used)\r\n\r\nBetween flag-opt-in and construct invalid options (I didn't bring up the named constructors), kbknapp said\r\n\r\n> I think it's almost 50/50 as to which route would be preferred. Opt-in to a flag (takes_value(false)) I think really only has the downside of being different from v2 causing (minimal) churn in that those that currently have Arg::new().long() would auto-magically have all their flags turn into options unless they go in and add takes_value(false) to them all. Whereas the I believe the number of users who are using Arg::new and no other \"value based\" methods and just relying on it being a positional are few and far between, so less churn. But again, I'm somewhat 50/50 as to which I think is \"better\" so to speak.</div>",
    "clap-rs__clap-4006": "Argument that requires another argument in an argument group gives empty error\n### Please complete the following tasks\r\n\r\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\r\n- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues\r\n\r\n### Rust Version\r\n\r\nrustc 1.64.0-nightly (9067d5277 2022-07-28)\r\n\r\n### Clap Version\r\n\r\n3.2.15\r\n\r\n### Minimal reproducible code\r\n\r\n```rust\r\nuse clap::{ArgGroup, Parser};\r\n\r\n#[derive(Parser, Debug)]\r\n#[clap(author, version, about, long_about = None)]\r\n#[clap(group(ArgGroup::new(\"either_or_both\").multiple(true).required(true).args(&[\"first\", \"second\"])))]\r\nstruct Args {\r\n    #[clap(short, long, requires(\"first\"))]\r\n    require_first: bool,\r\n    #[clap(short, long)]\r\n    first: bool,\r\n    #[clap(short, long)]\r\n    second: bool,\r\n}\r\nfn main() {\r\n    let args: Args = Args::parse();\r\n\r\n    dbg!(args);\r\n}\r\n```\r\n\r\n\r\n### Steps to reproduce the bug with the above code\r\n\r\n`cargo run -- --require-first --second`\r\n\r\n### Actual Behaviour\r\n\r\n```\r\nerror: The following required arguments were not provided:\r\n\r\nUSAGE:\r\n    clap_example --require-first <--first|--second>\r\n\r\nFor more information try --help\r\n```\r\n\r\n### Expected Behaviour\r\n\r\nError message should provide context, e.g.\r\n```\r\nerror: The following required arguments were not provided:\r\n    --first\r\n\r\nUSAGE:\r\n    clap_example --require-first <--first|--second>\r\n\r\nFor more information try --help\r\n```\r\n\r\n### Additional Context\r\n\r\nRemoving the `multiple(true)` part unintuitively works:\r\n```\r\n[src/main.rs:17] args = Args {\r\n    require_first: true,\r\n    first: false,\r\n    second: true,\r\n}\r\n```\r\nThis leads me to believe I'm probably misusing `ArgGroup` in this case, however the error message should still say _something_ IMO.\r\n\r\n### Debug Output\r\n\r\n```\r\n[      clap::builder::command] \tCommand::_do_parse\r\n[      clap::builder::command] \tCommand::_build: name=\"clap_example\"\r\n[      clap::builder::command] \tCommand::_propagate:clap_example\r\n[      clap::builder::command] \tCommand::_check_help_and_version: clap_example\r\n[      clap::builder::command] \tCommand::_propagate_global_args:clap_example\r\n[      clap::builder::command] \tCommand::_derive_display_order:clap_example\r\n[clap::builder::debug_asserts] \tCommand::_debug_asserts\r\n[clap::builder::debug_asserts] \tArg::_debug_asserts:help\r\n[clap::builder::debug_asserts] \tArg::_debug_asserts:version\r\n[clap::builder::debug_asserts] \tArg::_debug_asserts:require-first\r\n[clap::builder::debug_asserts] \tArg::_debug_asserts:first\r\n[clap::builder::debug_asserts] \tArg::_debug_asserts:second\r\n[clap::builder::debug_asserts] \tCommand::_verify_positionals\r\n[        clap::parser::parser] \tParser::get_matches_with\r\n[        clap::parser::parser] \tParser::get_matches_with: Begin parsing 'RawOsStr(\"--require-first\")' ([45, 45, 114, 101, 113, 117, 105, 114, 101, 45, 102, 105, 114, 115, 116])\r\n[        clap::parser::parser] \tParser::possible_subcommand: arg=Ok(\"--require-first\")\r\n[        clap::parser::parser] \tParser::get_matches_with: sc=None\r\n[        clap::parser::parser] \tParser::parse_long_arg\r\n[        clap::parser::parser] \tParser::parse_long_arg: Does it contain '='...\r\n[        clap::parser::parser] \tParser::parse_long_arg: Found valid arg or flag '--require-first'\r\n[        clap::parser::parser] \tParser::parse_long_arg(\"require-first\"): Presence validated\r\n[        clap::parser::parser] \tParser::react action=IncOccurrence, identifier=Some(Long), source=CommandLine\r\n[        clap::parser::parser] \tParser::react: cur_idx:=1\r\n[        clap::parser::parser] \tParser::remove_overrides: id=require-first\r\n[   clap::parser::arg_matcher] \tArgMatcher::start_occurrence_of_arg: id=require-first\r\n[      clap::builder::command] \tCommand::groups_for_arg: id=require-first\r\n[        clap::parser::parser] \tParser::get_matches_with: After parse_long_arg ValuesDone\r\n[        clap::parser::parser] \tParser::get_matches_with: Begin parsing 'RawOsStr(\"--second\")' ([45, 45, 115, 101, 99, 111, 110, 100])\r\n[        clap::parser::parser] \tParser::possible_subcommand: arg=Ok(\"--second\")\r\n[        clap::parser::parser] \tParser::get_matches_with: sc=None\r\n[        clap::parser::parser] \tParser::parse_long_arg\r\n[        clap::parser::parser] \tParser::parse_long_arg: Does it contain '='...\r\n[        clap::parser::parser] \tParser::parse_long_arg: Found valid arg or flag '--second'\r\n[        clap::parser::parser] \tParser::parse_long_arg(\"second\"): Presence validated\r\n[        clap::parser::parser] \tParser::react action=IncOccurrence, identifier=Some(Long), source=CommandLine\r\n[        clap::parser::parser] \tParser::react: cur_idx:=2\r\n[        clap::parser::parser] \tParser::remove_overrides: id=second\r\n[   clap::parser::arg_matcher] \tArgMatcher::start_occurrence_of_arg: id=second\r\n[      clap::builder::command] \tCommand::groups_for_arg: id=second\r\n[   clap::parser::arg_matcher] \tArgMatcher::start_occurrence_of_group: id=either_or_both\r\n[        clap::parser::parser] \tParser::get_matches_with: After parse_long_arg ValuesDone\r\n[        clap::parser::parser] \tParser::add_defaults\r\n[        clap::parser::parser] \tParser::add_defaults:iter:help:\r\n[        clap::parser::parser] \tParser::add_default_value:iter:help: doesn't have default missing vals\r\n[        clap::parser::parser] \tParser::add_default_value: doesn't have conditional defaults\r\n[        clap::parser::parser] \tParser::add_default_value:iter:help: doesn't have default vals\r\n[        clap::parser::parser] \tParser::add_defaults:iter:version:\r\n[        clap::parser::parser] \tParser::add_default_value:iter:version: doesn't have default missing vals\r\n[        clap::parser::parser] \tParser::add_default_value: doesn't have conditional defaults\r\n[        clap::parser::parser] \tParser::add_default_value:iter:version: doesn't have default vals\r\n[        clap::parser::parser] \tParser::add_defaults:iter:require-first:\r\n[        clap::parser::parser] \tParser::add_default_value:iter:require-first: doesn't have default missing vals\r\n[        clap::parser::parser] \tParser::add_default_value: doesn't have conditional defaults\r\n[        clap::parser::parser] \tParser::add_default_value:iter:require-first: doesn't have default vals\r\n[        clap::parser::parser] \tParser::add_defaults:iter:first:\r\n[        clap::parser::parser] \tParser::add_default_value:iter:first: doesn't have default missing vals\r\n[        clap::parser::parser] \tParser::add_default_value: doesn't have conditional defaults\r\n[        clap::parser::parser] \tParser::add_default_value:iter:first: doesn't have default vals\r\n[        clap::parser::parser] \tParser::add_defaults:iter:second:\r\n[        clap::parser::parser] \tParser::add_default_value:iter:second: doesn't have default missing vals\r\n[        clap::parser::parser] \tParser::add_default_value: doesn't have conditional defaults\r\n[        clap::parser::parser] \tParser::add_default_value:iter:second: doesn't have default vals\r\n[     clap::parser::validator] \tValidator::validate\r\n[     clap::parser::validator] \tValidator::validate_conflicts\r\n[     clap::parser::validator] \tValidator::validate_exclusive\r\n[     clap::parser::validator] \tValidator::validate_exclusive:iter:require-first\r\n[     clap::parser::validator] \tValidator::validate_exclusive:iter:second\r\n[     clap::parser::validator] \tValidator::validate_exclusive:iter:either_or_both\r\n[     clap::parser::validator] \tValidator::validate_conflicts::iter: id=require-first\r\n[     clap::parser::validator] \tConflicts::gather_conflicts: arg=require-first\r\n[      clap::builder::command] \tCommand::groups_for_arg: id=require-first\r\n[     clap::parser::validator] \tConflicts::gather_direct_conflicts id=require-first, conflicts=[]\r\n[      clap::builder::command] \tCommand::groups_for_arg: id=second\r\n[     clap::parser::validator] \tConflicts::gather_direct_conflicts id=second, conflicts=[]\r\n[     clap::parser::validator] \tConflicts::gather_direct_conflicts id=either_or_both, conflicts=[]\r\n[     clap::parser::validator] \tConflicts::gather_conflicts: conflicts=[]\r\n[     clap::parser::validator] \tValidator::validate_conflicts::iter: id=second\r\n[     clap::parser::validator] \tConflicts::gather_conflicts: arg=second\r\n[     clap::parser::validator] \tConflicts::gather_conflicts: conflicts=[]\r\n[     clap::parser::validator] \tValidator::validate_required: required=ChildGraph([Child { id: either_or_both, children: [] }])\r\n[     clap::parser::validator] \tValidator::gather_requires\r\n[     clap::parser::validator] \tValidator::gather_requires:iter:require-first\r\n[     clap::parser::validator] \tValidator::gather_requires:iter:second\r\n[     clap::parser::validator] \tValidator::gather_requires:iter:either_or_both\r\n[     clap::parser::validator] \tValidator::gather_requires:iter:either_or_both:group\r\n[     clap::parser::validator] \tValidator::validate_required: is_exclusive_present=false\r\n[     clap::parser::validator] \tValidator::validate_required:iter:aog=first\r\n[     clap::parser::validator] \tValidator::validate_required:iter: This is an arg\r\n[     clap::parser::validator] \tValidator::is_missing_required_ok: first\r\n[     clap::parser::validator] \tConflicts::gather_conflicts: arg=first\r\n[      clap::builder::command] \tCommand::groups_for_arg: id=first\r\n[     clap::parser::validator] \tConflicts::gather_direct_conflicts id=first, conflicts=[]\r\n[     clap::parser::validator] \tConflicts::gather_conflicts: conflicts=[]\r\n[     clap::parser::validator] \tValidator::missing_required_error; incl=[]\r\n[     clap::parser::validator] \tValidator::missing_required_error: reqs=ChildGraph([Child { id: either_or_both, children: [] }, Child { id: first, children: [] }])\r\n[         clap::output::usage] \tUsage::get_required_usage_from: incls=[], matcher=true, incl_last=true\r\n[         clap::output::usage] \tUsage::get_required_usage_from: unrolled_reqs={either_or_both, first}\r\n[      clap::builder::command] \tCommand::unroll_args_in_group: group=either_or_both\r\n[      clap::builder::command] \tCommand::unroll_args_in_group:iter: entity=first\r\n[      clap::builder::command] \tCommand::unroll_args_in_group:iter: this is an arg\r\n[      clap::builder::command] \tCommand::unroll_args_in_group:iter: entity=second\r\n[      clap::builder::command] \tCommand::unroll_args_in_group:iter: this is an arg\r\n[      clap::builder::command] \tCommand::unroll_args_in_group: group=either_or_both\r\n[      clap::builder::command] \tCommand::unroll_args_in_group:iter: entity=first\r\n[      clap::builder::command] \tCommand::unroll_args_in_group:iter: this is an arg\r\n[      clap::builder::command] \tCommand::unroll_args_in_group:iter: entity=second\r\n[      clap::builder::command] \tCommand::unroll_args_in_group:iter: this is an arg\r\n[         clap::output::usage] \tUsage::get_required_usage_from: ret_val={}\r\n[     clap::parser::validator] \tValidator::missing_required_error: req_args=[]\r\n[         clap::output::usage] \tUsage::create_usage_with_title\r\n[         clap::output::usage] \tUsage::create_usage_no_title\r\n[         clap::output::usage] \tUsage::create_smart_usage\r\n[         clap::output::usage] \tUsage::get_required_usage_from: incls=[require-first, second, either_or_both], matcher=false, incl_last=true\r\n[         clap::output::usage] \tUsage::get_required_usage_from: unrolled_reqs={either_or_both, first}\r\n[      clap::builder::command] \tCommand::unroll_args_in_group: group=either_or_both\r\n[      clap::builder::command] \tCommand::unroll_args_in_group:iter: entity=first\r\n[      clap::builder::command] \tCommand::unroll_args_in_group:iter: this is an arg\r\n[      clap::builder::command] \tCommand::unroll_args_in_group:iter: entity=second\r\n[      clap::builder::command] \tCommand::unroll_args_in_group:iter: this is an arg\r\n[         clap::output::usage] \tUsage::get_required_usage_from:iter:require-first\r\n[      clap::builder::command] \tCommand::unroll_args_in_group: group=either_or_both\r\n[      clap::builder::command] \tCommand::unroll_args_in_group:iter: entity=first\r\n[      clap::builder::command] \tCommand::unroll_args_in_group:iter: this is an arg\r\n[      clap::builder::command] \tCommand::unroll_args_in_group:iter: entity=second\r\n[      clap::builder::command] \tCommand::unroll_args_in_group:iter: this is an arg\r\n[         clap::output::usage] \tUsage::get_required_usage_from: ret_val={\"--require-first\", \"<--first|--second>\"}\r\n[      clap::builder::command] \tCommand::color: Color setting...\r\n[      clap::builder::command] \tAuto\r\nerror: The following required arguments were not provided:\r\n\r\nUSAGE:\r\n    clap_example --require-first <--first|--second>\r\n\r\nFor more information try --help\r\n```",
    "clap-rs__clap-4005": "Argument that requires another argument in an argument group gives empty error\n### Please complete the following tasks\r\n\r\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\r\n- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues\r\n\r\n### Rust Version\r\n\r\nrustc 1.64.0-nightly (9067d5277 2022-07-28)\r\n\r\n### Clap Version\r\n\r\n3.2.15\r\n\r\n### Minimal reproducible code\r\n\r\n```rust\r\nuse clap::{ArgGroup, Parser};\r\n\r\n#[derive(Parser, Debug)]\r\n#[clap(author, version, about, long_about = None)]\r\n#[clap(group(ArgGroup::new(\"either_or_both\").multiple(true).required(true).args(&[\"first\", \"second\"])))]\r\nstruct Args {\r\n    #[clap(short, long, requires(\"first\"))]\r\n    require_first: bool,\r\n    #[clap(short, long)]\r\n    first: bool,\r\n    #[clap(short, long)]\r\n    second: bool,\r\n}\r\nfn main() {\r\n    let args: Args = Args::parse();\r\n\r\n    dbg!(args);\r\n}\r\n```\r\n\r\n\r\n### Steps to reproduce the bug with the above code\r\n\r\n`cargo run -- --require-first --second`\r\n\r\n### Actual Behaviour\r\n\r\n```\r\nerror: The following required arguments were not provided:\r\n\r\nUSAGE:\r\n    clap_example --require-first <--first|--second>\r\n\r\nFor more information try --help\r\n```\r\n\r\n### Expected Behaviour\r\n\r\nError message should provide context, e.g.\r\n```\r\nerror: The following required arguments were not provided:\r\n    --first\r\n\r\nUSAGE:\r\n    clap_example --require-first <--first|--second>\r\n\r\nFor more information try --help\r\n```\r\n\r\n### Additional Context\r\n\r\nRemoving the `multiple(true)` part unintuitively works:\r\n```\r\n[src/main.rs:17] args = Args {\r\n    require_first: true,\r\n    first: false,\r\n    second: true,\r\n}\r\n```\r\nThis leads me to believe I'm probably misusing `ArgGroup` in this case, however the error message should still say _something_ IMO.\r\n\r\n### Debug Output\r\n\r\n```\r\n[      clap::builder::command] \tCommand::_do_parse\r\n[      clap::builder::command] \tCommand::_build: name=\"clap_example\"\r\n[      clap::builder::command] \tCommand::_propagate:clap_example\r\n[      clap::builder::command] \tCommand::_check_help_and_version: clap_example\r\n[      clap::builder::command] \tCommand::_propagate_global_args:clap_example\r\n[      clap::builder::command] \tCommand::_derive_display_order:clap_example\r\n[clap::builder::debug_asserts] \tCommand::_debug_asserts\r\n[clap::builder::debug_asserts] \tArg::_debug_asserts:help\r\n[clap::builder::debug_asserts] \tArg::_debug_asserts:version\r\n[clap::builder::debug_asserts] \tArg::_debug_asserts:require-first\r\n[clap::builder::debug_asserts] \tArg::_debug_asserts:first\r\n[clap::builder::debug_asserts] \tArg::_debug_asserts:second\r\n[clap::builder::debug_asserts] \tCommand::_verify_positionals\r\n[        clap::parser::parser] \tParser::get_matches_with\r\n[        clap::parser::parser] \tParser::get_matches_with: Begin parsing 'RawOsStr(\"--require-first\")' ([45, 45, 114, 101, 113, 117, 105, 114, 101, 45, 102, 105, 114, 115, 116])\r\n[        clap::parser::parser] \tParser::possible_subcommand: arg=Ok(\"--require-first\")\r\n[        clap::parser::parser] \tParser::get_matches_with: sc=None\r\n[        clap::parser::parser] \tParser::parse_long_arg\r\n[        clap::parser::parser] \tParser::parse_long_arg: Does it contain '='...\r\n[        clap::parser::parser] \tParser::parse_long_arg: Found valid arg or flag '--require-first'\r\n[        clap::parser::parser] \tParser::parse_long_arg(\"require-first\"): Presence validated\r\n[        clap::parser::parser] \tParser::react action=IncOccurrence, identifier=Some(Long), source=CommandLine\r\n[        clap::parser::parser] \tParser::react: cur_idx:=1\r\n[        clap::parser::parser] \tParser::remove_overrides: id=require-first\r\n[   clap::parser::arg_matcher] \tArgMatcher::start_occurrence_of_arg: id=require-first\r\n[      clap::builder::command] \tCommand::groups_for_arg: id=require-first\r\n[        clap::parser::parser] \tParser::get_matches_with: After parse_long_arg ValuesDone\r\n[        clap::parser::parser] \tParser::get_matches_with: Begin parsing 'RawOsStr(\"--second\")' ([45, 45, 115, 101, 99, 111, 110, 100])\r\n[        clap::parser::parser] \tParser::possible_subcommand: arg=Ok(\"--second\")\r\n[        clap::parser::parser] \tParser::get_matches_with: sc=None\r\n[        clap::parser::parser] \tParser::parse_long_arg\r\n[        clap::parser::parser] \tParser::parse_long_arg: Does it contain '='...\r\n[        clap::parser::parser] \tParser::parse_long_arg: Found valid arg or flag '--second'\r\n[        clap::parser::parser] \tParser::parse_long_arg(\"second\"): Presence validated\r\n[        clap::parser::parser] \tParser::react action=IncOccurrence, identifier=Some(Long), source=CommandLine\r\n[        clap::parser::parser] \tParser::react: cur_idx:=2\r\n[        clap::parser::parser] \tParser::remove_overrides: id=second\r\n[   clap::parser::arg_matcher] \tArgMatcher::start_occurrence_of_arg: id=second\r\n[      clap::builder::command] \tCommand::groups_for_arg: id=second\r\n[   clap::parser::arg_matcher] \tArgMatcher::start_occurrence_of_group: id=either_or_both\r\n[        clap::parser::parser] \tParser::get_matches_with: After parse_long_arg ValuesDone\r\n[        clap::parser::parser] \tParser::add_defaults\r\n[        clap::parser::parser] \tParser::add_defaults:iter:help:\r\n[        clap::parser::parser] \tParser::add_default_value:iter:help: doesn't have default missing vals\r\n[        clap::parser::parser] \tParser::add_default_value: doesn't have conditional defaults\r\n[        clap::parser::parser] \tParser::add_default_value:iter:help: doesn't have default vals\r\n[        clap::parser::parser] \tParser::add_defaults:iter:version:\r\n[        clap::parser::parser] \tParser::add_default_value:iter:version: doesn't have default missing vals\r\n[        clap::parser::parser] \tParser::add_default_value: doesn't have conditional defaults\r\n[        clap::parser::parser] \tParser::add_default_value:iter:version: doesn't have default vals\r\n[        clap::parser::parser] \tParser::add_defaults:iter:require-first:\r\n[        clap::parser::parser] \tParser::add_default_value:iter:require-first: doesn't have default missing vals\r\n[        clap::parser::parser] \tParser::add_default_value: doesn't have conditional defaults\r\n[        clap::parser::parser] \tParser::add_default_value:iter:require-first: doesn't have default vals\r\n[        clap::parser::parser] \tParser::add_defaults:iter:first:\r\n[        clap::parser::parser] \tParser::add_default_value:iter:first: doesn't have default missing vals\r\n[        clap::parser::parser] \tParser::add_default_value: doesn't have conditional defaults\r\n[        clap::parser::parser] \tParser::add_default_value:iter:first: doesn't have default vals\r\n[        clap::parser::parser] \tParser::add_defaults:iter:second:\r\n[        clap::parser::parser] \tParser::add_default_value:iter:second: doesn't have default missing vals\r\n[        clap::parser::parser] \tParser::add_default_value: doesn't have conditional defaults\r\n[        clap::parser::parser] \tParser::add_default_value:iter:second: doesn't have default vals\r\n[     clap::parser::validator] \tValidator::validate\r\n[     clap::parser::validator] \tValidator::validate_conflicts\r\n[     clap::parser::validator] \tValidator::validate_exclusive\r\n[     clap::parser::validator] \tValidator::validate_exclusive:iter:require-first\r\n[     clap::parser::validator] \tValidator::validate_exclusive:iter:second\r\n[     clap::parser::validator] \tValidator::validate_exclusive:iter:either_or_both\r\n[     clap::parser::validator] \tValidator::validate_conflicts::iter: id=require-first\r\n[     clap::parser::validator] \tConflicts::gather_conflicts: arg=require-first\r\n[      clap::builder::command] \tCommand::groups_for_arg: id=require-first\r\n[     clap::parser::validator] \tConflicts::gather_direct_conflicts id=require-first, conflicts=[]\r\n[      clap::builder::command] \tCommand::groups_for_arg: id=second\r\n[     clap::parser::validator] \tConflicts::gather_direct_conflicts id=second, conflicts=[]\r\n[     clap::parser::validator] \tConflicts::gather_direct_conflicts id=either_or_both, conflicts=[]\r\n[     clap::parser::validator] \tConflicts::gather_conflicts: conflicts=[]\r\n[     clap::parser::validator] \tValidator::validate_conflicts::iter: id=second\r\n[     clap::parser::validator] \tConflicts::gather_conflicts: arg=second\r\n[     clap::parser::validator] \tConflicts::gather_conflicts: conflicts=[]\r\n[     clap::parser::validator] \tValidator::validate_required: required=ChildGraph([Child { id: either_or_both, children: [] }])\r\n[     clap::parser::validator] \tValidator::gather_requires\r\n[     clap::parser::validator] \tValidator::gather_requires:iter:require-first\r\n[     clap::parser::validator] \tValidator::gather_requires:iter:second\r\n[     clap::parser::validator] \tValidator::gather_requires:iter:either_or_both\r\n[     clap::parser::validator] \tValidator::gather_requires:iter:either_or_both:group\r\n[     clap::parser::validator] \tValidator::validate_required: is_exclusive_present=false\r\n[     clap::parser::validator] \tValidator::validate_required:iter:aog=first\r\n[     clap::parser::validator] \tValidator::validate_required:iter: This is an arg\r\n[     clap::parser::validator] \tValidator::is_missing_required_ok: first\r\n[     clap::parser::validator] \tConflicts::gather_conflicts: arg=first\r\n[      clap::builder::command] \tCommand::groups_for_arg: id=first\r\n[     clap::parser::validator] \tConflicts::gather_direct_conflicts id=first, conflicts=[]\r\n[     clap::parser::validator] \tConflicts::gather_conflicts: conflicts=[]\r\n[     clap::parser::validator] \tValidator::missing_required_error; incl=[]\r\n[     clap::parser::validator] \tValidator::missing_required_error: reqs=ChildGraph([Child { id: either_or_both, children: [] }, Child { id: first, children: [] }])\r\n[         clap::output::usage] \tUsage::get_required_usage_from: incls=[], matcher=true, incl_last=true\r\n[         clap::output::usage] \tUsage::get_required_usage_from: unrolled_reqs={either_or_both, first}\r\n[      clap::builder::command] \tCommand::unroll_args_in_group: group=either_or_both\r\n[      clap::builder::command] \tCommand::unroll_args_in_group:iter: entity=first\r\n[      clap::builder::command] \tCommand::unroll_args_in_group:iter: this is an arg\r\n[      clap::builder::command] \tCommand::unroll_args_in_group:iter: entity=second\r\n[      clap::builder::command] \tCommand::unroll_args_in_group:iter: this is an arg\r\n[      clap::builder::command] \tCommand::unroll_args_in_group: group=either_or_both\r\n[      clap::builder::command] \tCommand::unroll_args_in_group:iter: entity=first\r\n[      clap::builder::command] \tCommand::unroll_args_in_group:iter: this is an arg\r\n[      clap::builder::command] \tCommand::unroll_args_in_group:iter: entity=second\r\n[      clap::builder::command] \tCommand::unroll_args_in_group:iter: this is an arg\r\n[         clap::output::usage] \tUsage::get_required_usage_from: ret_val={}\r\n[     clap::parser::validator] \tValidator::missing_required_error: req_args=[]\r\n[         clap::output::usage] \tUsage::create_usage_with_title\r\n[         clap::output::usage] \tUsage::create_usage_no_title\r\n[         clap::output::usage] \tUsage::create_smart_usage\r\n[         clap::output::usage] \tUsage::get_required_usage_from: incls=[require-first, second, either_or_both], matcher=false, incl_last=true\r\n[         clap::output::usage] \tUsage::get_required_usage_from: unrolled_reqs={either_or_both, first}\r\n[      clap::builder::command] \tCommand::unroll_args_in_group: group=either_or_both\r\n[      clap::builder::command] \tCommand::unroll_args_in_group:iter: entity=first\r\n[      clap::builder::command] \tCommand::unroll_args_in_group:iter: this is an arg\r\n[      clap::builder::command] \tCommand::unroll_args_in_group:iter: entity=second\r\n[      clap::builder::command] \tCommand::unroll_args_in_group:iter: this is an arg\r\n[         clap::output::usage] \tUsage::get_required_usage_from:iter:require-first\r\n[      clap::builder::command] \tCommand::unroll_args_in_group: group=either_or_both\r\n[      clap::builder::command] \tCommand::unroll_args_in_group:iter: entity=first\r\n[      clap::builder::command] \tCommand::unroll_args_in_group:iter: this is an arg\r\n[      clap::builder::command] \tCommand::unroll_args_in_group:iter: entity=second\r\n[      clap::builder::command] \tCommand::unroll_args_in_group:iter: this is an arg\r\n[         clap::output::usage] \tUsage::get_required_usage_from: ret_val={\"--require-first\", \"<--first|--second>\"}\r\n[      clap::builder::command] \tCommand::color: Color setting...\r\n[      clap::builder::command] \tAuto\r\nerror: The following required arguments were not provided:\r\n\r\nUSAGE:\r\n    clap_example --require-first <--first|--second>\r\n\r\nFor more information try --help\r\n```",
    "clap-rs__clap-3990": "Setting external subcommand type is inconsistent with args\n### Please complete the following tasks\n\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\n- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues\n\n### Rust Version\n\nrustc 1.57.0 (f1edd0429 2021-11-29)\n\n### Clap Version\n\nmaster\n\n### Minimal reproducible code\n\n`arg.value_parser(clap::value_parser!(OsString))`\r\n\r\nvs\r\n\r\n`cmd.allow_invalid_utf8_for_external_subcommands(true)`\n\n### Steps to reproduce the bug with the above code\n\nBuild code around it\n\n### Actual Behaviour\n\nInconsistent\n\n### Expected Behaviour\n\nBeing able to set a `ValueParser` for external subcommands\n\n### Additional Context\n\nThe `PartialEq` requirement on commands is what held this back from being in #3732\n\n### Debug Output\n\n_No response_",
    "clap-rs__clap-3989": "Duplicating a subcommand name as a subcommand alias is not prevented\nThe following should panic in a debug assert but doesn't.  It should mirror the asserts for duplicate flags\r\n```rust\r\n#!/usr/bin/env -S rust-script --debug\r\n\r\n//! ```cargo\r\n//! [dependencies]\r\n//! clap = { path = \"../clap\", features = [\"env\", \"derive\"] }\r\n//! ```\r\n\r\nfn main() {\r\n    let mut cmd = clap::Command::new(\"myprog\")\r\n        .subcommand(clap::Command::new(\"foo\"))\r\n        .subcommand(clap::Command::new(\"bar\").alias(\"foo\"));\r\n    cmd.build();\r\n}\r\n```",
    "clap-rs__clap-3975": "Builder and `clap_derive` should be WYSIWYG\n### Rust Version\r\n\r\n1.55.0\r\n\r\n### Affected Version of clap\r\n\r\nv3.0.0-beta.4\r\n\r\n### Expected Behavior Summary\r\n\r\nArgs are ordered as I declare them\r\n\r\n### Actual Behavior Summary\r\n\r\nArgs are sorted, without any exception (exceptions are common)\r\n\r\n### Context\r\n\r\n`DeriveDisplayOrder` is a [very popular flag to turn on](https://github.com/clap-rs/clap/discussions/2627#discussion-3478195).  When further researching this, [it is popular across CLIs and even when args are sorted, its one manually to allow exceptions](https://github.com/clap-rs/clap/discussions/2627#discussioncomment-1120949).\r\n\r\n`rg` is one major exception for this\r\n> I don't enable `DeriveDisplayOrder` because I do actually want everything to be alphabetical. See [group command line args into affected processing steps BurntSushi/ripgrep#1814](https://github.com/BurntSushi/ripgrep/issues/1814) and [organized flags in man page according to logical section? BurntSushi/ripgrep#1022](https://github.com/BurntSushi/ripgrep/issues/1022) for more details.\r\n\r\nI chalk this up to `rg` being an exceptional case in its scope and design and being limited by clap2's lack of `help_heading`.\r\n\r\n#### Trade offs\r\n\r\nCurrent Sorting Implementation\r\n- Strengths\r\n  - Immediate polish for quick and dirty programs\r\n  - Maintainable polish with large CLIs that have no good sort order and can't use `help_heading` (ie `rg`)\r\n- Weaknesses\r\n  - Doesn't group `--no-` flags with their positive versions\r\n  - Sorts all, even `--help` and `--version` which are generally left unsorted\r\n\r\nDeriving Order\r\n- Easily discoverable path to both behaviors (can manually sort without finding the Setting)\r\n  - Except when composing CLIs, like with `#[clap(flatten)]`\r\n- Commonly what is expected\r\n\r\n#### Survey of CLIs\r\n\r\nSorted\r\n- `rg`\r\n  - sort order is always respected, even for `--help` and `--version` (uses clap, author confirmed its intentional)\r\n- `tokei`\r\n  - sort order is always respected, even for `--help` and `--version` (uses clap)\r\n- gnu `ls`\r\n  - sort order is broken for `--help` / `--version`\r\n- gnu `df`\r\n  - sort order is broken for `--help` / `--version`\r\n- `less`\r\n  - sorts by short name, then long name (so long names without a short name are last)\r\n  - Even sorts `no-` variants\r\n\r\nCustom\r\n- `cargo`\r\n- `bat`\r\n- `fd`\r\n- `delta`\r\n- `hyperfine`\r\n- `rsync`\r\n- `vim`\r\n- gnu `chmod` \r\n  - Even if this was sorted, I suspect the `no-` variants would not be sorted\r\n- `mount`\r\n- `curl`\r\n- `wget`\r\n- `iptables`\r\n- `traceroute`\r\n- gnu `grep`\r\n- gnu `find` (mostly sorted but there are exceptions\r\n\r\n*(List of commands was inspired by prior Rust command list, some off the top of my head, and a random [50 linux command list](https://www.ubuntupit.com/best-linux-commands-to-run-in-the-terminal/) I found.  I only did a random sampling of the GNU CoreUtils though)*",
    "clap-rs__clap-3974": "`args_conflicts_with_subcommands` does not overriding requireds on arguments\nMaintainer's notes\r\n\r\nNormally, conflicts are two way and they override `required(true)`.  We aren't doing that with `args_conflicts_with_subcommands` while it can be worked around with `subcommand_negates_reqs`.  The main question is whether to consider this a breaking change or not.\r\n\r\n--\r\n\r\n### Discussed in https://github.com/clap-rs/clap/discussions/3892\r\n\r\n<div type='discussions-op-text'>\r\n\r\n<sup>Originally posted by **sasial-dev** July  1, 2022</sup>\r\nHow would I **not** have `-f` & `-p` in the subcommands?\r\n\r\n```rust\r\n    let cli = command!(\"edit-place\")\r\n        .propagate_version(true)\r\n        .arg_required_else_help(true)\r\n        .subcommand(\r\n            command!(\"config\")\r\n                .about(\"Edit the favourites config\")\r\n                .subcommand_required(true)\r\n                .subcommand(command!(\"add\").about(\"Add a favourite\"))\r\n                .subcommand(command!(\"list\").about(\"List all favourites\"))\r\n                .subcommand(command!(\"remove\").about(\"Remove a favourite\")),\r\n        )\r\n        .arg(arg!(-p --place <\"place id\"> \"Place ID to open\").global(false))\r\n        .arg(arg!(-f --favourite <\"favourite name\"> \"Favourite place to open\").global(false))\r\n        .group(\r\n            ArgGroup::new(\"id\")\r\n                .required(true)\r\n                .args(&[\"place\", \"favourite\"]),\r\n        )\r\n        .get_matches();\r\n```</div>",
    "clap-rs__clap-3972": "Update `arg!` to set Actions\nDepending on circumstances, it'd be `SetTrue`, `Set`, or `Append`\r\n\r\nWe'll also need to find all the places where we do this manually and revert them back",
    "clap-rs__clap-3968": "InvalidSubcommand and UnrecognizedSubcommand are redundant\n### Please complete the following tasks\n\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\n- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues\n\n### Rust Version\n\nrustc 1.57.0 (f1edd0429 2021-11-29)\n\n### Clap Version\n\n3.1.13\n\n### Minimal reproducible code\n\n```rust\r\n#[cfg(feature = \"unstable-multicall\")]\r\n#[test]\r\nfn bad_multicall_command_error() {\r\n    let cmd = Command::new(\"repl\")\r\n        .version(\"1.0.0\")\r\n        .propagate_version(true)\r\n        .multicall(true)\r\n        .subcommand(Command::new(\"foo\"))\r\n        .subcommand(Command::new(\"bar\"));\r\n\r\n    let err = cmd.clone().try_get_matches_from(&[\"world\"]).unwrap_err();\r\n    assert_eq!(err.kind(), ErrorKind::UnrecognizedSubcommand);\r\n    static HELLO_EXPECTED: &str = \"\\\r\nerror: The subcommand 'world' wasn't recognized\r\n\r\nUSAGE:\r\n    <SUBCOMMAND>\r\n\r\nFor more information try help\r\n\";\r\n    utils::assert_eq(HELLO_EXPECTED, err.to_string());\r\n\r\n    let err = cmd.clone().try_get_matches_from(&[\"baz\"]).unwrap_err();\r\n    assert_eq!(err.kind(), ErrorKind::InvalidSubcommand);\r\n    static BAZ_EXPECTED: &str = \"\\\r\nerror: The subcommand 'baz' wasn't recognized\r\n\r\n\\tDid you mean 'bar'?\r\n\r\nIf you believe you received this message in error, try re-running with ' -- baz'\r\n\r\nUSAGE:\r\n    <SUBCOMMAND>\r\n\r\nFor more information try help\r\n\";\r\n    utils::assert_eq(BAZ_EXPECTED, err.to_string());\r\n\r\n    // Verify whatever we did to get the above to work didn't disable `--help` and `--version`.\r\n\r\n    let err = cmd\r\n        .clone()\r\n        .try_get_matches_from(&[\"foo\", \"--help\"])\r\n        .unwrap_err();\r\n    assert_eq!(err.kind(), ErrorKind::DisplayHelp);\r\n\r\n    let err = cmd\r\n        .clone()\r\n        .try_get_matches_from(&[\"foo\", \"--version\"])\r\n        .unwrap_err();\r\n    assert_eq!(err.kind(), ErrorKind::DisplayVersion);\r\n}\r\n```\n\n### Steps to reproduce the bug with the above code\n\nRun the above code\n\n### Actual Behaviour\n\nSuggested fixes are one error kind while lack of suggestion is another\n\n### Expected Behaviour\n\nA single error kind with the nuance handled in the error context\n\n### Additional Context\n\n_No response_\n\n### Debug Output\n\n_No response_",
    "clap-rs__clap-3960": "Error with multiple flags and positional arguments\n### Please complete the following tasks\r\n\r\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\r\n- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues\r\n\r\n### Rust Version\r\n\r\nrustc 1.58.1 (db9d1b20b 2022-01-20)\r\n\r\n### Clap Version\r\n\r\n3.2.13\r\n\r\n### Minimal reproducible code\r\n\r\n```rust\r\nuse clap::{Arg, ArgAction, Command};\r\n\r\nfn main() {\r\n    let matches = args().get_matches();\r\n\r\n    println!(\r\n        \"input: {:?}\",\r\n        matches\r\n            .get_many::<String>(\"input\")\r\n            .unwrap()\r\n            .into_iter()\r\n            .map(String::from)\r\n            .collect::<Vec<_>>()\r\n    );\r\n    println!(\"output: {:?}\", matches.get_one::<String>(\"output\").unwrap());\r\n    println!(\"one: {:?}\", matches.get_one::<String>(\"one\"));\r\n    println!(\"two: {:?}\", matches.get_one::<String>(\"two\"));\r\n    println!(\"yes: {:?}\", matches.get_one::<bool>(\"yes\"));\r\n}\r\n\r\nfn args<'a>() -> clap::App<'a> {\r\n    Command::new(\"Clap test\")\r\n        .version(\"1.0\")\r\n        .author(\"Dmitriy Pleshevskiy <dmitriy@ideascup.me>\")\r\n        .about(\"Error reproduction with multiple parameters\")\r\n        .arg(Arg::new(\"yes\").long(\"yes\").action(ArgAction::SetTrue))\r\n        .arg(Arg::new(\"one\").long(\"one\").action(ArgAction::Set))\r\n        .arg(Arg::new(\"two\").long(\"two\").action(ArgAction::Set))\r\n        .arg(Arg::new(\"input\").multiple_values(true).required(true))\r\n        .arg(Arg::new(\"output\").required(true))\r\n}\r\n```\r\n\r\n\r\n### Steps to reproduce the bug with the above code\r\n\r\n```\r\ncargo run -- --one 1 --two 2 3 4 5 6 7 8\r\n```\r\n\r\n### Actual Behaviour\r\n\r\n```\r\nerror: Found argument '4' which wasn't expected, or isn't valid in this context\r\n\r\nUSAGE:\r\n    clap-multi-arg-repro [OPTIONS] <input>... <output>\r\n```\r\n\r\n### Expected Behaviour\r\n\r\n```\r\ninput: [\"3\", \"4\", \"5\", \"6\", \"7\"]\r\noutput: \"8\"\r\none: Same(\"1\")\r\ntwo: Some(\"2\")\r\nyes: Some(false)\r\n```\r\n\r\n### Additional Context\r\n\r\nMore examples in repository with error reproduction. https://github.com/pleshevskiy/clap-multi-arg-repro\r\n\r\n### Debug Output\r\n\r\n```\r\n[      clap::builder::command] \tCommand::_do_parse\r\n[      clap::builder::command] \tCommand::_build: name=\"Clap test\"\r\n[      clap::builder::command] \tCommand::_propagate:Clap test\r\n[      clap::builder::command] \tCommand::_check_help_and_version: Clap test\r\n[      clap::builder::command] \tCommand::_propagate_global_args:Clap test\r\n[      clap::builder::command] \tCommand::_derive_display_order:Clap test\r\n[clap::builder::debug_asserts] \tCommand::_debug_asserts\r\n[clap::builder::debug_asserts] \tArg::_debug_asserts:help\r\n[clap::builder::debug_asserts] \tArg::_debug_asserts:version\r\n[clap::builder::debug_asserts] \tArg::_debug_asserts:yes\r\n[clap::builder::debug_asserts] \tArg::_debug_asserts:one\r\n[clap::builder::debug_asserts] \tArg::_debug_asserts:two\r\n[clap::builder::debug_asserts] \tArg::_debug_asserts:input\r\n[clap::builder::debug_asserts] \tArg::_debug_asserts:output\r\n[clap::builder::debug_asserts] \tCommand::_verify_positionals\r\n[        clap::parser::parser] \tParser::get_matches_with\r\n[        clap::parser::parser] \tParser::get_matches_with: Begin parsing 'RawOsStr(\"--one\")' ([45, 45, 111, 110, 101])\r\n[        clap::parser::parser] \tParser::get_matches_with: Positional counter...1\r\n[        clap::parser::parser] \tParser::get_matches_with: Low index multiples...true\r\n[        clap::parser::parser] \tParser::is_new_arg: RawOsStr(\"1\"):\"input\"\r\n[        clap::parser::parser] \tParser::is_new_arg: value\r\n[        clap::parser::parser] \tParser::possible_subcommand: arg=Ok(\"1\")\r\n[        clap::parser::parser] \tParser::possible_subcommand: arg=Ok(\"--one\")\r\n[        clap::parser::parser] \tParser::get_matches_with: sc=None\r\n[        clap::parser::parser] \tParser::parse_long_arg\r\n[        clap::parser::parser] \tParser::parse_long_arg: Does it contain '='...\r\n[        clap::parser::parser] \tParser::parse_long_arg: Found valid arg or flag '--one <one>'\r\n[        clap::parser::parser] \tParser::parse_long_arg(\"one\"): Found an arg with value 'None'\r\n[        clap::parser::parser] \tParser::parse_opt_value; arg=one, val=None, has_eq=false\r\n[        clap::parser::parser] \tParser::parse_opt_value; arg.settings=ArgFlags(MULTIPLE_OCC | TAKES_VAL)\r\n[        clap::parser::parser] \tParser::parse_opt_value; Checking for val...\r\n[        clap::parser::parser] \tParser::parse_opt_value: More arg vals required...\r\n[        clap::parser::parser] \tParser::get_matches_with: After parse_long_arg Opt(one)\r\n[        clap::parser::parser] \tParser::get_matches_with: Begin parsing 'RawOsStr(\"1\")' ([49])\r\n[        clap::parser::parser] \tParser::get_matches_with: Positional counter...1\r\n[        clap::parser::parser] \tParser::get_matches_with: Low index multiples...true\r\n[        clap::parser::parser] \tParser::is_new_arg: RawOsStr(\"--two\"):\"input\"\r\n[        clap::parser::parser] \tParser::is_new_arg: --<something> found\r\n[        clap::parser::parser] \tParser::get_matches_with: Bumping the positional counter...\r\n[        clap::parser::parser] \tParser::split_arg_values; arg=one, val=RawOsStr(\"1\")\r\n[        clap::parser::parser] \tParser::split_arg_values; trailing_values=false, DontDelimTrailingVals=false\r\n[   clap::parser::arg_matcher] \tArgMatcher::needs_more_vals: o=one, resolved=0, pending=1\r\n[        clap::parser::parser] \tParser::get_matches_with: Begin parsing 'RawOsStr(\"--two\")' ([45, 45, 116, 119, 111])\r\n[        clap::parser::parser] \tParser::get_matches_with: Positional counter...2\r\n[        clap::parser::parser] \tParser::get_matches_with: Low index multiples...false\r\n[        clap::parser::parser] \tParser::possible_subcommand: arg=Ok(\"--two\")\r\n[        clap::parser::parser] \tParser::get_matches_with: sc=None\r\n[        clap::parser::parser] \tParser::parse_long_arg\r\n[        clap::parser::parser] \tParser::parse_long_arg: Does it contain '='...\r\n[        clap::parser::parser] \tParser::parse_long_arg: Found valid arg or flag '--two <two>'\r\n[        clap::parser::parser] \tParser::parse_long_arg(\"two\"): Found an arg with value 'None'\r\n[        clap::parser::parser] \tParser::parse_opt_value; arg=two, val=None, has_eq=false\r\n[        clap::parser::parser] \tParser::parse_opt_value; arg.settings=ArgFlags(MULTIPLE_OCC | TAKES_VAL)\r\n[        clap::parser::parser] \tParser::parse_opt_value; Checking for val...\r\n[        clap::parser::parser] \tParser::parse_opt_value: More arg vals required...\r\n[        clap::parser::parser] \tParser::resolve_pending: id=one\r\n[        clap::parser::parser] \tParser::react action=Set, identifier=Some(Long), source=CommandLine\r\n[        clap::parser::parser] \tParser::react: cur_idx:=1\r\n[        clap::parser::parser] \tParser::remove_overrides: id=one\r\n[   clap::parser::arg_matcher] \tArgMatcher::start_custom_arg: id=one, source=CommandLine\r\n[      clap::builder::command] \tCommand::groups_for_arg: id=one\r\n[        clap::parser::parser] \tParser::push_arg_values: [\"1\"]\r\n[        clap::parser::parser] \tParser::add_single_val_to_arg: cur_idx:=2\r\n[      clap::builder::command] \tCommand::groups_for_arg: id=one\r\n[   clap::parser::arg_matcher] \tArgMatcher::needs_more_vals: o=one, resolved=1, pending=0\r\n[        clap::parser::parser] \tParser::get_matches_with: After parse_long_arg Opt(two)\r\n[        clap::parser::parser] \tParser::get_matches_with: Begin parsing 'RawOsStr(\"2\")' ([50])\r\n[        clap::parser::parser] \tParser::get_matches_with: Positional counter...2\r\n[        clap::parser::parser] \tParser::get_matches_with: Low index multiples...false\r\n[        clap::parser::parser] \tParser::split_arg_values; arg=two, val=RawOsStr(\"2\")\r\n[        clap::parser::parser] \tParser::split_arg_values; trailing_values=false, DontDelimTrailingVals=false\r\n[   clap::parser::arg_matcher] \tArgMatcher::needs_more_vals: o=two, resolved=0, pending=1\r\n[        clap::parser::parser] \tParser::get_matches_with: Begin parsing 'RawOsStr(\"3\")' ([51])\r\n[        clap::parser::parser] \tParser::get_matches_with: Positional counter...2\r\n[        clap::parser::parser] \tParser::get_matches_with: Low index multiples...false\r\n[        clap::parser::parser] \tParser::possible_subcommand: arg=Ok(\"3\")\r\n[        clap::parser::parser] \tParser::get_matches_with: sc=None\r\n[        clap::parser::parser] \tParser::resolve_pending: id=two\r\n[        clap::parser::parser] \tParser::react action=Set, identifier=Some(Long), source=CommandLine\r\n[        clap::parser::parser] \tParser::react: cur_idx:=3\r\n[        clap::parser::parser] \tParser::remove_overrides: id=two\r\n[   clap::parser::arg_matcher] \tArgMatcher::start_custom_arg: id=two, source=CommandLine\r\n[      clap::builder::command] \tCommand::groups_for_arg: id=two\r\n[        clap::parser::parser] \tParser::push_arg_values: [\"2\"]\r\n[        clap::parser::parser] \tParser::add_single_val_to_arg: cur_idx:=4\r\n[      clap::builder::command] \tCommand::groups_for_arg: id=two\r\n[   clap::parser::arg_matcher] \tArgMatcher::needs_more_vals: o=two, resolved=1, pending=0\r\n[        clap::parser::parser] \tParser::split_arg_values; arg=output, val=RawOsStr(\"3\")\r\n[        clap::parser::parser] \tParser::split_arg_values; trailing_values=false, DontDelimTrailingVals=false\r\n[        clap::parser::parser] \tParser::get_matches_with: Begin parsing 'RawOsStr(\"4\")' ([52])\r\n[        clap::parser::parser] \tParser::get_matches_with: Positional counter...3\r\n[        clap::parser::parser] \tParser::get_matches_with: Low index multiples...false\r\n[        clap::parser::parser] \tParser::possible_subcommand: arg=Ok(\"4\")\r\n[        clap::parser::parser] \tParser::get_matches_with: sc=None\r\n[        clap::parser::parser] \tParser::resolve_pending: id=output\r\n[        clap::parser::parser] \tParser::react action=StoreValue, identifier=Some(Index), source=CommandLine\r\n[        clap::parser::parser] \tParser::remove_overrides: id=output\r\n[   clap::parser::arg_matcher] \tArgMatcher::start_occurrence_of_arg: id=output\r\n[      clap::builder::command] \tCommand::groups_for_arg: id=output\r\n[        clap::parser::parser] \tParser::push_arg_values: [\"3\"]\r\n[        clap::parser::parser] \tParser::add_single_val_to_arg: cur_idx:=5\r\n[      clap::builder::command] \tCommand::groups_for_arg: id=output\r\n[   clap::parser::arg_matcher] \tArgMatcher::needs_more_vals: o=output, resolved=1, pending=0\r\n[         clap::output::usage] \tUsage::create_usage_with_title\r\n[         clap::output::usage] \tUsage::create_usage_no_title\r\n[         clap::output::usage] \tUsage::create_help_usage; incl_reqs=true\r\n[         clap::output::usage] \tUsage::get_required_usage_from: incls=[], matcher=false, incl_last=false\r\n[         clap::output::usage] \tUsage::get_required_usage_from: unrolled_reqs={input, output}\r\n[         clap::output::usage] \tUsage::get_required_usage_from:push:input\r\n[         clap::output::usage] \tUsage::get_required_usage_from:push:output\r\n[         clap::output::usage] \tUsage::get_required_usage_from: ret_val={\"<input>...\", \"<output>\"}\r\n[         clap::output::usage] \tUsage::needs_options_tag\r\n[         clap::output::usage] \tUsage::needs_options_tag:iter: f=help\r\n[         clap::output::usage] \tUsage::needs_options_tag:iter Option is built-in\r\n[         clap::output::usage] \tUsage::needs_options_tag:iter: f=version\r\n[         clap::output::usage] \tUsage::needs_options_tag:iter Option is built-in\r\n[         clap::output::usage] \tUsage::needs_options_tag:iter: f=yes\r\n[      clap::builder::command] \tCommand::groups_for_arg: id=yes\r\n[         clap::output::usage] \tUsage::needs_options_tag:iter: [OPTIONS] required\r\n[         clap::output::usage] \tUsage::create_help_usage: usage=clap-multi-arg-repro [OPTIONS] <input>... <output>\r\n[      clap::builder::command] \tCommand::color: Color setting...\r\n[      clap::builder::command] \tAuto\r\n```",
    "clap-rs__clap-3874": "Return help message as String for Command\n### Please complete the following tasks\n\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\n- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues\n\n### Clap Version\n\n3.1.18\n\n### Describe your use case\n\nThe only way I could find to use the help message is to print out it to `Stdout`. In my use case I would like to get the help message as a String as I intend to not print it to `Stdout` directly.\n\n### Describe the solution you'd like\n\nA function that returns the help message as a String.\n\n### Alternatives, if applicable\n\n_No response_\n\n### Additional Context\n\n_No response_",
    "clap-rs__clap-3775": "default_value_if should work with flags that don't take a value\n### Please complete the following tasks\r\n\r\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\r\n- [X] I have searched the existing issues\r\n\r\n### Clap Version\r\n\r\n3.0.7\r\n\r\n### Describe your use case\r\n\r\nI want to have various specific flags imply a general flag, for example `--mystery` or `--suspense` implies `--fiction`. I don't want to require an extra \"=true\" on the flags.\r\n\r\n### Describe the solution you'd like\r\n\r\nClap can almost support this use case: `fiction` should have `default_value_ifs` stating that any `mystery` or `suspense` argument gives the default value of `true`, and `takes_value` is false. However, `default_value_if` and `default_value_ifs` seem to need `takes_value`. They set it implicitly, and when it is turned off, the implication does not happen.\r\n\r\nOr if the right answer is to use `min_value(0)`, that should be documented (see below).\r\n\r\n### Alternatives, if applicable\r\n\r\nAn alternative solution is to override `parse`, `parse_from`, `try_parse`, and `try_parse_from` (and call `<Self as Parser>::*parse*`) and call a validation function to set implied values.\r\n\r\nAnother alternative solution would be to let the struct or app define a post-parse hook (the validation function mentioned above).\r\n\r\nIf \"true\" and \"false\" are not valid positional values, the easiest workaround is to use `min_values(0) ` instead of `takes_value(false)`. If this is the best solution for now, I suggest adding a note to the `takes_value` docs such as: \"Note that if `takes_value(false)` cannot be used due to a default value being set by another argument's presence, `min_values(0)` is a reasonable substitute.\"\r\n\r\n### Additional Context\r\n\r\nThis issue is shown in rust playground here: https://play.rust-lang.org/?version=stable&mode=debug&edition=2021&gist=4855a88381f65cef8d07f7eab4d41e78",
    "clap-rs__clap-3732": "Add an option to not panic on value*of() of non valid arguments\n### Please complete the following tasks\n\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\n- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues\n\n### Clap Version\n\nclap-3.1.8\n\n### Describe your use case\n\nThe `cargo` feature exposes is_valid() as workaround but it makes quite cumbersome to deal with code that has similar needs.\n\n### Describe the solution you'd like\n\nAdding a setting to simply return None would spare quite a bit of boilerplate.\n\n### Alternatives, if applicable\n\nMake so the `cargo` feature re-enable the former behavior.\n\n### Additional Context\n\n_No response_",
    "clap-rs__clap-3700": "Help me catch mismatches in number of values and value names\n### Please complete the following tasks\n\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\n- [X] I have searched the existing issues\n\n### Clap Version\n\n3.0.0-beta.2\n\n### Describe your use case\n\nThe two main use cases I have for value names with multiple_values are\r\n- 1 value name repeated repeated for each value\r\n- Value name per value\n\n### Describe the solution you'd like\n\nTo catch mismatches in these, I'd like to have a debug assert so I know when I update one without the other\n\n### Alternatives, if applicable\n\n_No response_\n\n### Additional Context\n\n_No response_",
    "clap-rs__clap-3684": "Stabilise `AppSettings::Multicall` Tracking Issue\nOriginal request: https://github.com/clap-rs/clap/issues/1120\r\n\r\nOriginal PR: https://github.com/clap-rs/clap/pull/2817\r\n\r\nFeature flag: `unstable-multicall`\r\n\r\nKnown issues:\r\n\r\n- [x] https://github.com/clap-rs/clap/issues/2862\r\n- [x] https://github.com/clap-rs/clap/issues/2864\r\n- [x] https://github.com/clap-rs/clap/issues/2865\r\n- [x] https://github.com/clap-rs/clap/issues/2866\r\n- [x] https://github.com/clap-rs/clap/issues/3074\r\n- [x] Should we strip all suffixes or just [EXE_SUFFIX](https://doc.rust-lang.org/std/env/consts/constant.EXE_SUFFIX.html)?  We should be consistent with #992 \r\n- [x] Demonstrate we can generate completions",
    "clap-rs__clap-3678": "Ability to set min_values per occurance when multiple_occurances is used\n### Please complete the following tasks\n\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\n- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues\n\n### Clap Version\n\n3.1.5\n\n### Describe your use case\n\nI have an option that supports multiple occurrences, but each occurrence is independent, and needs a minimum of 1 value passed to it.  I'm using `grouped_values_of` to get the groups of values. If I use `.min_values(1)`, then it requires that there is at least one value in total, not that there is one value per occurance.\r\n\r\nHere's some example code:\r\n\r\n```rust\r\nuse clap::*; // 3.1.5\r\n\r\nfn main() {\r\n let app = Command::new(\"test\")\r\n .arg(Arg::new(\"example\").short('x').min_values(1).multiple_occurrences(true).value_name(\"x\"));\r\n let matches = app.get_matches_from(&[\"test\", \"-x\", \"a\", \"-x\"]);\r\n println!(\"{:?}\", matches);\r\n\r\n}\r\n```\r\n\r\nThis produces a successful match, but I want it to fail, because no argument is given to the second occurance of `-x`. \r\n\r\n\n\n### Describe the solution you'd like\n\nIdeally, `.min_values` would behave as I've described. And if the current behavior is unintentional , then this is probably a bug, and it might be worth changing. However, changing `min_values`'s behavior would technically be backwards incompatible, so it may be necessary to introduce a new api like `min_values_per_occurance` (and probably a similar `max_values_per_occurance`). \n\n### Alternatives, if applicable\n\nThe only alternative I know of is to have the application check that enough arguments are provided to each group returned by `grouped_values_of` rather than letting clap do the validation for me.\n\n### Additional Context\n\nSee https://github.com/sharkdp/fd/pull/960#issuecomment-1059998122.\r\n",
    "clap-rs__clap-3670": "Clap 3.1.13 fails to build by unwrapping a None value\n### Please complete the following tasks\n\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\n- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues\n\n### Rust Version\n\nrustc 1.60.0 (7737e0b5c 2022-04-04)\n\n### Clap Version\n\n3.1.13\n\n### Minimal reproducible code\n\n```rust\r\nfn main() {\r\n    todo!()\r\n}\r\n```\r\n\n\n### Steps to reproduce the bug with the above code\n\nSorry for not being able to reproduce this, this only happens in this one project I have where I upgraded `clap` and not in a few others I have, see this PR: https://github.com/sondr3/git-ignore/pull/9. It seems to come from the `build.rs` file when generating shell completions when running with `RUST_BACKTRACES=1`:\r\n\r\n```\r\n\u276f RUST_BACKTRACE=1 cargo c\r\n   Compiling git-ignore-generator v1.2.0 (/home/sondre/Code/rust/git-ignore)\r\nerror: failed to run custom build command for `git-ignore-generator v1.2.0 (/home/sondre/Code/rust/git-ignore)`\r\n\r\nCaused by:\r\n  process didn't exit successfully: `/home/sondre/Code/rust/git-ignore/target/debug/build/git-ignore-generator-322665dc073b363c/build-script-build` (exit status: 101)\r\n  --- stdout\r\n  cargo:rerun-if-changed=src/cli.rs\r\n  cargo:rerun-if-changed=man\r\n\r\n  --- stderr\r\n  thread 'main' panicked at 'called `Option::unwrap()` on a `None` value', /home/sondre/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-3.1.13/src/output/usage.rs:436:35\r\n  stack backtrace:\r\n     0: rust_begin_unwind\r\n               at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/std/src/panicking.rs:584:5\r\n     1: core::panicking::panic_fmt\r\n               at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/core/src/panicking.rs:143:14\r\n     2: core::panicking::panic\r\n               at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/core/src/panicking.rs:48:5\r\n     3: core::option::Option<T>::unwrap\r\n               at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/core/src/option.rs:752:21\r\n     4: clap::output::usage::Usage::get_required_usage_from::{{closure}}\r\n               at /home/sondre/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-3.1.13/src/output/usage.rs:436:25\r\n     5: core::ops::function::impls::<impl core::ops::function::FnOnce<A> for &mut F>::call_once\r\n               at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/core/src/ops/function.rs:280:13\r\n     6: core::option::Option<T>::map\r\n               at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/core/src/option.rs:906:29\r\n     7: <core::iter::adapters::map::Map<I,F> as core::iter::traits::iterator::Iterator>::next\r\n               at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/core/src/iter/adapters/map.rs:103:9\r\n     8: <alloc::vec::Vec<T> as alloc::vec::spec_from_iter_nested::SpecFromIterNested<T,I>>::from_iter\r\n               at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/alloc/src/vec/spec_from_iter_nested.rs:26:32\r\n     9: <alloc::vec::Vec<T> as alloc::vec::spec_from_iter::SpecFromIter<T,I>>::from_iter\r\n               at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/alloc/src/vec/spec_from_iter.rs:33:9\r\n    10: <alloc::vec::Vec<T> as core::iter::traits::collect::FromIterator<T>>::from_iter\r\n               at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/alloc/src/vec/mod.rs:2552:9\r\n    11: core::iter::traits::iterator::Iterator::collect\r\n               at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/core/src/iter/traits/iterator.rs:1778:9\r\n    12: clap::output::usage::Usage::get_required_usage_from\r\n               at /home/sondre/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-3.1.13/src/output/usage.rs:428:24\r\n    13: clap::build::command::App::_build_bin_names_internal\r\n               at /home/sondre/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-3.1.13/src/build/command.rs:4133:28\r\n    14: clap::build::command::App::_build_bin_names_internal\r\n               at /home/sondre/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-3.1.13/src/build/command.rs:4197:17\r\n    15: clap::build::command::App::_build_bin_names_internal\r\n               at /home/sondre/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-3.1.13/src/build/command.rs:4197:17\r\n    16: clap::build::command::App::build\r\n               at /home/sondre/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-3.1.13/src/build/command.rs:4015:9\r\n    17: clap_complete::generator::_generate\r\n               at /home/sondre/.cargo/registry/src/github.com-1ecc6299db9ec823/clap_complete-3.1.2/src/generator/mod.rs:239:5\r\n    18: clap_complete::generator::generate_to\r\n               at /home/sondre/.cargo/registry/src/github.com-1ecc6299db9ec823/clap_complete-3.1.2/src/generator/mod.rs:186:5\r\n    19: build_script_build::build_shell_completion\r\n               at ./build.rs:18:9\r\n    20: build_script_build::main\r\n               at ./build.rs:49:5\r\n    21: core::ops::function::FnOnce::call_once\r\n               at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/core/src/ops/function.rs:227:5\r\n  note: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\r\n```\n\n### Actual Behaviour\n\nI have verified that this only happens on `3.1.13`, using `3.1.10`, `3.1.11` and`3.1.12` does not crash. I did a quick look at the commits but can't pinpoint any culprits from a quick glance.\n\n### Expected Behaviour\n\nThis worked in the previous patch release.\n\n### Additional Context\n\nIf need be, I can try to bisect `clap` itself if you need more information. I haven't been able to create a minimal, crashing example.\n\n### Debug Output\n\n_No response_",
    "clap-rs__clap-3521": "[3.1] Derive parsing FromStr args into a vector regression from 3.0\n### Please complete the following tasks\n\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\n- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues\n\n### Rust Version\n\nrustc 1.59.0 (9d1b2106e 2022-02-23)\n\n### Clap Version\n\n3.1.2\n\n### Minimal reproducible code\n\n```rust\r\nuse clap::Parser;\r\nuse std::str::FromStr;\r\n\r\n#[derive(Debug, PartialEq)]\r\npub enum MyType {\r\n    A,\r\n    B,\r\n}\r\n\r\nimpl FromStr for MyType {\r\n    type Err = String;\r\n\r\n    fn from_str(s: &str) -> Result<Self, Self::Err> {\r\n        match s.to_lowercase().as_str() {\r\n            \"a\" => Ok(MyType::A),\r\n            \"b\" => Ok(MyType::B),\r\n            _ => Err(\"\".to_owned()),\r\n        }\r\n    }\r\n}\r\n\r\n#[derive(Parser)]\r\npub struct Config {\r\n    #[clap(long, default_value = \"a,b,a\", value_delimiter = ',')]\r\n    pub values: Vec<MyType>,\r\n}\r\n\r\n// These two tests pass in 3.0 but fail in 3.1\r\n\r\n#[test]\r\nfn shuold_build_a_vec_of_types() {\r\n    let args: Vec<std::ffi::OsString> = vec![\"\".into()];\r\n    let config = Config::parse_from(args);\r\n    assert_eq!(vec![MyType::A, MyType::B, MyType::A], config.values);\r\n}\r\n\r\n#[test]\r\nfn shuold_build_a_vec_of_types_from_default_value() {\r\n    let args: Vec<std::ffi::OsString> = vec![\"\".into(), \"--values=a,b\".into()];\r\n    let config = Config::parse_from(args);\r\n    assert_eq!(vec![MyType::A, MyType::B], config.values);\r\n}\r\n```\r\n\n\n### Steps to reproduce the bug with the above code\n\nExecutes the two tests provided in the minimal reproducible code; they both fail in 3.1 but pass in 3.0\n\n### Actual Behaviour\n\nA validation error is thrown when the configuration is built.\n\n### Expected Behaviour\n\nThe configuration is valid in 3.0 and should be valid in 3.1 too.\n\n### Additional Context\n\n_No response_\n\n### Debug Output\n\n_No response_",
    "clap-rs__clap-3455": "Derive should only show help when argc==1 rather than missing subcommand\n### Please complete the following tasks\n\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\n- [X] I have searched the existing issues\n\n### Rust Version\n\nrustc 1.57.0 (f1edd0429 2021-11-29)\n\n### Clap Version\n\nv3.0.6\n\n### Minimal reproducible code\n\n```rust\r\nuse clap::{AppSettings, Parser, Subcommand};\r\n\r\n#[derive(Parser)]\r\n#[clap(author, version, about, long_about = None)]\r\n#[clap(global_setting(AppSettings::PropagateVersion))]\r\n#[clap(global_setting(AppSettings::UseLongFormatForHelpSubcommand))]\r\nstruct Cli {\r\n    #[clap(short, long, parse(from_occurrences), global = true)]\r\n    verbose: usize,\r\n\r\n    #[clap(subcommand)]\r\n    command: Commands,\r\n}\r\n\r\n#[derive(Subcommand)]\r\nenum Commands {\r\n    /// Adds files to myapp\r\n    Add { name: Option<String> },\r\n}\r\n\r\nfn main() {\r\n    let cli = Cli::parse();\r\n\r\n    // You can check for the existence of subcommands, and if found use their\r\n    // matches just as you would the top level app\r\n    match &cli.command {\r\n        Commands::Add { name } => {\r\n            println!(\"'myapp add' was used, name is: {:?}\", name)\r\n        }\r\n    }\r\n}\r\n\r\n```\r\n\n\n### Steps to reproduce the bug with the above code\n\n```console\r\n$ cargo run -- -v\r\n```\n\n### Actual Behaviour\n\n```console\r\n$ cargo run -- -v\r\n   Compiling test-clap v0.1.0 (/home/epage/src/personal/test-clap)\r\n    Finished dev [unoptimized + debuginfo] target(s) in 0.70s\r\n     Running `target/debug/test-clap -v`\r\ntest-clap 0.1.0\r\nMe\r\nFrom Cargo.toml\r\n\r\nUSAGE:\r\n    test-clap [OPTIONS] <SUBCOMMAND>\r\n\r\nOPTIONS:\r\n    -h, --help       Print help information\r\n    -v, --verbose    \r\n    -V, --version    Print version information\r\n\r\nSUBCOMMANDS:\r\n    add     Adds files to myapp\r\n    help    Print this message or the help of the given subcommand(s)\r\n\r\n```\n\n### Expected Behaviour\n\n```console\r\n$ cargo run -- -v\r\n   Compiling test-clap v0.1.0 (/home/epage/src/personal/test-clap)\r\n    Finished dev [unoptimized + debuginfo] target(s) in 0.67s\r\n     Running `target/debug/test-clap -v`\r\nerror: 'test-clap' requires a subcommand, but one was not provided\r\n\r\nUSAGE:\r\n    test-clap [OPTIONS] <SUBCOMMAND>\r\n\r\nFor more information try --help\r\n```\n\n### Additional Context\n\nTo reproduce the desired behavior:\r\n```rust\r\n#[clap(setting(AppSettings::SubcommandRequired))]\r\n#[clap(setting(AppSettings::ArgRequiredElseHelp))]\r\n#[clap(unset_setting(AppSettings::SubcommandRequiredElseHelp))]\r\n```\r\n\r\nThis was inspired by a conversation in #2513 \r\n\r\nIn my mind, showing of help should be reserved for when the user has taken no action but `SubcommandRequired` allows the user to pass some arguments.  In those cases, we should be showing a more specific error message than a long, generic message that takes the user some work to figure out what the next steps are.\n\n### Debug Output\n\n_No response_",
    "clap-rs__clap-3453": "`name` implies a user-facing meaning, causing confusion\nMaintainer's notes:\r\n- The root cause was [confusion over `name` vs `value_name` and impact on the rest of the API](https://github.com/clap-rs/clap/issues/3335#issuecomment-1020308017)\r\n- We should look into renaming `Arg::name` to `Arg::id`\r\n- We should also resolve https://github.com/clap-rs/clap/issues/2475 which is possible because we (should be) setting `value_name` on people's behalf.\r\n---\r\n### Please complete the following tasks\r\n\r\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\r\n- [X] I have searched the existing issues\r\n\r\n### Rust Version\r\n\r\nrustc 1.58.1 (db9d1b20b 2022-01-20)\r\n\r\n### Clap Version\r\n\r\n3.0.10\r\n\r\n### Minimal reproducible code\r\n\r\n```rust\r\nuse clap::Parser;\r\n\r\n#[derive(Debug, Parser)]\r\npub struct Example {\r\n    #[clap(short = 'S', long, conflicts_with = \"version\")]\r\n    pub staged: bool,\r\n\r\n    #[clap(name = \"OBJ_ID\")]\r\n    pub object_id: String,\r\n\r\n    #[clap(name = \"VERSION\")]\r\n    pub version: Option<String>,\r\n}\r\n\r\nfn main() {\r\n    println!(\"{:?}\", Example::parse());\r\n}\r\n```\r\n\r\n\r\n### Steps to reproduce the bug with the above code\r\n\r\n```shell\r\ncargo run -- asdf\r\n```\r\n\r\n\r\n### Actual Behaviour\r\n\r\nPanics:\r\n\r\n```\r\nthread 'main' panicked at 'App clap-example: Argument or group 'version' specified in 'conflicts_with*' for 'staged' does not exist', /home/pwinckles/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-3.0.10/src/build/app/debug_asserts.rs:171:13\r\n```\r\n\r\n### Expected Behaviour\r\n\r\nIt should not panic. I would expect Clap to enforce that the `staged` flag cannot be set if a `version` positional arg is provided, and otherwise allow the flag to be present or not.\r\n\r\n### Additional Context\r\n\r\n`conflicts_with` works as expected when conflicting with another flag. The problem seems to be when conflicting with an optional positional arg.\r\n\r\n### Debug Output\r\n\r\n```\r\n[            clap::build::app] \tApp::_do_parse\r\n[            clap::build::app] \tApp::_build\r\n[            clap::build::app] \tApp::_propagate:clap-example\r\n[            clap::build::app] \tApp::_check_help_and_version\r\n[            clap::build::app] \tApp::_check_help_and_version: Removing generated version\r\n[            clap::build::app] \tApp::_propagate_global_args:clap-example\r\n[            clap::build::app] \tApp::_derive_display_order:clap-example\r\n[clap::build::app::debug_asserts] \tApp::_debug_asserts\r\n[clap::build::arg::debug_asserts] \tArg::_debug_asserts:help\r\n[clap::build::arg::debug_asserts] \tArg::_debug_asserts:staged\r\n```",
    "clap-rs__clap-3423": "default_value may not be included in possible_values and only checked in a runtime\n### Please complete the following tasks\n\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\n- [X] I have searched the existing issues\n\n### Clap Version\n\n3.0.0-rc.7\n\n### Describe your use case\n\nA configuration when a `default_value` is not listed in `possible_values` is valid and i only get error in runtime.\r\n\r\nexample\r\n`#[clap(short, long, default_value_t = 64, possible_values = [\"16\", \"32\"])]`\r\nthis also works:\r\n`#[clap(short, long, default_value = \"64\", possible_values = [\"16\", \"32\"])]`\n\n### Describe the solution you'd like\n\nI want to get error at compile time.\r\nMaybe implementing a https://github.com/clap-rs/clap/issues/3201 may automatically resolve this issue.\r\n\r\n```\r\n#[clap(short, long, default_value_t = 128, possible_values = [\"12\", \"16\", \"32\"])]\r\nfat: u8,\r\n\r\nerror: default value is not in range of possible values\r\n```\n\n### Alternatives, if applicable\n\n_No response_\n\n### Additional Context\n\n_No response_",
    "clap-rs__clap-3421": "ArgRequiredElseHelp is ignored if there are *any* default values\n### Rust Version\r\n\r\nrustc 1.25.0 (84203cac6 2018-03-25)\r\n\r\n### Affected Version of clap\r\n\r\n2.31.2\r\n\r\n### Expected Behavior Summary\r\n\r\nIf `ArgRequiredElseHelp` is enabled, you should see the help menu if an option is not provided correctly.\r\n\r\n### Actual Behavior Summary\r\n\r\nIf you have two arguments, and one has a default, this the help menu is not correctly printed.\r\n\r\n### Steps to Reproduce the issue\r\n\r\nRun the code below in a test project via `cargo run`. It won't work (rightly so) because the \"second\" option is not provided - but you'll get an error instead of the help menu.\r\n\r\nDo the same again with the default value removed from \"first\", and you'll then see a help menu. Regardless of the default value of \"first\", it should show the help menu both times.\r\n\r\n```rust\r\nApp::new(\"\")\r\n    // package metadata from cargo\r\n    .name(env!(\"CARGO_PKG_NAME\"))\r\n    .about(env!(\"CARGO_PKG_DESCRIPTION\"))\r\n    .version(env!(\"CARGO_PKG_VERSION\"))\r\n\r\n    // arguments and flag details\r\n    .arg(Arg::with_name(\"second\")\r\n        .help(\"second option\")\r\n        .required(true))\r\n    .arg(Arg::with_name(\"first\")\r\n        .help(\"first option\")\r\n        .default_value(\"something\"))\r\n\r\n    // settings required for parsing\r\n    .setting(AppSettings::ArgRequiredElseHelp)\r\n```",
    "clap-rs__clap-3420": "Require rules ignore a defaulted value\n### \r\n\r\n- [x] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\r\n- [x] I have searched the existing issues\r\n\r\n### Description\r\n\r\nThis consolidates:\r\n- https://github.com/clap-rs/clap/issues/2714\r\n- https://github.com/clap-rs/clap/issues/1586\r\n- https://github.com/clap-rs/clap/issues/1906\r\n- https://github.com/clap-rs/clap/issues/2897\r\n\r\nAn attempt at a fix was reverted in 9753f68a76091bebd7743dc2763bb272cbd4054a.  See also #3020 ",
    "clap-rs__clap-3402": "Is it possible to not show usage string in post validation errors?\nMaintainer's notes:\r\n- If we move error formatting to display time, we can provide all of the information the user needs that the user can build the error as they need (see also #2628)\r\n--\r\n### Discussed in https://github.com/clap-rs/clap/discussions/3226\r\n\r\n<div type='discussions-op-text'>\r\n\r\n<sup>Originally posted by **ducaale** December 27, 2021</sup>\r\nIn Structopt/Clap 2.x, errors from both initial-parsing and post-processing errors didn't include the Usage string. However, in Clap 3.x, post-processing errors include the usage string. Is there a way to opt-out of this new behavior in Clap 3.x?\r\n\r\n### Structopt/Clap 2.x\r\n```rust\r\n// structopt = \"0.3\"\r\n// anyhow = \"1.0\"\r\n\r\nuse std::str::FromStr;\r\nuse std::time::Duration;\r\n\r\nuse anyhow::anyhow;\r\nuse structopt::clap::{Error, ErrorKind};\r\nuse structopt::StructOpt;\r\n\r\npub struct Timeout(Duration);\r\n\r\nimpl FromStr for Timeout {\r\n    type Err = anyhow::Error;\r\n\r\n    fn from_str(sec: &str) -> anyhow::Result<Timeout> {\r\n        let pos_sec: f64 = match sec.parse::<f64>() {\r\n            Ok(sec) if sec.is_sign_positive() => sec,\r\n            _ => return Err(anyhow!(\"Invalid seconds as connection timeout\")),\r\n        };\r\n\r\n        let dur = Duration::from_secs_f64(pos_sec);\r\n        Ok(Timeout(dur))\r\n    }\r\n}\r\n\r\n#[derive(StructOpt)]\r\nstruct Cli {\r\n    #[structopt(long, short)]\r\n    config: Option<String>,\r\n\r\n    #[structopt(long, short)]\r\n    timeout: Option<Timeout>,\r\n}\r\n\r\nfn main() {\r\n    let _ = Cli::from_args();\r\n    Error::with_description(\r\n        \"Can't do relative and absolute version change\",\r\n        ErrorKind::ArgumentConflict,\r\n    )\r\n    .exit();\r\n}\r\n```\r\n\r\n```\r\n$ cargo run\r\nerror: Can't do relative and absolute version change\r\n\r\n$ cargo run -- --timeout=-1\r\nerror: Invalid value for '--timeout <timeout>': Invalid seconds as connection timeout\r\n```\r\n\r\n### Clap 3.x\r\n```rust\r\n// clap = { version = \"3.0.0-rc.9\", features = [\"derive\"] }\r\n// anyhow = \"1.0\"\r\n\r\nuse std::str::FromStr;\r\nuse std::time::Duration;\r\n\r\nuse anyhow::anyhow;\r\nuse clap::{ErrorKind, IntoApp, Parser};\r\n\r\npub struct Timeout(Duration);\r\n\r\nimpl FromStr for Timeout {\r\n    type Err = anyhow::Error;\r\n\r\n    fn from_str(sec: &str) -> anyhow::Result<Timeout> {\r\n        let pos_sec: f64 = match sec.parse::<f64>() {\r\n            Ok(sec) if sec.is_sign_positive() => sec,\r\n            _ => return Err(anyhow!(\"Invalid seconds as connection timeout\")),\r\n        };\r\n\r\n        let dur = Duration::from_secs_f64(pos_sec);\r\n        Ok(Timeout(dur))\r\n    }\r\n}\r\n\r\n#[derive(Parser)]\r\nstruct Cli {\r\n    #[clap(long, short)]\r\n    config: Option<String>,\r\n\r\n    #[structopt(long, short)]\r\n    timeout: Option<Timeout>,\r\n}\r\n\r\nfn main() {\r\n    let _ = Cli::parse();\r\n    let mut app = Cli::into_app();\r\n    app.error(\r\n        ErrorKind::ArgumentConflict,\r\n        \"Can't do relative and absolute version change\",\r\n    )\r\n    .exit();\r\n}\r\n```\r\n\r\n```\r\n$ cargo run\r\nerror: Can't do relative and absolute version change\r\n\r\nUSAGE:\r\n    temp-clap [OPTIONS]\r\n\r\nFor more information try --help\r\n\r\n$ cargo run -- --timeout=-1\r\nerror: Invalid value for '--timeout <TIMEOUT>': Invalid seconds as connection timeout\r\n\r\nFor more information try --help\r\n```\r\n\r\n</div>",
    "clap-rs__clap-3394": "Show possible values when an arguments value is missing\n### Please complete the following tasks\n\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\n- [X] I have searched the existing issues\n\n### Clap Version\n\nv3.0.6\n\n### Describe your use case\n\nMany CLIs allow using the argument without a value to list what values are available.  This allows a more targeted browsing than digging in `--help`\r\n\r\nToday, clap just points people to help\r\n```console\r\n$ git-stack --color\r\n    Finished dev [unoptimized + debuginfo] target(s) in 0.04s\r\n     Running `/home/epage/src/personal/git-stack/target/debug/git-stack --color`\r\nerror: The argument '--color <WHEN>' requires a value but none was supplied\r\n\r\nUSAGE:\r\n    git-stack [OPTIONS]\r\n\r\nFor more information try --help\r\n```\r\n\n\n### Describe the solution you'd like\n\nFor example:\r\n```console\r\n$ cargo test --test    \r\nerror: \"--test\" takes one argument.                                      \r\nAvailable tests:                    \r\n    builder     \r\n    derive                                                               \r\n    derive_ui                       \r\n    examples                                                             \r\n    macros                                                                                                                                         \r\n    yaml                                                                 \r\n```\r\n(granted, this is dynamically generating the list)\r\n\r\nWe could also list the `PossibleValue::help` like in #3312.\n\n### Alternatives, if applicable\n\n_No response_\n\n### Additional Context\n\n_No response_",
    "clap-rs__clap-3391": "Option not to reorder possible values for an argument\n### Affected Version of clap\r\n\r\n2.33.0\r\n\r\n### Bug or Feature Request Summary\r\n\r\nI have a list of possible *numeric* values for a given argument, but clap reorders them in alphabetical (non-numeric) order.\r\n\r\n### Expected Behavior Summary\r\n\r\nBeing able to tell clap not to reorder my argument list.\r\n\r\n### Actual Behavior Summary\r\n\r\nA list of numbers (e.g. [\"0\", \"1\", \"2\", \"12\"]) is reordered in non-numeric order (e.g. [\"0\", \"1\", \"12\", \"2\"]).\r\n\r\n### Sample Code or Link to Sample Code\r\n\r\n```\r\nlet number_strings = [\"0\", \"1\", \"2\", \"12\"];\r\n\r\n(boilerplate)\r\n.arg(\r\n    Arg::with_name(\"my_arg\")\r\n    .short(\"m\")\r\n    .long(\"my_arg\")\r\n    .value_name(\"MY_ARG\")\r\n    .possible_values(&number_strings)\r\n)\r\n(boilerplate)\r\n```\r\n\r\n<details>\r\n<summary> Example Output </summary>\r\n<pre>\r\n<code>\r\n\r\nerror: 'blah' isn't a valid value for '--my_arg <MY_ARG>'\r\n        [possible values: 0, 1, 12, 2]\r\n\r\n</code>\r\n</pre>\r\n</details>\r\n",
    "clap-rs__clap-3334": "Conflicting args both present\n### Please complete the following tasks\r\n\r\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\r\n- [X] I have searched the existing issues\r\n\r\n### Rust Version\r\n\r\nrustc 1.58.1 (db9d1b20b 2022-01-20)\r\n\r\n### Clap Version\r\n\r\n3.0.10\r\n\r\n### Minimal reproducible code\r\n\r\n```rust\r\nuse clap::Parser;\r\n\r\n#[derive(Debug, Parser)]\r\nstruct Args {\r\n    /// Simulate instead of using USB\r\n    #[clap(short = 's', conflicts_with = \"usb\")]\r\n    sim: bool,\r\n\r\n    /// Sets the USB device to use\r\n    #[clap(\r\n        short = 'd',\r\n        required_unless_present = \"sim\",\r\n        group = \"usb\"\r\n    )]\r\n    device: Option<u32>,\r\n\r\n    /// Sets the time in milliseconds to wait for USB reads and writes\r\n    #[clap(\r\n        short = 't',\r\n        default_value_t = 1000,\r\n        required_unless_present = \"sim\",\r\n        group = \"usb\"\r\n    )]\r\n    timeout: u64,\r\n}\r\n\r\nfn main() {\r\n    dbg!(Args::parse());\r\n}\r\n```\r\n\r\nIn `Cargo.toml`, the \"derive\" and \"debug\" features are enabled.\r\n\r\n\r\n### Steps to reproduce the bug with the above code\r\n\r\n```console\r\n$ cargo run -- -s -d 123 # arbitrary number\r\n<output from clap \"debug\" feature is omitted>\r\n[src/main.rs:28] Args::parse() = Args {\r\n    sim: true,\r\n    device: Some(\r\n        123,\r\n    ),\r\n    timeout: 1000,\r\n}\r\n```\r\n\r\n### Actual Behaviour\r\n\r\nThe `sim` option conflicts with the group `usb` (members: `device`, `timeout`). But when `sim` is present alongside `device`, clap doesn't give any errors. In the output of the program, you can see `sim` is true, and `device` has some value.\r\n\r\n### Expected Behaviour\r\n\r\nI expect that `sim` and `device` both being present is an error, since `sim` conflicts with the group that `device` is a member of.\r\n\r\n### Additional Context\r\n\r\nInterestingly, `sim` and `timeout` both present gives an error as expected. Also, if `timeout` is changed to not have a default value, everything works as expected.\r\n\r\nLastly, explicitly listing conflicting args using `conflicts_with_all` works.\r\n\r\n### Debug Output\r\n\r\n```console\r\n$ cargo run -- -s -d 123\r\n[            clap::build::app] \tApp::_do_parse\r\n[            clap::build::app] \tApp::_build\r\n[            clap::build::app] \tApp::_propagate:reproducable-example\r\n[            clap::build::app] \tApp::_check_help_and_version\r\n[            clap::build::app] \tApp::_check_help_and_version: Removing generated version\r\n[            clap::build::app] \tApp::_propagate_global_args:reproducable-example\r\n[            clap::build::app] \tApp::_derive_display_order:reproducable-example\r\n[clap::build::app::debug_asserts] \tApp::_debug_asserts\r\n[clap::build::arg::debug_asserts] \tArg::_debug_asserts:help\r\n[clap::build::arg::debug_asserts] \tArg::_debug_asserts:sim\r\n[clap::build::arg::debug_asserts] \tArg::_debug_asserts:device\r\n[clap::build::arg::debug_asserts] \tArg::_debug_asserts:timeout\r\n[clap::build::app::debug_asserts] \tApp::_verify_positionals\r\n[         clap::parse::parser] \tParser::get_matches_with\r\n[         clap::parse::parser] \tParser::_build\r\n[         clap::parse::parser] \tParser::get_matches_with: Begin parsing 'RawOsStr(\"-s\")' ([45, 115])\r\n[         clap::parse::parser] \tParser::get_matches_with: Positional counter...1\r\n[         clap::parse::parser] \tParser::get_matches_with: Low index multiples...false\r\n[         clap::parse::parser] \tParser::possible_subcommand: arg=RawOsStr(\"-s\")\r\n[         clap::parse::parser] \tParser::get_matches_with: sc=None\r\n[         clap::parse::parser] \tParser::parse_short_arg: short_arg=RawOsStr(\"s\")\r\n[         clap::parse::parser] \tParser::parse_short_arg:iter:s\r\n[         clap::parse::parser] \tParser::parse_short_arg:iter:s: cur_idx:=1\r\n[         clap::parse::parser] \tParser::parse_short_arg:iter:s: Found valid opt or flag\r\n[         clap::parse::parser] \tParser::check_for_help_and_version_char\r\n[         clap::parse::parser] \tParser::check_for_help_and_version_char: Checking if -s is help or version...\r\n[         clap::parse::parser] \tNeither\r\n[         clap::parse::parser] \tParser::parse_flag\r\n[         clap::parse::parser] \tParser::remove_overrides: id=sim\r\n[    clap::parse::arg_matcher] \tArgMatcher::inc_occurrence_of_arg: id=sim\r\n[            clap::build::app] \tApp::groups_for_arg: id=sim\r\n[         clap::parse::parser] \tParser::get_matches_with: After parse_short_arg ValuesDone\r\n[         clap::parse::parser] \tParser::get_matches_with: Begin parsing 'RawOsStr(\"-d\")' ([45, 100])\r\n[         clap::parse::parser] \tParser::get_matches_with: Positional counter...1\r\n[         clap::parse::parser] \tParser::get_matches_with: Low index multiples...false\r\n[         clap::parse::parser] \tParser::possible_subcommand: arg=RawOsStr(\"-d\")\r\n[         clap::parse::parser] \tParser::get_matches_with: sc=None\r\n[         clap::parse::parser] \tParser::parse_short_arg: short_arg=RawOsStr(\"d\")\r\n[         clap::parse::parser] \tParser::parse_short_arg:iter:d\r\n[         clap::parse::parser] \tParser::parse_short_arg:iter:d: cur_idx:=2\r\n[         clap::parse::parser] \tParser::parse_short_arg:iter:d: Found valid opt or flag\r\n[         clap::parse::parser] \tParser::parse_short_arg:iter:d: val=RawOsStr(\"\") (bytes), val=[] (ascii), short_arg=RawOsStr(\"d\")\r\n[         clap::parse::parser] \tParser::parse_opt; opt=device, val=None\r\n[         clap::parse::parser] \tParser::parse_opt; opt.settings=ArgFlags(TAKES_VAL)\r\n[         clap::parse::parser] \tParser::parse_opt; Checking for val...\r\n[         clap::parse::parser] \tParser::parse_opt: More arg vals required...\r\n[         clap::parse::parser] \tParser::remove_overrides: id=device\r\n[    clap::parse::arg_matcher] \tArgMatcher::inc_occurrence_of_arg: id=device\r\n[            clap::build::app] \tApp::groups_for_arg: id=device\r\n[    clap::parse::arg_matcher] \tArgMatcher::inc_occurrence_of_group: id=usb\r\n[            clap::build::app] \tApp::groups_for_arg: id=device\r\n[         clap::parse::parser] \tParser::get_matches_with: After parse_short_arg Opt(device)\r\n[         clap::parse::parser] \tParser::get_matches_with: Begin parsing 'RawOsStr(\"123\")' ([49, 50, 51])\r\n[         clap::parse::parser] \tParser::get_matches_with: Positional counter...1\r\n[         clap::parse::parser] \tParser::get_matches_with: Low index multiples...false\r\n[         clap::parse::parser] \tParser::add_val_to_arg; arg=device, val=RawOsStr(\"123\")\r\n[         clap::parse::parser] \tParser::add_val_to_arg; trailing_values=false, DontDelimTrailingVals=false\r\n[         clap::parse::parser] \tParser::add_single_val_to_arg: adding val...\"123\"\r\n[         clap::parse::parser] \tParser::add_single_val_to_arg: cur_idx:=3\r\n[            clap::build::app] \tApp::groups_for_arg: id=device\r\n[    clap::parse::arg_matcher] \tArgMatcher::needs_more_vals: o=device\r\n[      clap::parse::validator] \tValidator::validate\r\n[         clap::parse::parser] \tParser::add_defaults\r\n[         clap::parse::parser] \tParser::add_defaults:iter:device:\r\n[         clap::parse::parser] \tParser::add_value: doesn't have conditional defaults\r\n[         clap::parse::parser] \tParser::add_value:iter:device: doesn't have default vals\r\n[         clap::parse::parser] \tParser::add_value:iter:device: doesn't have default missing vals\r\n[         clap::parse::parser] \tParser::add_defaults:iter:timeout:\r\n[         clap::parse::parser] \tParser::add_value: doesn't have conditional defaults\r\n[         clap::parse::parser] \tParser::add_value:iter:timeout: has default vals\r\n[         clap::parse::parser] \tParser::add_value:iter:timeout: wasn't used\r\n[            clap::build::app] \tApp::groups_for_arg: id=timeout\r\n[         clap::parse::parser] \tParser::add_single_val_to_arg: adding val...\"1000\"\r\n[         clap::parse::parser] \tParser::add_single_val_to_arg: cur_idx:=4\r\n[            clap::build::app] \tApp::groups_for_arg: id=timeout\r\n[         clap::parse::parser] \tParser::add_value:iter:timeout: doesn't have default missing vals\r\n[      clap::parse::validator] \tValidator::validate_conflicts\r\n[      clap::parse::validator] \tValidator::validate_exclusive\r\n[      clap::parse::validator] \tValidator::validate_exclusive:iter:sim\r\n[      clap::parse::validator] \tValidator::validate_exclusive:iter:device\r\n[      clap::parse::validator] \tValidator::validate_exclusive:iter:usb\r\n[      clap::parse::validator] \tValidator::validate_exclusive:iter:timeout\r\n[      clap::parse::validator] \tValidator::validate_conflicts::iter: id=sim\r\n[      clap::parse::validator] \tConflicts::gather_conflicts\r\n[            clap::build::app] \tApp::groups_for_arg: id=sim\r\n[      clap::parse::validator] \tConflicts::gather_direct_conflicts id=sim, conflicts=[usb]\r\n[            clap::build::app] \tApp::groups_for_arg: id=device\r\n[      clap::parse::validator] \tConflicts::gather_direct_conflicts id=device, conflicts=[timeout]\r\n[      clap::parse::validator] \tValidator::validate_conflicts::iter: id=device\r\n[      clap::parse::validator] \tConflicts::gather_conflicts\r\n[      clap::parse::validator] \tValidator::validate_required: required=ChildGraph([])\r\n[      clap::parse::validator] \tValidator::gather_requirements\r\n[      clap::parse::validator] \tValidator::gather_requirements:iter:sim\r\n[      clap::parse::validator] \tValidator::gather_requirements:iter:device\r\n[      clap::parse::validator] \tValidator::gather_requirements:iter:usb\r\n[      clap::parse::validator] \tValidator::gather_requirements:iter:usb:group\r\n[      clap::parse::validator] \tValidator::gather_requirements:iter:timeout\r\n[      clap::parse::validator] \tValidator::validate_required_unless\r\n[      clap::parse::validator] \tValidator::validate_matched_args\r\n[      clap::parse::validator] \tValidator::validate_matched_args:iter:sim: vals=Flatten {\r\n    inner: FlattenCompat {\r\n        iter: Fuse {\r\n            iter: Some(\r\n                Iter(\r\n                    [],\r\n                ),\r\n            ),\r\n        },\r\n        frontiter: None,\r\n        backiter: None,\r\n    },\r\n}\r\n[      clap::parse::validator] \tValidator::validate_arg_num_vals\r\n[      clap::parse::validator] \tValidator::validate_arg_values: arg=\"sim\"\r\n[      clap::parse::validator] \tValidator::validate_arg_num_occurs: \"sim\"=1\r\n[      clap::parse::validator] \tValidator::validate_matched_args:iter:device: vals=Flatten {\r\n    inner: FlattenCompat {\r\n        iter: Fuse {\r\n            iter: Some(\r\n                Iter(\r\n                    [\r\n                        [\r\n                            \"123\",\r\n                        ],\r\n                    ],\r\n                ),\r\n            ),\r\n        },\r\n        frontiter: None,\r\n        backiter: None,\r\n    },\r\n}\r\n[      clap::parse::validator] \tValidator::validate_arg_num_vals\r\n[      clap::parse::validator] \tValidator::validate_arg_values: arg=\"device\"\r\n[      clap::parse::validator] \tValidator::validate_arg_values: checking validator...\r\n[      clap::parse::validator] \tgood\r\n[      clap::parse::validator] \tValidator::validate_arg_num_occurs: \"device\"=1\r\n[      clap::parse::validator] \tValidator::validate_matched_args:iter:usb: vals=Flatten {\r\n    inner: FlattenCompat {\r\n        iter: Fuse {\r\n            iter: Some(\r\n                Iter(\r\n                    [\r\n                        [\r\n                            \"123\",\r\n                        ],\r\n                        [\r\n                            \"1000\",\r\n                        ],\r\n                    ],\r\n                ),\r\n            ),\r\n        },\r\n        frontiter: None,\r\n        backiter: None,\r\n    },\r\n}\r\n[      clap::parse::validator] \tValidator::validate_matched_args:iter:timeout: vals=Flatten {\r\n    inner: FlattenCompat {\r\n        iter: Fuse {\r\n            iter: Some(\r\n                Iter(\r\n                    [\r\n                        [\r\n                            \"1000\",\r\n                        ],\r\n                    ],\r\n                ),\r\n            ),\r\n        },\r\n        frontiter: None,\r\n        backiter: None,\r\n    },\r\n}\r\n[      clap::parse::validator] \tValidator::validate_arg_num_vals\r\n[      clap::parse::validator] \tValidator::validate_arg_values: arg=\"timeout\"\r\n[      clap::parse::validator] \tValidator::validate_arg_values: checking validator...\r\n[      clap::parse::validator] \tgood\r\n[      clap::parse::validator] \tValidator::validate_arg_num_occurs: \"timeout\"=0\r\n[    clap::parse::arg_matcher] \tArgMatcher::get_global_values: global_arg_vec=[help]\r\n<output from actual program is omitted>",
    "clap-rs__clap-3311": "debug_assert fails with PropagateVersion in 3.0.8/3.0.9, but get_matches does not\n### Please complete the following tasks\n\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\n- [X] I have searched the existing issues\n\n### Rust Version\n\nrustc 1.57.0 (f1edd0429 2021-11-29)\n\n### Clap Version\n\n3.0.9\n\n### Minimal reproducible code\n\n```rust\r\nfn cli() -> clap::App<'static> {\r\n    clap::App::new(env!(\"CARGO_PKG_NAME\"))\r\n        .version(env!(\"CARGO_PKG_VERSION\"))\r\n        .global_setting(clap::AppSettings::PropagateVersion)\r\n        .subcommand(clap::App::new(\"subcommand\"))\r\n}\r\n\r\nfn main() {\r\n    let cli = cli();\r\n    cli.get_matches();\r\n}\r\n\r\n#[cfg(test)]\r\nmod tests {\r\n    #[test]\r\n    fn test_cli() {\r\n        super::cli().debug_assert();\r\n    }\r\n}\r\n```\r\n\n\n### Steps to reproduce the bug with the above code\n\n`cargo run -- --help` succeeds, but `cargo test` fails\n\n### Actual Behaviour\n\nPropagateVersion should work in debug_assert\n\n### Expected Behaviour\n\nPropagateVersion seems to not work in debug_assert\n\n### Additional Context\n\nIf I pin `clap` to `=3.0.7`, this works, so this is a regression in 3.0.8\n\n### Debug Output\n\n```\r\nrunning 1 test\r\n[            clap::build::app] \tApp::_build\r\n[            clap::build::app] \tApp::_propagate:clp-test\r\n[            clap::build::app] \tApp::_check_help_and_version\r\n[            clap::build::app] \tApp::_check_help_and_version: Building help subcommand\r\n[            clap::build::app] \tApp::_propagate_global_args:clp-test\r\n[            clap::build::app] \tApp::_derive_display_order:clp-test\r\n[            clap::build::app] \tApp::_derive_display_order:subcommand\r\n[            clap::build::app] \tApp::_derive_display_order:help\r\n[clap::build::app::debug_asserts] \tApp::_debug_asserts\r\n[clap::build::arg::debug_asserts] \tArg::_debug_asserts:help\r\n[clap::build::arg::debug_asserts] \tArg::_debug_asserts:version\r\n[clap::build::app::debug_asserts] \tApp::_verify_positionals\r\n[            clap::build::app] \tApp::_build\r\n[            clap::build::app] \tApp::_propagate:subcommand\r\n[            clap::build::app] \tApp::_check_help_and_version\r\n[            clap::build::app] \tApp::_propagate_global_args:subcommand\r\n[            clap::build::app] \tApp::_derive_display_order:subcommand\r\n[clap::build::app::debug_asserts] \tApp::_debug_asserts\r\n[clap::build::arg::debug_asserts] \tArg::_debug_asserts:help\r\n[clap::build::arg::debug_asserts] \tArg::_debug_asserts:version\r\n[clap::build::app::debug_asserts] \tApp::_verify_positionals\r\n[            clap::build::app] \tApp::_build\r\n[            clap::build::app] \tApp::_propagate:help\r\n[            clap::build::app] \tApp::_check_help_and_version\r\n[            clap::build::app] \tApp::_check_help_and_version: Removing generated help\r\n[            clap::build::app] \tApp::_check_help_and_version: Removing generated version\r\n[            clap::build::app] \tApp::_propagate_global_args:help\r\n[            clap::build::app] \tApp::_derive_display_order:help\r\n[clap::build::app::debug_asserts] \tApp::_debug_asserts\r\ntest tests::test_cli ... FAILED\r\n\r\nfailures:\r\n\r\n---- tests::test_cli stdout ----\r\nthread 'tests::test_cli' panicked at 'App help: No version information via App::version or App::long_version to propagate', /Users/jbrown/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-3.0.9/src/build/app/debug_asserts.rs:18:9\r\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\r\n\r\n```",
    "clap-rs__clap-3225": "Flags that take multiple value cannot be partially overridden\n### Please complete the following tasks\r\n\r\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\r\n- [X] I have searched the existing issues\r\n\r\n### Rust Version\r\n\r\nrustc 1.56.0 (09c42c458 2021-10-18)\r\n\r\n### Clap Version\r\n\r\n3.0.0-rc.8\r\n\r\n### Minimal reproducible code\r\n\r\n```rust\r\nuse clap::Parser;\r\n\r\n/// Simple program to greet a person\r\n#[derive(Parser, Debug)]\r\nstruct Args {\r\n    /// Number of times to greet\r\n    #[clap(short, long, number_of_values = 1)]\r\n    name: Vec<String>,\r\n\r\n    #[clap(long, overrides_with = \"name\")]\r\n    no_name: bool,\r\n}\r\n\r\nfn main() {\r\n    let _ = dbg!(Args::parse());\r\n}\r\n```\r\n\r\n\r\n### Steps to reproduce the bug with the above code\r\n\r\n```\r\ncargo run -- --name=ahmed --no-name --name=ali\r\n```\r\n\r\n### Actual Behaviour\r\n`--no-name` is not unsetting the previous values of `--name`\r\n```\r\n[src/main.rs:15] Args::parse() = Args {\r\n    name: [\r\n        \"ahmed\",\r\n        \"ali\",\r\n    ],\r\n    no_name: false,\r\n}\r\n```\r\n\r\n### Expected Behaviour\r\n\r\nFrom Clap 2.x/StructOpt\r\n```\r\n[src/main.rs:16] Args::from_args() = Args {\r\n    name: [\r\n        \"ali\",\r\n    ],\r\n    no_name: false,\r\n}\r\n```\r\n\r\n### Additional Context\r\n\r\nNo response\r\n\r\n### Debug Output\r\n\r\nNo response",
    "clap-rs__clap-3212": "Internal error when using `conflicts_with` with `ArgGroup`\n### Please complete the following tasks\n\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\n- [X] I have searched the existing issues\n\n### Rust Version\n\nrustc 1.57.0 (f1edd0429 2021-11-29)\n\n### Clap Version\n\n3.0.0-rc.7\n\n### Minimal reproducible code\n\n```rust\r\nuse clap::{App, Arg, ArgGroup};\r\n\r\nfn main() {\r\n    let m = App::new(\"demoapp\")\r\n        .arg(Arg::new(\"foo\").long(\"foo\").conflicts_with(\"argument-group\"))\r\n        .arg(Arg::new(\"bar\").long(\"bar\"))\r\n        .group(ArgGroup::new(\"argument-group\").arg(\"bar\"))\r\n        .get_matches();\r\n\r\n    dbg!(m);\r\n}\r\n\r\n```\r\n\n\n### Steps to reproduce the bug with the above code\n\n`cargo run -- --foo`\n\n### Actual Behaviour\n\nThe program panics, with the following internal error:\r\n\r\n```\r\nthread 'main' panicked at 'Fatal internal error. Please consider filing a bug report at https://github.com/clap-rs/clap/issues', /home/elomatreb/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-3.0.0-rc.7/src/parse/validator.rs:240:18\r\nstack backtrace:\r\n   0: rust_begin_unwind\r\n             at /rustc/f1edd0429582dd29cccacaf50fd134b05593bd9c/library/std/src/panicking.rs:517:5\r\n   1: core::panicking::panic_fmt\r\n             at /rustc/f1edd0429582dd29cccacaf50fd134b05593bd9c/library/core/src/panicking.rs:100:14\r\n   2: core::panicking::panic_display\r\n             at /rustc/f1edd0429582dd29cccacaf50fd134b05593bd9c/library/core/src/panicking.rs:64:5\r\n   3: core::option::expect_failed\r\n             at /rustc/f1edd0429582dd29cccacaf50fd134b05593bd9c/library/core/src/option.rs:1638:5\r\n   4: core::option::Option<T>::expect\r\n             at /rustc/f1edd0429582dd29cccacaf50fd134b05593bd9c/library/core/src/option.rs:709:21\r\n   5: clap::parse::validator::Validator::build_conflict_err\r\n             at /home/elomatreb/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-3.0.0-rc.7/src/parse/validator.rs:237:25\r\n   6: clap::parse::validator::Validator::validate_conflicts::{{closure}}\r\n             at /home/elomatreb/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-3.0.0-rc.7/src/parse/validator.rs:304:33\r\n   7: core::iter::traits::iterator::Iterator::try_for_each::call::{{closure}}\r\n             at /rustc/f1edd0429582dd29cccacaf50fd134b05593bd9c/library/core/src/iter/traits/iterator.rs:2053:26\r\n   8: core::iter::adapters::filter::filter_try_fold::{{closure}}\r\n             at /rustc/f1edd0429582dd29cccacaf50fd134b05593bd9c/library/core/src/iter/adapters/filter.rs:44:44\r\n   9: core::iter::adapters::map::map_try_fold::{{closure}}\r\n             at /rustc/f1edd0429582dd29cccacaf50fd134b05593bd9c/library/core/src/iter/adapters/map.rs:91:21\r\n  10: core::iter::traits::iterator::Iterator::try_fold\r\n             at /rustc/f1edd0429582dd29cccacaf50fd134b05593bd9c/library/core/src/iter/traits/iterator.rs:1995:21\r\n  11: <core::iter::adapters::map::Map<I,F> as core::iter::traits::iterator::Iterator>::try_fold\r\n             at /rustc/f1edd0429582dd29cccacaf50fd134b05593bd9c/library/core/src/iter/adapters/map.rs:117:9\r\n  12: <core::iter::adapters::filter::Filter<I,P> as core::iter::traits::iterator::Iterator>::try_fold\r\n             at /rustc/f1edd0429582dd29cccacaf50fd134b05593bd9c/library/core/src/iter/adapters/filter.rs:93:9\r\n  13: core::iter::traits::iterator::Iterator::try_for_each\r\n             at /rustc/f1edd0429582dd29cccacaf50fd134b05593bd9c/library/core/src/iter/traits/iterator.rs:2056:9\r\n  14: clap::parse::validator::Validator::validate_conflicts\r\n             at /home/elomatreb/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-3.0.0-rc.7/src/parse/validator.rs:264:9\r\n  15: clap::parse::validator::Validator::validate\r\n             at /home/elomatreb/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-3.0.0-rc.7/src/parse/validator.rs:72:9\r\n  16: clap::parse::parser::Parser::get_matches_with\r\n             at /home/elomatreb/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-3.0.0-rc.7/src/parse/parser.rs:702:9\r\n  17: clap::build::app::App::_do_parse\r\n             at /home/elomatreb/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-3.0.0-rc.7/src/build/app/mod.rs:2565:29\r\n  18: clap::build::app::App::try_get_matches_from_mut\r\n             at /home/elomatreb/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-3.0.0-rc.7/src/build/app/mod.rs:649:9\r\n  19: clap::build::app::App::get_matches_from\r\n             at /home/elomatreb/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-3.0.0-rc.7/src/build/app/mod.rs:519:9\r\n  20: clap::build::app::App::get_matches\r\n             at /home/elomatreb/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-3.0.0-rc.7/src/build/app/mod.rs:431:9\r\n  21: claptest::main\r\n             at ./src/main.rs:4:13\r\n  22: core::ops::function::FnOnce::call_once\r\n             at /rustc/f1edd0429582dd29cccacaf50fd134b05593bd9c/library/core/src/ops/function.rs:227:5\r\n```\n\n### Expected Behaviour\n\nThe program should work, outputting something like\r\n```\r\n[src/main.rs:10] m = ArgMatches {\r\n    valid_args: [\r\n        help,\r\n        foo,\r\n        bar,\r\n        argument-group,\r\n    ],\r\n    valid_subcommands: [],\r\n    args: {\r\n        foo: MatchedArg {\r\n            occurs: 1,\r\n            ty: CommandLine,\r\n            indices: [\r\n                1,\r\n            ],\r\n            vals: [],\r\n            ignore_case: false,\r\n            invalid_utf8_allowed: Some(\r\n                false,\r\n            ),\r\n        },\r\n    },\r\n    subcommand: None,\r\n}\r\n```\n\n### Additional Context\n\nI am trying to make a single argument conflict with a `ArgGroup` (to save on repetition). If I instead place the `conflicts_with(\"foo\")` on  the argument group definition, it works as expected.\r\n\r\nI'm assuming using the `conflicts_with` method on the individual argument should be possible too, but if it isn't supposed to be possible, a better error message would be good.\n\n### Debug Output\n\n```\r\n[            clap::build::app] \tApp::_do_parse\r\n[            clap::build::app] \tApp::_build\r\n[            clap::build::app] \tApp::_propagate:demoapp\r\n[            clap::build::app] \tApp::_check_help_and_version\r\n[            clap::build::app] \tApp::_check_help_and_version: Removing generated version\r\n[            clap::build::app] \tApp::_propagate_global_args:demoapp\r\n[            clap::build::app] \tApp::_derive_display_order:demoapp\r\n[clap::build::app::debug_asserts] \tApp::_debug_asserts\r\n[clap::build::arg::debug_asserts] \tArg::_debug_asserts:help\r\n[clap::build::arg::debug_asserts] \tArg::_debug_asserts:foo\r\n[clap::build::arg::debug_asserts] \tArg::_debug_asserts:bar\r\n[         clap::parse::parser] \tParser::get_matches_with\r\n[         clap::parse::parser] \tParser::_build\r\n[         clap::parse::parser] \tParser::_verify_positionals\r\n[         clap::parse::parser] \tParser::get_matches_with: Begin parsing 'RawOsStr(\"--foo\")' ([45, 45, 102, 111, 111])\r\n[         clap::parse::parser] \tParser::get_matches_with: Positional counter...1\r\n[         clap::parse::parser] \tParser::get_matches_with: Low index multiples...false\r\n[         clap::parse::parser] \tParser::possible_subcommand: arg=RawOsStr(\"--foo\")\r\n[         clap::parse::parser] \tParser::get_matches_with: sc=None\r\n[         clap::parse::parser] \tParser::parse_long_arg\r\n[         clap::parse::parser] \tParser::parse_long_arg: cur_idx:=1\r\n[         clap::parse::parser] \tParser::parse_long_arg: Does it contain '='...\r\n[         clap::parse::parser] \tNo\r\n[         clap::parse::parser] \tParser::parse_long_arg: Found valid opt or flag '--foo'\r\n[         clap::parse::parser] \tParser::check_for_help_and_version_str\r\n[         clap::parse::parser] \tParser::check_for_help_and_version_str: Checking if --RawOsStr(\"foo\") is help or version...\r\n[         clap::parse::parser] \tNeither\r\n[         clap::parse::parser] \tParser::parse_long_arg: Presence validated\r\n[         clap::parse::parser] \tParser::parse_flag\r\n[    clap::parse::arg_matcher] \tArgMatcher::inc_occurrence_of_arg: id=foo\r\n[            clap::build::app] \tApp::groups_for_arg: id=foo\r\n[         clap::parse::parser] \tParser::get_matches_with: After parse_long_arg ValuesDone\r\n[         clap::parse::parser] \tParser::remove_overrides\r\n[         clap::parse::parser] \tParser::remove_overrides:iter:foo\r\n[      clap::parse::validator] \tValidator::validate\r\n[         clap::parse::parser] \tParser::add_defaults\r\n[      clap::parse::validator] \tValidator::validate_conflicts\r\n[      clap::parse::validator] \tValidator::validate_exclusive\r\n[      clap::parse::validator] \tValidator::validate_exclusive:iter:foo\r\n[      clap::parse::validator] \tValidator::gather_conflicts\r\n[      clap::parse::validator] \tValidator::gather_conflicts:iter: id=foo\r\n[            clap::build::app] \tApp::groups_for_arg: id=foo\r\n[      clap::parse::validator] \tValidator::validate_conflicts:iter:argument-group\r\n[            clap::build::app] \tApp::unroll_args_in_group: group=argument-group\r\n[            clap::build::app] \tApp::unroll_args_in_group:iter: entity=bar\r\n[            clap::build::app] \tApp::unroll_args_in_group:iter: this is an arg\r\n[      clap::parse::validator] \tValidator::build_conflict_err: name=argument-group\r\n[         clap::output::usage] \tUsage::create_usage_with_title\r\n[         clap::output::usage] \tUsage::create_usage_no_title\r\n[         clap::output::usage] \tUsage::create_help_usage; incl_reqs=true\r\n[         clap::output::usage] \tUsage::get_required_usage_from: incls=[], matcher=false, incl_last=false\r\n[         clap::output::usage] \tUsage::get_required_usage_from: unrolled_reqs={}\r\n[         clap::output::usage] \tUsage::get_required_usage_from: ret_val=[]\r\n[         clap::output::usage] \tUsage::needs_options_tag\r\n[         clap::output::usage] \tUsage::needs_options_tag:iter: f=help\r\n[         clap::output::usage] \tUsage::needs_options_tag:iter Option is built-in\r\n[         clap::output::usage] \tUsage::needs_options_tag:iter: f=foo\r\n[            clap::build::app] \tApp::groups_for_arg: id=foo\r\n[         clap::output::usage] \tUsage::needs_options_tag:iter: [OPTIONS] required\r\n[         clap::output::usage] \tUsage::create_help_usage: usage=claptest [OPTIONS]\r\n[            clap::build::app] \tApp::unroll_args_in_group: group=argument-group\r\n[            clap::build::app] \tApp::unroll_args_in_group:iter: entity=bar\r\n[            clap::build::app] \tApp::unroll_args_in_group:iter: this is an arg\r\n```",
    "clap-rs__clap-3196": "Next-line help is always used despite no long-help being shown (despite `long_about` being set on a subcommand)\n### Discussed in https://github.com/clap-rs/clap/discussions/3178\r\n\r\n### clap version\r\n\r\n`master`\r\n\r\n### rust version\r\n\r\n `rustc 1.59.0-nightly (404c8471a 2021-12-14)`\r\n\r\n### Minimal Reproducible Code\r\n\r\n```rust\r\nuse clap::StructOpt;\r\n\r\n#[derive(StructOpt, Debug)]\r\npub struct Opts {\r\n    #[structopt(subcommand)]\r\n    pub subcmd: SubCommand,\r\n}\r\n\r\n#[derive(StructOpt, Debug)]\r\npub struct SampleSubcmd {\r\n    testopt: Option<String>,\r\n}\r\n\r\n#[derive(StructOpt, Debug)]\r\npub enum SubCommand {\r\n    /// With just this line everything renders normally\r\n    ///\r\n    /// THIS NEW PARAGRAPH CHANGES FORMATTING\r\n    Subcmd(SampleSubcmd),\r\n}\r\n\r\nfn main() {\r\n    let _opts = Opts::from_args();\r\n}\r\n```\r\n\r\n### Reproduction steps\r\n\r\n```rust\r\n$ cargo run -- --help\r\n```\r\n\r\n### Expected Behavior\r\n\r\n```\r\ntest-clap 0.1.0\r\n\r\nUSAGE:\r\n    test-clap <SUBCOMMAND>\r\n\r\nFLAGS:\r\n    -h, --help       Prints help information\r\n    -V, --version    Prints version information\r\n\r\nSUBCOMMANDS:\r\n    help      Prints this message or the help of the given subcommand(s)\r\n    subcmd    With just this line everything renders normally\r\n```\r\n\r\n### Actual Behavior\r\n\r\n```\r\ntest-clap \r\n\r\nUSAGE:\r\n    test-clap <SUBCOMMAND>\r\n\r\nOPTIONS:\r\n    -h, --help\r\n            Print help information\r\n\r\nSUBCOMMANDS:\r\n    help\r\n            Print this message or the help of the given subcommand(s)\r\n    subcmd\r\n            With just this line everything renders normally\r\n```\r\n\r\n### Context\r\n\r\nclap2 shows args on next line but not subcommands.\r\n\r\nNote that `long_about` is being set but isn't being shown.\r\n\r\nLooks like this is a bug in clap3.\r\n\r\nThis has levels of fixes\r\n1. Ignore `next_line_help` for subcommands to get to clap2's behavior\r\n2. Ignore subcommands when calculating whether to use `next_line_help` since short help has precedence over long help (fixes the issue reported here)\r\n3. Actually respect short vs long with subcommands and show \"THIS NEW PARAGRAPH CHANGES FORMATTING\" (I worry there is a reason this wasn't done that is eluding me)\r\n\r\nThe next part to consider is whether\r\n- args and subcommands should infer `next_line_help` separately\r\n- whether we should stop doing global `next_line_help` inferring and leave it to the individual args",
    "clap-rs__clap-3179": "Too much whitespace in output\n### Please complete the following tasks\r\n\r\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\r\n- [X] I have searched the existing issues\r\n\r\n### Rust Version\r\n\r\nrustc 1.55.0 (c8dfcfe04 2021-09-06)\r\n\r\n### Clap Version\r\n\r\n3.0.0-rc.0\r\n\r\n### Minimal reproducible code\r\n\r\n```rust\r\nuse structopt::StructOpt;\r\n\r\n#[derive(StructOpt, Debug)]\r\n#[structopt(author, about)]\r\nstruct Opt {}\r\n\r\nfn main() {\r\n    let opt = Opt::from_args();\r\n    dbg!(opt);\r\n}\r\n\r\n```\r\n\r\n\r\n### Steps to reproduce the bug with the above code\r\n\r\ncargo run -- --help\r\n\r\n### Actual Behaviour\r\n\r\n```\r\ntest-clap 0.1.0      \r\n                                                                         \r\nMe                                                                       \r\n                                    \r\nFrom Cargo.toml\r\n                                                                         \r\nUSAGE:                                                                   \r\n    test-clap                       \r\n                                                                         \r\nOPTIONS:             \r\n    -h, --help       Print help information                              \r\n    -V, --version    Print version information                \r\n```\r\n\r\n### Expected Behaviour\r\n\r\nNote quite but similar to clap2 which is\r\n```\r\ntest-clap 0.1.0                                                          \r\nMe                   \r\nFrom Cargo.toml\r\n                                                                         \r\nUSAGE:                                                                   \r\n    test-clap                       \r\n                                                                         \r\nFLAGS:               \r\n    -h, --help       Prints help information                             \r\n    -V, --version    Prints version information\r\n```\r\n\r\nMaybe\r\n```\r\ntest-clap 0.1.0                                                          \r\nMe                   \r\n\r\nFrom Cargo.toml\r\n                                                                         \r\nUSAGE:                                                                   \r\n    test-clap                       \r\n                                                                         \r\nFLAGS:               \r\n    -h, --help       Prints help information                             \r\n    -V, --version    Prints version information\r\n```\r\n\r\nor\r\n```\r\ntest-clap 0.1.0 - From Cargo.toml \r\nMe                   \r\n                                                                         \r\nUSAGE:                                                                   \r\n    test-clap                       \r\n                                                                         \r\nFLAGS:               \r\n    -h, --help       Prints help information                             \r\n    -V, --version    Prints version information\r\n```\r\n\r\n\r\n### Additional Context\r\n\r\nThis came from [reddit](https://www.reddit.com/r/rust/comments/rbyi41/ann_clap_300rc0/hnri0lw/).\r\n\r\n### Debug Output\r\n\r\n_No response_",
    "clap-rs__clap-3169": "global_setting DisableVersionFlag and DisableHelpFlag don't remove auto completion for subcommands fully\n### Please complete the following tasks\r\n\r\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\r\n- [X] I have searched the existing issues\r\n\r\n### Rust Version\r\n\r\nrustc 1.54.0 (a178d0322 2021-07-26)\r\n\r\n### Clap Version\r\n\r\nmaster\r\n\r\n### Minimal reproducible code\r\n\r\n```rust\r\nuse clap::{AppSettings, Clap, IntoApp};\r\nuse clap_generate::generators;\r\n\r\nfn main() {\r\n    // App::parse();\r\n\r\n    clap_generate::generate::<generators::Fish, _>(\r\n        &mut App::into_app(),\r\n        \"command\",\r\n        &mut std::io::stdout(),\r\n    );\r\n}\r\n\r\n#[derive(Clap)]\r\n#[clap(global_setting=AppSettings::DisableVersionFlag, global_setting=AppSettings::DisableHelpFlag)]\r\nstruct App {\r\n    #[clap(subcommand)]\r\n    subcommand: A,\r\n}\r\n\r\n#[derive(Clap)]\r\nenum A {\r\n    A,\r\n}\r\n```\r\n\r\n\r\n### Steps to reproduce the bug with the above code\r\n\r\nadd clap and clap_generate (master) to your project\r\n`cargo run`\r\n\r\n### Actual Behaviour\r\n\r\nThe generated completions are:\r\n```sh\r\ncomplete -c command -n \"__fish_use_subcommand\" -f -a \"a\"\r\ncomplete -c command -n \"__fish_use_subcommand\" -f -a \"help\" -d 'Print this message or the help of the given subcommand(s)'\r\ncomplete -c command -n \"__fish_seen_subcommand_from a\" -l help -d 'Print help information'\r\ncomplete -c command -n \"__fish_seen_subcommand_from a\" -l version -d 'Print version information'\r\ncomplete -c command -n \"__fish_seen_subcommand_from help\" -l help -d 'Print help information'\r\ncomplete -c command -n \"__fish_seen_subcommand_from help\" -l version -d 'Print version information'\r\n```\r\n\r\n### Expected Behaviour\r\n\r\nThe generated completions should be without the --help and --version:\r\n```sh\r\ncomplete -c command -n \"__fish_use_subcommand\" -f -a \"a\"\r\ncomplete -c command -n \"__fish_use_subcommand\" -f -a \"help\" -d 'Print this message or the help of the given subcommand(s)'\r\n```\r\n\r\n### Additional Context\r\n\r\n_No response_\r\n\r\n### Debug Output\r\n\r\n```\r\n    Finished dev [unoptimized + debuginfo] target(s) in 0.01s\r\n     Running `target/debug/clap-issue`\r\n[            clap::build::app]  App::_build\r\n[            clap::build::app]  App::_propagate:clap-issue\r\n[            clap::build::app]  App::_check_help_and_version\r\n[            clap::build::app]  App::_check_help_and_version: Removing generated help\r\n[            clap::build::app]  App::_check_help_and_version: Removing generated version\r\n[            clap::build::app]  App::_check_help_and_version: Building help subcommand\r\n[            clap::build::app]  App::_propagate_global_args:clap-issue\r\n[            clap::build::app]  App::_derive_display_order:clap-issue\r\n[            clap::build::app]  App::_derive_display_order:a\r\n[            clap::build::app]  App::_derive_display_order:help\r\n[clap::build::app::debug_asserts]       App::_debug_asserts\r\n[            clap::build::app]  App::_build_bin_names\r\n[            clap::build::app]  App::_build_bin_names:iter: bin_name set...\r\n[            clap::build::app]  No\r\n[            clap::build::app]  App::_build_bin_names:iter: Setting bin_name of clap-issue to command a\r\n[            clap::build::app]  App::_build_bin_names:iter: Calling build_bin_names from...a\r\n[            clap::build::app]  App::_build_bin_names\r\n[            clap::build::app]  App::_build_bin_names:iter: bin_name set...\r\n[            clap::build::app]  No\r\n[            clap::build::app]  App::_build_bin_names:iter: Setting bin_name of clap-issue to command help\r\n[            clap::build::app]  App::_build_bin_names:iter: Calling build_bin_names from...help\r\n[            clap::build::app]  App::_build_bin_names\r\n[clap_generate::generators::shells::fish]       gen_fish_inner\r\n[clap_generate::generators::shells::fish]       gen_fish_inner: bin_name=command\r\n[   clap_generate::generators]  flags: name=clap-issue\r\n[clap_generate::generators::shells::fish]       gen_fish_inner\r\n[clap_generate::generators::shells::fish]       gen_fish_inner: bin_name=a\r\n[   clap_generate::generators]  flags: name=a\r\n[clap_generate::generators::shells::fish]       gen_fish_inner\r\n[clap_generate::generators::shells::fish]       gen_fish_inner: bin_name=help\r\n[   clap_generate::generators]  flags: name=help\r\ncomplete -c command -n \"__fish_use_subcommand\" -f -a \"a\"\r\ncomplete -c command -n \"__fish_use_subcommand\" -f -a \"help\" -d 'Print this message or the help of the given subcommand(s)'\r\ncomplete -c command -n \"__fish_seen_subcommand_from a\" -l help -d 'Print help information'\r\ncomplete -c command -n \"__fish_seen_subcommand_from a\" -l version -d 'Print version information'\r\ncomplete -c command -n \"__fish_seen_subcommand_from help\" -l help -d 'Print help information'\r\ncomplete -c command -n \"__fish_seen_subcommand_from help\" -l version -d 'Print version information'\r\n```",
    "clap-rs__clap-3023": "Deriving for generic structs\n### Please complete the following tasks\n\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\n- [X] I have searched the existing issues\n\n### Clap Version\n\n3.0.0-beta.4\n\n### Describe your use case\n\nI would like to have a library with most common cli arguments, and then allow the main crate to specify additional, like:\r\n\r\n```\r\n#[derive(Clap)]\r\nstruct GenericArgs<T: Clap> {\r\n    #[clap(long)]\r\n    something_generic: Option<String>,\r\n    #[clap(flatten)]\r\n    app_args: T,\r\n}\r\n```\r\n\r\nThe derive macro currently does not support generic structs though\n\n### Describe the solution you'd like\n\nThe easiest solution and one that works for me would be inserting just generic args as they were in the definition into the implementation.\r\n\r\nAs you see, I have put `T: Clap` trait bound in the struct definition since it will be needed in the implementation.\n\n### Alternatives, if applicable\n\nOther possibility is adding those trait bounds in the implementation, so that they are not needed in struct definition. Although this would probably not work for my usecase as I'm actually not using `T` directly, and instead use `<T as my::GenericAppTrait>::Args` that implements `Clap`, so putting a bound on `T` would not work\n\n### Additional Context\n\n_No response_",
    "clap-rs__clap-3020": "Require rules ignore a defaulted value\n### \r\n\r\n- [x] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\r\n- [x] I have searched the existing issues\r\n\r\n### Description\r\n\r\nThis consolidates:\r\n- https://github.com/clap-rs/clap/issues/2714\r\n- https://github.com/clap-rs/clap/issues/1586\r\n- https://github.com/clap-rs/clap/issues/1906\r\n- https://github.com/clap-rs/clap/issues/2897\r\n\r\nAn attempt at a fix was reverted in 9753f68a76091bebd7743dc2763bb272cbd4054a.  See also #3020 ",
    "clap-rs__clap-2993": "`multiple_occurrences` behaviour does not match documentation\n### Please complete the following tasks\r\n\r\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\r\n- [X] I have searched the existing issues\r\n\r\n### Clap Version\r\n\r\n3.0.0-beta.2\r\n\r\n### Where?\r\n\r\nhttps://docs.rs/clap/3.0.0-beta.2/clap/struct.Arg.html#method.multiple_occurrences\r\n\r\n### What's wrong?\r\n\r\nThe documentation claims that with the above method set to true, something like `-a 1 2` would be disallowed and only `-a 1 -a 2` would be allowed. However, the tests don't agree:\r\n\r\nhttps://github.com/clap-rs/clap/blob/412b71efb64d9ac88667b6206c4110460c8d93e1/clap_derive/tests/options.rs#L225\r\n\r\nAnd questions have been answered based on the docs: https://github.com/clap-rs/clap/discussions/2259#discussioncomment-220052\r\n\r\n### How to fix?\r\n\r\nMake behavior match the docs, unless there is some other way of getting the behavior described in the discussions link above. \r\n\r\nTo clarify further, I'd expect the test case:\r\n\r\n```rust\r\n    assert_eq!(\r\n        Opt {\r\n            arg: Some(vec![1, 2])\r\n        },\r\n        Opt::parse_from(&[\"test\", \"-a\", \"1\", \"2\"])\r\n    );\r\n```\r\n\r\nto instead be\r\n\r\n```rust\r\n    assert_eq!(\r\n        Opt {\r\n            arg: Some(vec![1])\r\n        },\r\n        Opt::parse_from(&[\"test\", \"-a\", \"1\", \"2\"])\r\n    );\r\n```",
    "clap-rs__clap-2990": "Derive attribute that specializes a user-provided function that gets to modify `Arg`\n### Please complete the following tasks\r\n\r\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\r\n- [X] I have searched the existing issues\r\n\r\n### Clap Version\r\n\r\nmaster  879dd23963f6ed968535d6ed7bc6f192f02a0a16\r\n\r\n### Describe your use case\r\n\r\nI have a bunch of messages defined in protobuf, I'd like to make a CLI to send those messages - `clap` should be able to parse the messages from terminal. I generate rust structs from protobuf definitions using [prost](https://crates.io/crates/prost) and I can automatically add `clap_derive` attributes, but I can't specify the attributes flexibly enough to solve my use-case. \r\n\r\nProblematic cases are when one struct contains another optional struct:\r\n\r\n```rust\r\nstruct A {\r\n   simple: u32,\r\n   inner: Option<B>\r\n}\r\n\r\nstruct B {\r\n   a: u32,\r\n   b: String,\r\n}\r\n```\r\n\r\nWhen automatically adding attributes, I can differentiate between protobuf native (u32, bool, ..) types and complex types (another struct), but I don't know if the complex type is `Option<B>` or `Option<C>`.\r\n\r\nWhat I want is to parse these complex types (for example `A::inner`) from from json string from the command line. The default value in this case should be None (empty string), which is simple enough to implement currently. But, I'd also like to generate an example json value for the Some case in the CLI help. But what annotation can I add to the field `A::inner`, where I only know that its a optional struct, but don't know which struct type (B or C) it actually is?\r\n\r\nIts really easy for me to write a function to generate the string:\r\n\r\n```rust\r\nfn example_json<T: serde::Serialize>(t: T) -> &'static str { todo!() } \r\n```\r\n\r\nAll I'd need to have some attribute in `clap_derive` to call that function and I don't need to know which type is `A::inner`\r\n\r\n```rust\r\n#[derive(clap::Parser)]\r\nstruct A {\r\n   simple: u32,\r\n   #[clap(about = example_json]\r\n   inner: Option<B>\r\n}\r\n```\r\n\r\nwhich should call something like this in the right place:\r\n\r\n```rust\r\nArg::about(arg, example_json::<Option<B>>())\r\n```\r\n\r\n`default_value_t` attribute actually does exactly the type-based fn specialization - I'd just like to be able to provide the generic fn and have it specialized by the field type.\r\n\r\n### Describe the solution you'd like\r\n\r\nI implemented something that would solve my problems here:\r\n\r\nhttps://github.com/clap-rs/clap/pull/2990\r\n\r\n### Alternatives, if applicable\r\n\r\n_No response_\r\n\r\n### Additional Context\r\n\r\nConversation started on #2813",
    "clap-rs__clap-2930": "Can't set help_heading on flattened arguments in `clap_derive`\n### Please complete the following tasks\n\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\n- [X] I have searched the existing issues\n\n### Rust Version\n\nrustc 1.55.0 (c8dfcfe04 2021-09-06)\n\n### Clap Version\n\nmaster\n\n### Minimal reproducible code\n\n```rust\r\n#[test]\r\nfn flattener_set_help_heading() {\r\n    #[derive(Debug, Clone, Parser)]\r\n    struct CliOptions {\r\n        #[clap(flatten)]\r\n        #[clap(help_heading = \"HEADING A\")]\r\n        options_a: OptionsA,\r\n    }\r\n\r\n    #[derive(Debug, Clone, Args)]\r\n    struct OptionsA {\r\n        #[clap(long)]\r\n        should_be_in_section_a: Option<u32>,\r\n    }\r\n\r\n    let app = CliOptions::into_app();\r\n\r\n    let should_be_in_section_a = app\r\n        .get_arguments()\r\n        .find(|a| a.get_name() == \"should-be-in-section-a\")\r\n        .unwrap();\r\n    assert_eq!(should_be_in_section_a.get_help_heading(), Some(\"HEADING A\"));\r\n}\r\n\r\n```\r\n\n\n### Steps to reproduce the bug with the above code\n\nAdd as test and run it\n\n### Actual Behaviour\n\n```\r\n---- flattener_set_help_heading stdout ----\r\nthread 'flattener_set_help_heading' panicked at 'assertion failed: `(left == right)`\r\n  left: `None`,\r\n right: `Some(\"HEADING A\")`', clap_derive/tests/help.rs:184:5\r\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\r\n```\n\n### Expected Behaviour\n\nPasses\n\n### Additional Context\n\nIn providing [clap-verbosity-flag](https://github.com/rust-cli/clap-verbosity-flag), I don't want to prescribe for users what help heading my arguments go under.  At the moment, the only way they can set it is if they set it for the entire struct.\r\n\r\nAllowing this argument during flattening would be a big help\n\n### Debug Output\n\n_No response_",
    "clap-rs__clap-2895": "Don't leak `help_heading` when flattening\n### Please complete the following tasks\r\n\r\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\r\n- [X] I have searched the existing issues\r\n\r\n### Rust Version\r\n\r\nrustc 1.55.0 (c8dfcfe04 2021-09-06)\r\n\r\n### Clap Version\r\n\r\nv3.0.0-beta.4\r\n\r\n### Minimal reproducible code\r\n\r\n```rust\r\nuse clap::Clap;\r\n\r\n#[derive(Debug, Clone, Clap)]\r\n#[clap(help_heading = \"General\")]\r\nstruct CliOptions {\r\n    #[clap(flatten)]\r\n    options_a: OptionsA,\r\n\r\n    #[clap(flatten)]\r\n    options_b: OptionsB,\r\n}\r\n\r\n#[derive(Debug, Clone, Clap)]\r\n#[clap(help_heading = \"HEADING A\")]\r\nstruct OptionsA {\r\n    #[clap(long)]\r\n    should_be_in_section_a: Option<u32>,\r\n}\r\n\r\n#[derive(Debug, Clone, Clap)]\r\nstruct OptionsB {\r\n    #[clap(long)]\r\n    option_b: Option<u32>,\r\n}\r\n\r\nfn main() {\r\n    CliOptions::parse();\r\n}\r\n```\r\n\r\n\r\n### Steps to reproduce the bug with the above code\r\n\r\ncargo run -- --help\r\n\r\n### Actual Behaviour\r\n\r\n`option_b` is in \"HEADING A\"\r\n\r\n### Expected Behaviour\r\n\r\n`option_b` should be in `General\r\n\r\n### Additional Context\r\n\r\nThis is split out of  #2785.  \r\n\r\nSimilarly, we should also support setting `help_heading` when specifying `flatten` and it should push and pop the heading.\r\n\r\n### Debug Output\r\n\r\n_No response_",
    "clap-rs__clap-2882": "Section headings don't match contents\n### Please complete the following tasks\r\n\r\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\r\n- [X] I have searched the existing issues\r\n\r\n### Rust Version\r\n\r\nrustc 1.55.0 (c8dfcfe04 2021-09-06)\r\n\r\n### Clap Version\r\n\r\nmaster\r\n\r\n### Minimal reproducible code\r\n\r\n```rust\r\nuse clap::Clap;\r\n\r\n#[derive(Debug, Clone, Clap)]\r\nstruct CliOptions {\r\n    #[clap(flatten)]\r\n    options_a: OptionsA,\r\n\r\n    #[clap(flatten)]\r\n    options_b: OptionsB,\r\n}\r\n\r\n#[derive(Debug, Clone, Clap)]\r\n#[clap(help_heading = \"HEADING A\")]\r\nstruct OptionsA {\r\n    #[clap(long)]\r\n    should_be_in_section_a: Option<u32>,\r\n}\r\n\r\n#[derive(Debug, Clone, Clap)]\r\n#[clap(help_heading = \"HEADING B\")]\r\nstruct OptionsB {\r\n    #[clap(long)]\r\n    should_be_in_section_b: Option<u32>,\r\n}\r\n\r\nfn main() {\r\n    CliOptions::parse();\r\n}\r\n```\r\n\r\n\r\n### Steps to reproduce the bug with the above code\r\n\r\n```\r\ncargo run -- --help\r\n```\r\n\r\n### Actual Behaviour\r\n\r\n```\r\nclap-failure-example\r\n\r\nUSAGE:\r\n    clap-failure-example [OPTIONS]\r\n\r\nFLAGS:\r\n    -h, --help       Print help information\r\n    -V, --version    Print version information\r\n\r\nOPTIONS:\r\n        --should-be-in-section-a <SHOULD_BE_IN_SECTION_A>\r\n\r\nHEADING A:\r\n        --should-be-in-section-b <SHOULD_BE_IN_SECTION_B>\r\n```\r\n\r\n### Expected Behaviour\r\n\r\n```\r\nclap-failure-example\r\n\r\nUSAGE:\r\n    clap-failure-example\r\n\r\nFLAGS:\r\n    -h, --help       Print help information\r\n    -V, --version    Print version information\r\n\r\nHEADING A:\r\n        --should-be-in-section-a <SHOULD_BE_IN_SECTION_A>\r\n\r\nHEADING B:\r\n        --should-be-in-section-b <SHOULD_BE_IN_SECTION_B>\r\n```\r\n\r\n### Additional Context\r\n\r\nThis was broken by #2531.\r\n\r\n### Debug Output\r\n\r\n_No response_",
    "clap-rs__clap-2878": "clap_derive users can't set both a default `help_heading` and an arg-specific `help_heading`\n### Please complete the following tasks\r\n\r\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\r\n- [X] I have searched the existing issues\r\n\r\n### Rust Version\r\n\r\nrustc 1.55.0 (c8dfcfe04 2021-09-06)\r\n\r\n### Clap Version\r\n\r\nv3.0.0-beta.4\r\n\r\n### Minimal reproducible code\r\n\r\nNote: this assumes #2785 is fixed\r\n\r\n```rust\r\nuse clap::{IntoApp, Parser};\r\n\r\n#[test]\r\nfn arg_help_heading_applied() {\r\n    #[derive(Debug, Clone, Parser)]\r\n    #[clap(help_heading = \"DEFAULT\")]\r\n    struct CliOptions {\r\n        #[clap(long)]\r\n        #[clap(help_heading = Some(\"HEADING A\"))]\r\n        should_be_in_section_a: Option<u32>,\r\n\r\n        #[clap(long)]\r\n        should_be_in_default_section: Option<u32>,\r\n    }\r\n\r\n    let app = CliOptions::into_app();\r\n\r\n    let should_be_in_section_a = app\r\n        .get_arguments()\r\n        .find(|a| a.get_name() == \"should-be-in-section-a\")\r\n        .unwrap();\r\n    assert_eq!(should_be_in_section_a.get_help_heading(), Some(\"HEADING A\"));\r\n\r\n    let should_be_in_default_section = app\r\n        .get_arguments()\r\n        .find(|a| a.get_name() == \"DEFAULT\")\r\n        .unwrap();\r\n    assert_eq!(should_be_in_default_section.get_help_heading(), Some(\"DEFAULT\"));\r\n}\r\n```\r\n\r\n### Steps to reproduce the bug with the above code\r\n\r\nRun the test\r\n\r\n### Actual Behaviour\r\n\r\n`should_be_in_section_a` is in section `DEFAULT`\r\n\r\n### Expected Behaviour\r\n\r\n`should_be_in_section_a` is in section `HEADING A`\r\n\r\n### Additional Context\r\n\r\nPR #1211 originally added `help_heading` with the current priority\r\n(`App::help_heading` wins).\r\n\r\nIn #1958, the PR author had proposed to change this\r\n\r\n> Note that I made the existing arg's heading a priority over the one in App::help_heading\r\n\r\nThis was reverted on reviewer request because\r\n\r\n> Thanks for the priority explanation. Yes, please make the app's help\r\n> heading a priority. I can see how it would be useful when people might\r\n> want to reuse args.\r\n\r\nRe-using args is an important use case but this makes life difficult\r\nfor anyone using `help_heading` with `clap_derive` because the user\r\ncan only call `App::help_heading` once per struct.  Derive users can't get\r\nper-field granularity with `App::help_heading` like the builder API.\r\n\r\nAs a bonus, I think this will be the least surprising to users.  Users\r\ngenerally expect the more generic specification (App) to be overridden by the\r\nmore specific specification (Arg).  Honestly, I had thought this Issue's Expected Behavior is\r\nhow `help_heading` worked  until I dug into the code with #2872.\r\n\r\nIn the argument re-use cases, a workaround is for the reusable arguments\r\nto **not** set their help_heading and require the caller to set it as\r\nneeded\r\n\r\nNote: I have a fix ready, just blocked on #2872.\r\n\r\n### Debug Output\r\n\r\n_No response_",
    "clap-rs__clap-2867": "Default help grouping is confusing and unwanted\n### Rust Version\r\n\r\n1.55.0\r\n\r\n### Affected Version of clap\r\n\r\nv3.0.0-beta.4\r\n\r\n### Expected Behavior Summary\r\n\r\nArgs would be in a shared group by default\r\n\r\n### Actual Behavior Summary\r\n\r\nArgs are split up by their type (flags, arguments, positional)\r\n\r\n### Context\r\n\r\n`UnifiedHelpMessage` is a [very popular flag to turn on](https://github.com/clap-rs/clap/discussions/2627#discussion-3478195).  When further researching this, [only tools using clap's defaults have this styling](https://github.com/clap-rs/clap/discussions/2627#discussioncomment-1120949).\r\n\r\nOne thing to keep in mind is ideally people can use `help_heading` out of the gate (see https://github.com/clap-rs/clap/issues/2847).  This is why I recommend we remove `UnifiedHelpMessage` and the default help headings, giving us the behavior of `UnifiedHelpMessage` while also allowing `help_heading` to be used by default.\r\n\r\nGoing into more detail for why we should unify the approaches:\r\n\r\nProblems with the default\r\n- It doesn't match the users workflow.   It focuses on how the flag is used (bool or enum) and not the users task.  `help_heading` and [`DeriveDisplayOrder`](https://github.com/clap-rs/clap/issues/2808) are other examples of organizing `--help` around the users task.  Even sorting alphabetically is an okay-ish fallback when explicit organization falls flat because someone can scan for arguments that start with a letter for a word related to their task (\"I need to see files, let's scan for `--f`\"), see `rg` (which fails frequently for me...).  Once I find the argument, I then care about how to use it (did they use a flag or an option with an enum and what are the values).\r\n  - Someone might say \"isn't this also true for argument and subcommand\" but it isn't.  Generally, when using positional arguments or subcommands, all flags/options are subordinate to them and having them separate-by-default goes alongwith the task-oriented organization.\r\n- It is [frequently disabled](https://github.com/clap-rs/clap/discussions/2627#discussion-3478195) and not following what people want with a default requires people be \"in the known\" and go through the effort of copy/pasting all of the non-defaults they set between apps they write (and frequently miss this and leave a less than desired experience)\r\n- The distinction between \"flag\" and \"option\" are confusing because\r\n  - People tend to be imprecise in their language, muddying definitions\r\n  - Sometimes something is both like `--color[=<when>]`\r\n\r\nProblems with `UnifiedHelpMessage`\r\n- The name is a misnomer; it only applies to Flags vs Options. It had been a while since I've dealt with my own tools help that I assumed this would also include Arguments and thought clap3 had a bug because it didn't.\r\n  - Yes, this is \"solved\" by documentation but that only helps when people read it which they are unlikely to do when the name already documents the behavior\r\n- It can't be used with `help_heading` (https://github.com/clap-rs/clap/issues/2847) and making it do so makes the name even more of a misnomer\r\n- At least for me, its difficult to come up with an accurate name that encompasses current behavior or if we add `help_heading` which suggests something is off about the feature.",
    "clap-rs__clap-2804": "Cannot use multiple values with multiple occurrences with positional arguments\n### Please complete the following tasks\n\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\n- [X] I have searched the existing issues\n\n### Rust Version\n\nrustc 1.55.0 (c8dfcfe04 2021-09-06)\n\n### Clap Version\n\nv3.0.0-beta.4\n\n### Minimal reproducible code\n\n```rust\r\n#[test]\r\nfn values_per_occurrence_named() {\r\n    let mut a = App::new(\"test\").arg(\r\n        Arg::new(\"pos\")\r\n            .long(\"pos\")\r\n            .number_of_values(2)\r\n            .multiple_occurrences(true),\r\n    );\r\n\r\n    let m = a.try_get_matches_from_mut(vec![\"myprog\", \"--pos\", \"val1\", \"val2\"]);\r\n    let m = match m {\r\n        Ok(m) => m,\r\n        Err(err) => panic!(\"{}\", err),\r\n    };\r\n    assert_eq!(\r\n        m.values_of(\"pos\").unwrap().collect::<Vec<_>>(),\r\n        [\"val1\", \"val2\"]\r\n    );\r\n\r\n    let m = a.try_get_matches_from_mut(vec![\r\n        \"myprog\", \"--pos\", \"val1\", \"val2\", \"--pos\", \"val3\", \"val4\",\r\n    ]);\r\n    let m = match m {\r\n        Ok(m) => m,\r\n        Err(err) => panic!(\"{}\", err),\r\n    };\r\n    assert_eq!(\r\n        m.values_of(\"pos\").unwrap().collect::<Vec<_>>(),\r\n        [\"val1\", \"val2\", \"val3\", \"val4\"]\r\n    );\r\n}\r\n\r\n#[test]\r\nfn values_per_occurrence_positional() {\r\n    let mut a = App::new(\"test\").arg(\r\n        Arg::new(\"pos\")\r\n            .number_of_values(2)\r\n            .multiple_occurrences(true),\r\n    );\r\n\r\n    let m = a.try_get_matches_from_mut(vec![\"myprog\", \"val1\", \"val2\"]);\r\n    let m = match m {\r\n        Ok(m) => m,\r\n        Err(err) => panic!(\"{}\", err),\r\n    };\r\n    assert_eq!(\r\n        m.values_of(\"pos\").unwrap().collect::<Vec<_>>(),\r\n        [\"val1\", \"val2\"]\r\n    );\r\n\r\n    let m = a.try_get_matches_from_mut(vec![\"myprog\", \"val1\", \"val2\", \"val3\", \"val4\"]);\r\n    let m = match m {\r\n        Ok(m) => m,\r\n        Err(err) => panic!(\"{}\", err),\r\n    };\r\n    assert_eq!(\r\n        m.values_of(\"pos\").unwrap().collect::<Vec<_>>(),\r\n        [\"val1\", \"val2\", \"val3\", \"val4\"]\r\n    );\r\n}\r\n```\r\n\n\n### Steps to reproduce the bug with the above code\n\n1. Add to `tests/multiple_values.rs`\r\n2. Run `cargo test --test multiple_values -- values_per_occurrence`\n\n### Actual Behaviour\n\n```\r\nrunning 2 tests\r\ntest values_per_occurrence_named ... ok\r\ntest values_per_occurrence_positional ... FAILED\r\n\r\nfailures:\r\n\r\n---- values_per_occurrence_positional stdout ----\r\nthread 'values_per_occurrence_positional' panicked at 'Argument 'pos' is a positional argument and can't be set as multiple occurrences', src/build/arg/debug_asserts.rs:40:9\r\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\r\n\r\n\r\nfailures:\r\n    values_per_occurrence_positional\r\n\r\ntest result: FAILED. 1 passed; 1 failed; 0 ignored; 0 measured; 59 filtered out; finished in 0.01s\r\n\r\nerror: test failed, to rerun pass '-p clap --test multiple_values'\r\n```\n\n### Expected Behaviour\n\n```\r\nrunning 2 tests\r\ntest values_per_occurrence_named ... ok\r\ntest values_per_occurrence_positional ... ok\r\n```\n\n### Additional Context\n\nWe treat values as values-per-occurence (see first, successful test) but then not support this with positional arguments (see second, failing test) and instead require a single occurrence with multiple values, preventing the use of them as tuples.\r\n\r\nThis is somewhat related to #2692 and #1772\n\n### Debug Output\n\n_No response_",
    "clap-rs__clap-2796": "Cannot override the help subcommand\n### Please complete the following tasks\n\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\n- [X] I have searched the existing issues\n\n### Rust Version\n\n1.54.0\n\n### Clap Version\n\nmaster\n\n### Minimal reproducible code\n\n```rust\r\n\r\nuse clap::Clap;\r\n\r\n#[derive(Clap)]\r\n#[clap(\r\n    global_setting = AppSettings::DisableHelpSubcommand\r\n)]\r\nenum Helper {\r\n    Help {\r\n        arg: String\r\n    },\r\n    NotHelp {\r\n        arg: String\r\n    }\r\n}\r\n\r\nimpl Helper {\r\n    fn handle(&self) -> String {\r\n        match self {\r\n            Helper::Help { arg } => format!(\"Helping {}\", arg),\r\n            Helper::NotHelp { arg } => format!(\"Not Helping {}\", arg)\r\n        }\r\n    }\r\n}\r\n\r\nfn main() {\r\n    // Test with a subcommand that is not `help`.\r\n    let command = Helper::parse_from([\"help_cmd\", \"not-help\", \"foo\"]).handle();\r\n    assert_eq!(command, \"Not Helping foo\");\r\n\r\n    // Test with the `help` subcommand.\r\n    let command = Helper::parse_from([\"help_cmd\", \"help\", \"foo\"]).handle();\r\n    assert_eq!(command, \"Helping foo\");\r\n}\r\n```\r\n\n\n### Steps to reproduce the bug with the above code\n\ncargo run\n\n### Actual Behaviour\n\nThe second assertion fails, and outputs a help message for the builtin Help subcommand:\r\n\r\n```\r\nerror:  The subcommand 'foo' wasn't recognized\r\n\r\nUSAGE:\r\n    help_cmd <subcommands>\r\n\r\nFor more information try --help\r\n```\n\n### Expected Behaviour\n\nThe tests should pass\n\n### Additional Context\n\nhttps://github.com/clap-rs/clap/pull/2788\n\n### Debug Output\n\n_No response_",
    "clap-rs__clap-2773": "Very large display_order values cause a crash while displaying help\n### Please complete the following tasks\r\n\r\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\r\n- [X] I have searched the existing issues\r\n\r\n### Rust Version\r\n\r\nrustc 1.55.0 (c8dfcfe04 2021-09-06)\r\n\r\n### Clap Version\r\n\r\n3.0.0-beta.4\r\n\r\n### Minimal reproducible code\r\n\r\n```rust\r\nfn main() {\r\n    clap::App::new(\"test\")\r\n        .subcommand(clap::App::new(\"sub\").display_order(usize::MAX))\r\n        .print_help()\r\n        .unwrap();\r\n}\r\n```\r\n\r\n\r\n### Steps to reproduce the bug with the above code\r\n\r\n`cargo run`\r\n\r\n### Actual Behaviour\r\n\r\nResults in the following crash in `VecMap`:\r\n\r\n```\r\nthread 'main' panicked at 'attempt to add with overflow', ~/.cargo/registry/src/github.com-1ecc6299db9ec823/vec_map-0.8.2/src/lib.rs:540:31\r\n```\r\n\r\nUsing `usize::MAX - 1` results in a `'capacity overflow'` in `VecMap`:\r\n```\r\nthread 'main' panicked at 'capacity overflow', library/alloc/src/raw_vec.rs:559:5\r\n```\r\n\r\n### Expected Behaviour\r\n\r\nThe help output is printed.\r\n\r\n### Additional Context\r\n\r\nI believe this was previously working for me, but I'm not sure when. I have upgraded Rust a couple times (it was working maybe in 1.52?), but I'm unsure if that's the only thing has changed.\r\n\r\n### Debug Output\r\n\r\n```\r\n[            clap::build::app] \tApp::_build\r\n[            clap::build::app] \tApp::_propagate:test\r\n[            clap::build::app] \tApp::_check_help_and_version\r\n[            clap::build::app] \tApp::_check_help_and_version: Building help subcommand\r\n[            clap::build::app] \tApp::_propagate_global_args:test\r\n[            clap::build::app] \tApp::_derive_display_order:test\r\n[            clap::build::app] \tApp::_derive_display_order:sub\r\n[            clap::build::app] \tApp::_derive_display_order:help\r\n[clap::build::app::debug_asserts] \tApp::_debug_asserts\r\n[clap::build::arg::debug_asserts] \tArg::_debug_asserts:help\r\n[clap::build::arg::debug_asserts] \tArg::_debug_asserts:version\r\n[         clap::parse::parser] \tParser::color_help\r\n[          clap::output::help] \tHelp::new\r\n[          clap::output::help] \tHelp::write_help\r\n[          clap::output::help] \tshould_show_arg: use_long=false, arg=help\r\n[          clap::output::help] \tHelp::write_templated_help\r\n[          clap::output::help] \tHelp::write_before_help\r\n[          clap::output::help] \tHelp::write_bin_name\r\n[         clap::output::usage] \tUsage::create_usage_no_title\r\n[         clap::output::usage] \tUsage::create_help_usage; incl_reqs=true\r\n[         clap::output::usage] \tUsage::get_required_usage_from: incls=[], matcher=false, incl_last=false\r\n[         clap::output::usage] \tUsage::get_required_usage_from: unrolled_reqs=[]\r\n[         clap::output::usage] \tUsage::get_required_usage_from: ret_val=[]\r\n[         clap::output::usage] \tUsage::needs_flags_tag\r\n[         clap::output::usage] \tUsage::needs_flags_tag:iter: f=help\r\n[         clap::output::usage] \tUsage::needs_flags_tag:iter: f=version\r\n[         clap::output::usage] \tUsage::needs_flags_tag: [FLAGS] not required\r\n[         clap::output::usage] \tUsage::create_help_usage: usage=test [SUBCOMMAND]\r\n[          clap::output::help] \tHelp::write_all_args\r\n[          clap::output::help] \tshould_show_arg: use_long=false, arg=help\r\n[          clap::output::help] \tshould_show_arg: use_long=false, arg=version\r\n[          clap::output::help] \tHelp::write_args\r\n[          clap::output::help] \tshould_show_arg: use_long=false, arg=help\r\n[          clap::output::help] \tHelp::write_args: Current Longest...2\r\n[          clap::output::help] \tHelp::write_args: New Longest...6\r\n[          clap::output::help] \tshould_show_arg: use_long=false, arg=version\r\n[          clap::output::help] \tHelp::write_args: Current Longest...6\r\n[          clap::output::help] \tHelp::write_args: New Longest...9\r\n[          clap::output::help] \tshould_show_arg: use_long=false, arg=help\r\n[          clap::output::help] \tHelp::spec_vals: a=--help\r\n[          clap::output::help] \tshould_show_arg: use_long=false, arg=version\r\n[          clap::output::help] \tHelp::spec_vals: a=--version\r\n[          clap::output::help] \tHelp::spec_vals: a=--help\r\n[          clap::output::help] \tHelp::short\r\n[          clap::output::help] \tHelp::long\r\n[          clap::output::help] \tHelp::val: arg=help\r\n[          clap::output::help] \tHelp::val: Has switch...\r\n[          clap::output::help] \tYes\r\n[          clap::output::help] \tHelp::val: nlh...false\r\n[          clap::output::help] \tHelp::help\r\n[          clap::output::help] \tHelp::help: Next Line...false\r\n[          clap::output::help] \tHelp::help: Too long...\r\n[          clap::output::help] \tNo\r\n[          clap::output::help] \tHelp::spec_vals: a=--version\r\n[          clap::output::help] \tHelp::short\r\n[          clap::output::help] \tHelp::long\r\n[          clap::output::help] \tHelp::val: arg=version\r\n[          clap::output::help] \tHelp::val: Has switch...\r\n[          clap::output::help] \tYes\r\n[          clap::output::help] \tHelp::val: nlh...false\r\n[          clap::output::help] \tHelp::help\r\n[          clap::output::help] \tHelp::help: Next Line...false\r\n[          clap::output::help] \tHelp::help: Too long...\r\n[          clap::output::help] \tNo\r\n[          clap::output::help] \tHelp::write_subcommands\r\nthread 'main' panicked at 'attempt to add with overflow', ~/.cargo/registry/src/github.com-1ecc6299db9ec823/vec_map-0.8.2/src/lib.rs:540:31\r\n```",
    "clap-rs__clap-2771": "Duplicate output in error message if called with missing argument\n### Please complete the following tasks\n\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\n- [X] I have searched the existing issues\n\n### Rust Version\n\nrustc 1.55.0 (c8dfcfe04 2021-09-06)\n\n### Clap Version\n\n3.0.0-beta.4\n\n### Minimal reproducible code\n\n```rust\r\nuse clap::{App, Arg};\r\n\r\nfn main() {\r\n    let _matches = App::new(\"Clap bug\")\r\n        .arg(\r\n            Arg::new(\"a\")\r\n                .short('a')\r\n                .required_unless_present_any(&[\"b\", \"c\"])\r\n                .conflicts_with_all(&[\"b\", \"c\"]),\r\n        )\r\n        .arg(\r\n            Arg::new(\"b\")\r\n                .short('b')\r\n                .required_unless_present(\"a\")\r\n                .requires(\"c\"),\r\n        )\r\n        .arg(\r\n            Arg::new(\"c\")\r\n                .short('c')\r\n                .required_unless_present(\"a\")\r\n                .requires(\"b\"),\r\n        )\r\n        .get_matches();\r\n}\r\n\r\n```\r\n\n\n### Steps to reproduce the bug with the above code\n\ncargo run -- -b\n\n### Actual Behaviour\n\nerror: The following required arguments were not provided:\r\n    -c\r\n    -c\r\n    -c\r\n\r\nUSAGE:\r\n    clap_repro [FLAGS] -c -b\r\n\r\nFor more information try --help\r\n\n\n### Expected Behaviour\n\nerror: The following required arguments were not provided:\r\n    -c\r\n\r\nUSAGE:\r\n    clap_repro [FLAGS] -c -b\r\n\r\nFor more information try --help\n\n### Additional Context\n\n_No response_\n\n### Debug Output\n\n   Compiling clap_derive v3.0.0-beta.4\r\n   Compiling clap v3.0.0-beta.4\r\n   Compiling clap_repro v0.1.0 (/tmp/clap/clap_repro)\r\n    Finished dev [unoptimized + debuginfo] target(s) in 5.71s\r\n     Running `target/debug/clap_repro -b`\r\n[            clap::build::app]  App::_do_parse\r\n[            clap::build::app]  App::_build\r\n[            clap::build::app]  App::_propagate:Clap bug\r\n[            clap::build::app]  App::_check_help_and_version\r\n[            clap::build::app]  App::_propagate_global_args:Clap bug\r\n[            clap::build::app]  App::_derive_display_order:Clap bug\r\n[clap::build::app::debug_asserts]       App::_debug_asserts\r\n[clap::build::arg::debug_asserts]       Arg::_debug_asserts:help\r\n[clap::build::arg::debug_asserts]       Arg::_debug_asserts:version\r\n[clap::build::arg::debug_asserts]       Arg::_debug_asserts:a\r\n[clap::build::arg::debug_asserts]       Arg::_debug_asserts:b\r\n[clap::build::arg::debug_asserts]       Arg::_debug_asserts:c\r\n[         clap::parse::parser]  Parser::get_matches_with\r\n[         clap::parse::parser]  Parser::_build\r\n[         clap::parse::parser]  Parser::_verify_positionals\r\n[         clap::parse::parser]  Parser::get_matches_with: Begin parsing '\"-b\"' ([45, 98])\r\n[         clap::parse::parser]  Parser::get_matches_with: Positional counter...1\r\n[         clap::parse::parser]  Parser::get_matches_with: Low index multiples...false\r\n[         clap::parse::parser]  Parser::possible_subcommand: arg=\"-b\"\r\n[         clap::parse::parser]  Parser::get_matches_with: sc=None\r\n[         clap::parse::parser]  Parser::parse_short_arg: full_arg=\"-b\"\r\n[         clap::parse::parser]  Parser::parse_short_arg:iter:b\r\n[         clap::parse::parser]  Parser::parse_short_arg:iter:b: cur_idx:=1\r\n[         clap::parse::parser]  Parser::parse_short_arg:iter:b: Found valid opt or flag\r\n[         clap::parse::parser]  Parser::check_for_help_and_version_char\r\n[         clap::parse::parser]  Parser::check_for_help_and_version_char: Checking if -b is help or version...\r\n[         clap::parse::parser]  Neither\r\n[         clap::parse::parser]  Parser::parse_flag\r\n[    clap::parse::arg_matcher]  ArgMatcher::inc_occurrence_of: arg=b\r\n[            clap::build::app]  App::groups_for_arg: id=b\r\n[         clap::parse::parser]  Parser::get_matches_with: After parse_short_arg ValuesDone\r\n[         clap::parse::parser]  Parser::remove_overrides\r\n[         clap::parse::parser]  Parser::remove_overrides:iter:b\r\n[      clap::parse::validator]  Validator::validate\r\n[         clap::parse::parser]  Parser::add_env: Checking arg `--help`\r\n[         clap::parse::parser]  Parser::add_env: Checking arg `--version`\r\n[         clap::parse::parser]  Parser::add_env: Checking arg `-a`\r\n[         clap::parse::parser]  Parser::add_env: Skipping existing arg `-b`\r\n[         clap::parse::parser]  Parser::add_env: Checking arg `-c`\r\n[         clap::parse::parser]  Parser::add_defaults\r\n[      clap::parse::validator]  Validator::validate_conflicts\r\n[      clap::parse::validator]  Validator::validate_exclusive\r\n[      clap::parse::validator]  Validator::validate_exclusive:iter:b\r\n[      clap::parse::validator]  Validator::gather_conflicts\r\n[      clap::parse::validator]  Validator::gather_conflicts:iter: id=b\r\n[            clap::build::app]  App::groups_for_arg: id=b\r\n[      clap::parse::validator]  Validator::validate_required: required=ChildGraph([])\r\n[      clap::parse::validator]  Validator::gather_requirements\r\n[      clap::parse::validator]  Validator::gather_requirements:iter:b\r\n[      clap::parse::validator]  Validator::validate_required:iter:aog=c\r\n[      clap::parse::validator]  Validator::validate_required:iter: This is an arg\r\n[      clap::parse::validator]  Validator::is_missing_required_ok: c\r\n[      clap::parse::validator]  Validator::validate_arg_conflicts: a=\"c\"\r\n[      clap::parse::validator]  Validator::missing_required_error; incl=[]\r\n[      clap::parse::validator]  Validator::missing_required_error: reqs=ChildGraph([Child { id: c, children: [] }, Child { id: b, children: [] }])\r\n[         clap::output::usage]  Usage::get_required_usage_from: incls=[], matcher=true, incl_last=true\r\n[         clap::output::usage]  Usage::get_required_usage_from: unrolled_reqs=[b, c, c, c, b, b]\r\n[         clap::output::usage]  Usage::get_required_usage_from:iter:c\r\n[         clap::output::usage]  Usage::get_required_usage_from:iter:c\r\n[         clap::output::usage]  Usage::get_required_usage_from:iter:c\r\n[         clap::output::usage]  Usage::get_required_usage_from: ret_val=[\"-c\", \"-c\", \"-c\"]\r\n[      clap::parse::validator]  Validator::missing_required_error: req_args=[\r\n    \"-c\",\r\n    \"-c\",\r\n    \"-c\",\r\n]\r\n[         clap::output::usage]  Usage::create_usage_with_title\r\n[         clap::output::usage]  Usage::create_usage_no_title\r\n[         clap::output::usage]  Usage::create_help_usage; incl_reqs=true\r\n[         clap::output::usage]  Usage::get_required_usage_from: incls=[], matcher=false, incl_last=false\r\n[         clap::output::usage]  Usage::get_required_usage_from: unrolled_reqs=[c, b]\r\n[         clap::output::usage]  Usage::get_required_usage_from:iter:c\r\n[         clap::output::usage]  Usage::get_required_usage_from:iter:b\r\n[         clap::output::usage]  Usage::get_required_usage_from: ret_val=[\"-c\", \"-b\"]\r\n[         clap::output::usage]  Usage::needs_flags_tag\r\n[         clap::output::usage]  Usage::needs_flags_tag:iter: f=help\r\n[         clap::output::usage]  Usage::needs_flags_tag:iter: f=version\r\n[         clap::output::usage]  Usage::needs_flags_tag:iter: f=a\r\n[            clap::build::app]  App::groups_for_arg: id=a\r\n[         clap::output::usage]  Usage::needs_flags_tag:iter: [FLAGS] required\r\n[         clap::output::usage]  Usage::create_help_usage: usage=clap_repro [FLAGS] -c -b\r\n[            clap::build::app]  App::color: Color setting...\r\n[            clap::build::app]  Auto\r\n[           clap::output::fmt]  is_a_tty: stderr=true\r\n",
    "clap-rs__clap-2758": "Support `about` for `possible_values` e.g. `ArgEnum`\n### Clap Version\r\n\r\nmaster\r\n\r\n### Describe your use case\r\n\r\nSometimes the value itself my not give enough information to the user, therefore it would be helpful to be able to show and additional about in e.g. fish completions.\r\nFish does that for example for `__fish_complete_users`:\r\n![grafik](https://user-images.githubusercontent.com/11978847/130304017-ed419f48-2321-4517-a67d-9c00d0d99f6a.png)\r\n\r\n\r\n### Describe the solution you'd like\r\n\r\nSupport adding abouts/documentation for the possible completion values.\r\n\r\nFor `ArgEnum`:\r\n```rs\r\n#[derive(Clone, Copy, ArgEnum)]\r\npub enum ShellType {\r\n    /// the default Shell\r\n    Bash,\r\n    /// the friendly interactive Shell\r\n    Fish\r\n}\r\n```\r\nThis should result in the following completions in fish for example:\r\n![grafik](https://user-images.githubusercontent.com/11978847/130304172-dee7c631-950a-4d52-843b-1cab6b6feda8.png)\r\n\r\n### Additional Context\r\n\r\nFor fish this is somewhat related to #2730 ",
    "clap-rs__clap-2749": "Usage suggests help subcommand when using DisableHelpSubcommand\n<!--\r\nPlease use the following template to assist with creating an issue and to ensure a speedy resolution. If an area is not applicable, feel free to delete the area or mark with `N/A`\r\n-->\r\n\r\n### Rust Version\r\n\r\n* rustc 1.36.0-nightly (3991285f5 2019-04-25)\r\n\r\n### Affected Version of clap\r\n\r\n* 2.33.0\r\n\r\n### Bug or Feature Request Summary\r\nWhen using the `AppSettings::DisableHelpSubcommand` and the `AppSettings::InferSubcommands` when an invalid subcommand is entered the usage suggests the (disabled) help subcommand.\r\n\r\n### Expected Behavior Summary\r\nUsage should not suggest the help subcommand.\r\n\r\n### Actual Behavior Summary\r\nSee playground link below.\r\n\r\n```\r\nerror: The subcommand 'help' wasn't recognized\r\n\r\nUSAGE:\r\n\tfake help <subcommands>...\r\n```\r\n\r\n### Steps to Reproduce the issue\r\nSee the playground link below.\r\n\r\n### Sample Code or Link to Sample Code\r\nhttps://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=7e194d417cd5086e439ba85cac5ab86b\r\n",
    "clap-rs__clap-2730": "clap_generate fish: ArgEnum completions shows the description of the argument\n### Rust Version\r\n\r\nrustc 1.54.0 (a178d0322 2021-07-26)\r\n\r\n### Clap Version\r\n\r\nmaster\r\n\r\n### Minimal reproducible code\r\n\r\n```rs\r\nuse clap::{ArgEnum, Clap, IntoApp};\r\nuse clap_generate::generators;\r\n\r\nfn main() {\r\n    clap_generate::generate::<generators::Fish, _>(\r\n        &mut App::into_app(),\r\n        \"clap-issue\",\r\n        &mut std::io::stdout(),\r\n    );\r\n}\r\n\r\n#[derive(Clap)]\r\nstruct App {\r\n    #[clap(subcommand)]\r\n    arg: A,\r\n}\r\n\r\n#[derive(Clap)]\r\nenum A {\r\n    A {\r\n        /// This should not be in the completion\r\n        #[clap(arg_enum)]\r\n        arg: AA,\r\n    },\r\n}\r\n\r\n#[derive(ArgEnum)]\r\nenum AA {\r\n    AA,\r\n    BB,\r\n}\r\n```\r\n\r\n### Steps to reproduce the bug with the above code\r\n\r\n`cargo run`\r\n\r\n### Actual Behaviour\r\n\r\n```sh\r\ncomplete -c clap-issue -n \"__fish_use_subcommand\" -s h -l help -d 'Print help information'\r\ncomplete -c clap-issue -n \"__fish_use_subcommand\" -s V -l version -d 'Print version information'\r\ncomplete -c clap-issue -n \"__fish_use_subcommand\" -f -a \"a\"\r\ncomplete -c clap-issue -n \"__fish_use_subcommand\" -f -a \"help\" -d 'Print this message or the helpof the given subcommand(s)'\r\ncomplete -c clap-issue -n \"__fish_seen_subcommand_from a\" -d 'This should not be in the completion' -r -f -a \"aa bb\"\r\ncomplete -c clap-issue -n \"__fish_seen_subcommand_from a\" -s h -l help -d 'Print help information'\r\ncomplete -c clap-issue -n \"__fish_seen_subcommand_from a\" -s V -l version -d 'Print version information'\r\ncomplete -c clap-issue -n \"__fish_seen_subcommand_from help\" -s h -l help -d 'Print help information'\r\ncomplete -c clap-issue -n \"__fish_seen_subcommand_from help\" -s V -l version -d 'Print version information'\r\n```\r\n\r\n### Expected Behaviour\r\n\r\n```sh\r\ncomplete -c clap-issue -n \"__fish_use_subcommand\" -s h -l help -d 'Print help information'\r\ncomplete -c clap-issue -n \"__fish_use_subcommand\" -s V -l version -d 'Print version information'\r\ncomplete -c clap-issue -n \"__fish_use_subcommand\" -f -a \"a\"\r\ncomplete -c clap-issue -n \"__fish_use_subcommand\" -f -a \"help\" -d 'Print this message or the helpof the given subcommand(s)'\r\ncomplete -c clap-issue -n \"__fish_seen_subcommand_from a\" -r -f -a \"aa bb\"\r\ncomplete -c clap-issue -n \"__fish_seen_subcommand_from a\" -s h -l help -d 'Print help information'\r\ncomplete -c clap-issue -n \"__fish_seen_subcommand_from a\" -s V -l version -d 'Print version information'\r\ncomplete -c clap-issue -n \"__fish_seen_subcommand_from help\" -s h -l help -d 'Print help information'\r\ncomplete -c clap-issue -n \"__fish_seen_subcommand_from help\" -s V -l version -d 'Print version information'\r\n```\r\n\r\n### Additional Context\r\n\r\nThe problem is that in fish the description will be put behind every alternative like so:\r\n```\r\n\u276f clap-issue a\r\naa  (This should not be in the completion)  bb  (This should not be in the completion)\r\n```\r\n\r\nA more reasonable description would be https://github.com/clap-rs/clap/discussions/2728\r\n\r\n### Debug Output\r\n\r\n_No response_",
    "clap-rs__clap-2701": "help text wrong for number_of_values=1\n<!--\r\nPlease use the following template to assist with creating an issue and to ensure a speedy resolution. If an area is not applicable, feel free to delete the area or mark with `N/A`\r\n-->\r\n\r\n### Rust Version\r\n\r\nAny\r\n\r\n### Affected Version of clap\r\n\r\nclap 2.33\r\n\r\n### Behavior Summary\r\n\r\nI'm moving this bug from structopt (TeXitoi/structopt#267) repo, since it is really about clap. Please forgive the syntax differences, but I think it should be clear how it maps to clap.\r\n\r\nFor a field defined like:\r\n```\r\n    #[structopt(long=\"package\", short=\"p\", name=\"name\", number_of_values=1)]\r\n    roots: Vec<String>,\r\n```\r\n\r\nThe help text implies you can specify multiple values per option:\r\n```\r\n    -p, --package <name>...\r\n```\r\n\r\nIt should probably remove the `...` in this case. Or at least it seems like the ability to specify an option multiple times should look different than allowing multiple values for a single option. I interpret `<value>...` as lots of values.",
    "clap-rs__clap-2696": "Self override and multiple values don't interact well together\n### Affected Version of clap\r\n\r\nmaster and v3-master (did not try crates.io versions)\r\n\r\n### Bug or Feature Request Summary\r\n\r\nArguments overriding themselves with multiple values have... surprising behavior.  Consider the sample code below:\r\n\r\n### Sample Code or Link to Sample Code\r\n\r\n```rust\r\nextern crate clap;\r\nuse clap::{App, Arg};\r\n\r\nfn main() {\r\n    let matches = App::new(\"MyApp\")\r\n        .arg(\r\n            Arg::with_name(\"input\")\r\n                .takes_value(true)\r\n                .long(\"input\")\r\n                .overrides_with(\"input\")\r\n                .min_values(0),\r\n        ).get_matches();\r\n\r\n    if let Some(vs) = matches.values_of(\"input\") {\r\n        println!(\"{:?}\", vs.collect::<Vec<_>>());\r\n    }\r\n}\r\n```\r\n\r\n### Expected Behavior Summary\r\n\r\nOne would expect this output, where each new occurrence of the `--input` argument overrides the preceding one:\r\n\r\n```shell\r\n$ ./target/debug/example --input a b c --input d\r\n[\"d\"]\r\n$ ./target/debug/example --input a b --input c d\r\n[\"c\", \"d\"]\r\n```\r\n\r\n### Actual Behavior Summary\r\n\r\nHowever on current clap master 33f908df9b1eba26aadb8634104a135e58ea6912 there is no difference between those two invocations:\r\n\r\n```shell\r\n$ ./target/debug/example --input a b c --input d\r\n[\"c\", \"d\"]\r\n$ ./target/debug/example --input a b --input c d\r\n[\"c\", \"d\"]\r\n```\r\n\r\nInterestingly, Clap v3 seems to have changed *something*, since on v3-master eaa0700e7ed76f37d245a6878deb3b8e81754d6c I get this:\r\n```shell\r\n$ ./target/debug/example --input a b c --input d\r\n[\"d\"]\r\n$ ./target/debug/example --input a b --input c d\r\n[\"d\"]\r\n```\r\n\r\nwhich is unfortunately not much better.\r\n\r\n### Consideration and thoughts\r\n\r\nThis seem to be caused by the self-override code being written with the use case of arguments with a single value in mind.  This also causes other issues, for instance if I change `min_values(0)` to `number_of_values(2)` in the above code I get:\r\n\r\n```shell\r\n$ ./target/debug/example --input a b --input c d\r\nerror: Found argument 'd' which wasn't expected, or isn't valid in this context\r\n```\r\non master and:\r\n\r\n```shell\r\n$ ./target/debug/example --input a b --input c d\r\nerror: The argument '--input <input> <input>' requires 2 values, but 1 was provided\r\n```\r\n\r\non v3-master.\r\n\r\nThe offending code is here:\r\n\r\nhttps://github.com/clap-rs/clap/blob/33f908df9b1eba26aadb8634104a135e58ea6912/src/args/arg_matcher.rs#L66-L75\r\n\r\nInterestingly, it somehow gets called twice (before parsing the overriding argument, and after parsing it), which is why we need `--input a b c --input d` to trigger the bug.  Doing only `--input a b --input c` would properly remove the `a` and `b` (if you are wondering: yes, `--input --input a b` only prints `[\"b\"]`).\r\n\r\nThe corresponding code in v3 is here, and it now pops off and only keeps the final argument value (hence the behavior change).  It is also now called only once, after the overriding argument has been parsed: \r\n\r\nhttps://github.com/clap-rs/clap/blob/eaa0700e7ed76f37d245a6878deb3b8e81754d6c/src/parse/parser.rs#L1328-L1338\r\n\r\nI am not familiar with the code at all, but from my understanding properly fixing this would require a way of knowing how much arguments were parsed in the current occurrence, in order to only keep that amount.  Unfortunately, there doesn't seem to be a way of getting that information currently.\r\n\r\nOne solution would be to add an `occurrences` vector to the `MatchedArg` which keeps track of the position in the `vals` vector when a new occurrence is encountered, and can be used to properly pop off all values but the ones associated with the last occurrence when an override occurs.  This can be extended by also keeping track of the position in the `indices` vector, since currently self-overrides \"leak\" through the `indices` (i.e. the indices of the overridden occurrences are kept), and can be used as a basis to solve #1026.  This may also be the opportunity to change the behavior of `min_values` and `max_values` in clap 3 (or add a setting) to be per-occurrence instead of sum-of-occurrences (at least for me, that would be more intuitive -- but this would probably require discussion beforehand).\r\n\r\nI have a proof-of-concept implementation of the above which I can make into a proper PR if the proposed solution seems reasonable, or I can try and implement another suggestion :)",
    "clap-rs__clap-2677": "use cases for value_of/values_of\nSorry to keep opening issues, and this may indeed be more of a question because I've missed something, but what are the intended use cases of `value_of`/`values_of`? In particular, I notice that this is part of its contract:\r\n\r\n> This method will panic! if the value contains invalid UTF-8 code points.\r\n\r\n(Pedant: I think this should say \"invalid UTF-8.\" There is no such thing as a \"UTF-8 codepoint.\")\r\n\r\nSince the value is typed by the user, this means that the user can cause your program to panic if you use `value_of`/`values_of` when the user gives a value that isn't valid UTF-8. In my view, if an *end user* sees a panic, then it ought to be considered a bug. If my interpretation is right, then that means I should *never* use `value_of`/`values_of`, right?\r\n\r\nI do see one possible use case: if a caller *disables* the `AllowInvalidUtf8` setting, then I believe clap will return a nice error if it detects invalid UTF-8, and therefore, `value_of`/`values_of` will *never* panic. However, according to the docs, `AllowInvalidUtf8` is enabled by default, so this seems like a potential footgun.\r\n\r\n(This is a good instance of the pot calling the kettle black because `docopt.rs`, for example, can't handle invalid UTF-8 *at all*! :-) So clap is already leagues better in this regard.)",
    "clap-rs__clap-2669": "`allow_leading_hyphens` doesn't work on positional arguments\n### Affected Version of clap\r\n\r\n2.32.0\r\n\r\n### Bug or Feature Request Summary\r\n\r\n`allow_leading_hyphens` doesn't work on positional arguments. Example:\r\n\r\n```\r\nuse clap::{App, Arg};\r\nfn main() {\r\n    let m = App::new(\"pattest\")\r\n        .arg(Arg::with_name(\"pat\")\r\n            .allow_hyphen_values(true)\r\n            .required(true)\r\n            .takes_value(true))\r\n        .get_matches();\r\n    assert_eq!(m.value_of(\"pat\"), Some(\"-file\"));\r\n}\r\n```\r\n### Expected Behavior Summary\r\n\r\nRunning with `target/debug/test -file` should exit normally.\r\n\r\n### Actual Behavior Summary\r\n\r\n```\r\n[roc@localhost test]$ target/debug/test -file\r\nerror: Found argument '-f' which wasn't expected, or isn't valid in this context\r\n\r\nUSAGE:\r\n    test <pat>\r\n\r\nFor more information try --help\r\n```",
    "clap-rs__clap-2653": "Singleton optional values should use `[<name>]` in help message\n### Rust Version\r\n\r\nrustc 1.53.0-nightly (9d9c2c92b 2021-04-19)\r\n\r\n### Affected Version of clap\r\n\r\n3.0.0-beta.2\r\n\r\n### Expected Behavior Summary\r\n\r\nHelp message for `Option<Option<type>>` switches uses `[<name>]` rather than `<name>...` to indicate that the value is optional.  For example, for switch `opt` the help screen reads `--opt [<opt>]`.  Ellipsis suggests that the value can be provided more than once (which is not correct) whereas square brackets correctly indicate the value can be given at most once.  \r\n\r\n### Actual Behavior Summary\r\n\r\nEllipsis is used in help message.  For switch `opt` the help screen reads `--opt <opt>...`.\r\n\r\n### Steps to Reproduce the issue\r\n\r\n```\r\nuse clap::Clap;\r\n\r\n#[derive(Clap, Debug)]\r\nstruct Opts {\r\n    #[clap(long)]\r\n    opt: Option<Option<i32>>\r\n}\r\n\r\nfn main() {\r\n    println!(\"{:?}\", Opts::parse());\r\n}\r\n```\r\n\r\n```\r\n$ cargo --quiet run -- --help |grep -e --opt\r\n        --opt <opt>...\r\n# Expected:         --opt [<opt>]\r\n```",
    "clap-rs__clap-2648": "Order of arguments looks wrong when using AllowMissingPositional\n<!--\r\nPlease use the following template to assist with creating an issue and to ensure a speedy resolution. If an area is not applicable, feel free to delete the area or mark with `N/A`\r\n-->\r\n\r\n### Rust Version\r\n\r\n```\r\nrustc 1.41.1 (f3e1a954d 2020-02-24)\r\n```\r\n\r\n### Code\r\n\r\n```rust\r\nuse clap::{App, Arg};\r\n\r\nfn main() {\r\n    let args: Vec<String> = std::env::args_os()\r\n        .map(|x| x.into_string().expect(\"Invalid argument\"))\r\n        .collect();\r\n\r\n    let args_as_str: Vec<&str> = args.iter()\r\n        .map(AsRef::as_ref)\r\n        .collect();\r\n\r\n    let clap_app = App::new(\"\")\r\n        .setting(clap::AppSettings::AllowMissingPositional)\r\n        .arg(\r\n            Arg::with_name(\"first\")\r\n                .required(false)\r\n                .default_value(\"default\")\r\n                .index(1),\r\n        )\r\n        .arg(\r\n            Arg::with_name(\"second\")\r\n                .required(true)\r\n                .index(2),\r\n        );\r\n\r\n    let matches = clap_app.get_matches_from(args);\r\n}\r\n```\r\n### Steps to reproduce the issue\r\n\r\nRun `cargo run -- --help`\r\n\r\n### Affected Version of `clap*`\r\n\r\n```\r\n2.33.0\r\n```\r\n\r\nAlso tested with `3.0.0-beta.1` which has the same behaviour.\r\n\r\n### Actual Behavior Summary\r\n\r\nThe indexes for parameters `first` and `second` specify that `first` should come first, then `second`. `first` is optional (using `AllowMissingPositional`). However, the usage shows `second` first, then `first`:\r\n\r\n```sh\r\nUSAGE:\r\n    httpx <second> [first]\r\n\r\nFLAGS:\r\n    -h, --help       Prints help information\r\n    -V, --version    Prints version information\r\n\r\nARGS:\r\n    <first>      [default: default]\r\n    <second>    \r\n```\r\n\r\n### Expected Behavior Summary\r\n\r\n```sh\r\nUSAGE:\r\n    httpx [first] <second>\r\n\r\nFLAGS:\r\n    -h, --help       Prints help information\r\n    -V, --version    Prints version information\r\n\r\nARGS:\r\n    <first>      [default: default]\r\n    <second>    \r\n```",
    "clap-rs__clap-2643": "`min_values(0)` still complains about no value when combining short versions\n### Please complete the following tasks\n\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\n- [X] I have searched the existing issues\n\n### Rust Version\n\nrustc 1.56.0-nightly (9c25eb7aa 2021-07-25)\n\n### Clap Version\n\n2.33\n\n### Minimal reproducible code\n\n```rust\r\nuse clap::{App, Arg};\r\n\r\nfn main() {\r\n    let matches = App::new(\"foo\")\r\n        .arg(\r\n            Arg::with_name(\"check\")\r\n                .short(\"c\")\r\n                .long(\"check\")\r\n                .takes_value(true)\r\n                .require_equals(true)\r\n                .min_values(0)\r\n                .possible_values(&[\"silent\", \"quiet\", \"diagnose-first\"])\r\n                .help(\"check for sorted input; do not sort\"),\r\n        )\r\n        .arg(\r\n            Arg::with_name(\"unique\")\r\n                .short(\"u\")\r\n                .long(\"unique\")\r\n                .help(\"output only the first of an equal run\"),\r\n        )\r\n        .get_matches();\r\n    assert!(matches.is_present(\"check\"));\r\n    assert!(matches.is_present(\"unique\"));\r\n}\r\n\r\n```\r\n\n\n### Steps to reproduce the bug with the above code\n\ncargo r -- -cu\n\n### Actual Behaviour\n\n```plaintext\r\nerror: The argument '--check=<check>' requires a value but none was supplied\r\n\r\nUSAGE:\r\n    clap-bug [FLAGS] [OPTIONS]\r\n\r\nFor more information try --help\r\n```\n\n### Expected Behaviour\n\nThe same thing that happens when invoking the program like this: `cargo r -- -u -c`, which should be synomymous to `-cu`.\r\nThe program would succeed and produce no output.\n\n### Additional Context\n\n_No response_\n\n### Debug Output\n\n```plaintext\r\nDEBUG:clap:Parser::propagate_settings: self=foo, g_settings=AppFlags(\r\n    (empty),\r\n)\r\nDEBUG:clap:Parser::get_matches_with;\r\nDEBUG:clap:Parser::create_help_and_version;\r\nDEBUG:clap:Parser::create_help_and_version: Building --help\r\nDEBUG:clap:Parser::create_help_and_version: Building --version\r\nDEBUG:clap:Parser::get_matches_with: Begin parsing '\"-cu\"' ([45, 99, 117])\r\nDEBUG:clap:Parser::is_new_arg:\"-cu\":NotFound\r\nDEBUG:clap:Parser::is_new_arg: arg_allows_tac=false\r\nDEBUG:clap:Parser::is_new_arg: - found\r\nDEBUG:clap:Parser::is_new_arg: starts_new_arg=true\r\nDEBUG:clap:Parser::possible_subcommand: arg=\"-cu\"\r\nDEBUG:clap:Parser::get_matches_with: possible_sc=false, sc=None\r\nDEBUG:clap:ArgMatcher::process_arg_overrides:None;\r\nDEBUG:clap:Parser::parse_short_arg: full_arg=\"-cu\"\r\nDEBUG:clap:Parser::parse_short_arg:iter:c\r\nDEBUG:clap:Parser::parse_short_arg:iter:c: Found valid opt\r\nDEBUG:clap:Parser::parse_short_arg:iter:c: p[0]=[], p[1]=[117]\r\nDEBUG:clap:Parser::parse_short_arg:iter:c: val=[117] (bytes), val=\"u\" (ascii)\r\nDEBUG:clap:Parser::parse_opt; opt=check, val=Some(\"u\")\r\nDEBUG:clap:Parser::parse_opt; opt.settings=ArgFlags(TAKES_VAL | DELIM_NOT_SET | REQUIRE_EQUALS)\r\nDEBUG:clap:Parser::parse_opt; Checking for val...Found Empty - Error\r\nDEBUG:clap:usage::create_usage_with_title;\r\nDEBUG:clap:usage::create_usage_no_title;\r\nDEBUG:clap:usage::get_required_usage_from: reqs=[], extra=None\r\nDEBUG:clap:usage::get_required_usage_from: after init desc_reqs=[]\r\nDEBUG:clap:usage::get_required_usage_from: no more children\r\nDEBUG:clap:usage::get_required_usage_from: final desc_reqs=[]\r\nDEBUG:clap:usage::get_required_usage_from: args_in_groups=[]\r\nDEBUG:clap:usage::needs_flags_tag;\r\nDEBUG:clap:usage::needs_flags_tag:iter: f=unique;\r\nDEBUG:clap:Parser::groups_for_arg: name=unique\r\nDEBUG:clap:Parser::groups_for_arg: No groups defined\r\nDEBUG:clap:usage::needs_flags_tag:iter: [FLAGS] required\r\nDEBUG:clap:usage::create_help_usage: usage=clap-bug [FLAGS] [OPTIONS]\r\nDEBUG:clap:Parser::color;\r\nDEBUG:clap:Parser::color: Color setting...Auto\r\nDEBUG:clap:is_a_tty: stderr=true\r\nDEBUG:clap:Colorizer::error;\r\nDEBUG:clap:OptBuilder::fmt:check\r\nDEBUG:clap:Colorizer::warning;\r\nDEBUG:clap:Colorizer::good;\r\nerror: The argument '--check=<check>' requires a value but none was supplied\r\n\r\nUSAGE:\r\n    clap-bug [FLAGS] [OPTIONS]\r\n\r\nFor more information try --help\r\n```",
    "clap-rs__clap-2642": "Change default help and version message to infinitive form\n### Please complete the following tasks\r\n\r\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\r\n- [X] I have searched the existing issues\r\n\r\n### Describe your use case\r\n\r\nThere are two problems here.\r\n\r\n1. `clap` uses an unconventional sentence form in its auto-generated help messages (i.e. `\"Prints a help message\"` vs `\"Print a help message\"`). A lot of users (as shown in the links above) would like to change this, because practically every other UNIX program shows it in the infinitive form:\r\n\r\n```sh\r\n$ grep --help\r\n-b, --byte-offset    print the byte offset with output lines\r\n\r\n$ git init --help\r\n--bare    create a bare repository\r\n\r\n$ rg -h\r\n--debug    Show debug messages.\r\n```\r\n2. There's no way to set this help message manually if you use `clap_derive`.\r\n\r\n### Describe the solution you'd like\r\n\r\nI'd like a way to set `global_help_message` and `global_version_message` in my app.\r\n### Alternatives, if applicable\r\n\r\n`app.mut_arg(\"help\", |a| a.about(\"help info\"))` is a solution, but it does not work for apps using `clap_derive`.\r\n\r\n### Additional Context\r\n\r\nThere's plenty of demand for this feature:\r\n\r\n- https://github.com/clap-rs/clap/issues/2080\r\n- https://github.com/clap-rs/clap/issues/1640\r\n- https://github.com/clap-rs/clap/issues/1646\r\n- https://github.com/clap-rs/clap/issues/1512\r\n- https://github.com/clap-rs/clap/issues/889\r\n- https://github.com/clap-rs/clap/issues/1665\r\n- https://github.com/clap-rs/clap/discussions/2152",
    "clap-rs__clap-2635": "Specify defaults in terms of the underlying type rather than strings\nI really like how the new clap v3 is shaping up! Now that structopt is integrated, it'd be great if defaults could be specified in terms of the default resulting value they produce rather than as a string. Other argument parsing libraries like Python's argparse work this way.",
    "clap-rs__clap-2633": "When setting `value_name`, argument parsing fails\n### Please complete the following tasks\r\n\r\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\r\n- [X] I have searched the existing issues\r\n\r\n### Rust Version\r\n\r\nrustc 1.53.0 (53cb7b09b 2021-06-17)\r\n\r\n### Clap Version\r\n\r\n5fbd764\r\n\r\n### Minimal reproducible code\r\n\r\n```rust\r\n#[clap(\r\n    number_of_values = 1,\r\n    long = \"using\",\r\n    value_name = \"pm\"\r\n)]\r\nusing: Option<String>,\r\n```\r\n\r\n### Steps to reproduce the bug with the above code\r\n\r\nPass arguments as expected\r\n\r\n### Actual Behaviour\r\n\r\nError when parsing:\r\n```\r\nerror: The argument '--using <USING> <pm>' requires 2 values, but 1 was provided\r\n```\r\nand help:\r\n```\r\nOPTIONS:\r\n        --using <USING> <pm>    Specify the package manager to be invoked\r\n```\r\n\r\n### Expected Behaviour\r\n\r\n```\r\nOPTIONS:\r\n        --using <pm>... Specify the package manager to be invoked\r\n```\r\n\r\n### Additional Context\r\n\r\n_No response_\r\n\r\n### Debug Output\r\n\r\n_No response_",
    "clap-rs__clap-2611": "value name with clap_derive doesn't follow common practices\n### Please complete the following tasks\n\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\n- [X] I have searched the existing issues\n\n### Rust Version\n\nrustc 1.53.0 (53cb7b09b 2021-06-17)\n\n### Clap Version\n\n3.0.0-beta.2\n\n### Minimal reproducible code\n\n```rust\r\n#[derive(Clap)]\r\nstruct Args {\r\n    #[clap(long)]\r\n    value: String,\r\n}\r\n```\r\n\n\n### Steps to reproduce the bug with the above code\n\nRun that with `--help`\n\n### Actual Behaviour\n\nHelp shows `--value value`\n\n### Expected Behaviour\n\nHelp shows `--value VALUE`\n\n### Additional Context\n\nClap itself says to do this\r\n\r\n> Although not required, it's somewhat convention to use all capital letters for the value name.\r\n\r\nFrom https://docs.rs/clap/2.33.3/clap/struct.Arg.html#method.value_name\n\n### Debug Output\n\n_No response_",
    "clap-rs__clap-2609": "Incorrect usage output if default_value is used\n### Please complete the following tasks\n\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\n- [X] I have searched the existing issues\n\n### Rust Version\n\nrustc 1.53.0 (53cb7b09b 2021-06-17)\n\n### Clap Version\n\n3.0.0-beta.2\n\n### Minimal reproducible code\n\n```rust\r\nuse clap::{App, Arg};\r\n\r\nfn main() {\r\n    let _ = App::new(\"bug\")\r\n        .arg(\r\n            Arg::new(\"foo\")\r\n                .long(\"config\")\r\n                .takes_value(true)\r\n                .default_value(\"bar\"),\r\n        )\r\n        .arg(Arg::new(\"input\").required(true))\r\n        .get_matches();\r\n}\r\n```\n\n### Steps to reproduce the bug with the above code\n\ncargo run\n\n### Actual Behaviour\n\nCurrent code displays:\r\n\r\n```\r\nerror: The following required arguments were not provided:\r\n    <input>\r\n\r\nUSAGE:\r\n    baz <input> --config <foo>\r\n\r\nFor more information try --help\r\n```\n\n### Expected Behaviour\n\nIt should display:\r\n\r\n```\r\nerror: The following required arguments were not provided:\r\n    <input>\r\n\r\nUSAGE:\r\n    baz [OPTIONS] <input>\r\n\r\nFor more information try --help\r\n```\n\n### Additional Context\n\n_No response_\n\n### Debug Output\n\n[            clap::build::app] \tApp::_do_parse\r\n[            clap::build::app] \tApp::_build\r\n[            clap::build::app] \tApp::_propagate:bug\r\n[            clap::build::app] \tApp::_derive_display_order:bug\r\n[            clap::build::app] \tApp::_create_help_and_version\r\n[            clap::build::app] \tApp::_create_help_and_version: Building --help\r\n[            clap::build::app] \tApp::_create_help_and_version: Building --version\r\n[clap::build::app::debug_asserts] \tApp::_debug_asserts\r\n[            clap::build::arg] \tArg::_debug_asserts:foo\r\n[            clap::build::arg] \tArg::_debug_asserts:input\r\n[            clap::build::arg] \tArg::_debug_asserts:help\r\n[            clap::build::arg] \tArg::_debug_asserts:version\r\n[         clap::parse::parser] \tParser::get_matches_with\r\n[         clap::parse::parser] \tParser::_build\r\n[         clap::parse::parser] \tParser::_verify_positionals\r\n[         clap::parse::parser] \tParser::remove_overrides\r\n[      clap::parse::validator] \tValidator::validate\r\n[         clap::parse::parser] \tParser::add_defaults\r\n[         clap::parse::parser] \tParser::add_defaults:iter:foo:\r\n[         clap::parse::parser] \tParser::add_value: doesn't have conditional defaults\r\n[         clap::parse::parser] \tParser::add_value:iter:foo: has default vals\r\n[         clap::parse::parser] \tParser::add_value:iter:foo: wasn't used\r\n[         clap::parse::parser] \tParser::add_val_to_arg; arg=foo, val=\"bar\"\r\n[         clap::parse::parser] \tParser::add_val_to_arg; trailing_vals=false, DontDelimTrailingVals=false\r\n[         clap::parse::parser] \tParser::add_single_val_to_arg: adding val...\"bar\"\r\n[            clap::build::app] \tApp::groups_for_arg: id=foo\r\n[    clap::parse::arg_matcher] \tArgMatcher::needs_more_vals: o=foo\r\n[         clap::parse::parser] \tParser::add_defaults:iter:input:\r\n[         clap::parse::parser] \tParser::add_value: doesn't have conditional defaults\r\n[         clap::parse::parser] \tParser::add_value:iter:input: doesn't have default vals\r\n[      clap::parse::validator] \tValidator::validate_conflicts\r\n[      clap::parse::validator] \tValidator::validate_exclusive\r\n[      clap::parse::validator] \tValidator::validate_exclusive:iter:foo\r\n[      clap::parse::validator] \tValidator::gather_conflicts\r\n[      clap::parse::validator] \tValidator::gather_conflicts:iter: id=foo\r\n[      clap::parse::validator] \tValidator::gather_conflicts:iter: This is default value, skipping.\r\n[      clap::parse::validator] \tValidator::validate_required: required=ChildGraph([Child { id: input, children: [] }])\r\n[      clap::parse::validator] \tValidator::gather_requirements\r\n[      clap::parse::validator] \tValidator::gather_requirements:iter:foo\r\n[      clap::parse::validator] \tValidator::validate_required:iter:aog=input\r\n[      clap::parse::validator] \tValidator::validate_required:iter: This is an arg\r\n[      clap::parse::validator] \tValidator::is_missing_required_ok: input\r\n[      clap::parse::validator] \tValidator::validate_arg_conflicts: a=\"input\"\r\n[      clap::parse::validator] \tValidator::missing_required_error; incl=None\r\n[      clap::parse::validator] \tValidator::missing_required_error: reqs=ChildGraph([Child { id: input, children: [] }])\r\n[         clap::output::usage] \tUsage::get_required_usage_from: incls=[], matcher=true, incl_last=true\r\n[         clap::output::usage] \tUsage::get_required_usage_from: unrolled_reqs=[input]\r\n[         clap::output::usage] \tUsage::get_required_usage_from:iter:input\r\n[         clap::output::usage] \tUsage::get_required_usage_from: ret_val=[\"<input>\"]\r\n[      clap::parse::validator] \tValidator::missing_required_error: req_args=[\r\n    \"<input>\",\r\n]\r\n[         clap::output::usage] \tUsage::create_usage_with_title\r\n[         clap::output::usage] \tUsage::create_usage_no_title\r\n[         clap::output::usage] \tUsage::create_smart_usage\r\n[         clap::output::usage] \tUsage::get_required_usage_from: incls=[foo], matcher=false, incl_last=true\r\n[         clap::output::usage] \tUsage::get_required_usage_from: unrolled_reqs=[input]\r\n[         clap::output::usage] \tUsage::get_required_usage_from:iter:input\r\n[         clap::output::usage] \tUsage::get_required_usage_from:iter:foo\r\n[         clap::output::usage] \tUsage::get_required_usage_from: ret_val=[\"<input>\", \"--config <foo>\"]\r\n[            clap::build::app] \tApp::color: Color setting...\r\n[            clap::build::app] \tAuto\r\n[           clap::output::fmt] \tis_a_tty: stderr=true",
    "clap-rs__clap-2587": "Use enum as subcommands in a subcommand\n### Make sure you completed the following tasks\r\n\r\n- [x] Searched the [discussions](https://github.com/clap-rs/clap/discussions)\r\n- [x] Searched the closes issues\r\n\r\n### Code\r\n\r\n```rust\r\nuse clap::Clap;\r\n\r\n#[derive(Clap)]\r\nenum App {\r\n    Build,\r\n    Config(Config),\r\n}\r\n\r\n#[derive(Clap)]\r\nenum Config {\r\n    Show,\r\n    Edit,\r\n}\r\n\r\nfn main() {\r\n    App::parse_from(&[\"app\", \"config\"]);\r\n}\r\n```\r\n\r\n#### Output\r\n```\r\nthread 'main' panicked at 'called `Option::unwrap()` on a `None` value', src/main.rs:9:10\r\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\r\n```\r\n\r\n### Steps to reproduce the issue\r\n1. Run `cargo run --`\r\n2. Observe that the application panics\r\n\r\n### Version\r\n\r\n* **Rust**: rustc 1.46.0-nightly (0c03aee8b 2020-07-05)\r\n* **Clap**: 3.0.0-beta.1\r\n\r\n### Actual Behavior Summary\r\n\r\nWhen deriving `Clap` for enums as shown in the code, calling any of the `parse` methods while not giving a secondary subcommand to primary subcommand causes a panic.\r\n\r\n### Expected Behavior Summary\r\n\r\nI think that instead of panicking, clap should return an error displaying the help message.\r\n\r\n### Additional context\r\n\r\nI have already opened a discussion about this at #2004, because I was unsure if this behavior was unexpected.\r\n@CreepySkeleton agrees that this is a bug.\r\n\r\n### Debug output\r\n<details>\r\n<summary> Debug Output </summary>\r\n<pre>\r\n<code>\r\n[            clap::build::app] \tApp::_do_parse\r\n[            clap::build::app] \tApp::_build\r\n[            clap::build::app] \tApp::_derive_display_order:clap-test\r\n[            clap::build::app] \tApp::_derive_display_order:build\r\n[            clap::build::app] \tApp::_derive_display_order:config\r\n[            clap::build::app] \tApp::_derive_display_order:show\r\n[            clap::build::app] \tApp::_derive_display_order:edit\r\n[            clap::build::app] \tApp::_create_help_and_version\r\n[            clap::build::app] \tApp::_create_help_and_version: Building --help\r\n[            clap::build::app] \tApp::_create_help_and_version: Building --version\r\n[            clap::build::app] \tApp::_create_help_and_version: Building help\r\n[            clap::build::app] \tApp::_debug_asserts\r\n[            clap::build::arg] \tArg::_debug_asserts:help\r\n[            clap::build::arg] \tArg::_debug_asserts:version\r\n[         clap::parse::parser] \tParser::get_matches_with\r\n[         clap::parse::parser] \tParser::_build\r\n[         clap::parse::parser] \tParser::_verify_positionals\r\n[         clap::parse::parser] \tParser::get_matches_with: Begin parsing '\"config\"' ([99, 111, 110, 102, 105, 103])\r\n[         clap::parse::parser] \tParser::is_new_arg: \"config\":NotFound\r\n[         clap::parse::parser] \tParser::is_new_arg: arg_allows_tac=false\r\n[         clap::parse::parser] \tParser::is_new_arg: probably value\r\n[         clap::parse::parser] \tParser::is_new_arg: starts_new_arg=false\r\n[         clap::parse::parser] \tParser::possible_subcommand: arg=\"config\"\r\n[         clap::parse::parser] \tParser::get_matches_with: possible_sc=true, sc=Some(\"config\")\r\n[         clap::parse::parser] \tParser::parse_subcommand\r\n[         clap::output::usage] \tUsage::get_required_usage_from: incls=[], matcher=false, incl_last=true\r\n[         clap::output::usage] \tUsage::get_required_usage_from: ret_val=[]\r\n[            clap::build::app] \tApp::_propagate:clap-test\r\n[            clap::build::app] \tApp::_build\r\n[            clap::build::app] \tApp::_derive_display_order:config\r\n[            clap::build::app] \tApp::_derive_display_order:show\r\n[            clap::build::app] \tApp::_derive_display_order:edit\r\n[            clap::build::app] \tApp::_create_help_and_version\r\n[            clap::build::app] \tApp::_create_help_and_version: Building --help\r\n[            clap::build::app] \tApp::_create_help_and_version: Building --version\r\n[            clap::build::app] \tApp::_create_help_and_version: Building help\r\n[            clap::build::app] \tApp::_debug_asserts\r\n[            clap::build::arg] \tArg::_debug_asserts:help\r\n[            clap::build::arg] \tArg::_debug_asserts:version\r\n[         clap::parse::parser] \tParser::parse_subcommand: About to parse sc=config\r\n[         clap::parse::parser] \tParser::get_matches_with\r\n[         clap::parse::parser] \tParser::_build\r\n[         clap::parse::parser] \tParser::_verify_positionals\r\n[         clap::parse::parser] \tParser::remove_overrides\r\n[      clap::parse::validator] \tValidator::validate\r\n[         clap::parse::parser] \tParser::add_defaults\r\n[      clap::parse::validator] \tValidator::validate_conflicts\r\n[      clap::parse::validator] \tValidator::validate_exclusive\r\n[      clap::parse::validator] \tValidator::gather_conflicts\r\n[      clap::parse::validator] \tValidator::validate_required: required=ChildGraph([])\r\n[      clap::parse::validator] \tValidator::gather_requirements\r\n[      clap::parse::validator] \tValidator::validate_required_unless\r\n[      clap::parse::validator] \tValidator::validate_matched_args\r\n[         clap::parse::parser] \tParser::remove_overrides\r\n[      clap::parse::validator] \tValidator::validate\r\n[         clap::parse::parser] \tParser::add_defaults\r\n[      clap::parse::validator] \tValidator::validate_conflicts\r\n[      clap::parse::validator] \tValidator::validate_exclusive\r\n[      clap::parse::validator] \tValidator::gather_conflicts\r\n[      clap::parse::validator] \tValidator::validate_required: required=ChildGraph([])\r\n[      clap::parse::validator] \tValidator::gather_requirements\r\n[      clap::parse::validator] \tValidator::validate_required_unless\r\n[      clap::parse::validator] \tValidator::validate_matched_args\r\n[    clap::parse::arg_matcher] \tArgMatcher::get_global_values: global_arg_vec=[]\r\n</code>\r\n</pre>\r\n</details>\r\n",
    "clap-rs__clap-2543": "Limit number of occurrences for flag arguments\n### Please complete the following tasks\n\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\n- [X] I have searched the existing issues\n\n### Describe your use case\n\nMy application includes a `-v` flag to control logging verbosity. The user can specify multiple occurrences of the flag, in which case verbosity increases.\r\n\r\n```rust\r\nlet args = App::new(\"foo\")\r\n    .arg(\r\n        Arg::with_name(\"verbosity\")\r\n            .short(\"v\")\r\n            .multiple(true)\r\n    )\r\n    .get_matches();\r\n\r\nlet log_builder = env_logger::Builder::new();\r\nmatch args.occurrences_of(\"verbosity\") {\r\n    0 => { log_builder.parse_default_env(); },\r\n    1 => { log_builder.filter_level(LevelFilter::Info); },\r\n    2 => { log_builder.filter_level(LevelFilter::Debug); },\r\n    _ => { log_builder.filter_level(LevelFilter::Trace); },\r\n}\r\n```\r\n\r\nAs written, the user can specify an arbitrary number of `-v` occurrences, but any occurrences after the third have no effect. However, I am feeling a bit pedantic in this case and would like to prevent the user from specifying more than 3 `-v`'s.\n\n### Describe the solution you'd like\n\nIt'd be awesome if there were something like `Arg::max_occurrences` which could be used to specify the maximum number of occurrences.\r\n\r\n```rust\r\nArg::with_name(\"verbosity\")\r\n    .short(\"v\")\r\n    .multiple(true)\r\n    .max_occurrences(3);\r\n```\n\n### Alternatives, if applicable\n\nI can approximate the desired behavior quite closely as follows:\r\n\r\n```rust\r\nmatch args.occurrences_of(\"verbosity\") {\r\n    0 => { log_builder.parse_default_env(); },\r\n    1 => { log_builder.filter_level(LevelFilter::Info); },\r\n    2 => { log_builder.filter_level(LevelFilter::Debug); },\r\n    3 => { log_builder.filter_level(LevelFilter::Trace); },\r\n    _ => {\r\n        eprintln!(\"Error: Argument -v specified more than 3 times\\n\");\r\n        eprintln!(\"{}\", args.usage());\r\n        std::process::exit(1);\r\n    },\r\n}\r\n```\n\n### Additional Context\n\n_No response_",
    "clap-rs__clap-2534": "Help heading is printed when all args are hidden\n### Please complete the following tasks\n\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\n- [X] I have searched the existing issues\n\n### Rust Version\n\nrustc 1.52.0 (88f19c6da 2021-05-03)\n\n### Clap Version\n\nmaster (585a7c955)\n\n### Minimal reproducible code\n\n```rust\r\nuse clap::{App, Arg};\r\n\r\nfn main() {\r\n    let mut app = App::new(\"blorp\")\r\n        .author(\"Will M.\")\r\n        .about(\"does stuff\")\r\n        .version(\"1.4\")\r\n        .arg(\r\n            Arg::from(\"-f, --fake <some> <val> 'some help'\")\r\n        )\r\n        .help_heading(\"NETWORKING\")\r\n        .arg(\r\n            Arg::new(\"no-proxy\")\r\n                .about(\"Do not use system proxy settings\")\r\n                .hidden_short_help(true),\r\n        )\r\n        .help_heading(\"SPECIAL\")\r\n        .arg(\r\n            Arg::from(\"-b, --birthday-song <song> 'Change which song is played for birthdays'\")\r\n        )\r\n        .stop_custom_headings()\r\n        .arg(\r\n            Arg::new(\"server-addr\")\r\n                .about(\"Set server address\")\r\n                .help_heading(Some(\"NETWORKING\"))\r\n                .hidden_short_help(true),\r\n        );\r\n    app.write_help(&mut std::io::stdout()).unwrap();\r\n}\r\n```\n\n### Steps to reproduce the bug with the above code\n\n```bash\r\ncargo run\r\n```\n\n### Actual Behaviour\n\n```text\r\nblorp 1.4\r\n\r\nWill M.\r\n\r\ndoes stuff\r\n\r\nUSAGE:\r\n    blorp --fake <some> <val> --birthday-song <song> [ARGS]\r\n\r\nFLAGS:\r\n    -h, --help       Prints help information\r\n    -V, --version    Prints version information\r\n\r\nOPTIONS:\r\n    -f, --fake <some> <val>    some help\r\n\r\nNETWORKING:\r\n\r\n\r\nSPECIAL:\r\n    -b, --birthday-song <song>    Change which song is played for birthdays\r\n```\n\n### Expected Behaviour\n\n```text\r\nblorp 1.4\r\n\r\nWill M.\r\n\r\ndoes stuff\r\n\r\nUSAGE:\r\n    blorp --fake <some> <val> --birthday-song <song> [ARGS]\r\n\r\nFLAGS:\r\n    -h, --help       Prints help information\r\n    -V, --version    Prints version information\r\n\r\nOPTIONS:\r\n    -f, --fake <some> <val>    some help\r\n\r\nSPECIAL:\r\n    -b, --birthday-song <song>    Change which song is played for birthdays\r\n```\n\n### Additional Context\n\n_No response_\n\n### Debug Output\n\n_No response_",
    "clap-rs__clap-2529": "Derived ArgEnum::from_str should not panic on invalid input \n### Please complete the following tasks\n\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\n- [X] I have searched the existing issues\n\n### Rust Version\n\nrustc 1.52.1\n\n### Clap Version\n\nclap 3.0.0-beta.2\n\n### Minimal reproducible code\n\n```rust\r\nuse clap::ArgEnum;\r\n\r\n#[derive(ArgEnum)]\r\npub enum MyEnum {\r\n    Foo,\r\n    Bar,\r\n}\r\n\r\nfn main() {\r\n    let _ = MyEnum::from_str(\"baz\", true).unwrap_or(MyEnum::Foo);\r\n}\r\n```\r\n\n\n### Steps to reproduce the bug with the above code\n\n`cargo run`\n\n### Actual Behaviour\n\nthread 'main' panicked at 'internal error: entered unreachable code: The impossible variant have been spotted: baz', src/main.rs:3:10\n\n### Expected Behaviour\n\nThe code completes without crashing and `MyEnum::Foo` is assigned to `_`.\n\n### Additional Context\n\n`ArgEnum::from_str` is defined as returning a `Result` so the derived implementation should follow that interface and return an `Err` on failure. Currently the derived implementation always returns `Ok` or panics with the `unreachable!` macro.\r\n\r\nSince `ArgEnum` is public, it is not correct to assume that clap code will be the only caller, so the invalid input code-path is not actually unreachable.\r\n\r\nIn my case, I am defining an argument type that internally contains an enum and when implementing `FromStr` it is convenient to re-use `ArgEnum::from_str` so that I do not have to duplicate the enum parsing. However, this panics when passed an invalid argument on the command line.\n\n### Debug Output\n\nNo change, but here is the output with `RUST_BACKTRACE=1`:\r\n```\r\nthread 'main' panicked at 'internal error: entered unreachable code: The impossible variant have been spotted: baz', src/main.rs:3:10\r\nstack backtrace:\r\n   0: rust_begin_unwind\r\n             at /build/rust/src/rustc-1.52.1-src/library/std/src/panicking.rs:493:5\r\n   1: core::panicking::panic_fmt\r\n             at /build/rust/src/rustc-1.52.1-src/library/core/src/panicking.rs:92:14\r\n   2: <clap_bug::MyEnum as clap::derive::ArgEnum>::from_str\r\n             at ./src/main.rs:3:10\r\n   3: clap_bug::main\r\n             at ./src/main.rs:10:14\r\n   4: core::ops::function::FnOnce::call_once\r\n             at /build/rust/src/rustc-1.52.1-src/library/core/src/ops/function.rs:227:5\r\n```",
    "clap-rs__clap-2501": "[v3 Bug] `flag_subcommands` doesn't work well with list of arguments\n### Please complete the following tasks\r\n\r\n- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)\r\n- [X] I have searched the existing issues\r\n\r\n### Rust Version\r\n\r\nrustc 1.52.1 (9bc8c42bb 2021-05-09)\r\n\r\n### Clap Version\r\n\r\n3.0.0-beta.2\r\n\r\n### Minimal reproducible code\r\n\r\n```rust\r\n//# clap = \"3.0.0-beta.2\"\r\n\r\nuse clap::{App, AppSettings, Arg};\r\n\r\nfn match_from(call: &[&str]) {\r\n    let matches = App::new(\"pacaptr\")\r\n        .setting(AppSettings::SubcommandRequiredElseHelp)\r\n        .subcommand(\r\n            App::new(\"sync\")\r\n                .short_flag('S')\r\n                .long_flag(\"sync\")\r\n                .about(\"Synchronize packages.\")\r\n                .arg(\r\n                    Arg::new(\"info\")\r\n                        .long(\"info\")\r\n                        .short('i')\r\n                        .about(\"view package information\"),\r\n                )\r\n                .arg(\r\n                    Arg::new(\"package\")\r\n                        .about(\"packages\")\r\n                        .multiple(true)\r\n                        .takes_value(true),\r\n                ),\r\n        )\r\n        .arg(\r\n            Arg::new(\"pm\")\r\n                .long(\"pm\")\r\n                .multiple(false)\r\n                .takes_value(true)\r\n                .global(true),\r\n        )\r\n        .get_matches_from(call);\r\n\r\n    assert_eq!(Some(\"mockpm\"), matches.value_of(\"pm\"));\r\n    match matches.subcommand() {\r\n        Some((\"sync\", sync_matches)) => {\r\n            let packages: Vec<_> = sync_matches.values_of(\"package\").unwrap().collect();\r\n            let values = packages.join(\", \");\r\n\r\n            assert!(sync_matches.is_present(\"info\"));\r\n            assert_eq!(values, \"docker\");\r\n        }\r\n        _ => panic!(),\r\n    }\r\n}\r\n\r\nfn main() {\r\n    // These examples pass...\r\n    match_from(&[\"pacaptr\", \"--pm\", \"mockpm\", \"--sync\", \"-i\", \"docker\"]);\r\n    match_from(&[\"pacaptr\", \"--pm=mockpm\", \"--sync\", \"-i\", \"docker\"]);\r\n    match_from(&[\"pacaptr\", \"-Si\", \"--pm\", \"mockpm\", \"docker\"]);\r\n    match_from(&[\"pacaptr\", \"-Si\", \"docker\", \"--pm\", \"mockpm\"]);\r\n    // But any of these doesn't:\r\n    // thread 'main' panicked at 'assertion failed: sync_matches.is_present(\\\"info\\\")', src/main.rs:40:13\r\n    // match_from(&[\"pacaptr\", \"--pm\", \"mockpm\", \"-Si\", \"docker\"]);\r\n    // match_from(&[\"pacaptr\", \"--pm=mockpm\", \"-Si\", \"docker\"]);\r\n}\r\n```\r\n\r\n\r\n### Steps to reproduce the bug with the above code\r\n\r\n`cargo run`\r\n\r\n### Actual Behaviour\r\n\r\nWhen I run `pacaptr --pm mockpm -Si docker`:\r\n- `--sync` is read properly.\r\n- `--info` is **not read**.\r\n- `packages == &[\"-Si\", \"docker\"]`\r\n\r\n### Expected Behaviour\r\n\r\nWhen I run `pacaptr --pm mockpm -Si docker`:\r\n- `--sync` is read properly.\r\n- `--info` is read properly.\r\n- `packages == &[\"docker\"]`\r\n\r\n### Additional Context\r\n\r\n_No response_\r\n\r\n### Debug Output\r\n\r\n_No response_",
    "clap-rs__clap-2400": "unset default value if some other Arg is present (or has a specific value)\n<!--\r\nPlease use the following template to assist with creating an issue and to ensure a speedy resolution. If an area is not applicable, feel free to delete the area or mark with `N/A`\r\n-->\r\n\r\n### Rust Version\r\n\r\nrustc 1.32.0 (9fda7c223 2019-01-16)\r\n\r\n### Affected Version of clap\r\n\r\n2.32.0\r\n\r\n### Feature Request Summary\r\n\r\nSome way to unset the default value for an Arg based on the presence or value of some other Arg. One alternative the current API allows is to pass the empty string (or some other value that means nothing) to `Arg::default_value_if` (at the expense of additional code to treat `Some(\"\")` like `None`):\r\n\r\n```rust\r\n.default_value_if(\"other\", None, \"\").default_value(\"foo\")\r\n```\r\n\r\nThe signature I\u2019m imagining looks something like:\r\n\r\n```rust\r\nfn no_default_value_if(self, arg: &'a str, val: Option<&'b str>) -> Self\r\n```",
    "clap-rs__clap-2360": "Add configuration to allow empty values in v3\n### Describe your use case\r\n\r\nhttps://github.com/clap-rs/clap/blob/master/v3_changes.md has a point about:\r\n> - Allow empty values no longer default\r\n\r\nFor [starship/starship](https://github.com/starship/starship), the prompt setup script may occasionally provide empty values to flags. On `3.0.0-alpha.1`, it seems that empty values surface an error to the user.\r\nIt would be nice to have a configuration option to optionally accept empty values.\r\n\r\n### Describe the solution you'd like\r\n\r\nA new clap attribute that would allow empty values to be passed in without surfacing an error.\r\nPerhaps `allow_empty`, or something along those lines.\r\n\r\n```rust\r\n#[derive(Clap, Debug)]\r\nenum Opts {\r\n    Prompt {\r\n        #[clap(short, long, allow_empty)] // <-- allow_empty would allow empty strings\r\n        status: Option<String>, // Would be `Some(\"\")`\r\n    },\r\n}\r\n```\r\n",
    "clap-rs__clap-2358": "clap_derive does not respect name attribute for enums\n### Code\r\n\r\n```rust\r\nuse clap::Clap;\r\n\r\n#[derive(Clap)]\r\n#[clap(name = \"mybin\", version = clap::crate_version!())]\r\nenum Opts {}\r\n\r\nfn main() {\r\n    Opts::parse();\r\n}\r\n```\r\n\r\nFull repository here: https://github.com/newAM/clap-issue\r\n\r\n### Steps to reproduce the issue\r\n\r\n1. `git clone git@github.com:newAM/clap-issue.git`\r\n2. `cd clap-issue`\r\n3. `cargo run -- -V`\r\n\r\n### Version\r\n\r\n* **Rust**: `rustc 1.47.0 (18bf6b4f0 2020-10-07)`\r\n* **Clap**: fad3d9632ebde36004455084df2c9052afe40855 (`master`)\r\n\r\n### Actual Behavior Summary\r\n\r\n```\r\n$ cargo run -- -V                                          \r\n    Finished dev [unoptimized + debuginfo] target(s) in 0.01s\r\n     Running `target/debug/cli -V`\r\ncli 0.1.0\r\n```\r\n\r\n### Expected Behavior Summary\r\n\r\nI expect `name = \"mybin\"` to set the name for the application, and the output should then look like this.\r\n\r\n```\r\n$ cargo run -- -V                                          \r\n    Finished dev [unoptimized + debuginfo] target(s) in 0.01s\r\n     Running `target/debug/cli -V`\r\nmybin 0.1.0\r\n```\r\n\r\n### Additional context\r\n\r\nThis *only* occurs for enums, when using a struct this matches the expected behaviour:\r\n```rust\r\nuse clap::Clap;\r\n\r\n#[derive(Clap)]\r\n#[clap(name = \"mybin\", version = clap::crate_version!())]\r\nstruct Opts {}\r\n\r\nfn main() {\r\n    Opts::parse();\r\n}\r\n```\r\n\r\n```\r\n$ cargo run -- -V                                          \r\n    Finished dev [unoptimized + debuginfo] target(s) in 0.01s\r\n     Running `target/debug/cli -V`\r\nmybin 0.1.0\r\n```\r\n\r\nIn addition to impacting `-V` and `--version` this also impacts completion scripts generated with `clap`.\r\n\r\n### Debug output\r\n\r\n<details>\r\n<summary> Debug Output </summary>\r\n<pre>\r\n<code>\r\n[            clap::build::app]  App::_do_parse\r\n[            clap::build::app]  App::_build\r\n[            clap::build::app]  App::_propagate:cli\r\n[            clap::build::app]  App::_derive_display_order:cli\r\n[            clap::build::app]  App::_create_help_and_version\r\n[            clap::build::app]  App::_create_help_and_version: Building --help\r\n[            clap::build::app]  App::_create_help_and_version: Building --version\r\n[clap::build::app::debug_asserts]       App::_debug_asserts\r\n[            clap::build::arg]  Arg::_debug_asserts:help\r\n[            clap::build::arg]  Arg::_debug_asserts:version\r\n[         clap::parse::parser]  Parser::get_matches_with\r\n[         clap::parse::parser]  Parser::_build\r\n[         clap::parse::parser]  Parser::_verify_positionals\r\n[         clap::parse::parser]  Parser::get_matches_with: Begin parsing '\"-V\"' ([45, 86])\r\n[         clap::parse::parser]  Parser::is_new_arg: \"-V\":NotFound\r\n[         clap::parse::parser]  Parser::is_new_arg: arg_allows_tac=false\r\n[         clap::parse::parser]  Parser::is_new_arg: - found\r\n[         clap::parse::parser]  Parser::is_new_arg: starts_new_arg=true\r\n[         clap::parse::parser]  Parser::possible_subcommand: arg=\"-V\"\r\n[         clap::parse::parser]  Parser::get_matches_with: possible_sc=false, sc=None\r\n[         clap::parse::parser]  Parser::parse_short_arg: full_arg=\"-V\"\r\n[         clap::parse::parser]  Parser::parse_short_arg:iter:V\r\n[         clap::parse::parser]  Parser::parse_short_arg:iter:V: Found valid opt or flag\r\n[         clap::parse::parser]  Parser::check_for_help_and_version_char\r\n[         clap::parse::parser]  Parser::check_for_help_and_version_char: Checking if -V is help or version...\r\n[         clap::parse::parser]  Version\r\n[         clap::parse::parser]  Parser::version_err\r\n[            clap::build::app]  App::_render_version\r\n[         clap::parse::parser]  Parser::color_help\r\n[           clap::output::fmt]  is_a_tty: stderr=false\r\ncli 0.1.0\r\n</code>\r\n</pre>\r\n</details>\r\n",
    "clap-rs__clap-2329": "Using >2 dashes shows 2 dashes in the help menu.\n### Make sure you completed the following tasks\r\n\r\n### Code\r\n\r\nThis can be seen with cargo. Just run `cargo -----`, \r\n\r\n### Actual Behavior Summary\r\n\r\nit will say,\r\n`error: Found argument '--' which wasn't expected, or isn't valid in this context`,\r\n2 dashes, even with more than 2 dashes in the command. I am using cargo since it is readily available and uses clap.\r\n\r\n### Expected Behavior Summary\r\n\r\n`error: Found argument '-----' which wasn't expected, or isn't valid in this context`,\r\n\r\n",
    "clap-rs__clap-2310": "Required groups don't use value_name in usage\n### Code\r\n\r\n```rust\r\nfn main() {\r\n    clap::App::new(\"prog\")\r\n        .arg(clap::Arg::with_name(\"a\").value_name(\"A\"))\r\n        .group(clap::ArgGroup::with_name(\"group\").arg(\"a\").required(true))\r\n        .get_matches();\r\n}\r\n```\r\n\r\n### Steps to reproduce the issue\r\n\r\n 1. `cargo run -- --help`\r\n\r\n### Version\r\n\r\n* **Rust**: rustc 1.44.0 (49cae5576 2020-06-01)\r\n* **Clap**: 2.33.3\r\n\r\n### Actual Behavior Summary\r\n\r\n`prog <a>` is printed for the usage string.\r\n\r\n### Expected Behavior Summary\r\n\r\n`prog <A>` is printed for the usage string.\r\n\r\n### Additional context\r\n\r\nSee also #1292, perhaps?\r\n\r\n### Debug output\r\n\r\nCompile clap with `debug` feature:\r\n\r\n```toml\r\n[dependencies]\r\nclap = { version = \"*\", features = [\"debug\"] }\r\n```\r\n\r\nThe output may be very long, so feel free to link to a gist or attach a text file\r\n\r\n<details>\r\n<summary> Debug Output </summary>\r\n<pre>\r\n<code>\r\n\r\nDEBUG:clap:Parser::propagate_settings: self=x, g_settings=AppFlags(\r\n    (empty),\r\n)\r\nDEBUG:clap:Parser::get_matches_with;\r\nDEBUG:clap:Parser::create_help_and_version;\r\nDEBUG:clap:Parser::create_help_and_version: Building --help\r\nDEBUG:clap:Parser::create_help_and_version: Building --version\r\nDEBUG:clap:Parser::get_matches_with: Begin parsing '\"--help\"' ([45, 45, 104, 101, 108, 112])\r\nDEBUG:clap:Parser::is_new_arg:\"--help\":NotFound\r\nDEBUG:clap:Parser::is_new_arg: arg_allows_tac=false\r\nDEBUG:clap:Parser::is_new_arg: -- found\r\nDEBUG:clap:Parser::is_new_arg: starts_new_arg=true\r\nDEBUG:clap:Parser::possible_subcommand: arg=\"--help\"\r\nDEBUG:clap:Parser::get_matches_with: possible_sc=false, sc=None\r\nDEBUG:clap:ArgMatcher::process_arg_overrides:None;\r\nDEBUG:clap:Parser::parse_long_arg;\r\nDEBUG:clap:Parser::parse_long_arg: Does it contain '='...No\r\nDEBUG:clap:Parser::parse_long_arg: Found valid flag '--help'\r\nDEBUG:clap:Parser::check_for_help_and_version_str;\r\nDEBUG:clap:Parser::check_for_help_and_version_str: Checking if --help is help or version...Help\r\nDEBUG:clap:Parser::_help: use_long=true\r\nDEBUG:clap:Help::write_parser_help;\r\nDEBUG:clap:Help::write_parser_help;\r\nDEBUG:clap:Parser::color;\r\nDEBUG:clap:Parser::color: Color setting...Auto\r\nDEBUG:clap:is_a_tty: stderr=false\r\nDEBUG:clap:Help::new;\r\nDEBUG:clap:Help::write_help;\r\nDEBUG:clap:Help::write_default_help;\r\nDEBUG:clap:Help::write_bin_name;\r\nDEBUG:clap:Help::write_version;\r\nDEBUG:clap:usage::create_usage_no_title;\r\nDEBUG:clap:usage::get_required_usage_from: reqs=[\"group\"], extra=None\r\nDEBUG:clap:usage::get_required_usage_from: after init desc_reqs=[]\r\nDEBUG:clap:usage::get_required_usage_from: no more children\r\nDEBUG:clap:usage::get_required_usage_from: final desc_reqs=[\"group\"]\r\nDEBUG:clap:usage::get_required_usage_from: args_in_groups=[\"a\"]\r\nDEBUG:clap:usage::needs_flags_tag;\r\nDEBUG:clap:usage::needs_flags_tag:iter: f=hclap_help;\r\nDEBUG:clap:usage::needs_flags_tag:iter: f=vclap_version;\r\nDEBUG:clap:usage::needs_flags_tag: [FLAGS] not required\r\nDEBUG:clap:usage::get_args_tag;\r\nDEBUG:clap:usage::get_args_tag:iter:a:\r\nDEBUG:clap:Parser::groups_for_arg: name=a\r\nDEBUG:clap:Parser::groups_for_arg: Searching through groups...\r\n\tFound 'group'\r\nDEBUG:clap:usage::get_args_tag:iter:a:iter:group;\r\nDEBUG:clap:usage::create_help_usage: usage=x <a>\r\nDEBUG:clap:Help::write_all_args;\r\nDEBUG:clap:Help::write_args;\r\nDEBUG:clap:Help::write_args: Current Longest...2\r\nDEBUG:clap:Help::write_args: New Longest...6\r\nDEBUG:clap:Help::write_args: Current Longest...6\r\nDEBUG:clap:Help::write_args: New Longest...9\r\nDEBUG:clap:Help::write_arg;\r\nDEBUG:clap:Help::short;\r\nDEBUG:clap:Help::long;\r\nDEBUG:clap:Help::val: arg=--help\r\nDEBUG:clap:Help::spec_vals: a=--help\r\nDEBUG:clap:Help::val: Has switch...Yes\r\nDEBUG:clap:Help::val: force_next_line...false\r\nDEBUG:clap:Help::val: nlh...false\r\nDEBUG:clap:Help::val: taken...21\r\nDEBUG:clap:Help::val: help_width > (width - taken)...23 > (120 - 21)\r\nDEBUG:clap:Help::val: longest...9\r\nDEBUG:clap:Help::val: next_line...No\r\nDEBUG:clap:write_spaces!: num=7\r\nDEBUG:clap:Help::help;\r\nDEBUG:clap:Help::help: Next Line...false\r\nDEBUG:clap:Help::help: Too long...No\r\nDEBUG:clap:Help::write_arg;\r\nDEBUG:clap:Help::short;\r\nDEBUG:clap:Help::long;\r\nDEBUG:clap:Help::val: arg=--version\r\nDEBUG:clap:Help::spec_vals: a=--version\r\nDEBUG:clap:Help::val: Has switch...Yes\r\nDEBUG:clap:Help::val: force_next_line...false\r\nDEBUG:clap:Help::val: nlh...false\r\nDEBUG:clap:Help::val: taken...21\r\nDEBUG:clap:Help::val: help_width > (width - taken)...26 > (120 - 21)\r\nDEBUG:clap:Help::val: longest...9\r\nDEBUG:clap:Help::val: next_line...No\r\nDEBUG:clap:write_spaces!: num=4\r\nDEBUG:clap:Help::help;\r\nDEBUG:clap:Help::help: Next Line...false\r\nDEBUG:clap:Help::help: Too long...No\r\nDEBUG:clap:Help::write_args_unsorted;\r\nDEBUG:clap:Help::write_arg;\r\nDEBUG:clap:Help::short;\r\nDEBUG:clap:Help::long;\r\nDEBUG:clap:Help::val: arg=&lt;A>\r\nDEBUG:clap:Help::spec_vals: a=&lt;A>\r\nDEBUG:clap:Help::val: Has switch...No, and not next_line\r\nDEBUG:clap:write_spaces!: num=4\r\nDEBUG:clap:Help::help;\r\nDEBUG:clap:Help::help: Next Line...false\r\nDEBUG:clap:Help::help: Too long...No\r\nx\r\n\r\nUSAGE:\r\n    x &lt;a>\r\n\r\nFLAGS:\r\n    -h, --help       Prints help information\r\n    -V, --version    Prints version information\r\n\r\nARGS:\r\n    &lt;A>\r\n\r\n</code>\r\n</pre>\r\n</details>\r\n",
    "clap-rs__clap-2309": "Regression in error messages when two args from a non-multiple group were passed\nThis is what it used to look like:\r\n```\r\nerror: The argument '--delete' cannot be used with '<base>'\r\nUSAGE:\r\n    clap-test <base|--delete>\r\nFor more information try --help\"\r\n```\r\n\r\nAfter https://github.com/clap-rs/clap/pull/1856 has landed, it looks like\r\n```\r\nerror: Found argument '--all' which wasn't expected, or isn't valid in this context\r\nIf you tried to supply `--all` as a PATTERN use `-- --all`\r\nUSAGE:\r\n    clap-test <-a|--delete>\r\nFor more information try --help\"\r\n```\r\n\r\nThis is undesirable and must be corrected, but the bugfix is more important.\r\n",
    "clap-rs__clap-2297": "AllArgsOverrideSelf fails to take effect in certain patterns of arguments\n### Make sure you completed the following tasks\r\n\r\n- [x] Searched the [discussions](https://github.com/clap-rs/clap/discussions)\r\n- [x] Searched the closed issues\r\n\r\n### Code\r\n\r\n```rust\r\nuse clap::{Arg, App, AppSettings};\r\n\r\nfn main() {\r\n    let schema = App::new(\"ripgrep#1701 reproducer\")\r\n        .setting(AppSettings::AllArgsOverrideSelf)\r\n        .arg(Arg::with_name(\"pretty\")\r\n            .short(\"p\")\r\n            .long(\"pretty\"))\r\n        .arg(Arg::with_name(\"search_zip\")\r\n            .short(\"z\")\r\n            .long(\"search-zip\"));\r\n\r\n    let test_args = &[\r\n       vec![\"reproducer\", \"-pz\", \"-p\"],\r\n       vec![\"reproducer\", \"-pzp\"],\r\n       vec![\"reproducer\", \"-zpp\"],\r\n       vec![\"reproducer\", \"-pp\", \"-z\"],\r\n       vec![\"reproducer\", \"-p\", \"-p\", \"-z\"],\r\n\r\n       vec![\"reproducer\", \"-p\", \"-pz\"],\r\n       vec![\"reproducer\", \"-ppz\"],\r\n    ];\r\n\r\n\r\n    for argv in test_args {\r\n        let matches = schema.clone().get_matches_from_safe(argv);\r\n        match matches {\r\n            Ok(_) => println!(\" OK: {:?}\", argv),\r\n            Err(e) => println!(\"ERR: {:?} ({:?})\", argv, e.kind),\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n### Steps to reproduce the issue\r\n\r\n1. Run `cargo run` for the reproducer script\r\n\r\n### Version\r\n\r\n* **Rust**: `rustc 1.47.0 (18bf6b4f0 2020-10-07)`\r\n* **Clap**: 2.33.3\r\n\r\n### Actual Behavior Summary\r\n\r\n```\r\n OK: [\"reproducer\", \"-pz\", \"-p\"]\r\n OK: [\"reproducer\", \"-pzp\"]\r\n OK: [\"reproducer\", \"-zpp\"]\r\n OK: [\"reproducer\", \"-pp\", \"-z\"]\r\n OK: [\"reproducer\", \"-p\", \"-p\", \"-z\"]\r\nERR: [\"reproducer\", \"-p\", \"-pz\"] (UnexpectedMultipleUsage)\r\nERR: [\"reproducer\", \"-ppz\"] (UnexpectedMultipleUsage)\r\n```\r\n\r\nI tripped over this when a script that invoked `rg -pz` errored out because I had `--pretty` in my ripgrep configuration file.\r\n\r\n### Expected Behavior Summary\r\n\r\nAll of the strings in the reproducer should behave identically.\r\n\r\n### Additional context\r\n\r\n[debug.log](https://github.com/clap-rs/clap/files/5370816/debug.log)",
    "clap-rs__clap-2296": "unset default value if some other Arg is present (or has a specific value)\n<!--\r\nPlease use the following template to assist with creating an issue and to ensure a speedy resolution. If an area is not applicable, feel free to delete the area or mark with `N/A`\r\n-->\r\n\r\n### Rust Version\r\n\r\nrustc 1.32.0 (9fda7c223 2019-01-16)\r\n\r\n### Affected Version of clap\r\n\r\n2.32.0\r\n\r\n### Feature Request Summary\r\n\r\nSome way to unset the default value for an Arg based on the presence or value of some other Arg. One alternative the current API allows is to pass the empty string (or some other value that means nothing) to `Arg::default_value_if` (at the expense of additional code to treat `Some(\"\")` like `None`):\r\n\r\n```rust\r\n.default_value_if(\"other\", None, \"\").default_value(\"foo\")\r\n```\r\n\r\nThe signature I\u2019m imagining looks something like:\r\n\r\n```rust\r\nfn no_default_value_if(self, arg: &'a str, val: Option<&'b str>) -> Self\r\n```",
    "clap-rs__clap-2253": "Global args on subcommands do not get propagated to sub-subcommands\n<!--\r\nPlease use the following template to assist with creating an issue and to ensure a speedy resolution. If an area is not applicable, feel free to delete the area or mark with `N/A`\r\n-->\r\n\r\n### Rust Version\r\n\r\n~~~\r\nrustc 1.30.1 (1433507eb 2018-11-07)\r\n~~~\r\n\r\n### Affected Version of clap\r\n\r\n~~~\r\n2.32.0\r\n~~~\r\n\r\n### Bug or Feature Request Summary\r\n\r\nBug\r\n\r\n### Expected Behavior Summary\r\n\r\nSubcommand matches gets value.\r\n\r\n### Actual Behavior Summary\r\n\r\nSubcommand matched do not get value.\r\n\r\n### Steps to Reproduce the issue\r\n\r\nRun sample code.\r\n\r\n### Sample Code or Link to Sample Code\r\n\r\n~~~rust\r\nextern crate clap;\r\n\r\nuse clap::{Arg,App,SubCommand};\r\n\r\nfn main() {\r\n\r\n    let app = App::new(\"foo\")\r\n\r\n        .subcommand(SubCommand::with_name(\"sub1\")\r\n\r\n            .arg(Arg::with_name(\"arg1\")\r\n                .long(\"arg1\")\r\n                .takes_value(true)\r\n                .global(true)\r\n            )\r\n\r\n            .subcommand(SubCommand::with_name(\"sub1a\")\r\n            )\r\n        )\r\n    ;\r\n\r\n    let m1 = app.get_matches_from(&[\"foo\", \"sub1\", \"--arg1\", \"v1\", \"sub1a\"]); // fails\r\n\r\n    println!(\"{:#?}\", m1);\r\n\r\n    let v1 = m1.subcommand_matches(\"sub1\").unwrap().subcommand_matches(\"sub1a\").unwrap().value_of(\"arg1\").unwrap();\r\n    println!(\"{}\", v1);\r\n}\r\n~~~\r\n\r\nOn the example application I would expect the subcommand to receive the global value as well. Putting the argument `arg1` on the app global level works. But then the argument is available outside the subcommand `sub1` as well.\r\n\r\n### Debug output\r\n\r\nCompile clap with cargo features `\"debug\"` such as:\r\n\r\n```toml\r\n[dependencies]\r\nclap = { version = \"2\", features = [\"debug\"] }\r\n```\r\n\r\n<details>\r\n<summary> Debug Output </summary>\r\n<pre>\r\n<code>\r\n\r\n   Compiling clap v2.32.0\r\n   Compiling clap1 v0.1.0 (/home/jreimann/git/clap1)\r\n    Finished dev [unoptimized + debuginfo] target(s) in 8.18s\r\n     Running `target/debug/clap1`\r\nDEBUG:clap:Parser::add_subcommand: term_w=None, name=sub1a\r\nDEBUG:clap:Parser::add_subcommand: term_w=None, name=sub1\r\nDEBUG:clap:Parser::propagate_settings: self=foo, g_settings=AppFlags(\r\n    (empty)\r\n)\r\nDEBUG:clap:Parser::propagate_settings: sc=sub1, settings=AppFlags(\r\n    NEEDS_LONG_HELP | NEEDS_LONG_VERSION | NEEDS_SC_HELP | UTF8_NONE | COLOR_AUTO\r\n), g_settings=AppFlags(\r\n    (empty)\r\n)\r\nDEBUG:clap:Parser::propagate_settings: self=sub1, g_settings=AppFlags(\r\n    (empty)\r\n)\r\nDEBUG:clap:Parser::propagate_settings: sc=sub1a, settings=AppFlags(\r\n    NEEDS_LONG_HELP | NEEDS_LONG_VERSION | NEEDS_SC_HELP | UTF8_NONE | COLOR_AUTO\r\n), g_settings=AppFlags(\r\n    (empty)\r\n)\r\nDEBUG:clap:Parser::propagate_settings: self=sub1a, g_settings=AppFlags(\r\n    (empty)\r\n)\r\nDEBUG:clap:Parser::get_matches_with;\r\nDEBUG:clap:Parser::create_help_and_version;\r\nDEBUG:clap:Parser::create_help_and_version: Building --help\r\nDEBUG:clap:Parser::create_help_and_version: Building --version\r\nDEBUG:clap:Parser::create_help_and_version: Building help\r\nDEBUG:clap:Parser::get_matches_with: Begin parsing '\"sub1\"' ([115, 117, 98, 49])\r\nDEBUG:clap:Parser::is_new_arg:\"sub1\":NotFound\r\nDEBUG:clap:Parser::is_new_arg: arg_allows_tac=false\r\nDEBUG:clap:Parser::is_new_arg: probably value\r\nDEBUG:clap:Parser::is_new_arg: starts_new_arg=false\r\nDEBUG:clap:Parser::possible_subcommand: arg=\"sub1\"\r\nDEBUG:clap:Parser::get_matches_with: possible_sc=true, sc=Some(\"sub1\")\r\nDEBUG:clap:Parser::parse_subcommand;\r\nDEBUG:clap:usage::get_required_usage_from: reqs=[], extra=None\r\nDEBUG:clap:usage::get_required_usage_from: after init desc_reqs=[]\r\nDEBUG:clap:usage::get_required_usage_from: no more children\r\nDEBUG:clap:usage::get_required_usage_from: final desc_reqs=[]\r\nDEBUG:clap:usage::get_required_usage_from: args_in_groups=[]\r\nDEBUG:clap:Parser::parse_subcommand: About to parse sc=sub1\r\nDEBUG:clap:Parser::parse_subcommand: sc settings=AppFlags(\r\n    NEEDS_LONG_HELP | NEEDS_LONG_VERSION | NEEDS_SC_HELP | UTF8_NONE | COLOR_AUTO\r\n)\r\nDEBUG:clap:Parser::get_matches_with;\r\nDEBUG:clap:Parser::create_help_and_version;\r\nDEBUG:clap:Parser::create_help_and_version: Building --help\r\nDEBUG:clap:Parser::create_help_and_version: Building --version\r\nDEBUG:clap:Parser::create_help_and_version: Building help\r\nDEBUG:clap:Parser::get_matches_with: Begin parsing '\"--arg1\"' ([45, 45, 97, 114, 103, 49])\r\nDEBUG:clap:Parser::is_new_arg:\"--arg1\":NotFound\r\nDEBUG:clap:Parser::is_new_arg: arg_allows_tac=false\r\nDEBUG:clap:Parser::is_new_arg: -- found\r\nDEBUG:clap:Parser::is_new_arg: starts_new_arg=true\r\nDEBUG:clap:Parser::possible_subcommand: arg=\"--arg1\"\r\nDEBUG:clap:Parser::get_matches_with: possible_sc=false, sc=None\r\nDEBUG:clap:ArgMatcher::process_arg_overrides:None;\r\nDEBUG:clap:Parser::parse_long_arg;\r\nDEBUG:clap:Parser::parse_long_arg: Does it contain '='...No\r\nDEBUG:clap:OptBuilder::fmt:arg1\r\nDEBUG:clap:Parser::parse_long_arg: Found valid opt '--arg1 <arg1>'\r\nDEBUG:clap:Parser::parse_opt; opt=arg1, val=None\r\nDEBUG:clap:Parser::parse_opt; opt.settings=ArgFlags(EMPTY_VALS | GLOBAL | TAKES_VAL | DELIM_NOT_SET)\r\nDEBUG:clap:Parser::parse_opt; Checking for val...None\r\nDEBUG:clap:ArgMatcher::inc_occurrence_of: arg=arg1\r\nDEBUG:clap:ArgMatcher::inc_occurrence_of: first instance\r\nDEBUG:clap:Parser::groups_for_arg: name=arg1\r\nDEBUG:clap:Parser::groups_for_arg: No groups defined\r\nDEBUG:clap:Parser::parse_opt: More arg vals required...\r\nDEBUG:clap:Parser:get_matches_with: After parse_long_arg Opt(\"arg1\")\r\nDEBUG:clap:Parser::get_matches_with: Begin parsing '\"v1\"' ([118, 49])\r\nDEBUG:clap:Parser::is_new_arg:\"v1\":Opt(\"arg1\")\r\nDEBUG:clap:Parser::is_new_arg: arg_allows_tac=false\r\nDEBUG:clap:Parser::is_new_arg: probably value\r\nDEBUG:clap:Parser::is_new_arg: starts_new_arg=false\r\nDEBUG:clap:Parser::add_val_to_arg; arg=arg1, val=\"v1\"\r\nDEBUG:clap:Parser::add_val_to_arg; trailing_vals=false, DontDelimTrailingVals=false\r\nDEBUG:clap:Parser::add_single_val_to_arg;\r\nDEBUG:clap:Parser::add_single_val_to_arg: adding val...\"v1\"\r\nDEBUG:clap:Parser::groups_for_arg: name=arg1\r\nDEBUG:clap:Parser::groups_for_arg: No groups defined\r\nDEBUG:clap:ArgMatcher::needs_more_vals: o=arg1\r\nDEBUG:clap:Parser::get_matches_with: Begin parsing '\"sub1a\"' ([115, 117, 98, 49, 97])\r\nDEBUG:clap:Parser::is_new_arg:\"sub1a\":ValuesDone\r\nDEBUG:clap:Parser::possible_subcommand: arg=\"sub1a\"\r\nDEBUG:clap:Parser::get_matches_with: possible_sc=true, sc=Some(\"sub1a\")\r\nDEBUG:clap:Parser::parse_subcommand;\r\nDEBUG:clap:usage::get_required_usage_from: reqs=[\"arg1\"], extra=None\r\nDEBUG:clap:usage::get_required_usage_from: after init desc_reqs=[]\r\nDEBUG:clap:usage::get_required_usage_from: no more children\r\nDEBUG:clap:usage::get_required_usage_from: final desc_reqs=[\"arg1\"]\r\nDEBUG:clap:usage::get_required_usage_from: args_in_groups=[]\r\nDEBUG:clap:Parser::parse_subcommand: About to parse sc=sub1a\r\nDEBUG:clap:Parser::parse_subcommand: sc settings=AppFlags(\r\n    NEEDS_LONG_HELP | NEEDS_LONG_VERSION | NEEDS_SC_HELP | UTF8_NONE | COLOR_AUTO\r\n)\r\nDEBUG:clap:Parser::get_matches_with;\r\nDEBUG:clap:Parser::create_help_and_version;\r\nDEBUG:clap:Parser::create_help_and_version: Building --help\r\nDEBUG:clap:Parser::create_help_and_version: Building --version\r\nDEBUG:clap:ArgMatcher::process_arg_overrides:None;\r\nDEBUG:clap:Parser::remove_overrides:[];\r\nDEBUG:clap:Validator::validate;\r\nDEBUG:clap:Parser::add_defaults;\r\nDEBUG:clap:Parser::add_defaults:iter:arg1: doesn't have conditional defaults\r\nDEBUG:clap:Parser::add_defaults:iter:arg1: doesn't have default vals\r\nDEBUG:clap:Validator::validate_blacklist;\r\nDEBUG:clap:Validator::validate_required: required=[];\r\nDEBUG:clap:Validator::validate_matched_args;\r\nDEBUG:clap:usage::create_usage_with_title;\r\nDEBUG:clap:usage::create_usage_no_title;\r\nDEBUG:clap:usage::get_required_usage_from: reqs=[], extra=None\r\nDEBUG:clap:usage::get_required_usage_from: after init desc_reqs=[]\r\nDEBUG:clap:usage::get_required_usage_from: no more children\r\nDEBUG:clap:usage::get_required_usage_from: final desc_reqs=[]\r\nDEBUG:clap:usage::get_required_usage_from: args_in_groups=[]\r\nDEBUG:clap:usage::needs_flags_tag;\r\nDEBUG:clap:usage::needs_flags_tag:iter: f=hclap_help;\r\nDEBUG:clap:usage::needs_flags_tag:iter: f=vclap_version;\r\nDEBUG:clap:usage::needs_flags_tag: [FLAGS] not required\r\nDEBUG:clap:usage::create_help_usage: usage=foo sub1 sub1a [OPTIONS]\r\nDEBUG:clap:ArgMatcher::process_arg_overrides:Some(\"arg1\");\r\nDEBUG:clap:Parser::remove_overrides:[];\r\nDEBUG:clap:Validator::validate;\r\nDEBUG:clap:Parser::add_defaults;\r\nDEBUG:clap:Parser::add_defaults:iter:arg1: doesn't have conditional defaults\r\nDEBUG:clap:Parser::add_defaults:iter:arg1: doesn't have default vals\r\nDEBUG:clap:Validator::validate_blacklist;\r\nDEBUG:clap:Validator::validate_blacklist:iter:arg1;\r\nDEBUG:clap:Parser::groups_for_arg: name=arg1\r\nDEBUG:clap:Parser::groups_for_arg: No groups defined\r\nDEBUG:clap:Validator::validate_required: required=[];\r\nDEBUG:clap:Validator::validate_matched_args;\r\nDEBUG:clap:Validator::validate_matched_args:iter:arg1: vals=[\r\n    \"v1\"\r\n]\r\nDEBUG:clap:Validator::validate_arg_num_vals:arg1\r\nDEBUG:clap:Validator::validate_arg_values: arg=\"arg1\"\r\nDEBUG:clap:Validator::validate_arg_requires:arg1;\r\nDEBUG:clap:Validator::validate_arg_num_occurs: a=arg1;\r\nDEBUG:clap:usage::create_usage_with_title;\r\nDEBUG:clap:usage::create_usage_no_title;\r\nDEBUG:clap:usage::get_required_usage_from: reqs=[], extra=None\r\nDEBUG:clap:usage::get_required_usage_from: after init desc_reqs=[]\r\nDEBUG:clap:usage::get_required_usage_from: no more children\r\nDEBUG:clap:usage::get_required_usage_from: final desc_reqs=[]\r\nDEBUG:clap:usage::get_required_usage_from: args_in_groups=[]\r\nDEBUG:clap:usage::needs_flags_tag;\r\nDEBUG:clap:usage::needs_flags_tag:iter: f=hclap_help;\r\nDEBUG:clap:usage::needs_flags_tag:iter: f=vclap_version;\r\nDEBUG:clap:usage::needs_flags_tag: [FLAGS] not required\r\nDEBUG:clap:usage::create_help_usage: usage=foo sub1 [OPTIONS] [SUBCOMMAND]\r\nDEBUG:clap:ArgMatcher::process_arg_overrides:None;\r\nDEBUG:clap:Parser::remove_overrides:[];\r\nDEBUG:clap:Validator::validate;\r\nDEBUG:clap:Parser::add_defaults;\r\nDEBUG:clap:Validator::validate_blacklist;\r\nDEBUG:clap:Validator::validate_required: required=[];\r\nDEBUG:clap:Validator::validate_matched_args;\r\nDEBUG:clap:usage::create_usage_with_title;\r\nDEBUG:clap:usage::create_usage_no_title;\r\nDEBUG:clap:usage::get_required_usage_from: reqs=[], extra=None\r\nDEBUG:clap:usage::get_required_usage_from: after init desc_reqs=[]\r\nDEBUG:clap:usage::get_required_usage_from: no more children\r\nDEBUG:clap:usage::get_required_usage_from: final desc_reqs=[]\r\nDEBUG:clap:usage::get_required_usage_from: args_in_groups=[]\r\nDEBUG:clap:usage::needs_flags_tag;\r\nDEBUG:clap:usage::needs_flags_tag:iter: f=hclap_help;\r\nDEBUG:clap:usage::needs_flags_tag:iter: f=vclap_version;\r\nDEBUG:clap:usage::needs_flags_tag: [FLAGS] not required\r\nDEBUG:clap:usage::create_help_usage: usage=foo [SUBCOMMAND]\r\nDEBUG:clap:ArgMatcher::get_global_values: global_arg_vec=[]\r\nArgMatches {\r\n    args: {},\r\n    subcommand: Some(\r\n        SubCommand {\r\n            name: \"sub1\",\r\n            matches: ArgMatches {\r\n                args: {\r\n                    \"arg1\": MatchedArg {\r\n                        occurs: 1,\r\n                        indices: [\r\n                            2\r\n                        ],\r\n                        vals: [\r\n                            \"v1\"\r\n                        ]\r\n                    }\r\n                },\r\n                subcommand: Some(\r\n                    SubCommand {\r\n                        name: \"sub1a\",\r\n                        matches: ArgMatches {\r\n                            args: {},\r\n                            subcommand: None,\r\n                            usage: Some(\r\n                                \"USAGE:\\n    foo sub1 sub1a [OPTIONS]\"\r\n                            )\r\n                        }\r\n                    }\r\n                ),\r\n                usage: Some(\r\n                    \"USAGE:\\n    foo sub1 [OPTIONS] [SUBCOMMAND]\"\r\n                )\r\n            }\r\n        }\r\n    ),\r\n    usage: Some(\r\n        \"USAGE:\\n    foo [SUBCOMMAND]\"\r\n    )\r\n}\r\nthread 'main' panicked at 'called `Option::unwrap()` on a `None` value', libcore/option.rs:345:21\r\nstack backtrace:\r\n   0: std::sys::unix::backtrace::tracing::imp::unwind_backtrace\r\n             at libstd/sys/unix/backtrace/tracing/gcc_s.rs:49\r\n   1: std::sys_common::backtrace::print\r\n             at libstd/sys_common/backtrace.rs:71\r\n             at libstd/sys_common/backtrace.rs:59\r\n   2: std::panicking::default_hook::{{closure}}\r\n             at libstd/panicking.rs:211\r\n   3: std::panicking::default_hook\r\n             at libstd/panicking.rs:227\r\n   4: std::panicking::rust_panic_with_hook\r\n             at libstd/panicking.rs:477\r\n   5: std::panicking::continue_panic_fmt\r\n             at libstd/panicking.rs:391\r\n   6: rust_begin_unwind\r\n             at libstd/panicking.rs:326\r\n   7: core::panicking::panic_fmt\r\n             at libcore/panicking.rs:77\r\n   8: core::panicking::panic\r\n             at libcore/panicking.rs:52\r\n   9: <core::option::Option<T>>::unwrap\r\n             at libcore/macros.rs:20\r\n  10: clap1::main\r\n             at src/main.rs:27\r\n  11: std::rt::lang_start::{{closure}}\r\n             at libstd/rt.rs:74\r\n  12: std::panicking::try::do_call\r\n             at libstd/rt.rs:59\r\n             at libstd/panicking.rs:310\r\n  13: __rust_maybe_catch_panic\r\n             at libpanic_unwind/lib.rs:103\r\n  14: std::rt::lang_start_internal\r\n             at libstd/panicking.rs:289\r\n             at libstd/panic.rs:392\r\n             at libstd/rt.rs:58\r\n  15: std::rt::lang_start\r\n             at libstd/rt.rs:74\r\n  16: main\r\n  17: __libc_start_main\r\n  18: <unknown>\r\n\r\nProcess finished with exit code 101\r\n\r\n\r\n</code>\r\n</pre>\r\n</details>\r\n",
    "clap-rs__clap-2251": "Bug in error message for required conflicted args\n### Rust Version\r\n\r\n`rustc 1.29.0-nightly (12ed235ad 2018-07-18)`\r\n\r\n### Affected Version of clap\r\n\r\n`2.32.0`\r\n\r\n### Bug Summary\r\n\r\nThere are 4 args: `a`, `b`, `c`, `d`. You may only provide 2 of them at a time: (`a` or `b`) AND (`c` or `d`). If you provide `c` and don't provide (`a` or `b`) the clap tells you that `a`, `b`, `d` were not provided while `d` is in a conflict with `c`.\r\n\r\n### Expected Behavior Summary\r\n\r\n```\r\nerror: The following required arguments were not provided:\r\n    --a <a>\r\n    --b <b>\r\n```\r\n\r\n### Actual Behavior Summary\r\n\r\n```\r\nerror: The following required arguments were not provided:\r\n    --a <a>\r\n    --b <b>\r\n    --d <d>\r\n```\r\n\r\n\r\n### Steps to Reproduce the issue\r\n\r\n`$ cargo run -- --c asd`\r\n\r\n### Sample Code or Link to Sample Code\r\n\r\n```rust\r\nextern crate clap;\r\nuse clap::{Arg, App};\r\n\r\nfn main() {\r\n    let matches = App::new(\"My Super Program\")\r\n        .arg(Arg::with_name(\"a\")\r\n           .long(\"a\")\r\n           .takes_value(true)\r\n           .required_unless(\"b\")\r\n           .conflicts_with(\"b\")\r\n        )\r\n        .arg(Arg::with_name(\"b\")\r\n            .long(\"b\")\r\n            .takes_value(true)\r\n            .required_unless(\"a\")\r\n            .conflicts_with(\"a\")\r\n        )\r\n        .arg(Arg::with_name(\"c\")\r\n           .long(\"c\")\r\n           .takes_value(true)\r\n           .required_unless(\"d\")\r\n           .conflicts_with(\"d\")\r\n        )\r\n        .arg(Arg::with_name(\"d\")\r\n           .long(\"d\")\r\n           .takes_value(true)\r\n           .required_unless(\"c\")\r\n           .conflicts_with(\"c\")\r\n        )\r\n        .get_matches();\r\n}\r\n```\r\n\r\n### Debug output\r\n\r\n<details>\r\n<summary> Debug Output </summary>\r\n<pre>\r\n<code>\r\n\r\n```\r\n     Running `target/debug/clap_test --c asd`\r\nDEBUG:clap:Parser::propagate_settings: self=My Super Program, g_settings=AppFlags(\r\n    (empty)\r\n)\r\nDEBUG:clap:Parser::get_matches_with;\r\nDEBUG:clap:Parser::create_help_and_version;\r\nDEBUG:clap:Parser::create_help_and_version: Building --help\r\nDEBUG:clap:Parser::create_help_and_version: Building --version\r\nDEBUG:clap:Parser::get_matches_with: Begin parsing '\"--c\"' ([45, 45, 99])\r\nDEBUG:clap:Parser::is_new_arg:\"--c\":NotFound\r\nDEBUG:clap:Parser::is_new_arg: arg_allows_tac=false\r\nDEBUG:clap:Parser::is_new_arg: -- found\r\nDEBUG:clap:Parser::is_new_arg: starts_new_arg=true\r\nDEBUG:clap:Parser::possible_subcommand: arg=\"--c\"\r\nDEBUG:clap:Parser::get_matches_with: possible_sc=false, sc=None\r\nDEBUG:clap:ArgMatcher::process_arg_overrides:None;\r\nDEBUG:clap:Parser::parse_long_arg;\r\nDEBUG:clap:Parser::parse_long_arg: Does it contain '='...No\r\nDEBUG:clap:OptBuilder::fmt:c\r\nDEBUG:clap:Parser::parse_long_arg: Found valid opt '--c <c>'\r\nDEBUG:clap:Parser::parse_opt; opt=c, val=None\r\nDEBUG:clap:Parser::parse_opt; opt.settings=ArgFlags(REQUIRED | EMPTY_VALS | TAKES_VAL | DELIM_NOT_SET)\r\nDEBUG:clap:Parser::parse_opt; Checking for val...None\r\nDEBUG:clap:ArgMatcher::inc_occurrence_of: arg=c\r\nDEBUG:clap:ArgMatcher::inc_occurrence_of: first instance\r\nDEBUG:clap:Parser::groups_for_arg: name=c\r\nDEBUG:clap:Parser::groups_for_arg: No groups defined\r\nDEBUG:clap:Parser::parse_opt: More arg vals required...\r\nDEBUG:clap:Parser:get_matches_with: After parse_long_arg Opt(\"c\")\r\nDEBUG:clap:Parser::get_matches_with: Begin parsing '\"asd\"' ([97, 115, 100])\r\nDEBUG:clap:Parser::is_new_arg:\"asd\":Opt(\"c\")\r\nDEBUG:clap:Parser::is_new_arg: arg_allows_tac=false\r\nDEBUG:clap:Parser::is_new_arg: probably value\r\nDEBUG:clap:Parser::is_new_arg: starts_new_arg=false\r\nDEBUG:clap:Parser::add_val_to_arg; arg=c, val=\"asd\"\r\nDEBUG:clap:Parser::add_val_to_arg; trailing_vals=false, DontDelimTrailingVals=false\r\nDEBUG:clap:Parser::add_single_val_to_arg;\r\nDEBUG:clap:Parser::add_single_val_to_arg: adding val...\"asd\"\r\nDEBUG:clap:Parser::groups_for_arg: name=c\r\nDEBUG:clap:Parser::groups_for_arg: No groups defined\r\nDEBUG:clap:ArgMatcher::needs_more_vals: o=c\r\nDEBUG:clap:ArgMatcher::process_arg_overrides:Some(\"c\");\r\nDEBUG:clap:Parser::remove_overrides:[];\r\nDEBUG:clap:Validator::validate;\r\nDEBUG:clap:Parser::add_defaults;\r\nDEBUG:clap:Parser::add_defaults:iter:a: doesn't have conditional defaults\r\nDEBUG:clap:Parser::add_defaults:iter:a: doesn't have default vals\r\nDEBUG:clap:Parser::add_defaults:iter:b: doesn't have conditional defaults\r\nDEBUG:clap:Parser::add_defaults:iter:b: doesn't have default vals\r\nDEBUG:clap:Parser::add_defaults:iter:c: doesn't have conditional defaults\r\nDEBUG:clap:Parser::add_defaults:iter:c: doesn't have default vals\r\nDEBUG:clap:Parser::add_defaults:iter:d: doesn't have conditional defaults\r\nDEBUG:clap:Parser::add_defaults:iter:d: doesn't have default vals\r\nDEBUG:clap:Validator::validate_blacklist;\r\nDEBUG:clap:Validator::validate_blacklist:iter:c;\r\nDEBUG:clap:Parser::groups_for_arg: name=c\r\nDEBUG:clap:Parser::groups_for_arg: No groups defined\r\nDEBUG:clap:Validator::validate_required: required=[\"a\", \"b\", \"c\", \"d\"];\r\nDEBUG:clap:Validator::validate_required:iter:a:\r\nDEBUG:clap:Validator::is_missing_required_ok: a=a\r\nDEBUG:clap:Validator::validate_arg_conflicts: a=\"a\";\r\nDEBUG:clap:Validator::validate_required_unless: a=\"a\";\r\nDEBUG:clap:Validator::missing_required_error: extra=None\r\nDEBUG:clap:Parser::color;\r\nDEBUG:clap:Parser::color: Color setting...Auto\r\nDEBUG:clap:is_a_tty: stderr=true\r\nDEBUG:clap:Validator::missing_required_error: reqs=[\r\n    \"a\",\r\n    \"b\",\r\n    \"d\"\r\n]\r\nDEBUG:clap:usage::get_required_usage_from: reqs=[\"a\", \"b\", \"d\"], extra=None\r\nDEBUG:clap:usage::get_required_usage_from: after init desc_reqs=[]\r\nDEBUG:clap:usage::get_required_usage_from: no more children\r\nDEBUG:clap:usage::get_required_usage_from: final desc_reqs=[\"a\", \"b\", \"d\"]\r\nDEBUG:clap:usage::get_required_usage_from: args_in_groups=[]\r\nDEBUG:clap:usage::get_required_usage_from:iter:a:\r\nDEBUG:clap:OptBuilder::fmt:a\r\nDEBUG:clap:usage::get_required_usage_from:iter:b:\r\nDEBUG:clap:OptBuilder::fmt:b\r\nDEBUG:clap:usage::get_required_usage_from:iter:d:\r\nDEBUG:clap:OptBuilder::fmt:d\r\nDEBUG:clap:Colorizer::error;\r\nDEBUG:clap:Colorizer::error;\r\nDEBUG:clap:Colorizer::error;\r\nDEBUG:clap:Validator::missing_required_error: req_args=\"\\n    \\u{1b}[1;31m--a <a>\\u{1b}[0m\\n    \\u{1b}[1;31m--b <b>\\u{1b}[0m\\n    \\u{1b}[1;31m--d <d>\\u{1b}[0m\"\r\nDEBUG:clap:usage::create_usage_with_title;\r\nDEBUG:clap:usage::create_usage_no_title;\r\nDEBUG:clap:usage::get_required_usage_from: reqs=[\"a\", \"b\", \"c\", \"d\"], extra=None\r\nDEBUG:clap:usage::get_required_usage_from: after init desc_reqs=[]\r\nDEBUG:clap:usage::get_required_usage_from: no more children\r\nDEBUG:clap:usage::get_required_usage_from: final desc_reqs=[\"a\", \"b\", \"c\", \"d\"]\r\nDEBUG:clap:usage::get_required_usage_from: args_in_groups=[]\r\nDEBUG:clap:usage::get_required_usage_from:iter:a:\r\nDEBUG:clap:OptBuilder::fmt:a\r\nDEBUG:clap:usage::get_required_usage_from:iter:b:\r\nDEBUG:clap:OptBuilder::fmt:b\r\nDEBUG:clap:usage::get_required_usage_from:iter:c:\r\nDEBUG:clap:OptBuilder::fmt:c\r\nDEBUG:clap:usage::get_required_usage_from:iter:d:\r\nDEBUG:clap:OptBuilder::fmt:d\r\nDEBUG:clap:usage::needs_flags_tag;\r\nDEBUG:clap:usage::needs_flags_tag:iter: f=hclap_help;\r\nDEBUG:clap:usage::needs_flags_tag:iter: f=vclap_version;\r\nDEBUG:clap:usage::needs_flags_tag: [FLAGS] not required\r\nDEBUG:clap:usage::create_help_usage: usage=clap_test --a <a> --b <b> --c <c> --d <d>\r\nDEBUG:clap:Parser::color;\r\nDEBUG:clap:Parser::color: Color setting...Auto\r\nDEBUG:clap:is_a_tty: stderr=true\r\nDEBUG:clap:Colorizer::error;\r\nDEBUG:clap:Colorizer::good;\r\nerror: The following required arguments were not provided:\r\n    --a <a>\r\n    --b <b>\r\n    --d <d>\r\n```\r\n\r\n</code>\r\n</pre>\r\n</details>\r\n",
    "clap-rs__clap-2203": "Suggestions of a subcommand shadowing valid input\nHello,\r\n\r\nI have a problem with sub-commands when the app also expects a parameter\r\n\r\n### Rust Version\r\n\r\n`rustc 1.15.0 (10893a9a3 2017-01-19)`\r\n\r\n### Affected Version of clap\r\n\r\n`clap 2.20.5 `\r\n\r\n### Bug Summary\r\nIn some cases, the suggestion feature will kick in and make the arguments parsing fail on an error even if the provided input is valid\r\n\r\n### Steps to Reproduce the issue\r\nHere is a small app demonstrating the issue (basically a stripped down version of the example in the doc, the problem also happens with it)\r\n```rust\r\n#[macro_use]\r\nextern crate clap;\r\n\r\nfn main() {\r\n    let matches = clap_app!(myapp =>\r\n        (about: \"Does awesome things\")\r\n        (@arg TEXT: +required \"The text to be processed\")\r\n        (@subcommand test =>\r\n            (about: \"Run some tests\")\r\n        )\r\n    ).get_matches();\r\n\r\n    println!(\"text = {:?}, subcommand = {:?}\", matches.value_of(\"TEXT\"), matches.subcommand_name());\r\n}\r\n```\r\nif we run this with these arguments \r\n```\r\n$ target/debug/clap-test foobar test\r\n```\r\nwe get the expected output \r\n```\r\ntext = Some(\"foobar\"), subcommand = Some(\"test\")\r\n``` \r\nNow the problem arises when instead of `foobar` we pass `hello`\r\n```\r\n$ target/debug/clap-test hello test\r\n```\r\n`hello` is to close to the generated subcommand `help` \r\n```\r\nerror: The subcommand 'hello' wasn't recognized\r\n\tDid you mean 'help'?\r\n\r\nIf you believe you received this message in error, try re-running with 'clap-test -- hello'\r\n\r\nUSAGE:\r\n    clap-test <TEXT> [SUBCOMMAND]\r\n\r\nFor more information try --help\r\n```\r\nThe problem disappears when deactivating the `suggestion` feature \r\n\r\n### Debug output\r\n```\r\n$ target/debug/clap-test hello test \r\nDEBUG:clap:Parser::add_subcommand: term_w=None, name=test\r\nDEBUG:clap:Parser::propogate_settings: self=myapp, g_settings=AppFlags(\r\n    NEEDS_LONG_HELP | NEEDS_LONG_VERSION | NEEDS_SC_HELP | UTF8_NONE | COLOR_AUTO\r\n)\r\nDEBUG:clap:Parser::propogate_settings: sc=test, settings=AppFlags(\r\n    NEEDS_LONG_HELP | NEEDS_LONG_VERSION | NEEDS_SC_HELP | UTF8_NONE | COLOR_AUTO\r\n), g_settings=AppFlags(\r\n    NEEDS_LONG_HELP | NEEDS_LONG_VERSION | NEEDS_SC_HELP | UTF8_NONE | COLOR_AUTO\r\n)\r\nDEBUG:clap:Parser::propogate_settings: self=test, g_settings=AppFlags(\r\n    NEEDS_LONG_HELP | NEEDS_LONG_VERSION | NEEDS_SC_HELP | UTF8_NONE | COLOR_AUTO\r\n)\r\nDEBUG:clap:Parser::get_matches_with;\r\nDEBUG:clap:Parser::create_help_and_version;\r\nDEBUG:clap:Parser::create_help_and_version: Building --help\r\nDEBUG:clap:Parser::create_help_and_version: Building --version\r\nDEBUG:clap:Parser::create_help_and_version: Building help\r\nDEBUG:clap:Parser::get_matches_with: Begin parsing '\"hello\"' ([104, 101, 108, 108, 111])\r\nDEBUG:clap:Parser::is_new_arg: arg=\"hello\", Needs Val of=None\r\nDEBUG:clap:Parser::is_new_arg: Does arg allow leading hyphen...false\r\nDEBUG:clap:Parser::is_new_arg: Starts new arg...Probable value\r\nDEBUG:clap:Parser::is_new_arg: Starts new arg...false\r\nDEBUG:clap:Parser::possible_subcommand: arg=\"hello\"\r\nDEBUG:clap:Parser::create_usage;\r\nDEBUG:clap:Parser::create_usage_no_title;\r\nDEBUG:clap:Parser::get_required_from: reqs=[\"TEXT\"], extra=None\r\nDEBUG:clap:Parser::get_required_from: args_in_groups=[]\r\nDEBUG:clap:Parser::needs_flags_tag;\r\nDEBUG:clap:Parser::needs_flags_tag:iter: f=hclap_help;\r\nDEBUG:clap:Parser::needs_flags_tag:iter: f=vclap_version;\r\nDEBUG:clap:Parser::needs_flags_tag: [FLAGS] not required\r\nDEBUG:clap:Parser::color;\r\nDEBUG:clap:Parser::color: Color setting...Auto\r\nDEBUG:clap:Colorizer::error;\r\nDEBUG:clap:is_a_tty: stderr=true\r\nDEBUG:clap:Colorizer::warning;\r\nDEBUG:clap:is_a_tty: stderr=true\r\nDEBUG:clap:Colorizer::good;\r\nDEBUG:clap:is_a_tty: stderr=true\r\nDEBUG:clap:Colorizer::good;\r\nDEBUG:clap:is_a_tty: stderr=true\r\nDEBUG:clap:Colorizer::good;\r\nDEBUG:clap:is_a_tty: stderr=true\r\nerror: The subcommand 'hello' wasn't recognized\r\n\tDid you mean 'help'?\r\n\r\nIf you believe you received this message in error, try re-running with 'clap-test -- hello'\r\n\r\nUSAGE:\r\n    clap-test <TEXT> [SUBCOMMAND]\r\n\r\nFor more information try --help\r\n```\r\n",
    "clap-rs__clap-2190": "Enable Arg::env also for options which do not take value\n\r\n### Affected Version of clap\r\n2.33.0\r\n\r\n### Feature Request Summary\r\n\r\nIt would nice if Arg::env would work also for argument that do not take value. In this case is_present will mean that either:\r\n* Argument is present on command line, or\r\n* There is environment variable, with given name, which is not empty (similar to test -n \"$MY_VAR\" in shell)\r\n\r\n\r\n### Expected Behavior Summary\r\nArg::env should not automatically set takes_values (but this is a breaking change, so maybe just leave it as it is).\r\nIf Arg::env has defined related env variable and takes_value is false, then ArgMatches::is_present will be true if argument is present on command line or env variable exists and is not empty.\r\n\r\n\r\n### Actual Behavior Summary\r\n\r\nCurrently clap Arg::env works only for arguments which take value - environment value is used as default if argument is not provided on command line. Arg::env also automatically sets takes_value to true automatically, which can lead to bit confusing behavior (if you do not know that Arg::env works **only** for Arguments which takes value (and considering that takes_value = false  is default). See short code example below:\r\n\r\n```rust\r\nextern crate clap;\r\n\r\nuse clap::{App,Arg};\r\nuse std::env;\r\n\r\nfn main() {\r\n    env::set_var(\"MY_FLAG\", \"1\");\r\n    \r\n    let matches_not_ok = App::new(\"prog\")\r\n        .arg(Arg::with_name(\"flag\")\r\n            .long(\"flag\")\r\n            .env(\"MY_FLAG\")\r\n            .takes_value(false)\r\n            )\r\n        .get_matches_from(vec![\r\n            \"prog\"\r\n        ]);\r\n        \r\n    // Not working for argument which does not take value :-(\r\n     assert!(! matches_not_ok.is_present(\"flag\"));  \r\n     \r\n     let matches_ok = App::new(\"prog\")\r\n        .arg(Arg::with_name(\"flag\")\r\n            .long(\"flag\")\r\n            .takes_value(false) // switching order of takes_value and env\r\n            .env(\"MY_FLAG\")\r\n            )\r\n        .get_matches_from(vec![\r\n            \"prog\"\r\n        ]);\r\n        \r\n    // And it looks like it's working \r\n     assert!(matches_ok.is_present(\"flag\"));  \r\n     \r\n     //but flag will now consumes value, cause env will set takes_value to true behind scenes\r\n     \r\n     env::remove_var(\"MY_FLAG\");\r\n     \r\n     let matches_ok = App::new(\"prog\")\r\n        .arg(Arg::with_name(\"pos\"))\r\n        .arg(Arg::with_name(\"flag\")\r\n            .long(\"flag\")\r\n            .takes_value(false) \r\n            .env(\"MY_FLAG\")\r\n            )\r\n        .get_matches_from(vec![\r\n            \"prog\", \"--flag\", \"pos\"\r\n        ]);\r\n        \r\n    // now works as expected, however now flag takes value\r\n     assert!(matches_ok.is_present(\"flag\"));  \r\n     // and pos argument is consumed\r\n     assert!(! matches_ok.is_present(\"pos\"));  \r\n     //by flag\r\n     assert_eq!( matches_ok.value_of(\"flag\"), Some(\"pos\"));\r\n     \r\n}\r\n```\r\n",
    "clap-rs__clap-2182": "A required `ArgGroup` is satisfied by a default value\n### Rust Version\r\n\r\n* `1.24.1`\r\n\r\n### Affected Version of clap\r\n\r\n* `2.31.1`\r\n\r\n### Expected Behavior Summary\r\n\r\nI'd expect that an `ArgGroup` with `required(true)` would fail unless the user explicitly passed an argument, even if one of the arguments sets a `default_value`. The documentation notes that this can be done by checking `occurrences_of`.\r\n\r\n### Actual Behavior Summary\r\n\r\nIf one argument of the group sets a `default_value`, the group is satisfied.\r\n\r\n### Steps to Reproduce the issue\r\n\r\n- Define an `App` with two arguments, one of which takes a defaulted value\r\n- Put the two arguments into a group with `.required(true)`\r\n- Run the command without passing either\r\n\r\n### Sample Code or Link to Sample Code\r\n\r\n```Rust\r\nextern crate clap;\r\n\r\nuse clap::{App,Arg,ArgGroup};\r\n\r\nfn main() {\r\n    App::new(\"example\")\r\n        .arg(Arg::with_name(\"foo\")\r\n            .long(\"foo\")\r\n            .takes_value(true))\r\n        .arg(Arg::with_name(\"bar\")\r\n            .long(\"bar\")\r\n            .takes_value(true))\r\n            .default_value(\"1\"))\r\n       .group(ArgGroup::with_name(\"baz\")\r\n            .args(&[\"foo\", \"bar\"])\r\n            .required(true))\r\n        .get_matches();\r\n}\r\n```",
    "clap-rs__clap-2168": "ArgRequiredElseHelp and SubcommandRequiredElseHelp don't result in clap::ErrorKind::HelpDisplayed\n### Make sure you completed the following tasks\r\n\r\n- [x] Searched the [discussions](https://github.com/clap-rs/clap/discussions)\r\n- [x] Searched the closes issues\r\n\r\n### Code\r\n\r\nThis is an example with `AppSettings::ArgRequiredElseHelp`. This also occurs with `AppSettings::SubcommandRequiredElseHelp`.\r\n\r\n```toml\r\n[package]\r\nname = \"fake\"\r\n\r\n[dependencies]\r\nclap = \"3.0.0-beta.1\"\r\n```\r\n```rust\r\nuse clap::{Arg, App, AppSettings, Error};\r\n\r\nfn main() -> Result<(), Error> {\r\n    let cli = App::new(\"myapp\")\r\n        .setting(AppSettings::ArgRequiredElseHelp)\r\n        .arg(\r\n            Arg::new(\"info\")\r\n                .about(\"Provides more info\")\r\n                .short('i')\r\n                .long(\"info\"),\r\n        );\r\n    let matches = match cli.try_get_matches() {\r\n        Ok(matches) => matches,\r\n        Err(e)\r\n            if e.kind == clap::ErrorKind::HelpDisplayed\r\n                || e.kind == clap::ErrorKind::VersionDisplayed\r\n                || e.kind == clap::ErrorKind::MissingArgumentOrSubcommand =>\r\n        {\r\n          println!(\"{:?}\", e.kind);\r\n          return Ok(());\r\n        }\r\n        Err(e) => {\r\n          return Err(e);\r\n        }\r\n    };\r\n\r\n    // We can find out whether or not debugging was turned on\r\n    if matches.is_present(\"info\") {\r\n        println!(\"This is more info\");\r\n    }\r\n    return Ok(())\r\n}\r\n```\r\n\r\n### Steps to reproduce the issue\r\n\r\n1. Run `cargo run`\r\n\r\n### Version\r\n\r\n* **Rust**: `rustc 1.45.0-nightly (a74d1862d 2020-05-14)`\r\n* **Clap**: `3.0.0-beta.1`\r\n\r\n### Actual Behavior Summary\r\n\r\nWhen I use `AppSettings::ArgRequiredElseHelp` or `AppSettings::SubcommandRequiredElseHelp` and do not provide an argument or subcommand the matches call returns an error of kind `clap::ErrorKind::MissingArgumentOrSubcommand` which is not documented or intuitive.\r\n\r\nIt is not intuitive because the `ElseHelp` suggests the result will match that of if the help is being displayed, which would be the `clap::ErrorKind::HelpDisplayed` kind.\r\n\r\nAlso, the `clap::ErrorKind::MissingArgumentOrSubcommand` error kind is treated as a failure and does not use stderr, as pointed out by @kinnison in https://github.com/rust-lang/rustup/pull/2427#issuecomment-659923231, which is inconsistent with `clap::ErrorKind::HelpDisplayed`.\r\nhttps://github.com/clap-rs/clap/blob/7127653b507802e005990b88341164aaf940bc14/src/errors.rs#L387-L392\r\n\r\n### Expected Behavior Summary\r\n\r\nI think there's a few ways this might be improved.\r\n\r\n1. Have this situation result in `clap::ErrorKind::HelpDisplayed`. This is intuitive, although maybe not as flexible.\r\n\r\n2. Rename the error kind to `clap::ErrorKind::MissingArgumentOrSubcommandHelpDisplayed` to indicate clearly that this error is being returned to display the help, but to retain the flexibility.\r\n\r\n3. Add docs indicating that the existing error is returned like HelpDisplayed and VersionDisplayed, so it's not a surprise when this error shows up.\r\n\r\n4. Do 3, plus treat the error not as a failure.\r\n\r\n### Additional context\r\n\r\nThis issue is related to a bug in the latest version of rustup: https://github.com/rust-lang/rustup/issues/2425. There is a fix for that bug in rustup https://github.com/rust-lang/rustup/pull/2427 but the rustup maintainers want to confirm if this is a bug in clap.\r\n\r\nIn rustup v2 of clap is being used but this issue is relevant to both v2 and v3, and looks like it has existed for about 5 years since the ElseHelp settings were added.\r\n\r\n### Debug output\r\n\r\nCompile clap with `debug` feature:\r\n\r\n```toml\r\n[dependencies]\r\nclap = { version = \"*\", features = [\"debug\"] }\r\n```\r\n\r\nThe output may be very long, so feel free to link to a gist or attach a text file\r\n\r\n<details>\r\n<summary> Debug Output </summary>\r\n<pre>\r\n<code>\r\n\r\n[            clap::build::app]  App::_do_parse\r\n[            clap::build::app]  App::_build\r\n[            clap::build::app]  App::_derive_display_order:myapp\r\n[            clap::build::app]  App::_create_help_and_version\r\n[            clap::build::app]  App::_create_help_and_version: Building --help\r\n[            clap::build::app]  App::_create_help_and_version: Building --version\r\n[            clap::build::app]  App::_debug_asserts\r\n[            clap::build::arg]  Arg::_debug_asserts:\r\n[            clap::build::arg]  Arg::_debug_asserts:help\r\n[            clap::build::arg]  Arg::_debug_asserts:version\r\n[         clap::parse::parser]  Parser::get_matches_with\r\n[         clap::parse::parser]  Parser::_build\r\n[         clap::parse::parser]  Parser::_verify_positionals\r\n[         clap::parse::parser]  Parser::remove_overrides\r\n[      clap::parse::validator]  Validator::validate\r\n[         clap::parse::parser]  Parser::add_defaults\r\n[         clap::parse::parser]  Parser::color_help\r\n[           clap::output::fmt]  is_a_tty: stderr=true\r\n[          clap::output::help]  Help::new\r\n[          clap::output::help]  Help::write_help\r\n[          clap::output::help]  Help::write_default_help\r\n[          clap::output::help]  Help::write_bin_name\r\n[          clap::output::help]  Help::write_version\r\n[         clap::output::usage]  Usage::create_usage_no_title\r\n[         clap::output::usage]  Usage::create_help_usage; incl_reqs=true\r\n[         clap::output::usage]  Usage::get_required_usage_from: incls=[], matcher=false, incl_last=false\r\n[         clap::output::usage]  Usage::get_required_usage_from: ret_val=[]\r\n[         clap::output::usage]  Usage::needs_flags_tag\r\n[         clap::output::usage]  Usage::needs_flags_tag:iter: f=\r\n[         clap::output::usage]  groups_for_arg: name=info\r\n[         clap::output::usage]  Usage::needs_flags_tag:iter: [FLAGS] required\r\n[         clap::output::usage]  Usage::create_help_usage: usage=fake [FLAGS]\r\n[          clap::output::help]  Help::write_all_args\r\n[          clap::output::help]  Help::write_args\r\n[          clap::output::help]  should_show_arg: use_long=false, arg=\r\n[          clap::output::help]  Help::write_args: Current Longest...2\r\n[          clap::output::help]  Help::write_args: New Longest...6\r\n[          clap::output::help]  should_show_arg: use_long=false, arg=help\r\n[          clap::output::help]  Help::write_args: Current Longest...6\r\n[          clap::output::help]  Help::write_args: New Longest...6\r\n[          clap::output::help]  should_show_arg: use_long=false, arg=version\r\n[          clap::output::help]  Help::write_args: Current Longest...6\r\n[          clap::output::help]  Help::write_args: New Longest...9\r\n[          clap::output::help]  Help::write_arg\r\n[          clap::output::help]  Help::short\r\n[          clap::output::help]  Help::long\r\n[          clap::output::help]  Help::val: arg=\r\n[          clap::output::help]  Help::spec_vals: a=--info\r\n[          clap::output::help]  Help::val: Has switch...\r\n[          clap::output::help]  Yes\r\n[          clap::output::help]  Help::val: force_next_line...false\r\n[          clap::output::help]  Help::val: nlh...false\r\n[          clap::output::help]  Help::val: taken...21\r\n[          clap::output::help]  val: help_width > (width - taken)...18 > (120 - 21)\r\n[          clap::output::help]  Help::val: longest...9\r\n[          clap::output::help]  Help::val: next_line...\r\n[          clap::output::help]  No\r\n[          clap::output::help]  Help::write_nspaces!: num=7\r\n[          clap::output::help]  Help::help\r\n[          clap::output::help]  Help::help: Next Line...false\r\n[          clap::output::help]  Help::help: Too long...\r\n[          clap::output::help]  No\r\n[          clap::output::help]  Help::write_arg\r\n[          clap::output::help]  Help::short\r\n[          clap::output::help]  Help::long\r\n[          clap::output::help]  Help::val: arg=help\r\n[          clap::output::help]  Help::spec_vals: a=--help\r\n[          clap::output::help]  Help::val: Has switch...\r\n[          clap::output::help]  Yes\r\n[          clap::output::help]  Help::val: force_next_line...false\r\n[          clap::output::help]  Help::val: nlh...false\r\n[          clap::output::help]  Help::val: taken...21\r\n[          clap::output::help]  val: help_width > (width - taken)...23 > (120 - 21)\r\n[          clap::output::help]  Help::val: longest...9\r\n[          clap::output::help]  Help::val: next_line...\r\n[          clap::output::help]  No\r\n[          clap::output::help]  Help::write_nspaces!: num=7\r\n[          clap::output::help]  Help::help\r\n[          clap::output::help]  Help::help: Next Line...false\r\n[          clap::output::help]  Help::help: Too long...\r\n[          clap::output::help]  No\r\n[          clap::output::help]  Help::write_arg\r\n[          clap::output::help]  Help::short\r\n[          clap::output::help]  Help::long\r\n[          clap::output::help]  Help::val: arg=version\r\n[          clap::output::help]  Help::spec_vals: a=--version\r\n[          clap::output::help]  Help::val: Has switch...\r\n[          clap::output::help]  Yes\r\n[          clap::output::help]  Help::val: force_next_line...false\r\n[          clap::output::help]  Help::val: nlh...false\r\n[          clap::output::help]  Help::val: taken...21\r\n[          clap::output::help]  val: help_width > (width - taken)...26 > (120 - 21)\r\n[          clap::output::help]  Help::val: longest...9\r\n[          clap::output::help]  Help::val: next_line...\r\n[          clap::output::help]  No\r\n[          clap::output::help]  Help::write_nspaces!: num=4\r\n[          clap::output::help]  Help::help\r\n[          clap::output::help]  Help::help: Next Line...false\r\n[          clap::output::help]  Help::help: Too long...\r\n[          clap::output::help]  No\r\nMissingArgumentOrSubcommand\r\n\r\n</code>\r\n</pre>\r\n</details>\r\n",
    "clap-rs__clap-2166": "Default alphabetical sorting of options in help message appears to be broken\n### Make sure you completed the following tasks\r\n\r\n- [x] Searched the [discussions](https://github.com/clap-rs/clap/discussions)\r\n- [x] Searched the closes issues\r\n\r\n### Code\r\n\r\n```rust\r\nuse std::net::SocketAddr;\r\nuse std::net::IpAddr;\r\nuse std::path::PathBuf;\r\nuse clap::{Clap, AppSettings};\r\n\r\n#[derive(Clap, Debug)]\r\n#[clap(\r\n    name = \"Pod, the open-source backend for Memri project.\",\r\n    // the bug is present even without this option, but it makes it easier to spot\r\n    setting = AppSettings::UnifiedHelpMessage,\r\n)]\r\npub struct CLIOptions {\r\n    /// Port to listen to.\r\n    #[clap(short, long, default_value = \"3030\")]\r\n    port: i16,\r\n\r\n    /// File to read https public certificate from.\r\n    #[clap(\r\n        short = 'c',\r\n        long,\r\n        default_value = \"./data/certs/pod.crt\",\r\n        name = \"CERTIFICATE_FILE\"\r\n    )]\r\n    https_pub_crt: String,\r\n\r\n    /// File to read https private key from.\r\n    #[clap(\r\n        short = 'k',\r\n        long,\r\n        default_value = \"./data/certs/pod.key\",\r\n        name = \"KEY_FILE\"\r\n    )]\r\n    https_priv_key: String,\r\n\r\n    /// Set the callback address for services launched from within Pod.\r\n    /// This should be the Pod-s address as seen by external services.\r\n    /// During development, it defaults to \"https://pod_pod_1:3030\" if Pod is inside docker,\r\n    /// or \"https://localhost:3030\" on Linux,\r\n    /// or \"https://host.docker.internal:3030\" on other operating systems.\r\n    #[clap(short = 's', long, name = \"ADDRESS\")]\r\n    services_callback_address: Option<SocketAddr>,\r\n\r\n    /// Do not use https when starting the server, instead run on http://127.0.0.1.\r\n    /// Running on loopback interface (127.0.0.1) means that only apps\r\n    /// from within the same computer will be able to access Pod.\r\n    /// This option might be used during development as an alternative to self-signed certificates.\r\n    #[clap(short = 't', long)]\r\n    non_tls: bool,\r\n\r\n    /// Unsafe version of --non-tls. Do not use https when starting the server,\r\n    /// instead run on http on the provided network interface.\r\n    /// WARNING: This is heavily discouraged as an intermediary\r\n    /// (even your router on a local network)\r\n    /// could spoof the traffic sent to the server and do a MiTM attack.\r\n    /// Please consider running Pod on a non-public network (--non-tls),\r\n    /// or use Pod with https encryption.\r\n    #[clap(short, long)]\r\n    insecure_non_tls: Option<IpAddr>,\r\n\r\n    /// Comma-separated list of Pod owners (hex-encoded hashes of public keys).\r\n    /// Only those owners are allowed to call Pod endpoints.\r\n    /// Each Pod owner has its own database and files directory,\r\n    /// the owners do not intersect data-wise.\r\n    ///\r\n    /// A magic value of \"ANY\" will allow any owner to connect to the Pod.\r\n    ///\r\n    /// Can be specified multiple times.\r\n    #[clap(short = 'o', long, required = true, multiple = true)]\r\n    owner: Vec<String>,\r\n\r\n    /// Validate a schema file, and exit.\r\n    /// This allows testing whether a given schema is suitable for use in Pod,\r\n    /// see README.md#schema for details.\r\n    /// Note that running project tests or starting the Pod will also automatically validate\r\n    /// the schema in `res/autogenerated_database_schema.json`.\r\n    #[clap(short = 'v', long, name = \"SCHEMA_FILE\", parse(from_os_str))]\r\n    validate_schema: Option<PathBuf>,\r\n}\r\n\r\nfn main() {\r\n    CLIOptions::parse_from(&[\"a\", \"--help\"]);\r\n}\r\n```\r\n\r\n### Steps to reproduce the issue\r\n\r\n1. `cargo run`\r\n\r\n### Version\r\n\r\n* **Rust**: `1.45.0`\r\n* **Clap**: `master`\r\n\r\n### Actual Behavior Summary\r\n\r\nOptions in help message are sorted in a weird way I don't recognize:\r\n\r\n```\r\nPod, the open-source backend for Memri project. \r\n\r\nUSAGE:\r\n    a [OPTIONS] --owner <owner>...\r\n\r\nOPTIONS:\r\n    -s, --services-callback-address <ADDRESS>\r\n            Set the callback address for services launched from within Pod. This should be the Pod-s\r\n            address as seen by external services. During development, it defaults to\r\n            \"https://pod_pod_1:3030\" if Pod is inside docker, or \"https://localhost:3030\" on Linux,\r\n            or \"https://host.docker.internal:3030\" on other operating systems\r\n    -c, --https-pub-crt <CERTIFICATE_FILE>\r\n            File to read https public certificate from [default: ./data/certs/pod.crt]\r\n\r\n    -k, --https-priv-key <KEY_FILE>\r\n            File to read https private key from [default: ./data/certs/pod.key]\r\n\r\n    -v, --validate-schema <SCHEMA_FILE>\r\n            Validate a schema file, and exit. This allows testing whether a given schema is suitable\r\n            for use in Pod, see README.md#schema for details. Note that running project tests or\r\n            starting the Pod will also automatically validate the schema in\r\n            `res/autogenerated_database_schema.json`\r\n    -h, --help                                   \r\n            Prints help information\r\n\r\n    -i, --insecure-non-tls <insecure-non-tls>\r\n            Unsafe version of --non-tls. Do not use https when starting the server, instead run on\r\n            http on the provided network interface. WARNING: This is heavily discouraged as an\r\n            intermediary (even your router on a local network) could spoof the traffic sent to the\r\n            server and do a MiTM attack. Please consider running Pod on a non-public network (--non-\r\n            tls), or use Pod with https encryption\r\n    -t, --non-tls\r\n            Do not use https when starting the server, instead run on http://127.0.0.1. Running on\r\n            loopback interface (127.0.0.1) means that only apps from within the same computer will\r\n            be able to access Pod. This option might be used during development as an alternative to\r\n            self-signed certificates\r\n    -o, --owner <owner>...\r\n            Comma-separated list of Pod owners (hex-encoded hashes of public keys). Only those\r\n            owners are allowed to call Pod endpoints. Each Pod owner has its own database and files\r\n            directory, the owners do not intersect data-wise.\r\n            \r\n            A magic value of \"ANY\" will allow any owner to connect to the Pod.\r\n            \r\n            Can be specified multiple times.\r\n    -p, --port <port>                            \r\n            Port to listen to [default: 3030]\r\n\r\n    -V, --version                                \r\n            Prints version information\r\n```\r\n\r\n### Expected Behavior Summary\r\n\r\nOptions must be sorted in alphabetical order, as specified in documentation.\r\n\r\n### Additional context\r\n\r\nOriginally reported in https://github.com/TeXitoi/structopt/issues/421\r\n\r\nThe problem still persists in master. ",
    "clap-rs__clap-2161": "Obscure panic with heading and default value\n### Make sure you completed the following tasks\r\n\r\n- [x] Searched the [discussions](https://github.com/clap-rs/clap/discussions)\r\n- [x] Searched the closes issues\r\n\r\n### Code\r\n\r\n```rust\r\nuse clap::Clap;\r\n\r\nfn main() {\r\n\t#[derive(Clap)]\r\n\t#[clap(help_heading = \"HEAD\")]\r\n\tstruct Opt2 {\r\n\t\t#[clap(long, name = \"size\")]\r\n\t\tpub b: Option<usize>,\r\n\t}\r\n\t#[derive(Clap)]\r\n\tstruct Opt {\r\n\t\t#[clap(flatten)]\r\n\t\topt2: Opt2,\r\n\r\n\t\t#[clap(long, default_value = \"32\")]\r\n\t\ta: i32,\r\n\t}\r\n\tOpt::parse_from(&[\"test\"]);\r\n}\r\n```\r\n\r\n### Steps to reproduce the issue\r\n\r\n1. Run `cargo run`\r\n\r\n### Version\r\n\r\n* **Rust**: rustc 1.46.0-nightly (346aec9b0 2020-07-11)\r\n* **Clap**: master at 48d308a8ab9e96d4b21336e428feee420dbac51d\r\n\r\n### Actual Behavior Summary\r\n\r\nCode is panicking with\r\n```\r\nthread 'auto_default_value' panicked at 'called `Option::unwrap()` on a `None` value', clap_derive/tests/default_arg_value.rs:18:12\r\n...\r\n  13: core::panicking::panic\r\n             at src/libcore/panicking.rs:50\r\n  14: core::option::Option<T>::unwrap\r\n             at /home/lach/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/src/libcore/macros/mod.rs:10\r\n  15: <default_arg_value::auto_default_value::Opt as clap::derive::FromArgMatches>::from_arg_matches\r\n             at clap_derive/tests/default_arg_value.rs:18\r\n  16: clap::derive::Clap::parse_from\r\n             at /home/lach/jsonnet-rs/clap/src/derive.rs:29\r\n  17: default_arg_value::auto_default_value\r\n             at clap_derive/tests/default_arg_value.rs:20\r\n  18: default_arg_value::auto_default_value::{{closure}}\r\n             at clap_derive/tests/default_arg_value.rs:5\r\n  19: core::ops::function::FnOnce::call_once\r\n             at /home/lach/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/src/libcore/ops/function.rs:233\r\n  20: <alloc::boxed::Box<F> as core::ops::function::FnOnce<A>>::call_once\r\n             at /rustc/346aec9b02f3c74f3fce97fd6bda24709d220e49/src/liballoc/boxed.rs:1081\r\n  21: <std::panic::AssertUnwindSafe<F> as core::ops::function::FnOnce<()>>::call_once\r\n             at /rustc/346aec9b02f3c74f3fce97fd6bda24709d220e49/src/libstd/panic.rs:318\r\n  22: std::panicking::try::do_call\r\n             at /rustc/346aec9b02f3c74f3fce97fd6bda24709d220e49/src/libstd/panicking.rs:348\r\n  23: std::panicking::try\r\n             at /rustc/346aec9b02f3c74f3fce97fd6bda24709d220e49/src/libstd/panicking.rs:325\r\n  24: std::panic::catch_unwind\r\n             at /rustc/346aec9b02f3c74f3fce97fd6bda24709d220e49/src/libstd/panic.rs:394\r\n  25: test::run_test_in_process\r\n             at src/libtest/lib.rs:541\r\n  26: test::run_test::run_test_inner::{{closure}}\r\n             at src/libtest/lib.rs:450\r\n```\r\n\r\n**If a project of yours is blocked due to this bug, please, mention it explicitly.**\r\n\r\nFound this while extracting argument parsing from main crate in https://github.com/CertainLach/jsonnet-rs\r\n\r\n### Expected Behavior Summary\r\n\r\nIt shouldn't panic, and successfully parse input\r\n\r\n### Additional context\r\n\r\n`default_arg_value.rs:18:12` points at `a: i32` line\r\n\r\nWith no `default_value` on `a: i32`, or  without `help_heading` on `Opt2` struct it works as expected\r\n\r\n### Debug output\r\n\r\nCompile clap with `debug` feature:\r\n\r\n```toml\r\n[dependencies]\r\nclap = { version = \"*\", features = [\"debug\"] }\r\n```\r\n\r\nThe output may be very long, so feel free to link to a gist or attach a text file\r\n\r\n<details>\r\n<summary> Debug Output </summary>\r\n<pre>\r\n<code>\r\n[            clap::build::app]  App::_do_parse\r\n[            clap::build::app]  App::_build\r\n[            clap::build::app]  App::_derive_display_order:clap_derive\r\n[            clap::build::app]  App::_create_help_and_version\r\n[            clap::build::app]  App::_create_help_and_version: Building --help\r\n[            clap::build::app]  App::_create_help_and_version: Building --version\r\n[            clap::build::app]  App::_debug_asserts\r\n[            clap::build::arg]  Arg::_debug_asserts:size\r\n[            clap::build::arg]  Arg::_debug_asserts:a\r\n[            clap::build::arg]  Arg::_debug_asserts:help\r\n[            clap::build::arg]  Arg::_debug_asserts:version\r\n[         clap::parse::parser]  Parser::get_matches_with\r\n[         clap::parse::parser]  Parser::_build\r\n[         clap::parse::parser]  Parser::_verify_positionals\r\n[         clap::parse::parser]  Parser::remove_overrides\r\n[      clap::parse::validator]  Validator::validate\r\n[         clap::parse::parser]  Parser::add_defaults\r\n[      clap::parse::validator]  Validator::validate_conflicts\r\n[      clap::parse::validator]  Validator::validate_exclusive\r\n[      clap::parse::validator]  Validator::gather_conflicts\r\n[      clap::parse::validator]  Validator::validate_required: required=ChildGraph([])\r\n[      clap::parse::validator]  Validator::gather_requirements\r\n[      clap::parse::validator]  Validator::validate_required_unless\r\n[      clap::parse::validator]  Validator::validate_matched_args\r\n[    clap::parse::arg_matcher]  ArgMatcher::get_global_values: global_arg_vec=[]\r\n</code>\r\n</pre>\r\n</details>\r\n",
    "clap-rs__clap-2154": "Suggest PATTERN when passing an invalid flag as a pattern\n### Rust Version\r\n\r\nrustc 1.24.1\r\n\r\n### Affected Version of clap\r\n\r\nhttps://github.com/BurntSushi/ripgrep/blob/master/Cargo.lock#L47\r\n\r\n### Suggestion\r\n\r\nWhen passing a PATTERN which looks like a flag (starting with `--` or perhaps `-`) \r\nand when the parser expects a PATTERN\r\nthen suggest using `-- --myPattern`\r\n\r\nBefore error text\r\n```\r\nerror: Found argument '--no-suggest' which wasn't expected, or isn't valid in this context\r\n\tDid you mean --no-sort-files?\r\n\r\nUSAGE:\r\n    \r\n    rg [OPTIONS] PATTERN [PATH ...]\r\n    rg [OPTIONS] [-e PATTERN ...] [-f FILE ...] [PATH ...]\r\n    rg [OPTIONS] --files [PATH ...]\r\n    rg [OPTIONS] --type-list\r\n\r\nFor more information try --help\r\n```\r\n\r\nAfter help text (only in case when the parser accepts a PATTERN\r\n```\r\nerror: Found argument '--no-suggest' which wasn't expected, or isn't valid in this context\r\n\tDid you mean --no-sort-files?\r\n        If you tried to supply `--no-suggest` as a PATTERN use `rg -- --no-suggest`\r\n\r\nUSAGE:\r\n    \r\n    rg [OPTIONS] PATTERN [PATH ...]\r\n    rg [OPTIONS] [-e PATTERN ...] [-f FILE ...] [PATH ...]\r\n    rg [OPTIONS] --files [PATH ...]\r\n    rg [OPTIONS] --type-list\r\n\r\nFor more information try --help\r\n```\r\n\r\nAddresses https://github.com/BurntSushi/ripgrep/issues/936",
    "clap-rs__clap-2135": "Escape or allow alt text for default values\n<!--\r\nPlease use the following template to assist with creating an issue and to ensure a speedy resolution. If an area is not applicable, feel free to delete the area or mark with `N/A`\r\n-->\r\n\r\n### Rust Version\r\n\r\nrustc 1.33.0 (2aa4c46cf 2019-02-28)\r\n\r\n### Affected Version of clap\r\n\r\n2.32.0\r\n\r\n### Bug or Feature Request Summary\r\n\r\nClap should either escape special characters when printing them or allow a message to be set that is printed instead of the default.\r\n\r\nFor my case, one of my default values is a newline. I would like it to print `\"\\n\"` in the help menu but instead it literally places a new line.\r\n\r\nAdditionally another default I have is a space. I would like that printed as `\" \"`.",
    "clap-rs__clap-2093": "Allow changing message for generated help subcommand\nIt would be nice if it were possible to change the help message for the Clap-provided `help` subcommand. For reference, the current text is \"Prints this message or the help of the given subcommand(s)\".\r\n\r\nForked from #1640.",
    "clap-rs__clap-2085": "-h, --help generate trailing spaces\n<!-- Issuehunt Badges -->\n[<img alt=\"Issuehunt badges\" src=\"https://img.shields.io/badge/IssueHunt-%2410%20Rewarded-%237E24E3.svg\" />](https://issuehunt.io/r/clap-rs/clap/issues/1094)\n<!-- /Issuehunt Badges -->\n\n\n### Rust Version\r\n\r\nrustc 1.21.0 (3b72af97e 2017-10-09)\r\n\r\n### Affected Version of clap\r\n\r\nclap 2.27.1\r\n\r\n### Expected Behavior Summary\r\n\r\nThe help info should not contain unexpected trailing spaces for any lines of text.\r\n\r\n### Actual Behavior Summary\r\n\r\nSome text ends with spaces, especially after the flag names.\r\n\r\n### Steps to Reproduce the issue\r\n\r\n`program --help` or `program -h`.\r\n\r\n### Sample Code\r\n\r\n```rust\r\nextern crate clap;\r\nuse clap::{App, Arg};\r\n\r\nfn main() {\r\n    let _ = App::new(\"clap-space\")\r\n        .arg(Arg::with_name(\"a\").long(\"flag-a\").help(\"The first flag.\"))\r\n        .arg(Arg::with_name(\"b\").long(\"flag-b\").help(\"The second flag.\"))\r\n        .print_long_help();\r\n}\r\n```\r\n\r\n### Debug output\r\n\r\n```\r\nDEBUG:clap:Parser::propagate_settings: self=clap-space, g_settings=AppFlags(\r\n    NEEDS_LONG_HELP | NEEDS_LONG_VERSION | NEEDS_SC_HELP | UTF8_NONE | COLOR_AUTO\r\n)\r\nDEBUG:clap:Parser::create_help_and_version;\r\nDEBUG:clap:Parser::create_help_and_version: Building --help\r\nDEBUG:clap:Parser::create_help_and_version: Building --version\r\nDEBUG:clap:Parser::propagate_settings: self=clap-space, g_settings=AppFlags(\r\n    NEEDS_LONG_HELP | NEEDS_LONG_VERSION | NEEDS_SC_HELP | UTF8_NONE | COLOR_AUTO\r\n)\r\nDEBUG:clap:Parser::create_help_and_version;\r\nDEBUG:clap:Help::write_app_help;\r\nDEBUG:clap:Help::write_parser_help;\r\nDEBUG:clap:Help::write_parser_help;\r\nDEBUG:clap:Parser::color;\r\nDEBUG:clap:Parser::color: Color setting...Auto\r\nDEBUG:clap:is_a_tty: stderr=false\r\nDEBUG:clap:Help::new;\r\nDEBUG:clap:Help::write_help;\r\nDEBUG:clap:Help::write_default_help;\r\nDEBUG:clap:Help::write_bin_name;\r\nDEBUG:clap:Help::write_version;\r\nDEBUG:clap:usage::create_usage_no_title;\r\nDEBUG:clap:usage::get_required_usage_from: reqs=[], extra=None\r\nDEBUG:clap:usage::get_required_usage_from: after init desc_reqs=[]\r\nDEBUG:clap:usage::get_required_usage_from: no more children\r\nDEBUG:clap:usage::get_required_usage_from: final desc_reqs=[]\r\nDEBUG:clap:usage::get_required_usage_from: args_in_groups=[]\r\nDEBUG:clap:usage::needs_flags_tag;\r\nDEBUG:clap:usage::needs_flags_tag:iter: f=a;\r\nDEBUG:clap:Parser::groups_for_arg: name=a\r\nDEBUG:clap:Parser::groups_for_arg: No groups defined\r\nDEBUG:clap:usage::needs_flags_tag:iter: [FLAGS] required\r\nDEBUG:clap:usage::create_help_usage: usage=clap-space [FLAGS]\r\nDEBUG:clap:Help::write_all_args;\r\nDEBUG:clap:Help::write_args;\r\nDEBUG:clap:Help::write_args: Current Longest...2\r\nDEBUG:clap:Help::write_args: New Longest...8\r\nDEBUG:clap:Help::write_args: Current Longest...8\r\nDEBUG:clap:Help::write_args: New Longest...8\r\nDEBUG:clap:Help::write_args: Current Longest...8\r\nDEBUG:clap:Help::write_args: New Longest...8\r\nDEBUG:clap:Help::write_args: Current Longest...8\r\nDEBUG:clap:Help::write_args: New Longest...9\r\nDEBUG:clap:Help::write_arg;\r\nDEBUG:clap:Help::short;\r\nDEBUG:clap:Help::long;\r\nDEBUG:clap:Help::val: arg=--flag-a\r\nDEBUG:clap:Help::spec_vals: a=--flag-a\r\nDEBUG:clap:Help::val: Has switch...Yes\r\nDEBUG:clap:Help::val: force_next_line...false\r\nDEBUG:clap:Help::val: nlh...false\r\nDEBUG:clap:Help::val: taken...21\r\nDEBUG:clap:Help::val: help_width > (width - taken)...15 > (120 - 21)\r\nDEBUG:clap:Help::val: longest...9\r\nDEBUG:clap:Help::val: next_line...No\r\nDEBUG:clap:write_spaces!: num=5\r\nDEBUG:clap:Help::help;\r\nDEBUG:clap:Help::help: Next Line...true\r\nDEBUG:clap:Help::help: Too long...No\r\nDEBUG:clap:Help::write_arg;\r\nDEBUG:clap:Help::short;\r\nDEBUG:clap:Help::long;\r\nDEBUG:clap:Help::val: arg=--flag-b\r\nDEBUG:clap:Help::spec_vals: a=--flag-b\r\nDEBUG:clap:Help::val: Has switch...Yes\r\nDEBUG:clap:Help::val: force_next_line...false\r\nDEBUG:clap:Help::val: nlh...false\r\nDEBUG:clap:Help::val: taken...21\r\nDEBUG:clap:Help::val: help_width > (width - taken)...16 > (120 - 21)\r\nDEBUG:clap:Help::val: longest...9\r\nDEBUG:clap:Help::val: next_line...No\r\nDEBUG:clap:write_spaces!: num=5\r\nDEBUG:clap:Help::help;\r\nDEBUG:clap:Help::help: Next Line...true\r\nDEBUG:clap:Help::help: Too long...No\r\nDEBUG:clap:Help::write_arg;\r\nDEBUG:clap:Help::short;\r\nDEBUG:clap:Help::long;\r\nDEBUG:clap:Help::val: arg=--help\r\nDEBUG:clap:Help::spec_vals: a=--help\r\nDEBUG:clap:Help::val: Has switch...Yes\r\nDEBUG:clap:Help::val: force_next_line...false\r\nDEBUG:clap:Help::val: nlh...false\r\nDEBUG:clap:Help::val: taken...21\r\nDEBUG:clap:Help::val: help_width > (width - taken)...23 > (120 - 21)\r\nDEBUG:clap:Help::val: longest...9\r\nDEBUG:clap:Help::val: next_line...No\r\nDEBUG:clap:write_spaces!: num=7\r\nDEBUG:clap:Help::help;\r\nDEBUG:clap:Help::help: Next Line...true\r\nDEBUG:clap:Help::help: Too long...No\r\nDEBUG:clap:Help::write_arg;\r\nDEBUG:clap:Help::short;\r\nDEBUG:clap:Help::long;\r\nDEBUG:clap:Help::val: arg=--version\r\nDEBUG:clap:Help::spec_vals: a=--version\r\nDEBUG:clap:Help::val: Has switch...Yes\r\nDEBUG:clap:Help::val: force_next_line...false\r\nDEBUG:clap:Help::val: nlh...false\r\nDEBUG:clap:Help::val: taken...21\r\nDEBUG:clap:Help::val: help_width > (width - taken)...26 > (120 - 21)\r\nDEBUG:clap:Help::val: longest...9\r\nDEBUG:clap:Help::val: next_line...No\r\nDEBUG:clap:write_spaces!: num=4\r\nDEBUG:clap:Help::help;\r\nDEBUG:clap:Help::help: Next Line...true\r\nDEBUG:clap:Help::help: Too long...No\r\nclap-space \r\n\r\nUSAGE:\r\n    clap-space [FLAGS]\r\n\r\nFLAGS:\r\n        --flag-a     \r\n            The first flag.\r\n\r\n        --flag-b     \r\n            The second flag.\r\n\r\n    -h, --help       \r\n            Prints help information\r\n\r\n    -V, --version    \r\n            Prints version information\r\n```\n\n\n<!-- Issuehunt content -->\n\n---\n\n<details>\n<summary>\n<b>IssueHunt Summary</b>\n</summary>\n\n#### [<img src='https://avatars2.githubusercontent.com/u/28928944?v=4' alt='knightpp' width=24 height=24> knightpp](https://issuehunt.io/u/knightpp) has been rewarded.\n\n### Backers (Total: $10.00)\n\n- [<img src='https://avatars0.githubusercontent.com/u/174703?v=4' alt='pksunkara' width=24 height=24> pksunkara](https://issuehunt.io/u/pksunkara) ($10.00)\n\n### Submitted pull Requests\n- [#2085 Don't print spaces in long help](https://issuehunt.io/r/clap-rs/clap/pull/2085)\n---\n\n### Tips\n\n- Checkout the [Issuehunt explorer](https://issuehunt.io/r/clap-rs/clap/) to discover more funded issues.\n- Need some help from other developers? [Add your repositories](https://issuehunt.io/r/new) on IssueHunt to raise funds.\n</details>\n<!-- /Issuehunt content-->",
    "clap-rs__clap-2075": "Error message for conflicted args outputs conflicting USAGE\n### Rust Version\r\n\r\n`rustc 1.34.1 (fc50f328b 2019-04-24)`\r\n\r\n### Affected Version of clap\r\n\r\n`2.33.0`\r\n\r\n### Bug or Feature Request Summary\r\n\r\nThere are 2 conflicting args: `a` and `b`. When both are issued, USAGE outputs the invalid command again.\r\n\r\n### Expected Behavior Summary\r\n\r\n```\r\nerror: The argument '-b' cannot be used with '-a'\r\n\r\nUSAGE:\r\n    clap-fix -a\r\n    clap-fix -b\r\n```\r\n\r\n### Actual Behavior Summary\r\n\r\n```\r\nerror: The argument '-b' cannot be used with '-a'\r\n\r\nUSAGE:\r\n    clap-fix -a -b\r\n```\r\n\r\n### Steps to Reproduce the issue\r\n\r\n`cargo run -- -a -b`\r\n\r\n### Sample Code or Link to Sample Code\r\n\r\n```\r\nextern crate clap;\r\nuse clap::{Arg, App};\r\n\r\nfn main() {\r\n    App::new(\"Conflict USAGE\")\r\n        .arg(Arg::with_name(\"a\")\r\n           .short(\"a\")\r\n           .conflicts_with(\"b\")\r\n        )\r\n        .arg(Arg::with_name(\"b\")\r\n            .short(\"b\")\r\n            .conflicts_with(\"a\")\r\n        )\r\n        .get_matches();\r\n}\r\n```\r\n\r\n### Debug output\r\n\r\n<details>\r\n<summary> Debug Output </summary>\r\n<pre>\r\n<code>\r\n\r\n     Running `target/debug/clap-fix -a -b`\r\nDEBUG:clap:Parser::propagate_settings: self=Conflict USAGE, g_settings=AppFlags(\r\n    (empty)\r\n)\r\nDEBUG:clap:Parser::get_matches_with;\r\nDEBUG:clap:Parser::create_help_and_version;\r\nDEBUG:clap:Parser::create_help_and_version: Building --help\r\nDEBUG:clap:Parser::create_help_and_version: Building --version\r\nDEBUG:clap:Parser::get_matches_with: Begin parsing '\"-a\"' ([45, 97])\r\nDEBUG:clap:Parser::is_new_arg:\"-a\":NotFound\r\nDEBUG:clap:Parser::is_new_arg: arg_allows_tac=false\r\nDEBUG:clap:Parser::is_new_arg: - found\r\nDEBUG:clap:Parser::is_new_arg: starts_new_arg=true\r\nDEBUG:clap:Parser::possible_subcommand: arg=\"-a\"\r\nDEBUG:clap:Parser::get_matches_with: possible_sc=false, sc=None\r\nDEBUG:clap:ArgMatcher::process_arg_overrides:None;\r\nDEBUG:clap:Parser::parse_short_arg: full_arg=\"-a\"\r\nDEBUG:clap:Parser::parse_short_arg:iter:a\r\nDEBUG:clap:Parser::parse_short_arg:iter:a: Found valid flag\r\nDEBUG:clap:Parser::check_for_help_and_version_char;\r\nDEBUG:clap:Parser::check_for_help_and_version_char: Checking if -a is help or version...Neither\r\nDEBUG:clap:Parser::parse_flag;\r\nDEBUG:clap:ArgMatcher::inc_occurrence_of: arg=a\r\nDEBUG:clap:ArgMatcher::inc_occurrence_of: first instance\r\nDEBUG:clap:Parser::groups_for_arg: name=a\r\nDEBUG:clap:Parser::groups_for_arg: No groups defined\r\nDEBUG:clap:Parser:get_matches_with: After parse_short_arg Flag\r\nDEBUG:clap:Parser::get_matches_with: Begin parsing '\"-b\"' ([45, 98])\r\nDEBUG:clap:Parser::is_new_arg:\"-b\":Flag\r\nDEBUG:clap:Parser::is_new_arg: arg_allows_tac=false\r\nDEBUG:clap:Parser::is_new_arg: - found\r\nDEBUG:clap:Parser::is_new_arg: starts_new_arg=true\r\nDEBUG:clap:Parser::possible_subcommand: arg=\"-b\"\r\nDEBUG:clap:Parser::get_matches_with: possible_sc=false, sc=None\r\nDEBUG:clap:ArgMatcher::process_arg_overrides:Some(\"a\");\r\nDEBUG:clap:Parser::parse_short_arg: full_arg=\"-b\"\r\nDEBUG:clap:Parser::parse_short_arg:iter:b\r\nDEBUG:clap:Parser::parse_short_arg:iter:b: Found valid flag\r\nDEBUG:clap:Parser::check_for_help_and_version_char;\r\nDEBUG:clap:Parser::check_for_help_and_version_char: Checking if -b is help or version...Neither\r\nDEBUG:clap:Parser::parse_flag;\r\nDEBUG:clap:ArgMatcher::inc_occurrence_of: arg=b\r\nDEBUG:clap:ArgMatcher::inc_occurrence_of: first instance\r\nDEBUG:clap:Parser::groups_for_arg: name=b\r\nDEBUG:clap:Parser::groups_for_arg: No groups defined\r\nDEBUG:clap:Parser:get_matches_with: After parse_short_arg Flag\r\nDEBUG:clap:ArgMatcher::process_arg_overrides:Some(\"b\");\r\nDEBUG:clap:Parser::remove_overrides:[];\r\nDEBUG:clap:Validator::validate;\r\nDEBUG:clap:Parser::add_defaults;\r\nDEBUG:clap:Validator::validate_blacklist;\r\nDEBUG:clap:Validator::validate_blacklist:iter:a;\r\nDEBUG:clap:Parser::groups_for_arg: name=a\r\nDEBUG:clap:Parser::groups_for_arg: No groups defined\r\nDEBUG:clap:Validator::validate_blacklist:iter:b;\r\nDEBUG:clap:Parser::groups_for_arg: name=b\r\nDEBUG:clap:Parser::groups_for_arg: No groups defined\r\nDEBUG:clap:Validator::validate_blacklist:iter:b: Checking blacklisted arg\r\nDEBUG:clap:Validator::validate_blacklist:iter:b: matcher contains it...\r\nDEBUG:clap:build_err!: name=b\r\nDEBUG:clap:build_err!: 'Some(\"-a\")' conflicts with 'b'\r\nDEBUG:clap:usage::create_usage_with_title;\r\nDEBUG:clap:usage::create_usage_no_title;\r\nDEBUG:clap:usage::smart_usage;\r\nDEBUG:clap:usage::get_required_usage_from: reqs=[\"a\", \"b\"], extra=None\r\nDEBUG:clap:usage::get_required_usage_from: after init desc_reqs=[]\r\nDEBUG:clap:usage::get_required_usage_from: no more children\r\nDEBUG:clap:usage::get_required_usage_from: final desc_reqs=[\"a\", \"b\"]\r\nDEBUG:clap:usage::get_required_usage_from: args_in_groups=[]\r\nDEBUG:clap:usage::get_required_usage_from:iter:a:\r\nDEBUG:clap:usage::get_required_usage_from:iter:b:\r\nDEBUG:clap:build_err!: It was a flag...\r\nDEBUG:clap:Parser::color;\r\nDEBUG:clap:Parser::color: Color setting...Auto\r\nDEBUG:clap:is_a_tty: stderr=true\r\nDEBUG:clap:Colorizer::error;\r\nDEBUG:clap:Colorizer::warning;\r\nDEBUG:clap:Colorizer::warning;\r\nDEBUG:clap:Colorizer::good;\r\nerror: The argument '-b' cannot be used with '-a'\r\n\r\nUSAGE:\r\n    clap-fix -a -b\r\n\r\n</code>\r\n</pre>\r\n</details>\r\n",
    "clap-rs__clap-2058": "Add blank line between items in long help\nCurrently, items in a long help message sometimes have a blank line between them, and sometimes run together. Compare this output from clap:\r\n\r\n```\r\nFLAGS:\r\n    -h, --help\r\n            Print help message\r\n\r\n    -u, --unstable\r\n            Enable unstable features. To avoid premature stabilization and excessive version churn,\r\n            unstable features are unavailable unless this flag is set. Unstable features are not\r\n            bound by semantic versioning stability guarantees, and may be changed or removed at any\r\n            time.\r\n    -V, --version\r\n            Print version number\r\n```\r\n\r\nWith this output from `man man`:\r\n\r\n```\r\n       -B     Specify  which  browser  to  use  on  HTML files.  This option overrides the\r\n              BROWSER environment variable. By default, man uses /usr/bin/less-is,\r\n\r\n       -H     Specify a command that renders HTML files as text.   This  option  overrides\r\n              the HTMLPAGER environment variable. By default, man uses /bin/cat,\r\n\r\n       -S  section_list\r\n              List  is  a  colon separated list of manual sections to search.  This option\r\n              overrides the MANSECT environment variable.\r\n```\r\n\r\nIt might be easier to visually parse if the items in a long help message were always separated by a blank line.",
    "clap-rs__clap-2027": "Rename ErrorKind::{VersionDisplayed, HelpDisplayed} to present tense\nUsing clap version `2.33.1`. See the following program:\r\n\r\n```rust\r\nuse clap::*;\r\n\r\nfn main() {\r\n    let app = App::new(\"app\")\r\n        .version(\"1.2.3\")\r\n        .arg(Arg::with_name(\"arg\").takes_value(true).long(\"arg\"));\r\n\r\n    let matches = app.get_matches_from_safe(&[\"app\", \"--version\"]);\r\n    println!(\"\\nerror: {:?}\", matches);\r\n}\r\n```\r\n\r\nThe current output I get is:\r\n```\r\napp 1.2.3\r\nerror: Err(Error { message: \"\", kind: VersionDisplayed, info: None })\r\n```\r\n\r\nThe output I expect is:\r\n```\r\nerror: Err(Error { message: \"\", kind: VersionDisplayed, info: None })\r\n```\r\n\r\nThe `--help` option behaves as expected.",
    "clap-rs__clap-2008": "add {before/after}_help_{short/long} to App struct\n### Make sure you completed the following tasks\r\n\r\n- [x] Searched the [discussions](https://github.com/clap-rs/clap/discussions)\r\n- [x] Searched the closed issues\r\n\r\n### Describe your use case\r\n\r\nI'm looking to use the help menu to replace creating a separate man page. To not bombard users with info, I'd like to include detailed information when they use the long --help flag for sections that need more detail. As a random example of more detail, if you \"man curl\", you'll see sections at the end explaining error codes that you wouldn't see with \"curl --help\" and I think {before/after}_help_{short/long} would provide that location.\r\n\r\n\r\n### Describe the solution you'd like\r\n\r\n```\r\nlet myapp = App::new(\"My App\")\r\n    .after_help(\"footer message\")  // this already exists\r\n    .before_help(\"header message\")  // this already exists\r\n\r\n    .after_help_short(\"a concise footer\")  // proposal, could be redundant with after_help\r\n    .after_help_long(\"a much longer footer\")  // proposal\r\n    .before_help_short(\"a short header\")  // proposal, could be redundant with before_help\r\n    .before_help_long(\"a verbose header\")  // proposal\r\n```\r\n\r\n\r\n### Alternatives, if applicable\r\n\r\nmake man pages or a hook into cargo doc from clap, although I think the suggested solution is easier.\r\n",
    "clap-rs__clap-1975": "clap_derive: Arg::short does not accept \"...\" anymore, it needs char\n`Arg::short` in clap 2.x is defined as `.short(\"...\")` while in clap 3.0 it's going to take `char`.\r\n\r\nAll the examples/tests for the derive use the obsoleted `\"...\"` form, which is supported by [this hack](https://github.com/clap-rs/clap/blob/81457178fa7e055775867ca659b37798b5ae9584/clap_derive/src/attrs.rs#L150-L154). \r\n\r\nThis should be fixed: tests/examples/docs need to be adjusted, the hack should be removed.",
    "clap-rs__clap-1972": "Default `--version` doesn't include newline\nIn version 2.33.0: `cargo run --example 01a_quick_example -- --version` prints version with the final newline. In the current master (f4ace424) it doesn't include the newline which makes it inconvenient in some shells:\r\n```\r\n[root@8428a91f4e1e /]# myapp --version\r\nMyApp 1.0[root@8428a91f4e1e /]#\r\n```\r\n\r\nI couldn't find an issue about that. Was the change intentional?",
    "clap-rs__clap-1958": "help_heading doesn't seem to work\n### Make sure you completed the following tasks\r\n\r\n- [x] Searched the [discussions](https://github.com/clap-rs/clap/discussions)\r\n- [x] Searched the closes issues\r\n\r\nInitially reported as https://github.com/clap-rs/clap/discussions/1954\r\n\r\n### Code\r\n\r\n```rust\r\nuse clap::{App, Arg};\r\n\r\nfn main() {\r\n    App::new(\"app\")\r\n        .arg(Arg::from(\"--flag\").help_heading(Some(\"CUSTOM\")))\r\n        .print_help()\r\n        .unwrap();\r\n}\r\n```\r\n\r\n### Steps to reproduce the issue\r\n\r\n1. Run `cargo run`\r\n\r\n### Version\r\n\r\n* **Rust**: 1.43.1\r\n* **Clap**: 3.0.0-beta.1\r\n\r\n### Actual Behavior Summary\r\n```\r\napp \r\n\r\nUSAGE:\r\n    app [FLAGS]\r\n\r\nFLAGS:\r\n        --flag       \r\n    -h, --help       Prints help information\r\n    -V, --version    Prints version information\r\n```\r\n\r\n### Expected Behavior Summary\r\n\r\n```\r\napp \r\n\r\nUSAGE:\r\n    app [FLAGS]\r\n\r\nFLAGS:\r\n    -h, --help       Prints help information\r\n    -V, --version    Prints version information\r\n\r\nCUSTOM:\r\n    --flag\r\n```\r\n\r\n### Additional context\r\n\r\n`help_heading` doesn't seem to work at all. I checked flags, options and positional args, incuding multiple options and combinations.\r\n",
    "clap-rs__clap-1869": "Arguments with default values conflict even if not used\n**Attention:** This is directly related to https://github.com/clap-rs/clap/issues/1071\r\n\r\nThe original issue was already marked as fixed but it seems like the bug was not fully eliminated.\r\n\r\n---\r\n\r\n### Rust Version\r\n\r\n* rustc 1.39.0 (4560ea788 2019-11-04)\r\n\r\n### Affected Version of clap\r\n\r\n* v2.33.0\r\n* latest master (a2f9fb5f6c2aeeac89c5c638f25dedb9e50bde00)\r\n\r\n### Expected Behavior Summary\r\n\r\nI expect conflicts to happen only when conflicting arguments are explicitly present on the command line.\r\n\r\n### Actual Behavior Summary\r\n\r\nAs mentioned in https://github.com/clap-rs/clap/issues/1071 originally it was enough for an argument to have a `default_value` configured to cause a conflict. This was fixed with 58b5b4be315280888d50d9b15119b91a9028f050 but it seems like the fix only applied to cases where `defaults` and `conflicts_with` are present on different arguments. As `conflicts_with` automatically applies to both related arguments it is also possible to apply the option the argument with the `default` option.\r\n\r\nThis again triggers the same error message as the original issue.\r\n\r\n### Sample Code or Link to Sample Code\r\n\r\n```rust\r\nuse clap::{App, Arg}; // 2.33.0\r\n\r\nfn main() {\r\n    let result = App::new(\"conflict\")\r\n        .arg(Arg::from_usage(\"-o, --opt=[opt] 'some opt'\")\r\n            .default_value(\"default\")\r\n            .conflicts_with(\"flag\"))\r\n        .arg(Arg::from_usage(\"-f, --flag 'some flag'\")\r\n            .conflicts_with(\"opt\"))\r\n        .get_matches_from_safe(vec![\"myprog\", \"-f\"]);\r\n        \r\n    eprintln!(\"{:#?}\", result);\r\n    \r\n    assert!(result.is_ok());\r\n    let m = result.unwrap();\r\n    \r\n    assert_eq!(m.value_of(\"opt\"), Some(\"default\"));\r\n    assert!(m.is_present(\"flag\"));\r\n}\r\n```\r\n\r\nhttps://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=9913e0f7a7905f7be0131ae53ef4ec63",
    "clap-rs__clap-1710": "Offer suggestions for InferSubcommands\nImagine we have this app\r\n```rust\r\nuse clap::*;\r\n\r\nfn main() {\r\n    let m = clap::App::new(\"foo\")\r\n        .global_setting(AppSettings::InferSubcommands)\r\n        .subcommand(App::new(\"test\"))\r\n        .subcommand(App::new(\"temp\"));\r\n\r\n    println!(\"{:?}\", m.get_matches());\r\n}\r\n```\r\n\r\nUser call it like \r\n```sh \r\n$ app te\r\n```\r\n\r\nCurrent error would be \r\n```\r\nerror: The subcommand 'te' wasn't recognized\r\n```\r\nbut it would be nice to see something like \r\n```\r\napp: command 'te' is ambiguous:\r\n    temp test\r\n```",
    "clap-rs__clap-1624": "Add `Arg::conflicts_with_everything` method\n### Summary\r\n\r\nAdd explicit support for arguments that conflict with every other flag and must be always passed alone.\r\n\r\n### Detailed description and motivation\r\n\r\nThere are cases when we need to introduce a command line argument that should always be used standalone, i.e it conflicts with every other argument.\r\n\r\nFor now this can be implemented via `conflicts_with_all` but we have to explicitly enlist all the other flags then:\r\n```rust\r\nApp::new(\"My daemon\")\r\n    .version(\"1.0\")\r\n        // this flag should be always passed alone, so it conflicts with any other flag\r\n        .arg(Arg::with_name(\"status\")\r\n        .conflicts_with_all(&[\r\n            // for now there's only one another flag so this is fairly simple\r\n            // but once we have other arguments we have to pay some extra attention \r\n            // to not miss some accidentally          \r\n            \"SERIAL-PORT\",\r\n        ])\r\n        .short(\"s\")\r\n        .long(\"status\")\r\n        .help(\"Daemon status\"))\r\n    .arg(Arg::with_name(\"SERIAL-PORT\")\r\n        .help(\"Sets the serial-port to use\")\r\n        .required(true))\r\n    .get_matches();\r\n```\r\n\r\nInspired by #1579 \r\n\r\n\r\n",
    "clap-rs__clap-941": "No default_value_os for reliably specifying filesystem paths as default arguments\n### Affected Version of clap\r\n\r\n2.20.3 \r\n\r\n### Expected Behavior Summary\r\n\r\nFunctions like `validator_os` and `value_of_os` should be complemented with a `default_value_os`.\r\n\r\n### Actual Behavior Summary\r\n\r\nOnly `default_value` and its variants are provided... which means that it's not possible to specify all valid paths as default values.\r\n\r\n### Sample Code or Link to Sample Code\r\n\r\n```rust\r\n// env::current_dir is fallible and default_value can't take a callback for lazy eval, so\r\n// resort to \".\" but future-proof it in case of esoteric platforms.\r\n// (Not perfect, but to_string_lossy() is necessary without a `default_value_os`)\r\nlet lazy_currdir = &Component::CurDir.as_os_str().to_string_lossy();\r\n\r\nlet matches = App::new(env!(\"CARGO_PKG_NAME\"))\r\n    .version(crate_version!())\r\n    // .about(\"Description text here\")\r\n    // TODO: Add args to control slog logging level\r\n    .arg(arg::with_name(\"inpath\")\r\n        .help(\"file(s) to use as input\")\r\n        .multiple(true)\r\n        .empty_values(false)\r\n        .default_value(lazy_currdir)\r\n        // .validator_os(validators::path_readable)\r\n        .required(true))\r\n    .get_matches();\r\n```\r\n\r\n(It's an excerpt from the \"new project\" boilerplate I'm putting together)",
    "nushell__nushell-13870": "Inconsistent exit code handling in pipeline?\n### Describe the bug\n\nI just downloaded v0.98.0 to play around with it from the releases and noticed this seemingly inconsistent behavior.\r\n\r\nIf I understand it correctly, when running a script without a config Nushell is supposed to throw an error if an external command's exit code is non-zero and if the external command is the last in a pipeline, but that does not happen here.\n\n### How to reproduce\n\nWithout a config, run each of these lines as a script separately\r\n```nu\r\n\"1\\n2\" | grep -E \"[[:alpha:]]\" # throws error about exit code 1\r\n\"1\\n2\" | grep -E \"[[:alpha:]]\" | lines # prints empty list\r\n\"1\\n2\" | grep -E \"[[:alpha:]]\" | detect columns # throws error about exit code 1\r\n```\n\n### Expected behavior\n\nI expected the final line to return `null` like it does on v0.97.1\n\n### Configuration\n\n| key                  | version                                           |\r\n| ------------------ | ------------------------------------------- |\r\n| version            | 0.98.0                                      |\r\n| major              | 0                                           |\r\n| minor              | 98                                          |\r\n| patch              | 0                                           |\r\n| branch             |                                             |\r\n| commit_hash        | 6e1e824473e15eba246e1c43704c5d88fa237a17    |\r\n| build_os           | linux-x86_64                                |\r\n| build_target       | aarch64-unknown-linux-gnu                   |\r\n| rust_version       | rustc 1.79.0 (129f3b996 2024-06-10)         |\r\n| rust_channel       | 1.79.0-x86_64-unknown-linux-gnu             |\r\n| cargo_version      | cargo 1.79.0 (ffa9cf99a 2024-06-03)         |\r\n| build_time         | 2024-09-18 07:55:36 +00:00                  |\r\n| build_rust_channel | release                                     |\r\n| allocator          | mimalloc                                    |\r\n| features           | default, sqlite, static-link-openssl, trash |\r\n| installed_plugins  |                                             |\r\n",
    "nushell__nushell-13357": "Inconsistent `$in` behavior in `each` closure\n### Describe the bug\n\n```ls | each {$in.name; $in.name}```\r\nWill list the names of X files X times over, resulting in a table of X^2 rows. \r\n\r\n```ls | each {$in.name}```\r\nonly lists each file once, resulting in X rows, as expected. \n\n### How to reproduce\n\n```\r\n# create random files for testing\r\nlet temp_dir = mktemp -d\r\n0..5 | each {mktemp --tmpdir-path $temp_dir}\r\n\r\n# list files\r\nls $temp_dir | each {$in.name; $in.name}\r\n```\r\n\r\nOutput\r\n\r\n```\r\n\u256d\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\r\n\u2502 0 \u2502 \u256d\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e \u2502\r\n\u2502   \u2502 \u2502 0 \u2502 D:\\TEMP\\tmp.fkMnGzm2n7\\tmp.5rLcq47YDc \u2502 \u2502\r\n\u2502   \u2502 \u2502 1 \u2502 D:\\TEMP\\tmp.fkMnGzm2n7\\tmp.cfoPCNIRiF \u2502 \u2502\r\n\u2502   \u2502 \u2502 2 \u2502 D:\\TEMP\\tmp.fkMnGzm2n7\\tmp.vIWG0RMFxl \u2502 \u2502\r\n\u2502   \u2502 \u2502 3 \u2502 D:\\TEMP\\tmp.fkMnGzm2n7\\tmp.VLiVn6BUZ0 \u2502 \u2502\r\n\u2502   \u2502 \u2502 4 \u2502 D:\\TEMP\\tmp.fkMnGzm2n7\\tmp.Y1EfmIhum4 \u2502 \u2502\r\n\u2502   \u2502 \u2502 5 \u2502 D:\\TEMP\\tmp.fkMnGzm2n7\\tmp.YFbRnOKOeK \u2502 \u2502\r\n\u2502   \u2502 \u2570\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f \u2502\r\n\u2502 1 \u2502 \u256d\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e \u2502\r\n\u2502   \u2502 \u2502 0 \u2502 D:\\TEMP\\tmp.fkMnGzm2n7\\tmp.5rLcq47YDc \u2502 \u2502\r\n\u2502   \u2502 \u2502 1 \u2502 D:\\TEMP\\tmp.fkMnGzm2n7\\tmp.cfoPCNIRiF \u2502 \u2502\r\n\u2502   \u2502 \u2502 2 \u2502 D:\\TEMP\\tmp.fkMnGzm2n7\\tmp.vIWG0RMFxl \u2502 \u2502\r\n\u2502   \u2502 \u2502 3 \u2502 D:\\TEMP\\tmp.fkMnGzm2n7\\tmp.VLiVn6BUZ0 \u2502 \u2502\r\n\u2502   \u2502 \u2502 4 \u2502 D:\\TEMP\\tmp.fkMnGzm2n7\\tmp.Y1EfmIhum4 \u2502 \u2502\r\n\u2502   \u2502 \u2502 5 \u2502 D:\\TEMP\\tmp.fkMnGzm2n7\\tmp.YFbRnOKOeK \u2502 \u2502\r\n\u2502   \u2502 \u2570\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f \u2502\r\n\u2502 2 \u2502 \u256d\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e \u2502\r\n\u2502   \u2502 \u2502 0 \u2502 D:\\TEMP\\tmp.fkMnGzm2n7\\tmp.5rLcq47YDc \u2502 \u2502\r\n\u2502   \u2502 \u2502 1 \u2502 D:\\TEMP\\tmp.fkMnGzm2n7\\tmp.cfoPCNIRiF \u2502 \u2502\r\n\u2502   \u2502 \u2502 2 \u2502 D:\\TEMP\\tmp.fkMnGzm2n7\\tmp.vIWG0RMFxl \u2502 \u2502\r\n\u2502   \u2502 \u2502 3 \u2502 D:\\TEMP\\tmp.fkMnGzm2n7\\tmp.VLiVn6BUZ0 \u2502 \u2502\r\n\u2502   \u2502 \u2502 4 \u2502 D:\\TEMP\\tmp.fkMnGzm2n7\\tmp.Y1EfmIhum4 \u2502 \u2502\r\n\u2502   \u2502 \u2502 5 \u2502 D:\\TEMP\\tmp.fkMnGzm2n7\\tmp.YFbRnOKOeK \u2502 \u2502\r\n\u2502   \u2502 \u2570\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f \u2502\r\n\u2502 3 \u2502 \u256d\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e \u2502\r\n\u2502   \u2502 \u2502 0 \u2502 D:\\TEMP\\tmp.fkMnGzm2n7\\tmp.5rLcq47YDc \u2502 \u2502\r\n\u2502   \u2502 \u2502 1 \u2502 D:\\TEMP\\tmp.fkMnGzm2n7\\tmp.cfoPCNIRiF \u2502 \u2502\r\n\u2502   \u2502 \u2502 2 \u2502 D:\\TEMP\\tmp.fkMnGzm2n7\\tmp.vIWG0RMFxl \u2502 \u2502\r\n\u2502   \u2502 \u2502 3 \u2502 D:\\TEMP\\tmp.fkMnGzm2n7\\tmp.VLiVn6BUZ0 \u2502 \u2502\r\n\u2502   \u2502 \u2502 4 \u2502 D:\\TEMP\\tmp.fkMnGzm2n7\\tmp.Y1EfmIhum4 \u2502 \u2502\r\n\u2502   \u2502 \u2502 5 \u2502 D:\\TEMP\\tmp.fkMnGzm2n7\\tmp.YFbRnOKOeK \u2502 \u2502\r\n\u2502   \u2502 \u2570\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f \u2502\r\n\u2502 4 \u2502 \u256d\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e \u2502\r\n\u2502   \u2502 \u2502 0 \u2502 D:\\TEMP\\tmp.fkMnGzm2n7\\tmp.5rLcq47YDc \u2502 \u2502\r\n\u2502   \u2502 \u2502 1 \u2502 D:\\TEMP\\tmp.fkMnGzm2n7\\tmp.cfoPCNIRiF \u2502 \u2502\r\n\u2502   \u2502 \u2502 2 \u2502 D:\\TEMP\\tmp.fkMnGzm2n7\\tmp.vIWG0RMFxl \u2502 \u2502\r\n\u2502   \u2502 \u2502 3 \u2502 D:\\TEMP\\tmp.fkMnGzm2n7\\tmp.VLiVn6BUZ0 \u2502 \u2502\r\n\u2502   \u2502 \u2502 4 \u2502 D:\\TEMP\\tmp.fkMnGzm2n7\\tmp.Y1EfmIhum4 \u2502 \u2502\r\n\u2502   \u2502 \u2502 5 \u2502 D:\\TEMP\\tmp.fkMnGzm2n7\\tmp.YFbRnOKOeK \u2502 \u2502\r\n\u2502   \u2502 \u2570\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f \u2502\r\n\u2502 5 \u2502 \u256d\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e \u2502\r\n\u2502   \u2502 \u2502 0 \u2502 D:\\TEMP\\tmp.fkMnGzm2n7\\tmp.5rLcq47YDc \u2502 \u2502\r\n\u2502   \u2502 \u2502 1 \u2502 D:\\TEMP\\tmp.fkMnGzm2n7\\tmp.cfoPCNIRiF \u2502 \u2502\r\n\u2502   \u2502 \u2502 2 \u2502 D:\\TEMP\\tmp.fkMnGzm2n7\\tmp.vIWG0RMFxl \u2502 \u2502\r\n\u2502   \u2502 \u2502 3 \u2502 D:\\TEMP\\tmp.fkMnGzm2n7\\tmp.VLiVn6BUZ0 \u2502 \u2502\r\n\u2502   \u2502 \u2502 4 \u2502 D:\\TEMP\\tmp.fkMnGzm2n7\\tmp.Y1EfmIhum4 \u2502 \u2502\r\n\u2502   \u2502 \u2502 5 \u2502 D:\\TEMP\\tmp.fkMnGzm2n7\\tmp.YFbRnOKOeK \u2502 \u2502\r\n\u2502   \u2502 \u2570\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f \u2502\r\n\u2570\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\r\n```\n\n### Expected behavior\n\n```\r\n\u256d\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e`\r\n\u2502 0 \u2502 D:\\TEMP\\tmp.fkMnGzm2n7\\tmp.5rLcq47YDc \u2502\r\n\u2502 1 \u2502 D:\\TEMP\\tmp.fkMnGzm2n7\\tmp.cfoPCNIRiF \u2502\r\n\u2502 2 \u2502 D:\\TEMP\\tmp.fkMnGzm2n7\\tmp.vIWG0RMFxl \u2502\r\n\u2502 3 \u2502 D:\\TEMP\\tmp.fkMnGzm2n7\\tmp.VLiVn6BUZ0 \u2502\r\n\u2502 4 \u2502 D:\\TEMP\\tmp.fkMnGzm2n7\\tmp.Y1EfmIhum4 \u2502\r\n\u2502 5 \u2502 D:\\TEMP\\tmp.fkMnGzm2n7\\tmp.YFbRnOKOeK \u2502\r\n\u2570\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\r\n```\n\n### Screenshots\n\n_No response_\n\n### Configuration\n\n| key                | value                                           |\r\n| ------------------ | ----------------------------------------------- |\r\n| version            | 0.94.1                                          |\r\n| major              | 0                                               |\r\n| minor              | 94                                              |\r\n| patch              | 1                                               |\r\n| branch             |                                                 |\r\n| commit_hash        |                                                 |\r\n| build_os           | windows-x86_64                                  |\r\n| build_target       | x86_64-pc-windows-msvc                          |\r\n| rust_version       | rustc 1.79.0-nightly (385fa9d84 2024-04-04)     |\r\n| rust_channel       | nightly-x86_64-pc-windows-msvc                  |\r\n| cargo_version      | cargo 1.79.0-nightly (0637083df 2024-04-02)     |\r\n| build_time         | 2024-05-30 20:32:04 -04:00                      |\r\n| build_rust_channel | release                                         |\r\n| allocator          | mimalloc                                        |\r\n| features           | default, sqlite, system-clipboard, trash, which |\r\n| installed_plugins  | polars                                          |\n\n### Additional context\n\n_No response_",
    "nushell__nushell-12901": "neither hide nor hide-env seems to hide environment variables from externals\n### Describe the bug\n\nI'm trying to hide an environment variable from externals, specifically cargo.\n\n### How to reproduce\n\n1. hide CARGO_TARGET_DIR\r\n2. hide-env CARGO_TARGET_DIR\r\n3. $env.CARGO_TARGET_DIR produces the error it should\r\n4. ^env show that CARGO_TARGET_DIR is still set\r\n5. cargo build, puts all build artifacts in the CARGO_TARGET_DIR folder\n\n### Expected behavior\n\nExternals shouldn't see a hidden env var\n\n### Screenshots\n\n_No response_\n\n### Configuration\n\n|key|value|\r\n|-|-|\r\n|version|0.75.1|\r\n|branch|main|\r\n|commit_hash|5e957ecda69f9221875e304de3a566e74193c22d|\r\n|build_os|windows-x86_64|\r\n|build_target|x86_64-pc-windows-msvc|\r\n|rust_version|rustc 1.66.1 (90743e729 2023-01-10)|\r\n|rust_channel|1.66.1-x86_64-pc-windows-msvc|\r\n|cargo_version|cargo 1.66.1 (ad779e08b 2023-01-10)|\r\n|pkg_version|0.75.1|\r\n|build_time|2023-02-01 08:23:51 -06:00|\r\n|build_rust_channel|release|\r\n|features|database, dataframe, default, trash, which, zip|\r\n|installed_plugins|custom-value generate|\n\n### Additional context\n\n_No response_",
    "nushell__nushell-12118": "Allow nushell to respect XDG_CONFIG_HOME environment variable if found\n### Related problem\n\nAfter our team meeting today, we've decided to move forward with this. We want to keep it simple. Here's the new rules.\r\n\r\npseudo code\r\n```\r\nif XDG_CONFIG_HOME env var exists\r\n  use it as the location of $nu.default-config-dir, where all nushell config files exist\r\nelse\r\n  use our current defined location (based on OS specifics like we do now)\r\n```\n\n### Describe the solution you'd like\n\nWe're looking for someone to implement this and work with us on it.\r\n\r\nClosing these old PRs:\r\nhttps://github.com/nushell/nushell/pull/8682\r\nhttps://github.com/nushell/nushell/pull/10523\r\nhttps://github.com/nushell/nushell/pull/10524\r\n\r\n/cc authors of the original PRs\r\n@ashlineldridge\r\n@utkarshgupta137\r\n\r\n@nushell/core-team Please jump in if I've stated anything wrong.\n\n### Describe alternatives you've considered\n\n_No response_\n\n### Additional context and details\n\n_No response_",
    "nushell__nushell-11948": "\"to json --raw\" does not \u201cremove all whitespace\u201d as documented\n### Describe the bug\r\n\r\n`to json --raw` leaves some whitespace\r\n\r\n### How to reproduce\r\n\r\n```nushell\r\n> {a:1} | to json -r\r\n{\"a\": 1}\r\n```\r\n\r\n### Expected behavior\r\n\r\n`to json --raw` should serialize exactly the way `http post` does:\r\n\r\n```nushell\r\n> {a:1} | to json -r\r\n{\"a\":1}\r\n```\r\n\r\n### Screenshots\r\n\r\n_No response_\r\n\r\n### Configuration\r\n\r\n\r\n| key                | value                                                            |\r\n| ------------------ | ---------------------------------------------------------------- |\r\n| version            | 0.90.1                                                           |\r\n| branch             | makepkg                                                          |\r\n| commit_hash        | c2992d5d8b8541b64e9fc1440ed2917fc9b757f7                         |\r\n| build_os           | linux-x86_64                                                     |\r\n| build_target       | x86_64-unknown-linux-gnu                                         |\r\n| rust_version       | rustc 1.75.0 (82e1608df 2023-12-21) (Arch Linux rust 1:1.75.0-2) |\r\n| cargo_version      | cargo 1.75.0                                                     |\r\n| build_time         | 2024-02-09 11:43:38 +00:00                                       |\r\n| build_rust_channel | release                                                          |\r\n| allocator          | mimalloc                                                         |\r\n| features           | dataframe, default, extra, sqlite, trash, which, zip             |\r\n| installed_plugins  |                                                                  |\r\n\r\n\r\n### Additional context\r\n\r\n_No response_",
    "nushell__nushell-11672": "Fix the parsing precedence of `not` operator\n### Describe the bug\n\n`not` currently has lower precedence than other boolean operators. It should be higher\n\n### How to reproduce\n\n```\r\n> (not false) and false\r\nfalse\r\n> not false and false\r\ntrue\r\n> not (false and false)\r\ntrue\r\n```\n\n### Expected behavior\n\n```\r\n> not false and false\r\nfalse\r\n```\n\n### Screenshots\n\n_No response_\n\n### Configuration\n\n0.89.0 (Nushell temporarily not available)\n\n### Additional context\n\n_No response_",
    "nushell__nushell-11493": "Bug between modules, constants, functions, and `do`\n### Describe the bug\n\nThe combination of modules, constants, functions, and `do` seems to have a bug.\r\n\r\nA command that works, stops working when wrapped with `do { }`, and `variable not found` is reported even when the source does not contain a variable.\r\n\n\n### How to reproduce\n\n\r\n```\r\nnu> module test1 { export const value = \"hello\"; export def func [] { $value } }\r\nnu> use test1\r\nnu> test1 func\r\nhello\r\nnu> do { test1 func }\r\nError: nu::shell::variable_not_found\r\n\r\n  \u00d7 Variable not found\r\n   \u256d\u2500[entry #66:1:1]\r\n 1 \u2502 do { test1 func }\r\n   \u00b7    \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\r\n   \u00b7           \u2570\u2500\u2500 variable not found\r\n   \u2570\u2500\u2500\u2500\u2500\r\n```\r\n\n\n### Expected behavior\n\n\r\n`do { test1 func }` returns `hello`, just like `test1 func` does.\r\n\n\n### Screenshots\n\n_No response_\n\n### Configuration\n\n\r\n| key                | value                                                |\r\n| ------------------ | ---------------------------------------------------- |\r\n| version            | 0.85.0                                               |\r\n| branch             |                                                      |\r\n| commit_hash        |                                                      |\r\n| build_os           | macos-x86_64                                         |\r\n| build_target       | x86_64-apple-darwin                                  |\r\n| rust_version       | rustc 1.72.1 (d5c2e9c34 2023-09-13)                  |\r\n| rust_channel       | stable-x86_64-apple-darwin                           |\r\n| cargo_version      | cargo 1.72.1 (103a7ff2e 2023-08-15)                  |\r\n| build_time         | 2023-10-05 17:57:55 +02:00                           |\r\n| build_rust_channel | release                                              |\r\n| allocator          | mimalloc                                             |\r\n| features           | dataframe, default, extra, sqlite, trash, which, zip |\r\n| installed_plugins  |                                                      |\r\n\r\n\n\n### Additional context\n\n_No response_",
    "nushell__nushell-11292": "Removing `into_string_parsable`\nI suggest removing `into_string_parsable`.  Currently it is equivalent to `into_string()`, but with single quotes around strings.  It's used in two places:\r\n\r\n- The documentation generator for default values.  Here I suggest using `into_string()` with backtick delimiting, so:\r\n   ```Nushell\r\n   text <string>:  (optional, default: 'a default string')\r\n   rec <record>:  (optional, default: {a: 1})\r\n   lst <list<any>>:  (optional, default: [1, 2, 3])\r\n   ```\r\n   gets changed into:\r\n\r\n   ```Nushell\r\n   text <string>:  (optional, default: `a default string`)\r\n   rec <record>:  (optional, default: `{a: 1}`)\r\n   lst <list<any>>:  (optional, default: `[1, 2, 3]`)\r\n    ```\r\n\r\n- `help_completions` menu.  Haven't figured out how this one works yet.  I looks similar to the doc generator.",
    "nushell__nushell-11169": "Naming a command parameter `in` breaks\n### Describe the bug\n\nIf I try to define a parameter named \"in\", nu lets me, but the parameter gets silently overwritten with the pipe input.\n\n### How to reproduce\n\n```\r\n\u276f def something [in: string] {\r\n\u276f   $in + \" something\"\r\n\u276f }\r\n\r\n\u276f something \"foo\"\r\nError: nu::shell::type_mismatch\r\n\r\n  \u00d7 Type mismatch during operation.\r\n   \u256d\u2500[entry #19:1:1]\r\n 1 \u2502 def something [in: string] {\r\n 2 \u2502   $in + \" something\"\r\n   \u00b7   \u2500\u252c\u2500 \u252c \u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\r\n   \u00b7    \u2502  \u2502       \u2570\u2500\u2500 string\r\n   \u00b7    \u2502  \u2570\u2500\u2500 type mismatch for operator\r\n   \u00b7    \u2570\u2500\u2500 nothing\r\n 3 \u2502 }\r\n   \u2570\u2500\u2500\u2500\u2500\r\n```\n\n### Expected behavior\n\n`foo something`\r\n\r\nOr, probably better, Nu should warn me when I define a function which takes a parameter named `in`. I was so confused by the error message until I figured it out.\n\n### Screenshots\n\n_No response_\n\n### Configuration\n\n| key                | value                                          |\r\n| ------------------ | ---------------------------------------------- |\r\n| version            | 0.87.1                                         |\r\n| branch             |                                                |\r\n| commit_hash        |                                                |\r\n| build_os           | macos-aarch64                                  |\r\n| build_target       | aarch64-apple-darwin                           |\r\n| rust_version       | rustc 1.74.0 (79e9716c9 2023-11-13) (Homebrew) |\r\n| cargo_version      | cargo 1.74.0                                   |\r\n| build_time         | 2023-11-18 17:46:36 +00:00                     |\r\n| build_rust_channel | release                                        |\r\n| allocator          | mimalloc                                       |\r\n| features           | dataframe, default, sqlite, trash, which, zip  |\r\n| installed_plugins  |                                                |\n\n### Additional context\n\n_No response_",
    "nushell__nushell-10629": "cannot specify fields and columns in record and table i/o type annotations\n### Describe the bug\n\ni wanted to write some interesting commands to play with the new features from the input/output type annotations.\r\nwe can use `table` and `record` but the parser is not happy when we try to specify the types of columns and fields respectively :thinking: \n\n### How to reproduce\n\n## tables\r\nlet's say i want all the names of the files in a given table, that could look like\r\n```nushell\r\ndef get_file_name []: table<type: string, name: string> -> table<name: string> {\r\n    where type == file | get name\r\n}\r\n```\r\nhowever, i get\r\n```\r\nError: nu::parser::unclosed_delimiter\r\n\r\n  \u00d7 Unclosed delimiter.\r\n   \u256d\u2500[entry #5:1:1]\r\n 1 \u2502 def get_file_name []: table<type: string, name: string> -> table<name: string> {\r\n   \u00b7                       \u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\r\n   \u00b7                            \u2570\u2500\u2500 unclosed >\r\n 2 \u2502     where type == file | get name\r\n   \u2570\u2500\u2500\u2500\u2500\r\n```\r\n\r\n## records\r\nthe exact same thing goes with record, e.g. with merging two records\r\n```nushell\r\ndef merge_records [other: record<bar: int>]: record<foo: string> -> record<foo: string, bar: int> {\r\n    merge $other\r\n}\r\n```\n\n### Expected behavior\n\n## tables\r\ni'd like to get no error and the following output in the root of the Nushell repo\r\n```nushell\r\n> ls | get_file_name\r\n\u256d\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\r\n\u2502 0 \u2502 CODE_OF_CONDUCT.md  \u2502\r\n\u2502 1 \u2502 CONTRIBUTING.md     \u2502\r\n\u2502 2 \u2502 Cargo.lock          \u2502\r\n\u2502 3 \u2502 Cargo.toml          \u2502\r\n\u2502 4 \u2502 Cross.toml          \u2502\r\n\u2502 5 \u2502 LICENSE             \u2502\r\n\u2502 6 \u2502 README.md           \u2502\r\n\u2502 7 \u2502 codecov.yml         \u2502\r\n\u2502 8 \u2502 rust-toolchain.toml \u2502\r\n\u2502 9 \u2502 toolkit.nu          \u2502\r\n\u2570\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\r\n```\r\n\r\n> in order to fix this, i need to remove the annotations, either with\r\n> ```nushell\r\n> def get_file_name []: table -> table {\r\n>     where type == file | get name\r\n> }\r\n> ```\r\n> or\r\n> ```nushell\r\n> def get_file_name []: table<> -> table<> {\r\n>     where type == file | get name\r\n> }\r\n> ```\r\n\r\n## records\r\nsame expected behaviour\r\n> same kind of fix\n\n### Screenshots\n\n_No response_\n\n### Configuration\n\n| key                | value                                    |\r\n| ------------------ | ---------------------------------------- |\r\n| version            | 0.82.1                                   |\r\n| branch             | main                                     |\r\n| commit_hash        | 57d96c09fa78f6231093cb241da4ddbd545f84bf |\r\n| build_os           | linux-x86_64                             |\r\n| build_target       | x86_64-unknown-linux-gnu                 |\r\n| rust_version       | rustc 1.69.0 (84c898d65 2023-04-16)      |\r\n| rust_channel       | 1.69.0-x86_64-unknown-linux-gnu          |\r\n| cargo_version      | cargo 1.69.0 (6e9a83356 2023-04-12)      |\r\n| build_time         | 2023-07-15 12:59:41 +02:00               |\r\n| build_rust_channel | release                                  |\r\n| allocator          | standard                                 |\r\n| features           | default, sqlite, trash, which, zip       |\r\n| installed_plugins  | hist                                     |\n\n### Additional context\n\n_No response_",
    "nushell__nushell-10613": "Overlay hooks don't work unless another hook is registered from command line\n### Describe the bug\n\nI've been experimenting using zoxide as an overlay, however I'm running into an issue where hooks registered in overlays don't seem to work **unless** an additional hook is registered from the command line...\n\n### How to reproduce\n\nSee this gist: https://gist.github.com/jakeswenson/d37884285ee494287b576558ce888d70\n\n### Expected behavior\n\nI expected hooks registered in overlays to work without registering an additional hook from the command line\n\n### Screenshots\n\n_No response_\n\n### Configuration\n\n> version | transpose key value | to md --pretty\r\n\r\n| key                | value                                                             |\r\n| ------------------ | ----------------------------------------------------------------- |\r\n| version            | 0.74.0                                                            |\r\n| branch             |                                                                   |\r\n| commit_hash        |                                                                   |\r\n| build_os           | macos-aarch64                                                     |\r\n| build_target       | aarch64-apple-darwin                                              |\r\n| rust_version       | rustc 1.66.0 (69f9c33d7 2022-12-12) (built from a source tarball) |\r\n| cargo_version      | cargo 1.66.0 (d65d197ad 2022-11-15)                               |\r\n| pkg_version        | 0.74.0                                                            |\r\n| build_time         | 2023-01-10 20:12:41 +00:00                                        |\r\n| build_rust_channel | release                                                           |\r\n| features           | database, default, trash, which, zip                              |\r\n| installed_plugins  |                                                                   |\n\n### Additional context\n\n_No response_",
    "nushell__nushell-10405": "cannot specify fields and columns in record and table i/o type annotations\n### Describe the bug\n\ni wanted to write some interesting commands to play with the new features from the input/output type annotations.\r\nwe can use `table` and `record` but the parser is not happy when we try to specify the types of columns and fields respectively :thinking: \n\n### How to reproduce\n\n## tables\r\nlet's say i want all the names of the files in a given table, that could look like\r\n```nushell\r\ndef get_file_name []: table<type: string, name: string> -> table<name: string> {\r\n    where type == file | get name\r\n}\r\n```\r\nhowever, i get\r\n```\r\nError: nu::parser::unclosed_delimiter\r\n\r\n  \u00d7 Unclosed delimiter.\r\n   \u256d\u2500[entry #5:1:1]\r\n 1 \u2502 def get_file_name []: table<type: string, name: string> -> table<name: string> {\r\n   \u00b7                       \u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\r\n   \u00b7                            \u2570\u2500\u2500 unclosed >\r\n 2 \u2502     where type == file | get name\r\n   \u2570\u2500\u2500\u2500\u2500\r\n```\r\n\r\n## records\r\nthe exact same thing goes with record, e.g. with merging two records\r\n```nushell\r\ndef merge_records [other: record<bar: int>]: record<foo: string> -> record<foo: string, bar: int> {\r\n    merge $other\r\n}\r\n```\n\n### Expected behavior\n\n## tables\r\ni'd like to get no error and the following output in the root of the Nushell repo\r\n```nushell\r\n> ls | get_file_name\r\n\u256d\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\r\n\u2502 0 \u2502 CODE_OF_CONDUCT.md  \u2502\r\n\u2502 1 \u2502 CONTRIBUTING.md     \u2502\r\n\u2502 2 \u2502 Cargo.lock          \u2502\r\n\u2502 3 \u2502 Cargo.toml          \u2502\r\n\u2502 4 \u2502 Cross.toml          \u2502\r\n\u2502 5 \u2502 LICENSE             \u2502\r\n\u2502 6 \u2502 README.md           \u2502\r\n\u2502 7 \u2502 codecov.yml         \u2502\r\n\u2502 8 \u2502 rust-toolchain.toml \u2502\r\n\u2502 9 \u2502 toolkit.nu          \u2502\r\n\u2570\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\r\n```\r\n\r\n> in order to fix this, i need to remove the annotations, either with\r\n> ```nushell\r\n> def get_file_name []: table -> table {\r\n>     where type == file | get name\r\n> }\r\n> ```\r\n> or\r\n> ```nushell\r\n> def get_file_name []: table<> -> table<> {\r\n>     where type == file | get name\r\n> }\r\n> ```\r\n\r\n## records\r\nsame expected behaviour\r\n> same kind of fix\n\n### Screenshots\n\n_No response_\n\n### Configuration\n\n| key                | value                                    |\r\n| ------------------ | ---------------------------------------- |\r\n| version            | 0.82.1                                   |\r\n| branch             | main                                     |\r\n| commit_hash        | 57d96c09fa78f6231093cb241da4ddbd545f84bf |\r\n| build_os           | linux-x86_64                             |\r\n| build_target       | x86_64-unknown-linux-gnu                 |\r\n| rust_version       | rustc 1.69.0 (84c898d65 2023-04-16)      |\r\n| rust_channel       | 1.69.0-x86_64-unknown-linux-gnu          |\r\n| cargo_version      | cargo 1.69.0 (6e9a83356 2023-04-12)      |\r\n| build_time         | 2023-07-15 12:59:41 +02:00               |\r\n| build_rust_channel | release                                  |\r\n| allocator          | standard                                 |\r\n| features           | default, sqlite, trash, which, zip       |\r\n| installed_plugins  | hist                                     |\n\n### Additional context\n\n_No response_",
    "nushell__nushell-10395": "Syntax-hightlight panics with index out of bounds due to custom function with many arguments\n### Describe the bug\n\nThe interactive shell panics during typing when calling a custom function with many arguments:\r\n\r\n(stacktrace from `RUST_BACKTRACE=full nu` -> reproduction steps)\r\n```\r\nthread 'main' panicked at 'index out of bounds: the len is 2 but the index is 3', crates/nu-parser/src/parser.rs:737:28\r\nstack backtrace:\r\n   0:     0x561699d32165 - <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt::h3155a8c966b4beb5\r\n   1:     0x5616991a19fe - core::fmt::write::h062c617411b691df\r\n   2:     0x561699d2a7f5 - std::io::Write::write_fmt::hb61fdf1275c61e1c\r\n   3:     0x561699d31f35 - std::sys_common::backtrace::print::hca896ae22beb06cb\r\n   4:     0x561699d33cbf - std::panicking::default_hook::{{closure}}::h0b5eeed5cf36ab5f\r\n   5:     0x561699d33a2a - std::panicking::default_hook::h8932b573145a321b\r\n   6:     0x561699d34350 - std::panicking::rust_panic_with_hook::h4b1447a24e3e94f8\r\n   7:     0x561699d340e4 - std::panicking::begin_panic_handler::{{closure}}::h8701da9995a3820c\r\n   8:     0x561699d3267c - std::sys_common::backtrace::__rust_end_short_backtrace::hb696c5ed02a01598\r\n   9:     0x561699d33e32 - rust_begin_unwind\r\n  10:     0x56169913abd3 - core::panicking::panic_fmt::h8aa706a976963c88\r\n  11:     0x56169913ad22 - core::panicking::panic_bounds_check::he585f6a1f703448f\r\n  12:     0x5616997b98ed - nu_parser::parser::parse_multispan_value::h67d8f1193d506532\r\n  13:     0x5616997bb64d - nu_parser::parser::parse_internal_call::hc113520e17e3a887\r\n  14:     0x5616997bdbda - nu_parser::parser::parse_call::h1f0bbfcb84b7667b\r\n  15:     0x5616997d1edd - nu_parser::parser::parse_expression::hffcd304ab2ee2251\r\n  16:     0x5616997d3ccb - nu_parser::parser::parse_block::h99ebe3033fbe971b\r\n  17:     0x5616997d6505 - nu_parser::parser::parse::h102b5a6027e18c2b\r\n  18:     0x5616992bd413 - <nu_cli::syntax_highlight::NuHighlighter as reedline::highlighter::Highlighter>::highlight::h19d6e3bee963c6e7\r\n  19:     0x561699c7cbc5 - reedline::engine::Reedline::repaint::hdce1b55e1695012e\r\n  20:     0x561699c796fb - reedline::engine::Reedline::read_line::h14782f212db6dba8\r\n  21:     0x5616992a7951 - nu_cli::repl::evaluate_repl::h8fa62efc712f0283\r\n  22:     0x56169925d6e8 - nu::run::run_repl::h099d0965c85cccb8\r\n  23:     0x56169926d6ce - nu::main::h6874178a2c9fda2d\r\n  24:     0x56169925dbec - std::sys_common::backtrace::__rust_begin_short_backtrace::h25965459592b9f02\r\n  25:     0x56169925fb9a - std::rt::lang_start::{{closure}}::h3ffff9d791fa9fb7\r\n  26:     0x561699d2424b - std::rt::lang_start_internal::hcd7e45acd25ab5ab\r\n  27:     0x56169926e3f5 - main\r\n  28:     0x7f4f3cabdd90 - <unknown>\r\n  29:     0x7f4f3cabde40 - __libc_start_main\r\n  30:     0x56169915f53e - _start\r\n  31:                0x0 - <unknown>\r\n```\n\n### How to reproduce\n\n1. `def a [b: bool, c: bool, d: float, e: float, f: float, g: float] {}` (5 arguments are fine - not sure if the datatype matters)\r\n2. `a true true 1 1` -> panics without any further input\n\n### Expected behavior\n\ni expect nu to let me fill out the command and run the function\n\n### Screenshots\n\n_No response_\n\n### Configuration\n\n| key                | value                                    |\r\n| ------------------ | ---------------------------------------- |\r\n| version            | 0.79.0                                   |\r\n| branch             |                                          |\r\n| commit_hash        | a1b72611215dbfca257351003204a80c83859e05 |\r\n| build_os           | linux-x86_64                             |\r\n| build_target       | x86_64-unknown-linux-gnu                 |\r\n| rust_version       | rustc 1.66.1 (90743e729 2023-01-10)      |\r\n| rust_channel       | 1.66.1-x86_64-unknown-linux-gnu          |\r\n| cargo_version      | cargo 1.66.1 (ad779e08b 2023-01-10)      |\r\n| build_time         | 2023-04-25 20:26:29 +00:00               |\r\n| build_rust_channel | release                                  |\r\n| features           | default, zip                             |\r\n| installed_plugins  |                                          |\r\n\r\nsystem: canonical-multipass ubuntu22.04 vm  \r\nenv.nu: empty file  \r\nconfig.nu: empty file\n\n### Additional context\n\n_No response_",
    "nushell__nushell-10381": "Syntax-hightlight panics with index out of bounds due to custom function with many arguments\n### Describe the bug\n\nThe interactive shell panics during typing when calling a custom function with many arguments:\r\n\r\n(stacktrace from `RUST_BACKTRACE=full nu` -> reproduction steps)\r\n```\r\nthread 'main' panicked at 'index out of bounds: the len is 2 but the index is 3', crates/nu-parser/src/parser.rs:737:28\r\nstack backtrace:\r\n   0:     0x561699d32165 - <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt::h3155a8c966b4beb5\r\n   1:     0x5616991a19fe - core::fmt::write::h062c617411b691df\r\n   2:     0x561699d2a7f5 - std::io::Write::write_fmt::hb61fdf1275c61e1c\r\n   3:     0x561699d31f35 - std::sys_common::backtrace::print::hca896ae22beb06cb\r\n   4:     0x561699d33cbf - std::panicking::default_hook::{{closure}}::h0b5eeed5cf36ab5f\r\n   5:     0x561699d33a2a - std::panicking::default_hook::h8932b573145a321b\r\n   6:     0x561699d34350 - std::panicking::rust_panic_with_hook::h4b1447a24e3e94f8\r\n   7:     0x561699d340e4 - std::panicking::begin_panic_handler::{{closure}}::h8701da9995a3820c\r\n   8:     0x561699d3267c - std::sys_common::backtrace::__rust_end_short_backtrace::hb696c5ed02a01598\r\n   9:     0x561699d33e32 - rust_begin_unwind\r\n  10:     0x56169913abd3 - core::panicking::panic_fmt::h8aa706a976963c88\r\n  11:     0x56169913ad22 - core::panicking::panic_bounds_check::he585f6a1f703448f\r\n  12:     0x5616997b98ed - nu_parser::parser::parse_multispan_value::h67d8f1193d506532\r\n  13:     0x5616997bb64d - nu_parser::parser::parse_internal_call::hc113520e17e3a887\r\n  14:     0x5616997bdbda - nu_parser::parser::parse_call::h1f0bbfcb84b7667b\r\n  15:     0x5616997d1edd - nu_parser::parser::parse_expression::hffcd304ab2ee2251\r\n  16:     0x5616997d3ccb - nu_parser::parser::parse_block::h99ebe3033fbe971b\r\n  17:     0x5616997d6505 - nu_parser::parser::parse::h102b5a6027e18c2b\r\n  18:     0x5616992bd413 - <nu_cli::syntax_highlight::NuHighlighter as reedline::highlighter::Highlighter>::highlight::h19d6e3bee963c6e7\r\n  19:     0x561699c7cbc5 - reedline::engine::Reedline::repaint::hdce1b55e1695012e\r\n  20:     0x561699c796fb - reedline::engine::Reedline::read_line::h14782f212db6dba8\r\n  21:     0x5616992a7951 - nu_cli::repl::evaluate_repl::h8fa62efc712f0283\r\n  22:     0x56169925d6e8 - nu::run::run_repl::h099d0965c85cccb8\r\n  23:     0x56169926d6ce - nu::main::h6874178a2c9fda2d\r\n  24:     0x56169925dbec - std::sys_common::backtrace::__rust_begin_short_backtrace::h25965459592b9f02\r\n  25:     0x56169925fb9a - std::rt::lang_start::{{closure}}::h3ffff9d791fa9fb7\r\n  26:     0x561699d2424b - std::rt::lang_start_internal::hcd7e45acd25ab5ab\r\n  27:     0x56169926e3f5 - main\r\n  28:     0x7f4f3cabdd90 - <unknown>\r\n  29:     0x7f4f3cabde40 - __libc_start_main\r\n  30:     0x56169915f53e - _start\r\n  31:                0x0 - <unknown>\r\n```\n\n### How to reproduce\n\n1. `def a [b: bool, c: bool, d: float, e: float, f: float, g: float] {}` (5 arguments are fine - not sure if the datatype matters)\r\n2. `a true true 1 1` -> panics without any further input\n\n### Expected behavior\n\ni expect nu to let me fill out the command and run the function\n\n### Screenshots\n\n_No response_\n\n### Configuration\n\n| key                | value                                    |\r\n| ------------------ | ---------------------------------------- |\r\n| version            | 0.79.0                                   |\r\n| branch             |                                          |\r\n| commit_hash        | a1b72611215dbfca257351003204a80c83859e05 |\r\n| build_os           | linux-x86_64                             |\r\n| build_target       | x86_64-unknown-linux-gnu                 |\r\n| rust_version       | rustc 1.66.1 (90743e729 2023-01-10)      |\r\n| rust_channel       | 1.66.1-x86_64-unknown-linux-gnu          |\r\n| cargo_version      | cargo 1.66.1 (ad779e08b 2023-01-10)      |\r\n| build_time         | 2023-04-25 20:26:29 +00:00               |\r\n| build_rust_channel | release                                  |\r\n| features           | default, zip                             |\r\n| installed_plugins  |                                          |\r\n\r\nsystem: canonical-multipass ubuntu22.04 vm  \r\nenv.nu: empty file  \r\nconfig.nu: empty file\n\n### Additional context\n\n_No response_",
    "rayon-rs__rayon-986": "Bug in Drop for Drain<'data, T>\nIf you try:\r\n```rust\r\nuse rayon::prelude::*;\r\n\r\nfn main() {\r\n    let mut vec_org = vec![0, 1, 2, 3, 4, 5, 6, 7, 8, 9];\r\n\r\n    let yielded = vec_org.par_drain(5..5).into_par_iter().collect::<Vec<_>>();\r\n\r\n    println!(\"{:?}\", vec_org);\r\n}\r\n\r\n```\r\nit will print a little bit unexpected result:\r\n```\r\n[0, 1, 2, 3, 4]\r\n```",
    "rayon-rs__rayon-863": "Add par_rchunks* to ParallelSlice[Mut]\n`[T]` has these methods with no parallel in Rayon yet:\r\n\r\n- `pub fn rchunks(&self, chunk_size: usize) -> RChunks<T>`\r\n- `pub fn rchunks_mut(&mut self, chunk_size: usize) -> RChunksMut<T>`\r\n- `pub fn rchunks_exact(&self, chunk_size: usize) -> RChunksExact<T>`\r\n- `pub fn rchunks_exact_mut(&mut self, chunk_size: usize) -> RChunksExactMut<T>`\r\n\r\nThey're mostly like `chunks(size).rev()`, except they are aligned to the end of the slice, so any remainder/shortcoming is at the beginning of the slice.",
    "serde-rs__serde-2798": "Serializing fields from a getter method.\nIs there any way to serialize a struct field using a getter method? \r\n\r\n```rs\r\n#[derive(Serialize)]\r\nstruct MyStruct {\r\n    #[serde(serialize_getter(get_value_with_prefix))]\r\n    value: String,\r\n}\r\n\r\nimpl MyStruct {\r\n    fn get_value_with_prefix(&self) -> String {\r\n        format!(\"prefix-{}\", self.value)\r\n    }\r\n}\r\n```\r\nI have found this workaround to write a custom serializer\r\n```rs\r\nimpl Serialize for MyStruct {\r\n    fn serialize<S>(&self, serializer: S) -> Result<S::Ok, S::Error>\r\n    where\r\n        S: Serializer,\r\n    {\r\n        let mut state = serializer.serialize_struct(\"MyStruct\", 1)?;\r\n        state.serialize_field(\"value\", &self.get_value_with_prefix())?;\r\n        state.end()\r\n    }\r\n}\r\n\r\n```\r\n\r\nBut the problem is that I lost the functionality of other field attributes such as:\r\n```rs\r\n#[serde(skip_serializing_if = \"Option::is_none\")]\r\n```\r\n\r\nIs there any other approach to achieve this but still can use the other field attributes?",
    "serde-rs__serde-2709": "Impl Serialize/Deserialize for std::num::Saturating<T>\nIt would be nice if we could get\r\n\r\n```\r\nuse std::num::Saturating;\r\n\r\nimpl Deserialize for Saturating<T: Deserialize> { ... }\r\nimpl Serialize for Saturating<T: Serialize> { ... }\r\n```\r\n\r\nso that it is possible to handle wrapped types, that already support those traits.",
    "sharkdp__bat-3189": "Default theme info is still printed on piped stdout\nI believe this is the same issue reported in #3073 and apparently fixed in #3075.\n\nAm I doing something wrong?\n\n**What steps will reproduce the bug?**\n\nRunning `$ bat --no-config --list-themes | cat`\n\nThe `--no-config` part is optional, it's just to clear my settings for this run.\n\n**What happens?**\n\nThis is the output:\n\n```txt\n1337\nColdark-Cold\nColdark-Dark\nDarkNeon\nDracula\nGitHub\nMonokai Extended (default dark)\nMonokai Extended Bright\nMonokai Extended Light (default light)\nMonokai Extended Origin\nNord\nOneHalfDark\nOneHalfLight\nSolarized (dark)\nSolarized (light)\nSublime Snazzy\nTwoDark\nVisual Studio Dark+\nansi\nbase16\nbase16-256\ncustom16\ngruvbox-dark\ngruvbox-light\nzenburn\n```\n\nMonokai Extended and Extended Light include default theme annotations.\n\n**What did you expect to happen instead?**\n\nThe same list / output but without `(default dark)` and `(default light)` information.\n\n**How did you install `bat`?**\n\nVia Cargo.\n\n**Side note**\n\nProbably unrelated but when I run `$ bat --list-themes --color=never` I get the same output but with `(default)` instead of `(default dark)`.\n\n---\n\n**bat version and environment**\n\n#### Software version\n\nbat 0.25.0\n\n#### Operating system\n\n- OS: Linux (Ubuntu 23.10)\n- Kernel: 6.5.0-44-generic\n\n#### Command-line\n\n```bash\nbat --diagnostic \n```\n\n#### Environment variables\n\n```bash\nBAT_CACHE_PATH=<not set>\nBAT_CONFIG_PATH=<not set>\nBAT_OPTS=<not set>\nBAT_PAGER='less -R'\nBAT_PAGING=<not set>\nBAT_STYLE=<not set>\nBAT_TABS=<not set>\nBAT_THEME=<not set>\nCOLORTERM=truecolor\nLANG=en_US.UTF-8\nLC_ALL=<not set>\nLESS=<not set>\nMANPAGER='sh -c '\\''col -bx | bat -p --language=man --theme=custom16'\\'''\nNO_COLOR=<not set>\nPAGER=less\nSHELL=/usr/bin/zsh\nTERM=xterm-256color\nXDG_CACHE_HOME=<not set>\nXDG_CONFIG_HOME=<not set>\n```\n\n#### System Config file\n\nCould not read contents of '/etc/bat/config': No such file or directory (os error 2).\n\n#### Config file\n\n```\n# This is `bat`s configuration file. Each line either contains a comment or\n# a command-line option that you want to pass to `bat` by default. You can\n# run `bat --help` to get a list of all possible configuration options.\n\n--theme=\"Dracula\"\n--italic-text=always\n--color=always\n```\n\n#### Custom assets metadata\n\n```\nbat_version: 0.25.0\ncreation_time:\n  secs_since_epoch: 1736608946\n  nanos_since_epoch: 486389724\n```\n\n#### Custom assets\n\n- metadata.yaml, 97 bytes\n- syntaxes.bin, 973899 bytes\n- themes.bin, 41464 bytes\n\n#### Compile time information\n\n- Profile: release\n- Target triple: x86_64-unknown-linux-gnu\n- Family: unix\n- OS: linux\n- Architecture: x86_64\n- Pointer width: 64\n- Endian: little\n- CPU features: fxsr,sse,sse2\n- Host: x86_64-unknown-linux-gnu\n\n#### Less version\n\n```\n> less --version \nless 590 (GNU regular expressions)\nCopyright (C) 1984-2021  Mark Nudelman\n\nless comes with NO WARRANTY, to the extent permitted by law.\nFor information about the terms of redistribution,\nsee the file named README in the less distribution.\nHome page: https://greenwoodsoftware.com/less\n```",
    "sharkdp__bat-3108": "[bat --paging=never --plain] still paging, since version 0.24.0\n<!--\r\n\r\nHey there, thank you for reporting a bug!\r\n\r\nPlease note that the following bugs have already been reported:\r\n\r\n* dpkg: error processing archive /some/path/some-program.deb (--unpack):\r\n  trying to overwrite '/usr/.crates2.json'\r\n\r\n  See https://github.com/sharkdp/bat/issues/938\r\n\r\n-->\r\n\r\n**What steps will reproduce the bug?**\r\n\r\nI am using MinGW-x64\r\n1. Install bat `0.23.0-3` and run command `bat --paging=never --plain myfile.txt`. **Not paging as expected.**\r\n2. Install bat `0.24.0-2` and run command `bat --paging=never --plain myfile.txt`. **Still paging.**\r\nThis only happens when `--paging=never` is used together with `--plain`\r\n**Workaround**: Use `-pp` instead of `--paging=never --plain`\r\n\r\n**How did you install `bat`?**\r\n\r\nDownload packages from [msys2-mingw64-repo](https://repo.msys2.org/mingw/mingw64/)\r\n ```\r\npacman -U mingw-w64-x86_64-bat-0.23.0-3-any.pkg.tar.zst\r\npacman -U mingw-w64-x86_64-bat-0.24.0-2-any.pkg.tar.zst\r\n```\r\n\r\n---\r\n\r\n**bat version and environment**\r\n\r\n[diagnostic-1.txt](https://github.com/user-attachments/files/16325873/diagnostic-1.txt)\r\n\r\n",
    "sharkdp__bat-3075": "Shell auto-completion for `--theme` list the default theme incorrectly\n*(not at all severe)*\r\n\r\nWhen using auto-complete to complete the default theme in any shell with supported completions (I've tested fish, zsh and bash) the default theme is completed as `Monokai Extended (default)` instead of `Monokai Extended`.\r\n\r\nThis is because the completion scripts use `bat --list-themes | cat` to get the list of themes.\r\n#2937 changed the basic output to include the `(default)` suffix which breaks the completions.\r\n\r\n---\r\n\r\n**What steps will reproduce the bug?**\r\n\r\n1. Start bash, fish or zsh with bat's completions installed. See #3072 \r\n3. Type `bat --theme Monokai\\ Extended` and trigger auto-complete (press tab)\r\n\r\n**What happens?**\r\n\r\nThe suggestions include `Monokai Extended (default)` (not a valid theme name)\r\n\r\n**What did you expect to happen instead?**\r\n\r\nThe suggestions should include `Monokai Extended` instead.\r\n\r\n**How did you install `bat`?**\r\n\r\nFrom source: https://github.com/sharkdp/bat/commit/b662fec214daaa77a67f08d8fbd2e81915d6e0bc\r\n",
    "sharkdp__bat-2896": "Support for different themes based on Terminal color scheme\n## Thanks!\r\n\r\nAs always and once again, thank you @sharkdp for your time and effort.  Hopefully I'm not being a nuisance with these requests.\r\n\r\n## Homework\r\n\r\nThis is not a direct duplicate of #641 or #689, but it is related.  I think that `bat` can be improved beyond its current suggestion of manually running `defaults read` by performing actual detection of background colors, and exposing multiple theme options.\r\n\r\n## Current State\r\n\r\nCurrently, `bat` allows specification of a SINGLE theme, via either `$BAT_THEME` or `--theme`.  This is great, and fits most use-cases.  The [README.md proposes a way to work around this](https://github.com/sharkdp/bat#dark-mode), which is macOS Terminal.app-specific, and a little hacky.  I think `bat` can do even better (and work on more platforms than macOS)!\r\n\r\nWhen distributing tools built upon `bat`, it's not generally predictable what background color / terminal theme a user has configured for `{Terminal.app,iTerm2.app,Konsole,gnome-terminal,etc}`.\r\n\r\nAdditionally, the default theme (i.e. no `--theme` nor `$BAT_THEME`) may not be appropriate for a given terminal (and the work-around does not fix this).\r\n\r\nFinally, the theme may actually need to change, if the user has multiple different terminal profiles, or if the color scheme of the profile changes based on external factors (such as the default Terminal.app theme, which may change based on the current time of day).\r\n\r\n## Feature\r\n\r\nIt would be nice to have `bat` attempt to do some forms of auto-detection of the terminal's default background color, and allow the user to supply `$BAT_THEME_DARK` and `$BAT_THEME_LIGHT`, one of which is auto-selected by `bat`.\r\n\r\nThese should probably have lower precedence of `$BAT_THEME` and `--theme`.\r\n\r\nThere are several reasons for wanting this:\r\n\r\n* Users who use macOS's \"Auto\" appearance switches between \"Light\" and \"Dark\" at various times of day, so a single theme isn't sufficient.\r\n* Projects which build upon `bat` may want to provide *modified* themes (and cache, and .bin files) to work around features that `bat` doesn't have yet (e.g. #1745) and forcefully override e.g. `$BAT_THEME` with their modified theme.  These tools may wish to provide two themes -- one for light mode, and one for dark mode.\r\n\r\n## Libraries and Other Prior Work\r\n\r\nThere are several projects that may be directly usable, or usable for inspiration and mechanism, for auto-detecting a light or dark terminal.\r\n\r\n### `termbg`\r\n\r\nRust library that claims to do exactly what's needed.\r\n\r\nHowever, it has at least one bug on macOS for Terminal.app: https://github.com/dalance/termbg/issues/8\r\n\r\nhttps://github.com/dalance/termbg\r\n\r\n### `rust-dark-light`\r\n\r\nRust project, not sure how well it works or what systems are supported.\r\n\r\nhttps://github.com/frewsxcv/rust-dark-light\r\n\r\n### `termenv`\r\n\r\nWhile written in Go, this is a whole library for manipulating colors, and also features UNIX- and Windows-compatible light/dark mode detection.\r\n\r\nIn particular, it has one function that does what we need:\r\n\r\n```go\r\n// Returns whether terminal uses a dark-ish background\r\ndarkTheme := termenv.HasDarkBackground()\r\n```\r\n\r\nhttps://github.com/muesli/termenv\r\n\r\n## Implementation Details - SKIP THIS SECTION, SEE ABOVE\r\n\r\n**Update: I did some more searching, and found several Rust (and other) libraries which may be usable to achieve this.  `termbg` is very promising, and worked in all terminals I tested via `cargo run`.  This section can be ignored.**\r\n\r\nRealistically, background color detection of the \"current terminal\" could likely be its own tool / library.\r\n\r\nDetection of whether the foreground is a light or dark color is in itself a challenge.  I've proposed some possibilities below, but I expect that the mechanism used by `git-delta` is likely sound.\r\n\r\nSeparately, determining whether a specific color is \"light\" or \"dark\" is pretty difficult, but I expect that checking that all three of R, G, and B are below some threshold (say, 0x60) you could say that it's a \"dark\" theme and anything else (e.g. #00ff00) would be a \"light\" theme.\r\n\r\n### Linux\r\n\r\n#### xterm\r\n\r\nA little bit of Googling around shows that Xterm, at least (and possibly other terminals) respond to certain escape sequences with their color configurations: https://unix.stackexchange.com/a/172674\r\n\r\nThis may be more generically applicable than just `xterm` itself, which is why I listed this first.\r\n\r\n#### gnome-terminal\r\n\r\nI can't speak to this, but it's a starting point.  Copied from https://unix.stackexchange.com/a/133920:\r\n\r\n```\r\n$ dconf list /org/gnome/terminal/legacy/profiles:/\r\n<profile id>\r\n\r\n$ dconf read /org/gnome/terminal/legacy/profiles:/<profile id>/background-color\r\n'rgb(0,0,0)'\r\n```\r\n\r\n### macOS\r\n\r\nA generic way to check for whether the theme should be light or dark is to check `defaults read -globalDomain AppleInterfaceStyle` (~10ms), which either emits nothing (for Light mode) or \"Dark\".  Note that if the user configures \"Auto\", the output of this value will reflect the _current_ setting.\r\n\r\n#### iTerm2\r\n\r\nThis terminal can be detected via the environment, and will have `TERM_PROGRAM=iTerm.app`.\r\n\r\nFor iTerm2, it should be possible to determine the foreground color from its configuration plist and the `$ITERM_PROFILE` environment variable.\r\n\r\nFor example, in Python one can do:\r\n\r\n```py\r\n#!/usr/bin/env python3\r\nimport plistlib\r\nimport os\r\n\r\nplist = plistlib.load(open('Library/Preferences/com.googlecode.iterm2.plist', 'rb'))\r\nprofile = os.getenv('ITERM_PROFILE', 'Default')\r\n\r\ndef hexify(color):\r\n    r = int(color['Red Component'] * 255) << 16\r\n    g = int(color['Green Component'] * 255) << 8\r\n    b = int(color['Blue Component'] * 255)\r\n    return '#%06x' % (r | g | b)\r\n\r\nfor b in plist['New Bookmarks']:\r\n    if b['Name'] != profile:\r\n        continue\r\n    print(f\"Foreground: {hexify(b['Foreground Color'])}\")\r\n    print(f\"Background: {hexify(b['Background Color'])}\")\r\n    break\r\n```\r\n\r\nWhich, for me, with Solarized Dark as my theme, prints out:\r\n\r\n```\r\nForeground: #839496\r\nBackground: #002b36\r\n```\r\n\r\n#### Terminal.app\r\n\r\nThis terminal can be detected via the environment, and will have `TERM_PROGRAM=Apple_Terminal`.\r\n\r\nTerminal.app is more complicated, because it uses NSKeyedArchiver and serialized NSColor objects.\r\n\r\nHowever, for the built-in Profiles (which I expect most users to use one of), we can pretty easily classify them with a simple shell script.  Note that the script takes ~160ms to run, despite being a single line, so it might make sense to cache it for some short period of time (e.g. 1 minute).\r\n\r\n```\r\n#!/usr/bin/env osascript\r\ntell application \"Terminal\" to return name of current settings of first window\r\n```\r\n\r\nThis will cause a TCC prompt if it's run from another application, e.g. iTerm2.app, but that should realistically never happen for color detection.  The output is the current Profile name, e.g. \"Basic\", \"Grass\", \"Homebrew\", and so on.  Since there's only 10 themes, it should be easy to just have a mapping for each one.\r\n\r\nIt is important to note that the actual colors of the \"Basic\" profile for Terminal.app is affected by `AppleInterfaceStyle`, as mentioned above (background may be black OR white depending on the setting).  I have not tested other Terminal.app themes.",
    "sharkdp__bat-2665": "cat -s clone\nThe  `-s` / `--squeeze-blank` option of cat can \"squeeze\" consecutive blank lines into one.\r\n\r\n```\r\n     1  hello\r\n     2\r\n     3\r\n     4  world\r\n     5\r\n     6\r\n     7\r\n     8  \u4e16\u754c\r\n```\r\n\r\nWith `cat -s`, the above text will become:\r\n\r\n```\r\n     1  hello\r\n     2\r\n     3  world\r\n     4\r\n     5  \u4e16\u754c\r\n```\r\n\r\nIt would be convenient if bat provides the same functionality.",
    "sharkdp__bat-2544": "Erratic output when OSC8 sequences are present\nHello -\r\n\r\nWhen bat displays something that already includes an OSC8 sequence, it has erratic output, dependent on the terminal-width. Seemingly, OSC8 ids and urls are included in line-wrapping which leads to strange output depending on where the line is cut.\r\n\r\n**What steps will reproduce the bug?**\r\n\r\nWorks as expected:\r\n```sh\r\necho '\\e]8;;http://example.com\\e\\\\This is a link\\e]8;;\\e\\\\\\n' | bat --terminal-width=64\r\n```\r\nIncludes escape characters in output:\r\n```sh\r\necho '\\e]8;;http://example.com\\e\\\\This is a link\\e]8;;\\e\\\\\\n' | bat --terminal-width=48\r\n```\r\nNo escape characters, but incorrect wrapping:\r\n```sh\r\necho '\\e]8;;http://example.com\\e\\\\This is a link\\e]8;;\\e\\\\\\n' | bat --terminal-width=40\r\n```\r\n\r\n**What happens?**\r\n\r\nIf you keep changing the terminal width, strange things keep happening.\r\n\r\n**What did you expect to happen instead?**\r\n\r\nThe output should be the same in all above scenarios, as long as `terminal-width` is greater than the length of the printable section of an OSC8 sequence (\"This is a link\") in this case.\r\n\r\n\r\n**How did you install `bat`?**\r\n\r\n```sh\r\nsudo pacman -S bat\r\n```\r\n\r\n**bat version and environment**\r\n\r\n\r\n#### Software version\r\n\r\nbat 0.23.0 (871abd27)\r\n\r\n#### Operating system\r\n\r\nLinux 6.2.10-arch1-1\r\n\r\n#### Command-line\r\n\r\n```bash\r\nbat --terminal-width=24 --diagnostic \r\n```\r\n\r\n#### Environment variables\r\n\r\n```bash\r\nSHELL=/usr/bin/zsh\r\nPAGER=<not set>\r\nLESS=<not set>\r\nLANG=en_US.UTF-8\r\nLC_ALL=<not set>\r\nBAT_PAGER=<not set>\r\nBAT_CACHE_PATH=<not set>\r\nBAT_CONFIG_PATH=<not set>\r\nBAT_OPTS=<not set>\r\nBAT_STYLE=<not set>\r\nBAT_TABS=<not set>\r\nBAT_THEME=<not set>\r\nXDG_CONFIG_HOME=<not set>\r\nXDG_CACHE_HOME=<not set>\r\nCOLORTERM=truecolor\r\nNO_COLOR=<not set>\r\nMANPAGER=<not set>\r\n```\r\n\r\n#### System Config file\r\n\r\nCould not read contents of '/etc/bat/config': No such file or directory (os error 2).\r\n\r\n#### Config file\r\n\r\nCould not read contents of '/home/tim/.config/bat/config': No such file or directory (os error 2).\r\n\r\n#### Custom assets metadata\r\n\r\nCould not read contents of '/home/tim/.cache/bat/metadata.yaml': No such file or directory (os error 2).\r\n\r\n#### Custom assets\r\n\r\n'/home/tim/.cache/bat' not found\r\n\r\n#### Compile time information\r\n\r\n- Profile: release\r\n- Target triple: x86_64-unknown-linux-gnu\r\n- Family: unix\r\n- OS: linux\r\n- Architecture: x86_64\r\n- Pointer width: 64\r\n- Endian: little\r\n- CPU features: fxsr,sse,sse2\r\n- Host: x86_64-unknown-linux-gnu\r\n\r\n#### Less version\r\n\r\n```\r\n> less --version \r\nless 608 (PCRE2 regular expressions)\r\nCopyright (C) 1984-2022  Mark Nudelman\r\n\r\nless comes with NO WARRANTY, to the extent permitted by law.\r\nFor information about the terms of redistribution,\r\nsee the file named README in the less distribution.\r\nHome page: https://greenwoodsoftware.com/less\r\n```\r\n\r\n\r\n",
    "sharkdp__bat-1518": "Can not run bat with input and output attached to /dev/null\n**Describe the bug you encountered:**\r\n\r\n```\r\n\u25b6 bat > /dev/null < /dev/null\r\n[bat error]: The output file is also an input!\r\n```\r\n\r\n**What did you expect to happen instead?**\r\n\r\nThis is kind of a weird edge case, but running `bat` like this is actually useful for benchmarking. This is how we measure the startup time of `bat` in `tests/benchmarks/run-benchmarks.sh`. We do not specify `/dev/null` explicitly, but rather just run:\r\n```\r\nhyperfine \"bat\"\r\n```\r\nwhich attaches stdin/stout to `/dev/null` internally.\r\n\r\nMaybe we should add an exception for `/dev/null`? `cat` does not complain.\r\n\r\nFYI: @niklasmohrin ",
    "sharkdp__bat-1402": "Do not use 'most' PAGER, as it is not compatible with bats output\n**Describe the bug you encountered:**\r\nwhen I use bat on a single file, colors are not displayed, control sequences are diplayed instead. The bug occurs with fedora's package or when I build bat from sources. Using fish or bash does not change anything and using konsole or alacritty has the same results.\r\nYou can find a screenshot [here](https://ibb.co/dpLKkL9)\r\n...\r\n\r\n**Describe what you expected to happen?**\r\nbat should display colors \r\n...\r\n\r\n**How did you install `bat`?**\r\n`dnf install bat`\r\nor\r\n`cargo build` (from sources)\r\n\r\n---\r\nsystem\r\n------\r\n\r\n**$ uname -srm**\r\nLinux 5.6.18-300.fc32.x86_64 x86_64\r\n\r\nbat\r\n---\r\n\r\n**$ bat --version**\r\nbat 0.15.0\r\n\r\n**$ env**\r\nPAGER=most\r\n\r\nbat_config\r\n----------\r\n\r\n**$ cat /home/daniel/.config/bat/config**\r\n```\r\n# This is `bat`s configuration file. Each line either contains a comment or\r\n# a command-line option that you want to pass to `bat` by default. You can\r\n# run `bat --help` to get a list of all possible configuration options.\r\n\r\n# Specify desired highlighting theme (e.g. \"TwoDark\"). Run `bat --list-themes`\r\n# for a list of all available themes\r\n#--theme=\"TwoDark\"\r\n--theme=\"Solarized (dark)\"\r\n\r\n# Enable this to use italic text on the terminal. This is not supported on all\r\n# terminal emulators (like tmux, by default):\r\n#--italic-text=always\r\n\r\n# Uncomment the following line to disable automatic paging:\r\n#--paging=never\r\n\r\n# Uncomment the following line if you are using less version >= 551 and want to\r\n# enable mouse scrolling support in `bat` when running inside tmux. This might\r\n# disable text selection, unless you press shift.\r\n#--pager=\"--RAW-CONTROL-CHARS --quit-if-one-screen --mouse\"\r\n\r\n# Syntax mappings: map a certain filename pattern to a language.\r\n#   Example 1: use the C++ syntax for .ino files\r\n#   Example 2: Use \".gitignore\"-style highlighting for \".ignore\" files\r\n#--map-syntax \"*.ino:C++\"\r\n#--map-syntax \".ignore:Git Ignore\"\r\n```\r\n\r\nbat_wrapper\r\n-----------\r\n\r\nNo wrapper script for 'bat'.\r\n\r\nbat_wrapper_function\r\n--------------------\r\n\r\nNo wrapper function for 'bat'.\r\n\r\nNo wrapper function for 'cat'.\r\n\r\ntool\r\n----\r\n\r\n**$ less --version**\r\nless 551 (POSIX regular expressions)\r\n",
    "sharkdp__bat-1276": "Alternative to `grid` for style which only draws a line between files\nI'm not a fan of having my `cat`-alike draw a full-blown table, but I would like to have some visible \"end of file, beginning of next file\" separation.\r\n\r\nUnfortunately, `--style=header,grid` still draws the horizontal lines as if they were part of a table, resulting in two lines where only one is necessary:\r\n\r\n![Spectacle J14905](https://user-images.githubusercontent.com/46915/91717467-1989ef00-eb81-11ea-9f23-3664eadc871d.png)\r\n\r\nI also get back a full-blown table if I ask for something like line numbers.\r\n\r\nWhat I'd really like is something more minimal than `grid`, which just draws a horizontal line above (or above and below) the `header` to make the change from one file to another more visible when paging through.",
    "sharkdp__bat-1197": "Infinite loop when \"input file is output file\"\n<!--\r\nHey there, thanks for creating an issue!\r\n\r\nIn order to reproduce your issue, we might need to know a little bit more about the environment\r\nwhich you're running `bat` on.\r\n\r\nIf you're on Linux or MacOS:\r\n  Please run the script at https://github.com/sharkdp/bat/blob/master/diagnostics/info.sh and\r\n  paste the output at the bottom of the bug report.\r\n\r\nIf you're on Windows:\r\n  Please tell us about your Windows Version (e.g. \"Windows 10 1908\") at the\r\n  bottom of the bug report.\r\n-->\r\n\r\n**What version of `bat` are you using?**\r\n[paste the output of `bat --version` here]\r\nbat 0.15.4\r\n**Describe the bug you encountered:**\r\nWhen input file is also an output file, an infinite loop can be created, where shell writes to a file, bat reads the file, the shell redirects it to the same file and bat has to read than again, ad infinitum.\r\nTo reproduce:\r\n```\r\necho a > a\r\nbat a b > b\r\n```\r\n**Describe what you expected to happen?**\r\n`bat` should behave as `cat`; cat prints `cat: b: input file is output file` to stderr. While this behaviour could be useful, it has the potential to use up all the disk space and reduce nand lifespan.\r\n\r\n**How did you install `bat`?**\r\npacman, Arch Linux\r\n\r\n---\r\n\r\n[paste the output of `info.sh` here]\r\nsystem\r\n------\r\n\r\n**$ uname -srm**\r\nLinux 5.8.9-zen2-1-zen x86_64\r\n\r\nbat\r\n---\r\n\r\n**$ bat --version**\r\nbat 0.15.4\r\n\r\n**$ env**\r\nALACRITTY_LOG=/tmp/Alacritty-59883.log\r\nCOLORTERM=truecolor\r\nDBUS_SESSION_BUS_ADDRESS=unix:path=/run/user/1000/bus\r\nDISPLAY=:0\r\nHOME=/home/lizzie\r\nI3SOCK=/run/user/1000/sway-ipc.1000.720.sock\r\nLANG=en_US.UTF-8\r\nLANGUAGE=en_US:en\r\nLC_ADDRESS=pl_PL.UTF-8\r\nLC_COLLATE=pl_PL.UTF-8\r\nLC_CTYPE=pl_PL.UTF-8\r\nLC_MEASUREMENT=pl_PL.UTF-8\r\nLC_MESSAGES=en_US.UTF-8\r\nLC_MONETARY=pl_PL.UTF-8\r\nLC_NAME=pl_PL.UTF-8\r\nLC_NUMERIC=pl_PL.UTF-8\r\nLC_PAPER=pl_PL.UTF-8\r\nLC_TELEPHONE=pl_PL.UTF-8\r\nLC_TIME=pl_PL.UTF-8\r\nLOGNAME=lizzie\r\nMAIL=/var/spool/mail/lizzie\r\nOMF_CONFIG=/home/lizzie/.config/omf\r\nOMF_PATH=/home/lizzie/.local/share/omf\r\nPATH=/usr/local/sbin:/usr/local/bin:/usr/bin:/usr/bin/site_perl:/usr/bin/vendor_perl:/usr/bin/core_perl\r\nPWD=/home/lizzie\r\nQT_QPA_PLATFORM=wayland\r\nSHELL=/usr/bin/fish\r\nSHLVL=2\r\nSWAYSOCK=/run/user/1000/sway-ipc.1000.720.sock\r\nTERM=alacritty\r\nUSER=lizzie\r\nWAYLAND_DISPLAY=wayland-0\r\nXCURSOR_SIZE=24\r\nXDG_RUNTIME_DIR=/run/user/1000\r\nXDG_SEAT=seat0\r\nXDG_SESSION_CLASS=user\r\nXDG_SESSION_ID=1\r\nXDG_SESSION_TYPE=tty\r\nXDG_VTNR=1\r\n\r\nbat_config\r\n----------\r\n\r\nbat_wrapper\r\n-----------\r\n\r\nNo wrapper script for 'bat'.\r\n\r\nbat_wrapper_function\r\n--------------------\r\n\r\nNo wrapper function for 'bat'.\r\n\r\nNo wrapper function for 'cat'.\r\n\r\ntool\r\n----\r\n\r\n**$ less --version**\r\nless 551 (PCRE regular expressions)\r\n",
    "sharkdp__fd-1394": "[BUG] unintended behavior when using \"-1\"\n### Checks\n\n- [X] I have read the troubleshooting section and still think this is a bug.\n\n### Describe the bug you encountered:\n\nThanks for fd, it comes in handy!\r\n\r\nAttempts to use the shorthand `-1` alias instead of `--max-results` with exec or batch exec are not prevented, and the operations will be performed on every object which matches the query instead of the first hit. Depending on what one was trying to achieve the impact of this can be quite significant.\r\n\r\n\r\nThe alias does not have the relevant `conflicts_with`\r\n\r\nhttps://github.com/sharkdp/fd/blob/93cdb2628e89dd5831eee22b8df697aea00eca3b/src/cli.rs#L513-L522\r\n\r\n\r\nUsing long option `--max-results=1` would yield immediate abort and explanation that options conflict:\r\n\r\nhttps://github.com/sharkdp/fd/blob/93cdb2628e89dd5831eee22b8df697aea00eca3b/src/cli.rs#L20-L30\r\n\r\n\r\nFinally `-1` overrides_with `--max-results`, but not the other way around so `fd --max-results=1 -1 -X prog query` will launch prog against all objects matching query.\n\n### Describe what you expected to happen:\n\nConsistent behavior: if mixing `max-results` with exec-type functions is refused, same should be true for aliases.\n\n### What version of `fd` are you using?\n\n8.7.0\n\n### Which operating system / distribution are you on?\n\n```shell\nLinux\n```\n",
    "sharkdp__fd-1162": "Panic when using `-j` flag\nAfter installing the latest version of `fd-find` (8.5.0), I am getting the following error when I rust fd in signle-thread mode:\r\n\r\n```\r\n$ fd -j 1\r\nthread 'main' panicked at 'Mismatch between definition and access of `threads`. Could not downcast to TypeId { t: 18349839772473174998 }, need to downcast to TypeId { t: 12390601965711666277 }\r\n', /home/ilya/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-4.0.18/src/parser/error.rs:30:9\r\nstack backtrace:\r\n   0: rust_begin_unwind\r\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/std/src/panicking.rs:584:5\r\n   1: core::panicking::panic_fmt\r\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/core/src/panicking.rs:142:14\r\n   2: <fd::cli::Opts as clap::derive::FromArgMatches>::from_arg_matches_mut\r\n   3: fd::main\r\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\r\n```\r\nWithout `-j 1` it works fine. The panic is present if using other number with `-j` flag, such as `-j 2` etc.\r\n\r\n**What version of `fd` are you using?**\r\n```\r\n$ fd --version\r\nfd 8.5.0\r\n```\r\n",
    "sharkdp__fd-1121": "[BUG] `--strip-cwd-prefix` does nothing\nSorry for not using the official bug template, it always returned error code 400 on my end, and acted pretty buggy in general.\r\n\r\n## Bug description ##\r\n\r\nI use a variant of the following line to find pdf files and sort them by date: \r\n\r\n```\r\nfd --strip-cwd-prefix -e pdf -X ls -t\r\n```\r\n`--strip-cwd-prefix` should remove the leading `./` string from the output (as per https://github.com/sharkdp/fd/pull/861). However, this string is still present in the output of `fd` in my interactive shell session, as well as in my shell scripts.\r\n\r\n## Expected behavior ##\r\n\r\n`fd` should always remove the leading `./` when I invoke it with `--strip-cwd-prefix`.\r\n\r\n\r\n## Version information ##\r\n\r\n```console\r\n$ fd --version\r\nfd 8.3.0\r\n$ uname -srm\r\nLinux 5.15.5-arch1-1 x86_64\r\n$ lsb-release -a\r\n-e LSB Version:\t1.4\r\n-e Distributor ID:\tArch\r\n-e Description:\tArch Linux\r\n-e Release:\trolling\r\n-e Codename:\tn/a\r\n\r\n```\r\n",
    "sharkdp__fd-1079": "fd does not want to work when cwd is non existent\n**What version of `fd` are you using?**\r\n`fd 8.3.1`\r\n`fish, version 3.3.1`\r\n\r\n```sh\r\n$ cd /mnt/path/to/some/external/drive\r\n# Unmount the drive\r\n# Remount the drive at the same space (may not be necessary)\r\nfdfind someFolder /home/zykino/some/path/\r\n[fd error]: Could not retrieve current directory (has it been deleted?).\r\n```\r\n\r\nI think this is a bug: when providing a path the cwd should not be accessed.",
    "sharkdp__fd-986": "Make `-u` idempotent (always search all files/dirs)\n`fd -u` is an alias for `fd -I`and `fd -uu`is an alias for `fd -IH`. The former is unnecessary given that it's an alias to another one-letter flag (I imagine it's there for historical reasons?) and the latter is cumbersome if someone wanted to use the long form (`--unrestricted`). This setup also makes the behavior of the flag ambiguous if new default filters were added in the future. In that case, would I disable all filters with `-uu` or would I need to use `-uuu`?\r\n\r\nGiven the project's focus on ergonomics and usability, I'd suggest to make `-u` always search all files and to deprecate `-uu`. This would be the equivalent of `ls -a`, giving the user the guarantee that no filters will be applied by default. The main cons of this suggestion is that it's a breaking change and a subtle one: the command would continue to work with `-u` but could return a different set of results.",
    "sharkdp__fd-866": "-X should batch the number of passed files to the maximum supported by the shell\nIt appears that if you run `getconf ARG_MAX` it returns the maximum length that the command string can be.  Possibly include a command to artificially limit the number of arguments as well?\r\n\r\n```\r\n$ fd -IH . -tf -X wc -l\r\n[fd error]: Problem while executing command: Argument list too long (os error 7)\r\n```",
    "sharkdp__fd-813": "Thoughts on non-zero exit code for no matches?\n`grep` returns a non-zero exit code when no matches are found, making it easy to include in shell scripts and if conditions directly without having to shell out to `test` to analyze the results.\r\n\r\nWhat are your thoughts on having `fd` do the same so that `fd not-exists` and `fd exists` have differing exit codes that could be directly checked?",
    "sharkdp__fd-658": "`-prune` options\nIs it possible to add an option `-prune`, to not explore sub-directories, when the current directory has been matched ? (like `find -prune`)",
    "sharkdp__fd-590": "Do not exit immediately if one of the search paths is missing\n**Describe the bug you encountered:**\r\n```bash\r\n> tree\r\n.\r\n\u2514\u2500\u2500 real\r\n    \u251c\u2500\u2500 bar\r\n    \u2514\u2500\u2500 foo\r\n> fd . real fake\r\n[fd error]: 'fake' is not a directory\r\n```\r\nMaybe this is as intended, but it would be beneficial to have a flag to allow traversal over dynamic directories.\r\n\r\n**Describe what you expected to happen:**\r\n```bash\r\n> {fd . real; fd . fake}\r\nreal/bar\r\nreal/foo\r\n[fd error]: 'fake' is not a directory.\r\n```\r\n\r\n**What version of `fd` are you using?**\r\nfd 7.3.0\r\n\r\n**Which operating system / distribution are you on?**\r\nLinux 5.3.0-51-generic x86_64\r\nDistributor ID:\tUbuntu\r\nDescription:\tUbuntu 19.10\r\nRelease:\t19.10\r\nCodename:\teoan\r\n\r\n",
    "sharkdp__fd-569": "Add --min-depth option\nWe have `--max-depth` option, but there is no `--min-depth` counterpart. It could be used exactly like it's been used with `find`.\r\n",
    "sharkdp__fd-558": "fd outputs \ufffd for filenames containing extended ascii\nBit of an edge case, obviously. If you have filenames that are not valid utf-8, fd will output a \ufffd rather than preserving the actual byte array. This breaks --exec. Find works as expected, here.",
    "sharkdp__fd-555": "Feature request: limit the number of find result\nWhen used with emacs helm, fd process is created after every char inputting. I want to limit the number of the find result, because the extra results have no use and just cost power.\r\n\r\nIf there are too many results (more than 100 for me), I will find again until the results are less than 30. This is my common use(99%).",
    "sharkdp__fd-546": "`-prune` options\nIs it possible to add an option `-prune`, to not explore sub-directories, when the current directory has been matched ? (like `find -prune`)",
    "sharkdp__fd-497": "`fd -L` omits broken symlinks\nIt appears that `fd -L` completely omits any broken symlinks. Instead it should fall back to treating a broken symlink as though `-L` was not specified, which matches the observed `find` behavior.\r\n\r\nExample:\r\n\r\n```\r\n> touch a\r\n> ln -s b c\r\n> ln -s a d\r\n> exa\r\na  c@  d@\r\n> find -L .\r\n.\r\n./a\r\n./c\r\n./d\r\n> fd -L\r\na\r\nd\r\n>\r\n```\r\n\r\nNotice how `fd -L` completely omitted the broken `c` symlink. Continued:\r\n\r\n```\r\n> find -L . -type l\r\n./c\r\n> fd -L -t l\r\n>\r\n```\r\n\r\nNotice how `find` is treating the broken symlink exactly as though `-L` were not specified.\r\n\r\nThis was tested with fd 7.2.0 on macOS 10.14.1 (18B75).",
    "tokio-rs__bytes-732": "`Buf::get_int()` implementation for `Bytes` returns positive number instead of negative when `nbytes` < 8.\n**Steps to reproduce:**\r\n\r\nRun the following program, using `bytes` version 1.7.1\r\n```\r\nuse bytes::{BytesMut, Buf, BufMut};\r\n\r\nfn main() {\r\n    const SOME_NEG_NUMBER: i64 = -42;\r\n    let mut buffer = BytesMut::with_capacity(8);\r\n\r\n    buffer.put_int(SOME_NEG_NUMBER, 1);\r\n    println!(\"buffer = {:?}\", &buffer);\r\n    assert_eq!(buffer.freeze().get_int(1), SOME_NEG_NUMBER);\r\n}\r\n```\r\n\r\n**Expected outcome:**\r\nAssertion passes and program terminates successfully, due to the symmetry of the `put_int` and `get_int` calls.\r\n\r\n**Actual outcome:**\r\nAssertion fails:\r\n```\r\nbuffer = b\"\\xd6\"\r\nthread 'main' panicked at src/main.rs:9:5:\r\nassertion `left == right` failed\r\n  left: 214\r\n right: -42\r\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\r\n```\r\n\r\n**Additional information:**\r\n1. Only happens with negative numbers; positive numbers are always OK.\r\n2. Only happens when `nbytes` parameter is < 8.\r\n3. Other combos like `put_i8()`/`get_i8()` or `put_i16()`/`get_i16()` work as intended. ",
    "tokio-rs__bytes-721": "Consider replacing Bytes::make_mut by impl From<Bytes> for BytesMut\n`Bytes::make_mut` is a very good addition to the API but I think it would be better if it was instead exposed as `<BytesMut as From<Bytes>>::from`. Could this be done before the next bytes version is released? `Bytes::make_mut` isn't released yet.",
    "tokio-rs__bytes-643": "Add a way to tell if `Bytes` is unique\nI would like to be able to tell if a `Bytes` object is the unique reference to the underlying data. The usecase is a cache, where I want to be able to evict an object from the cache only if it is not used elsewhere\u2009\u2014\u2009otherwise, removing it from the cache would not free up any memory, and if the object was requested again later, it would have to be fetched (in my case, thru a network request), and duplicated in memory if the original copy is still around.",
    "tokio-rs__bytes-547": "Conversion from Bytes to Vec<u8>?\nAccording to this thread https://github.com/tokio-rs/bytes/pull/151/commits/824a986fec988eaa7f9313838a01c7ff6d0e85bb conversion from `Bytes` to `Vec<u8>` has ever existed but not found today. Is it deleted? but what reason? Is there some workaround today?\r\n\r\nI want to use `Bytes` entirely in my [library](https://github.com/akiradeveloper/lol). It is a Raft library using gRPC. To send RPC I need to make `Vec<u8>` as payload (I hope prost generates code using `Bytes` instead of `Vec<u8>` though), if there is no cost to extract `Vec<u8>` from `Bytes` when refcnt=1 that would push me forward to fully depend on `Bytes`.",
    "tokio-rs__bytes-543": "Conversion from Bytes to Vec<u8>?\nAccording to this thread https://github.com/tokio-rs/bytes/pull/151/commits/824a986fec988eaa7f9313838a01c7ff6d0e85bb conversion from `Bytes` to `Vec<u8>` has ever existed but not found today. Is it deleted? but what reason? Is there some workaround today?\r\n\r\nI want to use `Bytes` entirely in my [library](https://github.com/akiradeveloper/lol). It is a Raft library using gRPC. To send RPC I need to make `Vec<u8>` as payload (I hope prost generates code using `Bytes` instead of `Vec<u8>` though), if there is no cost to extract `Vec<u8>` from `Bytes` when refcnt=1 that would push me forward to fully depend on `Bytes`.",
    "tokio-rs__tokio-7124": "Use `[lints.rust.unexpected_cfgs.check-cfg]` instead of hacky check-cfg workaround\nWith the release of rust-lang/cargo#13913 (in nightly-2024-05-19), there is no longer any need for the kind of workarounds employed in [#6538](https://github.com/tokio-rs/tokio/pull/6538). Cargo has gain the ability to declare `--check-cfg` args directly inside the `[lints]` table with [`[lints.rust.unexpected_cfgs.check-cfg]`](https://doc.rust-lang.org/nightly/rustc/check-cfg/cargo-specifics.html#check-cfg-in-lintsrust-table)[^1]:\r\n\r\n`Cargo.toml`:\r\n```toml\r\n[lints.rust]\r\nunexpected_cfgs = { level = \"warn\", check-cfg = ['cfg(foo)'] }\r\n```\r\n\r\n> Note that the diagnostic output of the lint has been updated to suggest the `[lints]` approach first. You can use it to guide you through the `--check-cfg` arguments that may need to be added.\r\n\r\n[^1]: take effect on Rust 1.80 (current nightly), is ignored on Rust 1.79 (current beta), and produce an unused warning below\r\n\r\n_Originally posted by @Urgau in https://github.com/tokio-rs/tokio/issues/6538#issuecomment-2128036174_\r\n            ",
    "tokio-rs__tokio-7111": "MPSC queue hangs on repeated polling\n**Version**\n```\n\u2514\u2500\u2500 tokio v1.43.0\n    \u2514\u2500\u2500 tokio-macros v2.5.0 (proc-macro)\n```\n\n**Platform**\nRHEL 8\nx86_64\nIntel CascadeLake\n\n**Description**\nThe MPSC channel receiver is failing to receive messages when being repeatedly polled. I notice that it will receive exactly 128 elements (4 underlying blocks) before failing.\n\nHere is a reproduction. Note that the `select!` macro simplifies the code here, but the issue also reproduces if the `select!` is replaced by a custom future that repeatedly invokes `Future::poll` on the `Receiver` object, verifying that the `select!` isn't a factor.\n\n```rust\nuse tokio::{select, sync::mpsc};\n\n#[tokio::main]\nasync fn main() {\n    let (sender, mut receiver) = mpsc::channel(2);\n\n    tokio::spawn(async move {\n        for n in 0usize.. {\n            sender.send(n).await.unwrap();\n        }\n    });\n\n    loop {\n        select! {\n            msg = receiver.recv() => println!(\"Received {}\", msg.unwrap()),\n            () = std::future::ready(()) => {}\n        }\n    }\n}\n```\n\nThe output is as follows. No logging is observed after 128 elements have been received.\n```\nReceived 0\nReceived 1\nReceived 2\n... (lines omitted for brevity) ...\nReceived 127\n```",
    "tokio-rs__tokio-6967": "Add `AsyncFd::try_io`\n**Is your feature request related to a problem? Please describe.**\r\n\r\nI have a Unix socket where I want to call `libc::sendmsg` on the file descriptor directly. Right now, I have to use \r\n```rust\r\nlet guard = async_fd.writable().await;\r\nsendmsg(...);\r\nguard.clear_ready();\r\n```\r\nwhich is error prone.\r\n\r\n**Describe the solution you'd like**\r\n\r\n It would be convenient to allow using try_io instead, like for UdpSocket:\r\n```rust\r\nasync_fd.try_io(Interest::WRITABLE, || sendmsg(...));\r\n```\r\n\r\n**Describe alternatives you've considered**\r\nKeep using `writable()` guard.\r\nImplement sendmsg APIs in tokio directly (https://github.com/tokio-rs/tokio/issues/2975).\r\n\r\n**Additional context**\r\nhttps://discord.com/channels/500028886025895936/500336333500448798/979801318375964733",
    "tokio-rs__tokio-6742": "Add `on_spawn` configuration for Builder\n**Is your feature request related to a problem? Please describe.**\r\n\r\nFor monitoring and tracking purposes I want to run some custom code when any spawned task is created/polled/dropped.\r\n\r\n**Describe the solution you'd like**\r\n\r\nI propose a configuration method `on_spawn` for `Builder` which would take a wrapper function to be applied to all spawned tasks.\r\n\r\nFor example following two examples would be equivalent:\r\n\r\n[(First example in playground, with example Wrapper)](https://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=2ae454d2353612a832fdaf4f1b53301d)\r\n```\r\nfn main() {\r\n    tokio::runtime::Builder::new_multi_thread()\r\n        .enable_all()\r\n        .build()\r\n        .unwrap()\r\n        .block_on(async {\r\n            tokio::spawn(Wrapper::new(async {\r\n                println!(\"Hello world\")\r\n            })).await.unwrap();\r\n        });\r\n}\r\n```\r\n\r\n```\r\nfn main() {\r\n    tokio::runtime::Builder::new_multi_thread()\r\n        .enable_all()\r\n        .on_spawn(Wrapper::new)\r\n        .build()\r\n        .unwrap()\r\n        .block_on(async {\r\n            tokio::spawn(async {\r\n                println!(\"Hello world\")\r\n            }).await.unwrap();\r\n        });\r\n}\r\n```\r\n\r\n**Describe alternatives you've considered**\r\n\r\nAlternative solution would be to apply this wrapper in all places where task is spawned. While this is possible for my own code, and also for crates like `Hyper` which offer configuration option like [`with_executor`](https://docs.rs/hyper/0.13.9/hyper/server/conn/struct.Http.html#method.with_executor), this is not possible when using crates which do not offer such configuration option.\r\n\r\nDoing this configuration for tokio runtime would be much better option.",
    "tokio-rs__tokio-6618": "Add a `CancellationToken` method for running a future until completion or cancellation\n(This is a variant of the idea proposed in #4598; I was advised to create a new issue for this.)\r\n\r\nGive how (seemingly) often a [`tokio_util::sync::CancellationToken`](https://docs.rs/tokio-util/latest/tokio_util/sync/struct.CancellationToken.html) gets used as follows:\r\n\r\n```rust\r\ntokio::select! {\r\n  _ = token.cancelled() => { /* something */ }\r\n  other => other_future => { /* something else */ }\r\n}\r\n```\r\n\r\nI propose adding a method to `CancellationToken` that takes a `Future`, runs it to completion, and returns its output \u2014 unless the token is cancelled before the future completes, in which case the future is dropped.  I feel the best type for the result of this composed future would be an `Option<Fut::Output>`, with `None` indicating cancellation.\r\n\r\nExample usage of this new method (here called `run_until_cancelled()`):\r\n\r\n```rust\r\nif let Some(r) = token.run_until_cancelled(fut).await {\r\n     /* Future completed; do stuff with future's return value `r` */\r\n} else {\r\n     /* Token & future were cancelled; do stuff for that */\r\n}\r\n```",
    "tokio-rs__tokio-6462": "Allow `if let` in select! macro\n**Is your feature request related to a problem? Please describe.**\r\nCurrently `if let` is not allowed in  `select!` macro.  This can be handy to match and extract \"internal\" values, which are then can be used to instantiate futures to wait on.\r\n\r\n**Describe the solution you'd like**\r\n\r\nSomething like this:\r\n\r\n```\r\nlet maybe_x = None\r\nselect! {\r\n _ = myfuture(x), if let Some(x) = maybe_x => {}\r\n}\r\n```\r\n\r\n\r\n**Describe alternatives you've considered**\r\n\r\nRigh now to extract value we need to call panicable methods. These will never panic in practice, but still not pretty.\r\n\r\n```\r\nlet maybe_x = None\r\nselect! {\r\n _ = myfuture(maybe_x.take().unwrap()), if maybe_x.is_some() => {}\r\n}\r\n```\r\n\r\n\r\n",
    "tokio-rs__tokio-6409": "[FEATURE_REQ] Add `recv_many` to StreamMap\n**Is your feature request related to a problem? Please describe.**\r\nMost channels in tokio offer `recv_many` and `poll_recv_many`, merged with https://github.com/tokio-rs/tokio/pull/6236. StreamMap doesn't offer anything like this.\r\n\r\n**Describe the solution you'd like**\r\nAn api like \r\nhttps://docs.rs/tokio/latest/tokio/sync/mpsc/struct.Receiver.html#method.recv_many \r\nhttps://docs.rs/tokio/latest/tokio/sync/mpsc/struct.Receiver.html#method.poll_recv_many\r\n\r\n**Describe alternatives you've considered**\r\nMy current hacked up solution\r\n```rust\r\n/// Returns a vec of all queued entries from a StreamMap\r\n/// Returns empty vec if no packets received\r\n/// Returns [Option::None] if no streams in StreamMap\r\n/// See `poll_next_entry()` from https://docs.rs/tokio-stream/latest/src/tokio_stream/stream_map.rs.html#520\r\npub async fn streammap_collect_queued<K: Clone + Unpin, V: Stream + Unpin>(\r\n    stream_map: &mut StreamMap<K, V>,\r\n) -> Option<Vec<(K, V::Item)>> {\r\n    match futures_util::poll!(pin!(stream_map.next())) {\r\n        // check if packets are queued\r\n        Poll::Ready(Some(sender_with_packets)) => {\r\n            let mut collected = vec![sender_with_packets];\r\n            // collect all queued packets\r\n            while let Poll::Ready(Some(sender_with_packets)) =\r\n                futures_util::poll!(pin!(stream_map.next()))\r\n            {\r\n                collected.push(sender_with_packets);\r\n            }\r\n            Some(collected)\r\n        }\r\n        // no streams in streammap\r\n        Poll::Ready(None) => {\r\n            warn!(\"StreamMap has no streams.\");\r\n            None\r\n        }\r\n        // streams don't have anything queued yet\r\n        Poll::Pending => {\r\n            // let other thread do work, maybe packet will come within timeout\r\n            match timeout(Duration::from_millis(50), stream_map.next()).await {\r\n                Ok(Some(sender_with_packets)) => {\r\n                    let mut collected = vec![sender_with_packets];\r\n                    while let Poll::Ready(Some(sender_with_packets)) =\r\n                        futures_util::poll!(pin!(stream_map.next()))\r\n                    {\r\n                        collected.push(sender_with_packets);\r\n                    }\r\n                    Some(collected)\r\n                }\r\n                Ok(None) => {\r\n                    warn!(\"StreamMap has no streams.\");\r\n                    None\r\n                }\r\n                // timeout, nothing was ready\r\n                Err(_) => Some(vec![]),\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nTests:\r\n```rust\r\n    #[tokio::test]\r\n    async fn test_streammap_multi_stream() {\r\n        let mut map: StreamMap<usize, UnboundedReceiverStream<usize>> = StreamMap::new();\r\n        let senders = (0..5)\r\n            .map(|i| {\r\n                let (sender, receiver) = unbounded_channel::<usize>();\r\n                let _ = map.insert(i, UnboundedReceiverStream::new(receiver));\r\n                sender\r\n            })\r\n            .collect::<Vec<_>>();\r\n\r\n        // this would hang indefinitely, since no channel is exhausted yet, and nothing has been inserted\r\n        // dbg!(map.next().await);\r\n\r\n        senders\r\n            .iter()\r\n            .enumerate()\r\n            .for_each(|(i, sender)| sender.send(i).unwrap());\r\n        assert_eq!(\r\n            streammap_collect_queued(&mut map)\r\n                .await\r\n                .unwrap()\r\n                .into_iter()\r\n                .sorted()\r\n                .collect_vec(),\r\n            vec![(0, 0), (1, 1), (2, 2), (3, 3), (4, 4)]\r\n        );\r\n\r\n        // add empty channel\r\n        let (_sender, receiver) = unbounded_channel();\r\n        map.insert(5, UnboundedReceiverStream::new(receiver));\r\n        assert_eq!(streammap_collect_queued(&mut map).await, Some(vec![]));\r\n\r\n        // add some more values, offset by 10\r\n        senders\r\n            .iter()\r\n            .enumerate()\r\n            .for_each(|(i, sender)| sender.send(i + 10).unwrap());\r\n        assert_eq!(\r\n            streammap_collect_queued(&mut map)\r\n                .await\r\n                .unwrap()\r\n                .into_iter()\r\n                .sorted()\r\n                .collect_vec(),\r\n            vec![(0, 10), (1, 11), (2, 12), (3, 13), (4, 14)]\r\n        );\r\n    }\r\n```\r\n\r\n**Additional context**\r\nAdd any other context or screenshots about the feature request here.\r\n",
    "tokio-rs__tokio-6345": "Make AsyncFd::new return inner on error\n**Is your feature request related to a problem? Please describe.**\r\nThis is required for a fix of https://github.com/emberian/evdev/issues/144. The TLDR is that right now, if you call AsyncFd::new and it fails, the inner type is dropped with no way to access it. This means if you need any data off of the inner type for error handling, you have to clone it before calling AsyncFd::new(). This leads to an unnecessary clone.\r\n\r\n\r\n**Describe the solution you'd like**\r\nI'd like to see a custom error type consisting of the underlying io::Error as well as the original inner that was passed in so that I can grab information off of it when necessary for error handling\r\n\r\n**Describe alternatives you've considered**\r\nBecause AsyncFd::new() has to take ownership and we don't want to require the inner type impl Clone, this seems like the only real solution to the problem.\r\n\r\n**Additional context**\r\nn/a\r\n",
    "tokio-rs__tokio-6339": "tokio::select! with only an \"else branch\"\nHi, I wrote a procedural macro and in it I use a `tokio::select!` where the amount of branches are dependent on the proc macro's input.\r\nI always have the falback `else` branch.\r\n\r\nIn my use case, my proc macro uses the user function signature as input and the amount of arguments will determine the amount of branches in the `tokio::select!` call. \r\n\r\nAnd it is totally valid to have a no argment function that will translate in a `select!` with 0 branch and only the `else` fallback. as such:\r\n\r\n ```rust\r\n...\r\nlet foo = tokio::select! {\r\n    else => 1,\r\n};\r\n...\r\n```\r\nBut it doesn't compile.\r\n\r\n**Describe the solution you'd like**\r\n\r\nA clear and concise description of what you want to happen.\r\nI would like this edge case to be valid. While I understand that this is not very useful by itself, we are talking here in the context of proc macro code.\r\nAlso, the `else` branch exists as a fallback for when all branches are disabled. And no branches at all is kinda equivalent to all branches disabled.\r\n\r\n**Describe alternatives you've considered**\r\n- **Alternative 1**: I write my proc macro a bit more complicate and take into account the special case when I have 0 branches and skip the `tokio::select!` altogether.\r\n\r\n- **Alternative 2**: I added a permanent dummy branch always disabled (with a never type `!` return type)  in the expension of my proc macro. As such:\r\n ```rust\r\n...\r\nlet foo = tokio::select! {\r\n    _ = async {} , if false => unreachable!(),\r\n    else => 1,\r\n};\r\n...\r\n```\r\n- **Alternative 3**: a PR to tokio to enhance the `select!` macro, the simplest is basically to implement \"Alternative 2\" directly in the `macro_rules!`.\r\n\r\n- **Alternative 4**: a PR to tokio to enhance the `select!` macro but done more elegantly than \"Alternative 3\" but will required more complex changes in the macro and suporting files such `tokio\\tokio-macros\\src\\select.rs` (because [here ](https://github.com/tokio-rs/tokio/blob/master/tokio-macros/src/select.rs#L34C20-L34C28) it doesn't work I think when `variants` is an empty Vec).\r\n\r\n**Additional notes**\r\nI already implemented **Alternative 3** and add 2 tests to cover it in `tokio\\tokio\\tests\\macros_select.rs`.\r\nI am ready to submit the PR if it is desired by the Tokio team.\r\n\r\nThank you.\r\n",
    "tokio-rs__tokio-6290": "Expose a `bind` method on `UnixStream`\n**Is your feature request related to a problem? Please describe.**\r\n\r\nAlthough very unconventional, it may be useful to bind a unix socket to a specific path. In my case, the listener calls `UnixStream::peer_addr()` upon accepting an incoming connection, and the path contains information necessary to process the connection.\r\n\r\n**Describe the solution you'd like**\r\n\r\nAllow users to create a `UnixStream` bound to a specific path. `socket2` exposes a [`bind`](https://docs.rs/socket2/latest/socket2/struct.Socket.html#method.bind) for this. I'm not sure how to make this fully backward compatible in tokio case though, since `UnixStream::connect` is currently the only way to create a socket.\r\n\r\n**Describe alternatives you've considered**\r\n\r\n- creating a socket2 socket, using `AsyncFd` for the connection, then convert the socket into a tokio socket\r\n- creating a socket2 socket, make a blocking `connect` call, then convert the socket into a tokio socket",
    "tokio-rs__tokio-6280": "try_join_next for JoinSet\nAs pointed out in the discussion in https://github.com/tokio-rs/tokio/discussions/6157, `JoinSet` appears to be missing a method equivalent to `try_recv` on `mpsc::Channel`. There is `poll_join_next`, but this appears to be intended for when manually implementing the `Future` trait, as it requires access to a `Context`.\r\n\r\nIt is possible to maintain a set of `JoinHandle`, and periodically check `is_finished` on each, where there might be more `JoinHandle` added to the set that is being tracked between checks. However, it feels like `JoinSet` is also intended for this use case, and would be a much more ergonomic abstraction over having to manually do this bookkeeping.",
    "tokio-rs__tokio-6252": "Add `mark_unchanged` or `mark_seen` for `tokio::sync::watch::Receiver`.\n**Is your feature request related to a problem? Please describe.**\n\nIn developing of a web server, I need to wait a new value when handling every http requests. I create a `watch` channel and clone the `Receiver` for every individual request.\n\nWhat I want is to call `.changed().await` and wait for a new value. However the receiver I clone from is always outdated. So I have to mark it as seen before waiting new value, otherwise the `changed()` return immediately.\n\nCurrently, the only way to mark the receiver is seen is the `borrow_and_update()` method. But it not only update the internal version, but also lock the internal RwLock for getting the value, which is unnecessary in this case.\n\n**Describe the solution you'd like**\nI want to add a method called `mark_unchanged` or `mark_seen`, which just update the Receiver internal version, without locking the shared RwLock anyway.\n\n**Describe alternatives you've considered**\n`drop(borrow_and_update())`\n\n**Additional context**\nNo additional context.\n\nI can explain more details of how I expect the web server works. When a new GET request incoming, it blocks to wait. In the background, a coroutine is scanning bluetooth devices in an infinite loop. Every time it found one, it sends a value to the channel. And all currently waiting request handlers received the value and return.\n\nI suggest to add this method for avoid an unnecessary read-lock because we can. It's not a critical optimization for me. But it will be useful for someone who is building high-performance services.",
    "tokio-rs__tokio-6205": "Add a way to request many permits on a `mpsc::channel`\n**Is your feature request related to a problem? Please describe.**\r\nI'm making a library where I'm exposing an API that transforms a message into many payloads, then insert them into an `mpsc::channel`. Because I want to be able to return an error with the **original** message if the channel is full I need to use the `Permit` API. However because I send `n` payload for `1` message I need to be able to ask `n Permit` efficiently before doing the message transformation. \r\n\r\n**Describe the solution you'd like**\r\nI noticed that the `Semaphore` API already has the possibility to ask `n` Permit and that the Permit API provided by the `mpsc::channel` is just a layer on top of it. So it shouldn't be too difficult to change the API. It could be something like that: \r\n```rust\r\npub struct ManyPermit<'a, T> {\r\n    chan: &'a chan::Tx<T, Semaphore>,\r\n    n: u32,\r\n}\r\n```\r\n\r\n```rust\r\npub fn try_reserve_many(&self, n: u32) -> Result<ManyPermit<'_, T>, TrySendError<()>> {\r\n    match self.chan.semaphore().semaphore.try_acquire(n) {\r\n        Ok(()) => {}\r\n        Err(TryAcquireError::Closed) => return Err(TrySendError::Closed(())),\r\n        Err(TryAcquireError::NoPermits) => return Err(TrySendError::Full(())),\r\n    }\r\n\r\n    Ok(ManyPermit {\r\n        chan: &self.chan,\r\n        n,\r\n    })\r\n}\r\n```\r\n\r\n```rust\r\nimpl<T> ManyPermit<'_, T> {\r\n    pub fn send(&mut self, value: T) {\r\n\t\t\t\t// Behavior here still needs some clarification between :\r\n\t\t\t\t// * returning an error\r\n\t\t\t\t// * Doing nothing\r\n\t\t\t\t// * Panic\r\n        if self.n > 0 {\r\n            self.chan.send(value);\r\n            self.n -= 1;\r\n        }\r\n    }\r\n}\r\n\r\nimpl<T> Drop for ManyPermit<'_, T> {\r\n    fn drop(&mut self) {\r\n        use chan::Semaphore;\r\n\r\n        let semaphore = self.chan.semaphore();\r\n\r\n        // Add the remaining permits back to the semaphore\r\n        semaphore.add_permits(self.n as usize);\r\n\r\n        // If this is the last sender for this channel, wake the receiver so\r\n        // that it can be notified that the channel is closed.\r\n        if semaphore.is_closed() && semaphore.is_idle() {\r\n            self.chan.wake_rx();\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n**Describe alternatives you've considered**\r\nThere are two other possibilitie I considered:\r\n* Ask multiple permits and then return a `Vec<Permit>` but this would allocate a new vec, so it is quite inneficient.\r\n* Put a `Semaphore` with the same size next to my sender and synchronize it with my sender to track the number of given permits.\r\n\r\n**Additional context**\r\nI'm willing to work on this feature if it is accepted.\r\n",
    "tokio-rs__tokio-5781": "Wait for messages in the error queue\n**Is your feature request related to a problem? Please describe.**\r\n\r\nI work on [ntpd-rs](https://github.com/pendulum-project/ntpd-rs), an NTP implementation in rust. A big part of how it works is to configure a UDP socket to record timestamps when a message is sent or received, and then retrieving these timestamps. The timestamp is not available immediately (we've observed this for external hardware clocks, software timestamps do seem to be effectively instant).\r\n\r\nThese timestaps end up in the error queue (libc::MSG_ERRQUEUE) of the socket. Tokio does not have a way to await or read these messages currently. The reading of these messages is probably too low-level for tokio, but being able to await the messages appearing would be extremely useful. \r\n\r\n**Describe the solution you'd like**\r\n\r\nWith https://github.com/tokio-rs/tokio/pull/5566 heading in a promising direction, I think from a user perspective, the best API would be\r\n\r\n```rust\r\nlet socket: AsyncFd<std::net::UdpSocket> = ...;\r\n\r\nloop { \r\n    let mut guard = socket.ready(Interest::ERROR).await?;\r\n\r\n    if guard.ready().is_error() {\r\n        match read_from_error_queue(socket.get_ref()) {\r\n            Ok(msg) => {\r\n                println!(\"read {msg}\");\r\n            }\r\n            Err(ref e) if e.kind() == io::ErrorKind::WouldBlock => {\r\n                guard.clear_ready_exact(Ready::ERROR);\r\n                continue;\r\n            }\r\n            Err(e) => {\r\n                return Err(e.into());\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nAdding `Ready::ERROR` is straightforward. But adding an error interest is really not. Currently, a tokio interest is just a wrapper around the `mio::Interest`:\r\n\r\n```rust\r\npub struct Interest(mio::Interest);\r\n\r\nimpl Interest {\r\n    /// Interest in all readable events.\r\n    ///\r\n    /// Readable interest includes read-closed events.\r\n    pub const READABLE: Interest = Interest(mio::Interest::READABLE);\r\n\r\n    ...\r\n```\r\n\r\nBut `mio::Interest::ERROR` does not exist, with a good reason: the error \"interest\" is always registered by the OS (see  https://github.com/tokio-rs/mio/issues/1672#issuecomment-1553456643). Therefore (not) using `mio::Interest::ERROR` would have no effect either way, and would be confusing.\r\n\r\nBut for public tokio APIs, the interest is specifically what you listen for, and hence what you'll be notified for. That would mean that tokio would have to implement `Interest` itself (sort of inlining the mio implementation). I don't see any technical issues with that approach, and I don't think there are performance downsides really: all of the logic to convert to `mio::Interest` could use `const fn`. \r\n\r\nBut it's kind of inelegant because it duplicates a bunch of logic from mio, and increases maintenance burden and the change of inconsistencies. I'd say it's worth it, but there is a cost.\r\n\r\n**Describe alternatives you've considered**\r\n\r\nAnother option would be to always include the error readiness, like mio:\r\n\r\n```rust\r\nimpl Ready { \r\n    pub(crate) fn from_interest(interest: Interest) -> Ready {\r\n        let mut ready = Ready::EMPTY;\r\n\r\n        if interest.is_readable() {\r\n            ready |= Ready::READABLE;\r\n            ready |= Ready::READ_CLOSED;\r\n        }\r\n\r\n        // ...\r\n\r\n        // just always include the error readiness\r\n        ready |= Ready::ERROR\r\n\r\n        ready\r\n    }\r\n}\r\n```\r\n\r\nthis would sort of work, but it's extremely inelegant. The example from earlier would have to pick a different, arbitrary `Interest`, and then just ignore this interest and just see if the readiness includes the error flag.\r\n\r\n```rust\r\nloop { \r\n    let mut guard = socket.ready(Interest::READABLE).await?;\r\n\r\n    if guard.ready().is_error() {\r\n        // ...\r\n    }\r\n}\r\n```\r\n\r\nI also think this will lead to problems with e.g. `readable` firing but a read stil blocking. Code should be robust against that, but it's still inefficient to read when we know it would block.\r\n\r\n**Additional context**\r\n\r\nThe error queue is used for many things besides timestamps. Here is [an example](https://gist.github.com/folkertdev/9bb8abeb5fcd7f32a8bfdc86f2a6fc3b) that puts a explicitly puts a message on the error queue. It may come in handy for testing. The examples that I know of are all from unix systems, but I don't see any harm in exposing error readiness across platforms (mio already supports it anyway). \r\n\r\nI'm happy to work on this, but would like some confirmation on this path not being totally unreasonable before starting. \r\n",
    "tokio-rs__tokio-5583": "UdpSocket.recv() using uninitialized Vec\n**Is your feature request related to a problem? Please describe.**\r\nAs today `UdpSocket.recv()`  and `UdpSocket.recv_from()` require a `Vec<u8> with length > 0`.\r\nThis prevents users to use a `Vec<u8>` created with `Vec::with_capacity()` for skipping the vec initialization; the methods always returns `OK(0)`.\r\n\r\nAs workaround [try_recv_buf_from](https://docs.rs/tokio/latest/tokio/net/struct.UdpSocket.html#method.try_recv_buf_from) and [try_recv_buf](https://docs.rs/tokio/latest/tokio/net/struct.UdpSocket.html#method.try_recv_buf) are available but they increase the code complexity.\r\n\r\n**Describe the solution you'd like**\r\nI've considered the following alternatives:\r\n\r\n1.  Implements `recv_buf` and `recv_buf_from`: they will work with buf having `length=0` without the complication of try variants.\r\n\r\n**Describe alternatives you've considered**\r\n\r\n2.  Switching recv() and recv_from from `&mut [u8]` to `&mut BufMut`. I'm not sure if that's an acceptable solution\r\n\r\n**Additional context**\r\nAs bonus point, it would be nice to improve methods documentations to underline the different behavior of the current methods: as today, the difference is only shown in the code snippets (not in the description).\r\n",
    "tokio-rs__tokio-5566": "Support waiting on POLLPRI events on Linux\n**Is your feature request related to a problem? Please describe.**\r\n`/proc/self/mounts` raises a priority event when there is a change in mount points (something is mounted or unmounted). There are probably other similar system-related files that do this as well. There appears to be no way of waiting for these in Tokio.\r\n\r\n**Describe the solution you'd like**\r\nAdd a `Priority` variant to `tokio::io::Interest` and implement support for it in `tokio::io::unix::AsyncFd`.\r\n\r\n**Describe alternatives you've considered**\r\nPolling for changes manually. Writing my own select/poll loop in a blocking thread.\r\n\r\n**Additional context**\r\nNone\r\n",
    "tokio-rs__tokio-5520": "Proposal: `UdpSocket::peek_sender()`\n**Is your feature request related to a problem? Please describe.**\r\nFor implementing a UDP-based gossip protocol, I would prefer not to require a separate connected socket per peer connection. While `recv_from()` and `send_to()` get me most of the way there, there's a piece of the puzzle missing.\r\n\r\nWhen handling a datagram on a bound socket, it can be important to know the sender of the next datagram in the queue without consuming it, e.g. to know if we even want to read the datagram into application memory or not, or to call up application state for that particular peer such as a DTLS session. \r\n\r\nFor DTLS specifically, the OpenSSL implementation provides its own read buffer per session, so we want to get the peer address of the datagram, call up the session, and then read the datagram into the DTLS read buffer, preferably without any redundant copies.\r\n\r\n[`UdpSocket::peek_from()`](https://docs.rs/tokio/latest/tokio/net/struct.UdpSocket.html#method.peek_from) is _almost_ what we need, but the Windows-specific behavior is problematic: we're forced to provide a buffer large enough to read the whole datagram whether we actually want to yet or not, or else the sender information will be discarded due to the `WSAEMSGSIZE` error.\r\n\r\n**Describe the solution you'd like**\r\n[I experimented with directly calling `recvfrom()` on Windows](https://gist.github.com/abonander/f1a35cd91a8675a65546e051a0743e62) and found that it _does_ populate the `sockaddr` out-pointer even when it returns `WSAEMSGSIZE`, so I'd propose that `UdpSocket` gain a new method:\r\n\r\n```rust\r\nimpl UdpSocket {\r\n    /// This could/should also have a `poll_peek_sender()` and `try_peek_sender()` counterpart.\r\n    pub async fn peek_sender(&self) -> std::io::Result<SocketAddr> {\r\n        // ...\r\n    }\r\n}\r\n```\r\n\r\nFor non-Windows platforms this can trivially be implemented in terms of `peek_from()`, but on Windows this should make a direct `recvfrom()` call, passing a zero-size buffer, setting the `MSG_PEEK` flag, and suppressing the `WSAEMSGSIZE` error.\r\n\r\nPart of the purpose of opening this issue is to get feedback on _where_ this should live, since I understand that most of the I/O methods in Tokio invoke methods in Mio which in turn invoke their `std` counterparts. I would _prefer_ not to have to go through the process of championing an RFC because I simply don't have the time or energy to endure that process these days.\r\n\r\n**Describe alternatives you've considered**\r\nIdeally `peek_from()` could just suppress the `WSAEMSGSIZE` error in the name of consistency as that's a Windows-specific idiosyncrasy, but that would be up to `std::net::UdpSocket::peek_from()`, and it would be a behavior change.\r\n\r\nI can just use `recv_from()`, read the datagram and get the sender every time, then copy the data into the DTLS read buffer if applicable, but that's a redundant copy which could be up to 64KiB in size _every datagram_. That's a potential vector for a denial-of-service attack; in practice our application limits datagrams to a more reasonable size just under the Ethernet MTU, but still a redundant copy of every datagram can add up if they're all 1+ KiB.\r\n\r\nI _can_ just make the `recvfrom` call directly in my application, however that's suboptimal as it requires upholding a number of `unsafe` invariants. Anyone else implementing this themselves would be at risk of making any number of mistakes that could result in undefined or just wrong behavior. As noted on the Gist I actually forgot to convert the `port` value from big-endian, so even my first attempt had a pretty significant bug.\r\n\r\n`socket2` is probably the most appropriate non-`std` place for this to live, but for convenience I would like to see it available in Tokio as well, as shuttling back and forth between `socket2::Socket` and `tokio::net::UdpSocket` is still potentially quite error-prone.\r\n\r\n**Additional context**\r\nI had previously spoken to @Noah-Kennedy on the Tokio Discord about this so I'd like his input here.\r\n",
    "tokio-rs__tokio-5343": "Add broadcast::Sender::len\n**Is your feature request related to a problem? Please describe.**\r\nI'm working on a service that's essentially a broadcast proxy - it receives a data stream and rebroadcasts it to all active clients. Tokio's broadcast queue fits in pretty cleanly to the core of the logic. I want to provide some metrics to help detect laggy clients; this could be the number of lagged items or the current queue size for example. I don't care about tracking this per client - just some aggregate value for the entire queue.\r\n\r\nCurrently I have a metric counting the number of lagged items that incremented when a client's receiver sees a `RecvError::Lagged(_)` value. However, this only works properly if the client lags and then recovers - a client that gets permanently stuck will never report any of its lost values.\r\n\r\nAlternatively, I could report the queue size via `Receiver::len`, but since the recv method is async and mutably borrows self, I can't cleanly do that e.g. in another task while simultaneously waiting for more data.\r\n\r\n**Describe the solution you'd like**\r\nThe simplest solution I can see is to add a `Sender::len` method returning the total number of queued items. It would be the maximum of the values reported from `Receiver::len` across all live receivers at that time.\r\n\r\n**Describe alternatives you've considered**\r\nAn alternative could be to add a `Receiver::poll_recv` method which would make it possible to have one task receiving and another tracking the queue length. However, this would be significantly more complicated to implement on my end and probably more complicated to implement in Tokio as well.\r\n\r\nI'm happy to make a PR if the Sender::len approach seems reasonable.",
    "tokio-rs__tokio-5244": "tokio-macros 1.8.1 regression\nNOTE(taiki-e): I yanked 1.8.1 for now.\r\n\r\n---\r\n\r\nI have a suspicion that this cause an interesting regression, but I'm not certain.\r\n\r\nIn our codebase, we have something along the lines of\r\n```rust\r\nmacro_rules! custom_test {\r\n    (async fn $name:ident() $b:block) => {\r\n        #[::tokio::test]\r\n        async fn $name() {\r\n            dbg!(\"foo\");\r\n            $b\r\n        }\r\n    };\r\n}\r\n\r\n// usage normally with macro_rules_attribute, but for demonstration\r\ncustom_test!(\r\n    async fn foo() {\r\n        dbg!(\"bar\");\r\n    }\r\n);\r\n```\r\n\r\nThis compiles with tokio-macros 1.8.0 but does not with 1.8.1\r\n\r\n```rust\r\nerror[E0425]: cannot find value `body` in this scope\r\n  --> tests/main.rs:74:20\r\n   |\r\n74 |       async fn foo() {\r\n   |  ____________________^\r\n75 | |         dbg!(\"bar\");\r\n76 | |     }\r\n   | |_____^ not found in this scope\r\n```\r\n\r\n_Originally posted by @conradludgate in https://github.com/tokio-rs/tokio/issues/5092#issuecomment-1331009348_\r\n      ",
    "tokio-rs__tokio-5200": "Ability to (temporarily) disable time auto-advance when paused\nThe timer wheel auto-advancing while in pause is obviously helpful when tasks blocked on timers however when doing a bit of I/O as well things get quite unpredictable. In my particular case the crate i'm testing runs a interval loop in one task while another task is doing some prep with I/O (only).   Depending on timing (hah) this causes the time to auto-advance some of the time but not always \r\n\r\n**Describe the solution you'd like**\r\n\r\nThe ability to pause time  while turning auto-advance on and off again so it's easier for the author to ensure there are no auto-advances for at least a given scope\r\n\r\n**Describe alternatives you've considered**\r\n\r\nThere really no way to always have the right trade-of when mixing tasks in sleep and tasks in i/o as the runtime/test framework can't be omniscient..  auto-advancing the timer is for sure needed to avoid deadlocks if progress relies on timers expiring, but it gets quite awkward if one only wants those to expire after some I/O bound prep has been done (creating files, reading test data, interacting with a mock). \r\n\r\n**Additional context**\r\n\r\nBelow is an example showing where the clock can unexpectedly; In real situation both the directory creation and the interval will be hidden deeper in the code that's being tested though\r\n\r\non playground:\r\nhttps://play.rust-lang.org/?version=stable&mode=debug&edition=2021&gist=e0e11bdc8e604a646186c5e9a4a9422c\r\n\r\nrelevant code:\r\n\r\n```rust\r\nlet start = Instant::now();\r\ntokio::spawn(async {\r\n    let mut interval = interval(Duration::from_secs(1));\r\n    loop {\r\n        interval.tick().await;\r\n    }\r\n});\r\n  \r\nfor i in 0..1000 {\r\n    let _ = tokio::fs::create_dir(\"/tmp/test\").await;\r\n    assert_eq!(start, Instant::now(), \"Failed after {} times\", i);\r\n}   \r\n```  ",
    "tokio-rs__tokio-5179": "LocalSet and Runtime cannot be stored in thread_local at the same time\n**Version**\r\n\r\ntokio 1.21.2\r\n\r\n**Platform**\r\nx86_64-unknown-linux-gnu\r\n\r\n**Description**\r\nIt seems similar to #4973 \r\n\r\nI tried this code:\r\n\r\n```rust\r\n// src/main.rs\r\nuse tokio::runtime::Runtime;\r\nuse tokio::task::LocalSet;\r\n\r\nthread_local! {\r\n    pub static LOCAL_SET: TokioLocalSet = TokioLocalSet::new();\r\n}\r\n\r\n// the order here seems wrong, \r\n// have revised, see the following comments\r\npub struct TokioLocalSet {\r\n    rt: Runtime,\r\n    local: LocalSet,\r\n}\r\n\r\nimpl TokioLocalSet {\r\n    pub fn new() -> TokioLocalSet {\r\n        TokioLocalSet {\r\n            rt: tokio::runtime::Builder::new_current_thread()\r\n                .enable_all()\r\n                .build()\r\n                .unwrap(),\r\n            local: LocalSet::new(),\r\n        }\r\n    }\r\n\r\n    async fn inner_method(&self) {\r\n        self.local\r\n            .run_until(async move {\r\n                tokio::task::spawn_local(async {});\r\n            })\r\n            .await\r\n    }\r\n\r\n    pub fn method(&self) {\r\n        self.rt.block_on(self.inner_method());\r\n    }\r\n}\r\n\r\nfn main1(){\r\n    // will panic\r\n    LOCAL_SET.with(|f|{\r\n        f.method();\r\n    });\r\n}\r\n\r\nfn main2(){\r\n    // work well\r\n    let ls = TokioLocalSet::new();\r\n    ls.method();\r\n}\r\n\r\nfn main3(){\r\n    // work well\r\n    let ls = TokioLocalSet::new();\r\n    ls.method();\r\n    LOCAL_SET.with(|f|{\r\n        f.method();\r\n    });\r\n}\r\n\r\n```\r\n\r\n```toml\r\n# Cargo.toml\r\n[package]\r\nname = \"tokio_local_set\"\r\nversion = \"0.1.0\"\r\nedition = \"2021\"\r\n\r\n[dependencies]\r\ntokio = { version = \"1.21.2\", features = [\"full\"] }\r\n```\r\n\r\nI expected to see this happen: `main1` works well.\r\n\r\nInstead, this happened: `main3` works well, `main1` panics. And reported the same error as #4973 \r\n\r\n```bash\r\nthread 'main' panicked at 'cannot access a Thread Local Storage value during or after destruction: AccessError'\r\n```\r\n\r\nIs this expected? \r\n\r\nHere is the link to the playground: https://play.rust-lang.org/?version=stable&mode=debug&edition=2021&gist=e26d1f993906627a219d304e849cc70b\r\n\r\n\r\n",
    "tokio-rs__tokio-5144": "Expose semaphore's MAX_PERMITS as a public constant.\n**Is your feature request related to a problem? Please describe.**\r\n\r\nSometimes semaphore needs to be disabled at runtime by adjusting it's configuration. But obvious `usize::MAX` fails with `a semaphore may not have more than MAX_PERMITS permits (2305843009213693951)` panic.\r\n\r\nBut `MAX_PERMITS` mentioned in the panic message is not available in API. Apart from serving as \"effective infinity\", it may be used to filter user input, preventing causing panics by setting deliberately invalid value. How are apps supposed to check user-configurable concurrency limit without panicking?\r\n\r\n**Describe the solution you'd like**\r\n\r\n`pub const  tokio::sync::Semaphore::MAX_PERMITS: usize = ...;`\r\n\r\n**Describe alternatives you've considered**\r\n\r\n* A fallible function for creating a semaphore, with Tower handling those errors.\r\n* Documenting `2305843009213693951` explicitly as a limit and never shrinking it, so apps can safely embed it.\r\n* Documenting that semaphores should not be operated close to the cap, if there are indeed valid reasons for that.",
    "tokio-rs__tokio-4789": "Add async OnceCell::wait method.\n**Is your feature request related to a problem? Please describe.**\r\n`once_cell::sync::OnceCell` has a blocking [`wait`](https://docs.rs/once_cell/latest/once_cell/sync/struct.OnceCell.html#method.wait) method that blocks the thread until the `OnceCell` is set from another thread. It may be useful to have an async equivalent to this for `tokio::sync::OnceCell` that blocks the current task until the `OnceCell` is set from another task/thread.\r\n\r\n**Describe the solution you'd like**\r\n```rs\r\nimpl<T> OnceCell<T> {\r\n    /// Returns a reference to the value currently stored in the `OnceCell`,\r\n    /// waiting until the `OnceCell` is set if it is empty.\r\n    async fn wait(&self) -> &T;\r\n}\r\n```\r\n\r\n**Describe alternatives you've considered**\r\nOne could use a loop with `tokio::time::sleep` and `OnceCell::initialized`.\r\n\r\n**Additional context**\r\nSomeone asked about this [on discord](https://discord.com/channels/500028886025895936/500336333500448798/989585463629197312). \r\n\r\n> What should I use if I want to set a value once and then only read it, but I don't know when it will be written and want all the readers to wait for that\r\n> OnceCell, for example, cannot wait for the write\r\n",
    "tokio-rs__tokio-4613": "tokio::test does not work with renamed crate (i.e. tokio02:::test)\n<!--\r\nThank you for reporting an issue.\r\n\r\nPlease fill in as much of the template below as you're able.\r\n-->\r\n\r\n## Version\r\n\r\n<!--\r\nList the versions of all `tokio` crates you are using. The easiest way to get\r\nthis information is using `cargo-tree`.\r\n\r\n`cargo install cargo-tree`\r\n(see install here: https://github.com/sfackler/cargo-tree)\r\n\r\nThen:\r\n\r\n`cargo tree | grep tokio`\r\n-->\r\n\r\nLong story short, we have:\r\n\r\n```toml\r\ntokio02 = { package = \"tokio\", version = \"0.2.13\", features = [\"blocking\", \"fs\", \"sync\", \"macros\", \"test-util\", \"rt-core\"] }\r\n```\r\n\r\n<Details>\r\n\r\n```\r\n\u2502   \u251c\u2500\u2500 tokio-codec v0.1.1\r\n\u2502   \u2502   \u2514\u2500\u2500 tokio-io v0.1.12\r\n\u2502   \u2502   \u2502   \u2502   \u2514\u2500\u2500 tokio-io v0.1.12 (*)\r\n\u2502   \u2502   \u2502   \u2502   \u2514\u2500\u2500 tokio-buf v0.1.1\r\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 tokio v0.1.22\r\n\u2502   \u2502   \u2502   \u2502   \u251c\u2500\u2500 tokio-codec v0.1.1 (*)\r\n\u2502   \u2502   \u2502   \u2502   \u251c\u2500\u2500 tokio-current-thread v0.1.6\r\n\u2502   \u2502   \u2502   \u2502   \u2502   \u2514\u2500\u2500 tokio-executor v0.1.9\r\n\u2502   \u2502   \u2502   \u2502   \u251c\u2500\u2500 tokio-executor v0.1.9 (*)\r\n\u2502   \u2502   \u2502   \u2502   \u251c\u2500\u2500 tokio-fs v0.1.6\r\n\u2502   \u2502   \u2502   \u2502   \u2502   \u251c\u2500\u2500 tokio-io v0.1.12 (*)\r\n\u2502   \u2502   \u2502   \u2502   \u2502   \u2514\u2500\u2500 tokio-threadpool v0.1.17\r\n\u2502   \u2502   \u2502   \u2502   \u2502       \u2514\u2500\u2500 tokio-executor v0.1.9 (*)\r\n\u2502   \u2502   \u2502   \u2502   \u251c\u2500\u2500 tokio-io v0.1.12 (*)\r\n\u2502   \u2502   \u2502   \u2502   \u251c\u2500\u2500 tokio-reactor v0.1.11\r\n\u2502   \u2502   \u2502   \u2502   \u2502   \u251c\u2500\u2500 tokio-executor v0.1.9 (*)\r\n\u2502   \u2502   \u2502   \u2502   \u2502   \u251c\u2500\u2500 tokio-io v0.1.12 (*)\r\n\u2502   \u2502   \u2502   \u2502   \u2502   \u2514\u2500\u2500 tokio-sync v0.1.7\r\n\u2502   \u2502   \u2502   \u2502   \u251c\u2500\u2500 tokio-sync v0.1.7 (*)\r\n\u2502   \u2502   \u2502   \u2502   \u251c\u2500\u2500 tokio-tcp v0.1.3\r\n\u2502   \u2502   \u2502   \u2502   \u2502   \u251c\u2500\u2500 tokio-io v0.1.12 (*)\r\n\u2502   \u2502   \u2502   \u2502   \u2502   \u2514\u2500\u2500 tokio-reactor v0.1.11 (*)\r\n\u2502   \u2502   \u2502   \u2502   \u251c\u2500\u2500 tokio-threadpool v0.1.17 (*)\r\n\u2502   \u2502   \u2502   \u2502   \u251c\u2500\u2500 tokio-timer v0.2.12\r\n\u2502   \u2502   \u2502   \u2502   \u2502   \u2514\u2500\u2500 tokio-executor v0.1.9 (*)\r\n\u2502   \u2502   \u2502   \u2502   \u251c\u2500\u2500 tokio-udp v0.1.5\r\n\u2502   \u2502   \u2502   \u2502   \u2502   \u251c\u2500\u2500 tokio-codec v0.1.1 (*)\r\n\u2502   \u2502   \u2502   \u2502   \u2502   \u251c\u2500\u2500 tokio-io v0.1.12 (*)\r\n\u2502   \u2502   \u2502   \u2502   \u2502   \u2514\u2500\u2500 tokio-reactor v0.1.11 (*)\r\n\u2502   \u2502   \u2502   \u2502   \u251c\u2500\u2500 tokio-uds v0.2.5\r\n\u2502   \u2502   \u2502   \u2502   \u2502   \u251c\u2500\u2500 tokio-codec v0.1.1 (*)\r\n\u2502   \u2502   \u2502   \u2502   \u2502   \u251c\u2500\u2500 tokio-io v0.1.12 (*)\r\n\u2502   \u2502   \u2502   \u2502   \u2502   \u2514\u2500\u2500 tokio-reactor v0.1.11 (*)\r\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 tokio-buf v0.1.1 (*)\r\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 tokio-executor v0.1.9 (*)\r\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 tokio-io v0.1.12 (*)\r\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 tokio-reactor v0.1.11 (*)\r\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 tokio-tcp v0.1.3 (*)\r\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 tokio-threadpool v0.1.17 (*)\r\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 tokio-timer v0.2.12 (*)\r\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 tokio-io v0.1.12 (*)\r\n\u2502   \u2502   \u251c\u2500\u2500 tokio v0.1.22 (*)\r\n\u2502   \u2502   \u251c\u2500\u2500 tokio-executor v0.1.9 (*)\r\n\u2502   \u2502   \u251c\u2500\u2500 tokio-io v0.1.12 (*)\r\n\u2502   \u2502   \u251c\u2500\u2500 tokio-threadpool v0.1.17 (*)\r\n\u2502   \u2502   \u251c\u2500\u2500 tokio-timer v0.2.12 (*)\r\n\u2502   \u2514\u2500\u2500 tokio-sync v0.1.7 (*)\r\n\u2502   \u251c\u2500\u2500 tokio-io v0.1.12 (*)\r\n\u2502   \u2514\u2500\u2500 tokio-openssl v0.3.0\r\n\u2502       \u2514\u2500\u2500 tokio-io v0.1.12 (*)\r\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 tokio-process v0.2.4\r\n\u2502   \u2502   \u2502   \u2502   \u251c\u2500\u2500 tokio-io v0.1.12 (*)\r\n\u2502   \u2502   \u2502   \u2502   \u251c\u2500\u2500 tokio-reactor v0.1.11 (*)\r\n\u2502   \u2502   \u2502   \u2502   \u2514\u2500\u2500 tokio-signal v0.2.7\r\n\u2502   \u2502   \u2502   \u2502       \u251c\u2500\u2500 tokio-executor v0.1.9 (*)\r\n\u2502   \u2502   \u2502   \u2502       \u251c\u2500\u2500 tokio-io v0.1.12 (*)\r\n\u2502   \u2502   \u2502   \u2502       \u2514\u2500\u2500 tokio-reactor v0.1.11 (*)\r\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 tokio-timer v0.2.12 (*)\r\n\u2502   \u2502   \u251c\u2500\u2500 tokio v0.1.22 (*)\r\n\u2502   \u2502   \u251c\u2500\u2500 tokio-timer v0.2.12 (*)\r\n\u2502   \u2502   \u251c\u2500\u2500 tokio v0.1.22 (*)\r\n\u2502   \u2502   \u251c\u2500\u2500 tokio-io v0.1.12 (*)\r\n\u2502   \u2502   \u2514\u2500\u2500 tokio-uds v0.2.5 (*)\r\n\u2502   \u251c\u2500\u2500 tokio v0.1.22 (*)\r\n\u2502   \u251c\u2500\u2500 tokio-codec v0.1.1 (*)\r\n\u2502   \u251c\u2500\u2500 tokio-io v0.1.12 (*)\r\n\u251c\u2500\u2500 tokio v0.1.22 (*)\r\n\u251c\u2500\u2500 tokio v0.2.13\r\n\u2502   \u2514\u2500\u2500 tokio-macros v0.2.5\r\n\u251c\u2500\u2500 tokio-compat v0.1.5\r\n\u2502   \u251c\u2500\u2500 tokio v0.2.13 (*)\r\n\u2502   \u251c\u2500\u2500 tokio-current-thread v0.1.6 (*)\r\n\u2502   \u251c\u2500\u2500 tokio-executor v0.1.9 (*)\r\n\u2502   \u251c\u2500\u2500 tokio-reactor v0.1.11 (*)\r\n\u2502   \u2514\u2500\u2500 tokio-timer v0.2.12 (*)\r\n\u251c\u2500\u2500 tokio-retry v0.2.0\r\n\u2502   \u2514\u2500\u2500 tokio-timer v0.2.12 (*)\r\n\u251c\u2500\u2500 tokio-signal v0.2.7 (*)\r\n\u251c\u2500\u2500 tokio-tls v0.2.1\r\n\u2502   \u2514\u2500\u2500 tokio-io v0.1.12 (*)\r\n\u251c\u2500\u2500 tokio-uds v0.2.5 (*)\r\n\u2502   \u2502   \u251c\u2500\u2500 tokio-executor v0.1.9 (*)\r\n\u2502   \u2502   \u251c\u2500\u2500 tokio-sync v0.1.7 (*)\r\n\u2502   \u2502   \u251c\u2500\u2500 tokio-sync v0.1.7 (*)\r\n\u2502   \u2502   \u251c\u2500\u2500 tokio-timer v0.2.12 (*)\r\n\u2502   \u2502   \u251c\u2500\u2500 tokio-timer v0.2.12 (*)\r\n\u2502   \u2502   \u251c\u2500\u2500 tokio-timer v0.2.12 (*)\r\n\u2502       \u251c\u2500\u2500 tokio-io v0.1.12 (*)\r\n\u2502   \u2502   \u2514\u2500\u2500 tokio-tcp v0.1.3 (*)\r\n\u2502   \u251c\u2500\u2500 tokio-buf v0.1.1 (*)\r\n\u2502   \u251c\u2500\u2500 tokio-executor v0.1.9 (*)\r\n\u2502   \u251c\u2500\u2500 tokio-io v0.1.12 (*)\r\n\u2502   \u2502   \u251c\u2500\u2500 tokio-buf v0.1.1 (*)\r\n\u2502   \u2502   \u251c\u2500\u2500 tokio-io v0.1.12 (*)\r\n\u2502   \u251c\u2500\u2500 tokio v0.1.22 (*)\r\n\u251c\u2500\u2500 tracing-tower v0.1.0 (git+https://github.com/tokio-rs/tracing?rev=65547d8809fcc726b8187db85b23c42e32ef5dce#65547d8809fcc726b8187db85b23c42e32ef5dce)\r\n\u2502   \u2514\u2500\u2500 tracing-futures v0.2.0 (git+https://github.com/tokio-rs/tracing?rev=65547d8809fcc726b8187db85b23c42e32ef5dce#65547d8809fcc726b8187db85b23c42e32ef5dce)\r\n\u2502   \u251c\u2500\u2500 tokio-executor v0.1.9 (*)\r\n\u2502   \u251c\u2500\u2500 tokio-io v0.1.12 (*)\r\n\u2502   \u251c\u2500\u2500 tokio-reactor v0.1.11 (*)\r\n\u2502   \u251c\u2500\u2500 tokio-tcp v0.1.3 (*)\r\n\u2502   \u251c\u2500\u2500 tokio-timer v0.2.12 (*)\r\n\u2502   \u251c\u2500\u2500 tokio-udp v0.1.5 (*)\r\n\u2502   \u251c\u2500\u2500 tokio v0.1.22 (*)\r\n\u2502   \u251c\u2500\u2500 tokio-executor v0.1.9 (*)\r\n\u2502   \u251c\u2500\u2500 tokio-tcp v0.1.3 (*)\r\n\u2502   \u251c\u2500\u2500 tokio-udp v0.1.5 (*)\r\n    \u251c\u2500\u2500 tokio v0.1.22 (*)\r\n    \u251c\u2500\u2500 tokio-io v0.1.12 (*)\r\n    \u251c\u2500\u2500 tokio-threadpool v0.1.17 (*)\r\n\u251c\u2500\u2500 tokio-test v0.2.0\r\n\u2502   \u2514\u2500\u2500 tokio v0.2.13 (*)\r\n\u251c\u2500\u2500 tokio01-test v0.1.1\r\n\u2502   \u251c\u2500\u2500 tokio-executor v0.1.9 (*)\r\n\u2502   \u2514\u2500\u2500 tokio-timer v0.2.12 (*)\r\n\u2502   \u251c\u2500\u2500 tokio-sync v0.1.7 (*)\r\n\u2502   \u251c\u2500\u2500 tokio v0.1.22 (*)\r\n\u2502   \u251c\u2500\u2500 tokio-tcp v0.1.3 (*)\r\n\u2502   \u251c\u2500\u2500 tokio-udp v0.1.5 (*)\r\n\u2502   \u251c\u2500\u2500 tokio v0.1.22 (*)\r\n\u2502   \u251c\u2500\u2500 tokio-executor v0.1.9 (*)\r\n\u2502   \u251c\u2500\u2500 tokio-io v0.1.12 (*)\r\n\u2502   \u251c\u2500\u2500 tokio-reactor v0.1.11 (*)\r\n\u2502   \u251c\u2500\u2500 tokio-tcp v0.1.3 (*)\r\n\u2502   \u251c\u2500\u2500 tokio-timer v0.2.12 (*)\r\n\u2502   \u251c\u2500\u2500 tokio-udp v0.1.5 (*)\r\n```\r\n\r\n</Details>\r\n\r\n## Description\r\n\r\n<!--\r\n\r\nEnter your issue details below this comment.\r\n\r\nOne way to structure the description:\r\n\r\n<short summary of the bug>\r\n\r\nI tried this code:\r\n\r\n<code sample that causes the bug>\r\n\r\nI expected to see this happen: <explanation>\r\n\r\nInstead, this happened: <explanation>\r\n-->\r\n\r\nIf we do:\r\n\r\n```rust\r\n#[tokio02::test]\r\nasync fn qwe() {\r\n     // ...\r\n}\r\n```\r\n\r\nWe get an error:\r\n\r\n```\r\n   | #[tokio02::test]\r\n   | ^^^^^^^^^^^^^^^^ method not found in `tokio::runtime::threadpool::builder::Builder`\r\n```\r\n\r\nIf we do:\r\n\r\n```rust\r\nuse tokio02 as tokio;\r\n#[tokio::test]\r\nasync fn qwe() {\r\n     // ...\r\n}\r\n```\r\n\r\nEverything works.\r\n\r\nIt's a small annoyance, and there's a workaround, but still...\r\n",
    "tokio-rs__tokio-4519": "tokio::select! only supports 63 branches when it seems like it should support 64\n**Version**\r\ntokio v1.16.1\r\n\r\n**Description**\r\nThe `tokio::select!` macro looks like it was intended to support up to 64 branches, but something seems to go wrong when I try to use it with 64 branches:\r\n\r\nI tried this code (I'm sorry):\r\n\r\n```rust\r\nuse std::future::ready;\r\n\r\n#[tokio::main]\r\nasync fn main() {\r\n    let (v0, v1, v2, v3) = (ready(()), ready(()), ready(()), ready(()));\r\n    let (v4, v5, v6, v7) = (ready(()), ready(()), ready(()), ready(()));\r\n    let (v8, v9, v10, v11) = (ready(()), ready(()), ready(()), ready(()));\r\n    let (v12, v13, v14, v15) = (ready(()), ready(()), ready(()), ready(()));\r\n    let (v16, v17, v18, v19) = (ready(()), ready(()), ready(()), ready(()));\r\n    let (v20, v21, v22, v23) = (ready(()), ready(()), ready(()), ready(()));\r\n    let (v24, v25, v26, v27) = (ready(()), ready(()), ready(()), ready(()));\r\n    let (v28, v29, v30, v31) = (ready(()), ready(()), ready(()), ready(()));\r\n    let (v32, v33, v34, v35) = (ready(()), ready(()), ready(()), ready(()));\r\n    let (v36, v37, v38, v39) = (ready(()), ready(()), ready(()), ready(()));\r\n    let (v40, v41, v42, v43) = (ready(()), ready(()), ready(()), ready(()));\r\n    let (v44, v45, v46, v47) = (ready(()), ready(()), ready(()), ready(()));\r\n    let (v48, v49, v50, v51) = (ready(()), ready(()), ready(()), ready(()));\r\n    let (v52, v53, v54, v55) = (ready(()), ready(()), ready(()), ready(()));\r\n    let (v56, v57, v58, v59) = (ready(()), ready(()), ready(()), ready(()));\r\n    let (v60, v61, v62, v63) = (ready(()), ready(()), ready(()), ready(()));\r\n\r\n    tokio::select! {\r\n        _ = v0 => {}\r\n        _ = v1 => {}\r\n        _ = v2 => {}\r\n        _ = v3 => {}\r\n        _ = v4 => {}\r\n        _ = v5 => {}\r\n        _ = v6 => {}\r\n        _ = v7 => {}\r\n        _ = v8 => {}\r\n        _ = v9 => {}\r\n        _ = v10 => {}\r\n        _ = v11 => {}\r\n        _ = v12 => {}\r\n        _ = v13 => {}\r\n        _ = v14 => {}\r\n        _ = v15 => {}\r\n        _ = v16 => {}\r\n        _ = v17 => {}\r\n        _ = v18 => {}\r\n        _ = v19 => {}\r\n        _ = v20 => {}\r\n        _ = v21 => {}\r\n        _ = v22 => {}\r\n        _ = v23 => {}\r\n        _ = v24 => {}\r\n        _ = v25 => {}\r\n        _ = v26 => {}\r\n        _ = v27 => {}\r\n        _ = v28 => {}\r\n        _ = v29 => {}\r\n        _ = v30 => {}\r\n        _ = v31 => {}\r\n        _ = v32 => {}\r\n        _ = v33 => {}\r\n        _ = v34 => {}\r\n        _ = v35 => {}\r\n        _ = v36 => {}\r\n        _ = v37 => {}\r\n        _ = v38 => {}\r\n        _ = v39 => {}\r\n        _ = v40 => {}\r\n        _ = v41 => {}\r\n        _ = v42 => {}\r\n        _ = v43 => {}\r\n        _ = v44 => {}\r\n        _ = v45 => {}\r\n        _ = v46 => {}\r\n        _ = v47 => {}\r\n        _ = v48 => {}\r\n        _ = v49 => {}\r\n        _ = v50 => {}\r\n        _ = v51 => {}\r\n        _ = v52 => {}\r\n        _ = v53 => {}\r\n        _ = v54 => {}\r\n        _ = v55 => {}\r\n        _ = v56 => {}\r\n        _ = v57 => {}\r\n        _ = v58 => {}\r\n        _ = v59 => {}\r\n        _ = v60 => {}\r\n        _ = v61 => {}\r\n        _ = v62 => {}\r\n        _ = v63 => {}\r\n    }\r\n}\r\n```\r\n\r\nIf you try to compile this, you get:\r\n\r\n```\r\nerror: no rules expected the token `_`\r\n  --> examples\\select_64.rs:22:5\r\n   |\r\n22 | /     tokio::select! {\r\n23 | |         _ = v0 => {}\r\n24 | |         _ = v1 => {}\r\n25 | |         _ = v2 => {}\r\n...  |\r\n86 | |         _ = v63 => {}\r\n87 | |     }\r\n   | |_____^ no rules expected this token in macro call\r\n   |\r\n   = note: this error originates in the macro `$crate::select` (in Nightly builds, run with -Z macro-backtrace for more info)\r\n\r\nerror: could not compile `test` due to previous error\r\n```\r\n\r\nIf you remove the last branch (`v63`) it compiles as expected.",
    "tokio-rs__tracing-2897": "`tracing::instrument(ret)` errors on function with `&mut` args returning `&`/`&mut`\n## Bug Report\r\n\r\n### Version\r\n\r\n```\r\ntracing v0.1.40\r\ntracing-attributes v0.1.27 (proc-macro)\r\ntracing-core v0.1.32\r\n```\r\n\r\n### Description\r\n\r\nWhen using `instrument(ret)` (or `instrument(err)`), the closure in the generated code is inferred to be `Fn` or `FnMut`, which causes compile errors when trying to return a reference to an argument.\r\n\r\n```rust\r\n// error: lifetime may not live long enough\r\n// note: closure implements `Fn`, so references to captured variables can't escape the closure\r\n#[tracing::instrument(ret)]\r\nfn foo(x: &mut ()) -> &() {\r\n    x\r\n}\r\n\r\n// error: captured variable cannot escape `FnMut` closure body\r\n#[tracing::instrument(ret)]\r\nfn foo(x: &mut ()) -> &mut () {\r\n    x\r\n}\r\n```\r\n\r\n### Possible Solution\r\n\r\nForce the generated closure to be `FnOnce`, either via a function:\r\n\r\n```rust\r\nfn force_fn_once<T, F: FnOnce() -> T>(f: F) -> F {\r\n    f\r\n}\r\n\r\nforce_fn_once(move || {\r\n    // ...\r\n})\r\n```\r\n\r\nOr by rebinding a captured variable\r\n\r\n```rust\r\nlet outer = &mut ();\r\nmove || {\r\n    { let inner = outer; }\r\n    // ...\r\n}\r\n```",
    "tokio-rs__tracing-2892": "`tracing::instrument(ret)` errors on function with `&mut` args returning `&`/`&mut`\n## Bug Report\r\n\r\n### Version\r\n\r\n```\r\ntracing v0.1.40\r\ntracing-attributes v0.1.27 (proc-macro)\r\ntracing-core v0.1.32\r\n```\r\n\r\n### Description\r\n\r\nWhen using `instrument(ret)` (or `instrument(err)`), the closure in the generated code is inferred to be `Fn` or `FnMut`, which causes compile errors when trying to return a reference to an argument.\r\n\r\n```rust\r\n// error: lifetime may not live long enough\r\n// note: closure implements `Fn`, so references to captured variables can't escape the closure\r\n#[tracing::instrument(ret)]\r\nfn foo(x: &mut ()) -> &() {\r\n    x\r\n}\r\n\r\n// error: captured variable cannot escape `FnMut` closure body\r\n#[tracing::instrument(ret)]\r\nfn foo(x: &mut ()) -> &mut () {\r\n    x\r\n}\r\n```\r\n\r\n### Possible Solution\r\n\r\nForce the generated closure to be `FnOnce`, either via a function:\r\n\r\n```rust\r\nfn force_fn_once<T, F: FnOnce() -> T>(f: F) -> F {\r\n    f\r\n}\r\n\r\nforce_fn_once(move || {\r\n    // ...\r\n})\r\n```\r\n\r\nOr by rebinding a captured variable\r\n\r\n```rust\r\nlet outer = &mut ();\r\nmove || {\r\n    { let inner = outer; }\r\n    // ...\r\n}\r\n```",
    "tokio-rs__tracing-2883": "string literal field names don't compile for `level!` event macros\n## Bug Report\r\n\r\n\r\n### Version\r\n\r\n```\r\ntracing 0.1.37\r\n```\r\n\r\n### Platform\r\n\r\nAny\r\n\r\n### Crates\r\n\r\n`tracing`\r\n\r\n### Description\r\n\r\nTracing's macros support string literals as field names. In the documentation, we give an example with a span:\r\n\r\n> Fields with names that are not Rust identifiers, or with names that are Rust reserved words,\r\n> may be created using quoted string literals. However, this may not be used with the local\r\n> variable shorthand.\r\n> ```rust\r\n> // records an event with fields whose names are not Rust identifiers\r\n> //  - \"guid:x-request-id\", containing a `:`, with the value \"abcdef\"\r\n> //  - \"type\", which is a reserved word, with the value \"request\"\r\n> span!(Level::TRACE, \"api\", \"guid:x-request-id\" = \"abcdef\", \"type\" = \"request\");\r\n> ```\r\n\r\nThis form works when used with the `span!` and `event!` macros. However, when used with the level event macros (e.g. `info!`, `debug!`, and friends), the string literal form doesn't compile --- the macro appears to interpret this as format arguments, rather than as fields. For example:\r\n```rust\r\nuse tracing::{self, Level}; // 0.1.37\r\n\r\nfn main() {\r\n    let foo = \"lol\";\r\n    // this compiles\r\n    tracing::span!(Level::TRACE, \"api\", \"guid:x-request-id\" = ?foo);\r\n    \r\n    // this compiles\r\n    tracing::trace_span!(\"api\", \"guid:x-request-id\" = ?foo);\r\n    \r\n    // this compiles\r\n    tracing::event!(Level::TRACE, \"guid:x-request-id\" = ?foo);\r\n    \r\n    // this doesn't compile\r\n    tracing::trace!(\"guid:x-request-id\" = ?foo)\r\n}\r\n```\r\n([playground](https://play.rust-lang.org/?version=stable&mode=debug&edition=2021&gist=0e020beed65ad302f86aceb0d895798d))\r\n\r\nWe should fix this.\r\n\r\nAlso, it appears that the `macros.rs` integration test doesn't contain any tests for this form: https://github.com/tokio-rs/tracing/blob/99e0377a6c48dd88b06ed2ae0259c62d8312c58d/tracing/tests/macros.rs\r\n\r\nThis is probably why it only works in some cases. :upside_down_face:",
    "tokio-rs__tracing-2335": "Configurable log level for `#[instrument(err)]`\n## Feature Request\r\n\r\nI'd like to be able to specify the log level that `Err` returns are printed at. \r\n\r\n### Crates\r\n\r\n`tracing::instrument`\r\n\r\n### Motivation\r\n\r\nCurrently it's hardcoded as `error`, but I have some functions that I'd like to instrument where returning an error is not especially unusual (think of for instance \"is the user logged in yet?\": any error eventually gets folded into \"no, the user is not logged in\"). In such cases, I'd like to be able to lower the level to WARN or INFO or even DEBUG.\r\n\r\n### Proposal\r\n\r\nHow about an additional attribute `err_level`?\r\n\r\n```rust\r\n#[instrument(level=\"debug\", ret, err, err_level=\"info\")]\r\nfn my_fun() -> Result<int> { Ok(42) }\r\n```\r\n\r\n### Alternatives\r\n\r\nI could avoid using the instrument macro and annotate every single caller with an event, but that's not really the spirit of the crate :)",
    "tokio-rs__tracing-2090": "`#[instrument]` on a fn returning `Pin<Box<dyn Future>>` leads to bogus `unused_braces` lint\n## Bug Report\r\n\r\n### Version\r\n\r\n0.1.29\r\n\r\n### Description\r\n\r\nWhen using a fn that returns a `Pin<Box<dyn Future>>` and uses an `async move` block, I get a bogus `unused_braces` lint.\r\n\r\n```rust\r\nuse std::future::Future;\r\nuse std::pin::Pin;\r\n\r\n#[tracing::instrument]\r\npub fn instumented_fn() -> Pin<Box<dyn Future<Output = ()>>> {\r\n    Box::pin(async move { () })\r\n}\r\n```\r\n\r\nThe lint is bogus and the suggestion would yield invalid code:\r\n\r\n```\r\n\r\nwarning: unnecessary braces around block return value\r\n  --> src/main.rs:50:25\r\n   |\r\n50 |     Box::pin(async move { () })\r\n   |                         ^^  ^^\r\n   |\r\n   = note: `#[warn(unused_braces)]` on by default\r\nhelp: remove these braces\r\n   |\r\n50 -     Box::pin(async move { () })\r\n50 +     Box::pin(async move ())\r\n   | \r\n\r\n```\r\n\r\nIn our original code we had something along the lines of `Box::pin(async move { foo.await.map_err(\u2026)? })`.",
    "tokio-rs__tracing-2027": "Unable to create a `Registry` with a dynamic number of `Layer`s\n## Feature Request\r\n\r\n### Crates\r\n\r\nProbably at least `tracing-subscriber`, maybe also others (`tracing-core`?).\r\n\r\n### Motivation\r\n\r\nI would like to use a dynamic number of layers with a `Registry` in order to configure (at startup-time) the set of output files and of what goes where.\r\n\r\nSo something like this:\r\n\r\n```rust\r\nlet mut registry = tracing_subscriber::registry();\r\n\r\nfor (file, filter) in &log_settings {\r\n  registry = registry.with(\r\n    fmt::layer()\r\n      .with_writer(Arc::new(file))\r\n      .with_filter(filter)\r\n  )\r\n}\r\n\r\nregistry.init();\r\n```\r\n\r\n### Proposal\r\n\r\nNo real idea, the issue seems to be that every `SubscriberExt::with()` call returns a different type, and so this can't be made dynamic.\r\n\r\nWhile not a solution, this issue seems to run into similar problems: https://github.com/tokio-rs/tracing/issues/575\r\n\r\nEdit: Maybe something like `impl Layer for Vec<Box<dyn Layer>>` could work? Then such a `Vec` could be added to the registry with `SubscriberExt::with()`.\r\n\r\n### Alternatives\r\n\r\nI tried doing this with a form of type-erased objects, but this doesn't work:\r\n\r\n```rust\r\ntrait RegistrySupertrait: SubscriberExt + SubscriberInitExt {}\r\nimpl<T: SubscriberExt + SubscriberInitExt> RegistrySupertrait for T {}\r\n\r\nlet mut registry: Box<dyn RegistrySupertrait> = tracing_subscriber::registry();\r\n\r\n...\r\n\r\nregistry.init();\r\n```\r\n\r\nFails because `SubscriberInitExt` is not object-safe. I also tried with `Into<Dispatch>` instead of `SubscriberInitExt` (which can be converted automatically), but `Into<Dispatch>` is also not object-safe, probably because `core::convert::Into<T>` requires `Self: Sized` (note: `std::convert::Into` does not _show_ this bound, but it actually seems to be the same type as `core::convert::Into`, and thus seems to require it as well).\r\n\r\nIs this possible somehow/am I missing something?",
    "tokio-rs__tracing-2008": "It is impossible to dis-/en- able event processing based on event field contents in tracing_subsriber::Subsribe\nThis means it is impossible to implement features like e.g. [env_logger's regex log message filtering](https://docs.rs/env_logger/latest/env_logger/#filtering-results) in a separate `Subscribe` layer; it must be implemented in each and every layer which processes `Subscribe::on_event`.\r\n\r\n## Feature Request\r\n\r\nAllow `Subscribe` layers in a `Layered` `Collect`or to determine if lower layers should receive the `on_event` callback.\r\n\r\n### Crates\r\n\r\nThis effects exclusively `tracing_subscriber`. The most straightforward implementation is a breaking change.\r\n\r\n### Motivation\r\n\r\nI'm working on an initiative ([tracing-filter](https://github.com/CAD97/tracing-filter)) to provide an alternative to `EnvFilter` which offers a more principled/structured way of doing tracing event filtering. Filtering on event field contents is a natural ability to have, and is required for feature parity with env_logger (transparent compatibility with which is a goal for tracing-filter, and not provided by `EnvFilter`, as it simply (at best) errors on `/filter` directives).\r\n\r\n### Proposal\r\n\r\nChange the signature of `Subscribe::on_event` to\r\n\r\n> ```rust\r\n> fn Subscribe::<C: Collect>::on_event(&self, event: &Event<'_>, ctx: Context<'_, C>) -> std::ops::ControlFlow<()>;\r\n> ```\r\n\r\nCall `on_event` starting from the top layer. Similar to how `Subscribe::enabled` is handled, if `on_event` returns\r\n\r\n- `ControlFlow::Continue`, continue and call the next layer's `on_event`.\r\n- `ControlFlow::Break`, stop calling `on_event`.\r\n\r\n#### Drawbacks\r\n\r\n- A slight complexity increase.\r\n- Breaking change.\r\n  - Mitigable with making this a new function defaulted to call the old one, for a complexity increase.\r\n  - Mitigable by bundling with tracing_core 0.2.\r\n- MSRV 1.55.0.\r\n- Unknown unknowns.\r\n\r\n### Alternatives\r\n\r\n- Status quo; just don't allow layered filtering based on the contents of an event, and only filter on events' `Metadata`.\r\n- Add a separate `Subscribe::event_enabled` rather than adding this functionality to `on_event`.\r\n  - Drawback: potential duplication of logic between `event_enabled` and `on_event`.\r\n- Go even further: `Subscribe::on_new_span`, `on_record`, `on_follows_from`, `on_event`, `on_enter`, `on_exit`, `on_close`, and `on_id_change` could all theoretically return `ControlFlow` and control whether lower layers see these callbacks. The author of this issue has not considered the ramifications of doing so, beyond that of `on_event`.\r\n  - Of these, `on_new_span` and `on_record` seem the most promising; `on_enter`/`exit`/`close` seem potentially problematic; `on_follows_from` and `on_id_change` very much so.",
    "tokio-rs__tracing-2001": "`tracing::subscriber::set_default(NoSubscriber::default())` not working as expected\n## Bug Report\r\n\r\n### Version\r\n\r\n```\r\n$ cargo tree | grep tracing\r\n\u2500\u2500 tracing v0.1.32\r\n\u2502   \u251c\u2500\u2500 tracing-attributes v0.1.20 (proc-macro)\r\n\u2502   \u2514\u2500\u2500 tracing-core v0.1.23\r\n\u2514\u2500\u2500 tracing-subscriber v0.3.9\r\n    \u251c\u2500\u2500 tracing-core v0.1.23 (*)\r\n    \u2514\u2500\u2500 tracing-log v0.1.2\r\n        \u2514\u2500\u2500 tracing-core v0.1.23 (*)\r\n```\r\n\r\n### Platform\r\n\r\n```\r\n$ uname -a\r\nLinux <hostname> 5.16.12-arch1-1 #1 SMP PREEMPT Wed, 02 Mar 2022 12:22:51 +0000 x86_64 GNU/Linux\r\n```\r\n\r\n### Crates\r\n\r\ntracing\r\n\r\n### Description\r\n\r\nI tried to temporarily stop logging with by setting a `NoSubscriber` as the default subscriber. Logging continued nevertheless.\r\n\r\nMinimal reproduction:\r\n\r\nCargo.toml:\r\n```toml\r\n[package]\r\nname = \"blurb\"\r\nversion = \"0.1.0\"\r\nedition = \"2021\"\r\n\r\n[dependencies]\r\ntracing = \"0.1.32\"\r\ntracing-subscriber = \"0.3.9\"\r\n```\r\n\r\nsrc/main.rs\r\n```rs\r\nuse tracing::subscriber::NoSubscriber;\r\nuse tracing_subscriber::fmt::Layer;\r\nuse tracing_subscriber::layer::SubscriberExt;\r\nuse tracing_subscriber::util::SubscriberInitExt;\r\nfn main() {\r\n    tracing_subscriber::registry()\r\n        .with(Layer::new())\r\n        .init();\r\n    let _default_guard = tracing::subscriber::set_default(NoSubscriber::default());\r\n    tracing::error!(\"you shouldn't see this!\");\r\n}\r\n```\r\nOutput:\r\n```\r\n$ cargo run\r\n    Finished dev [unoptimized + debuginfo] target(s) in 0.07s\r\n     Running `target/debug/blurb`\r\n2022-03-17T22:41:51.974464Z ERROR blurb: you shouldn't see this!\r\n```",
    "tokio-rs__tracing-1983": "`EnvFilter` does not implement `Filter`\n## Bug Report\r\n\r\n### Version\r\n\r\ntracing-subscriber v0.3.7\r\n\r\n### Crates\r\n\r\ntracing-subscriber\r\n\r\n### Description\r\n\r\n`tracing_subscriber::layer::Filter` is implemented for most various filter-like things I can think of, including `LevelFilter`, `Targets`, `FilterFn`, `DynFilterFn`, and the new combinators. But what is notably missing from this list is `EnvFilter`. I can apply a filter on top of `EnvFilter` using `<EnvFilter as Layer>::with_filter()`, but I can't apply an `EnvFilter` on top of an existing filter. This is a weird limitation and feels like a simple oversight.",
    "tokio-rs__tracing-1853": "opentelemetry 0.17 support\n## Feature Request\r\n\r\n### Crates\r\n\r\n`tracing-opentelemetry`\r\n\r\n### Motivation\r\n\r\n`opentelemetry` 0.17 is released, and it's nice to align the version numbers so that the types are compatible and structs can be passed between crates.\r\n\r\n### Proposal\r\n\r\nMake a new release of `tracing-opentelemetry` that depends on `opentelemetry` 0.17.\r\n\r\n### Alternatives\r\n\r\nNot that I can think of.\r\n",
    "tokio-rs__tracing-1619": "tracing_subscriber::Layer::downcast_raw not called when filtered\n## Bug Report\r\n\r\n### Version\r\n\r\n```\r\ntracing-downcast-bug v0.1.0 (/Users/bryan/personal/x-ray-test/tracing-downcast-bug)\r\n\u251c\u2500\u2500 tracing v0.1.28 (*)\r\n\u2514\u2500\u2500 tracing-subscriber v0.2.24 (*)\r\n```\r\n\r\n### Platform\r\n\r\n```\r\nDarwin Bryans-MacBook-Pro.local 20.6.0 Darwin Kernel Version 20.6.0: Mon Aug 30 06:12:21 PDT 2021; root:xnu-7195.141.6~3/RELEASE_X86_64 x86_64\r\n```\r\n\r\n### Crates\r\n\r\n`tracing-subscriber`\r\n\r\n### Description\r\n\r\nI'm trying to implement a `Layer` that has something very similar to tracing-error's [`WithContext`](https://github.com/tokio-rs/tracing/blob/66cd79f72af5ebcb6f21a1017b6ce33bea05558d/tracing-error/src/layer.rs#L32) to support erasing types and getting access to the current span's state.\r\n\r\nTo do that, I implement `Layer::downcast_raw` in [the same way that tracing-error does](https://github.com/tokio-rs/tracing/blob/66cd79f72af5ebcb6f21a1017b6ce33bea05558d/tracing-error/src/layer.rs#L55-L63).\r\n\r\nThis works great when the layer is not filtered. However, once I filter the layer\r\n\r\n```rust\r\nlet filter = tracing_subscriber::filter::Targets::new().with_default(tracing::Level::INFO);\r\nlet layer = MyLayer::new();\r\ntracing_subscriber::registry().with(layer.with_filter(filter)).init();\r\n```\r\n\r\nI'm not able to get a `WithContext` instance anymore, because `Filtered` [handles `downcast_raw`, and doesn't forward it](https://github.com/tokio-rs/tracing/blob/66cd79f72af5ebcb6f21a1017b6ce33bea05558d/tracing-subscriber/src/filter/layer_filters.rs#L379-L391) to `MyLayer::downcast_raw`.\r\n\r\n\r\n### Reproduction (sorry it's a bit long)\r\n\r\n```rust\r\nuse tracing_subscriber::prelude::*;\r\n\r\nfn main() {\r\n    let layer = MyLayer::new();\r\n    let subscriber = tracing_subscriber::registry().with(layer);\r\n    println!(\"Running unfiltered test:\");\r\n    tracing::subscriber::with_default(subscriber, || {\r\n        let span = tracing::span!(tracing::Level::INFO, \"hey\");\r\n        let _entered = span.enter();\r\n\r\n        let result = get_current_span_name();\r\n\r\n        println!(\"Unfiltered: {:?}\", result);\r\n    });\r\n    println!();\r\n\r\n    println!(\"Running filtered test:\");\r\n    let filter = tracing_subscriber::filter::Targets::new().with_default(tracing::Level::INFO);\r\n    let layer = MyLayer::new();\r\n    let subscriber = tracing_subscriber::registry().with(layer.with_filter(filter));\r\n    tracing::subscriber::with_default(subscriber, || {\r\n        let span = tracing::span!(tracing::Level::INFO, \"hey\");\r\n        let _entered = span.enter();\r\n\r\n        let result = get_current_span_name();\r\n\r\n        println!(\"Filtered: {:?}\", result);\r\n    });\r\n    println!();\r\n}\r\n\r\nfn get_current_span_name() -> Option<String> {\r\n    let span = tracing::Span::current();\r\n    span.with_subscriber(|(id, s)| {\r\n        if let Some(with_context) = s.downcast_ref::<WithContext>() {\r\n            Some(with_context.get_span_name(s, id))\r\n        } else {\r\n            None\r\n        }\r\n    })\r\n    .flatten()\r\n}\r\n\r\nstruct MyLayer<S> {\r\n    with_context: WithContext,\r\n    phantom: std::marker::PhantomData<S>,\r\n}\r\n\r\nimpl<S> MyLayer<S>\r\nwhere\r\n    S: tracing::Subscriber,\r\n    S: for<'lookup> tracing_subscriber::registry::LookupSpan<'lookup>,\r\n{\r\n    pub fn new() -> Self {\r\n        let with_context = WithContext {\r\n            get_span_name: Self::get_span_name,\r\n        };\r\n\r\n        Self {\r\n            with_context,\r\n            phantom: std::marker::PhantomData,\r\n        }\r\n    }\r\n\r\n    fn get_span_name(dispatch: &tracing::Dispatch, id: &tracing::span::Id) -> String {\r\n        let subscriber = dispatch\r\n            .downcast_ref::<S>()\r\n            .expect(\"subscriber should downcast to expected type; this is a bug!\");\r\n        let span = subscriber\r\n            .span(id)\r\n            .expect(\"registry should have a span for the current ID\");\r\n\r\n        // let mut extensions = span.extensions_mut();\r\n        // if let Some(custom_data) = extensions.get_mut::<CustomData>() {\r\n        //     do something with custom_data\r\n        // }\r\n        span.name().to_string()\r\n    }\r\n}\r\n\r\nstruct WithContext {\r\n    get_span_name: fn(&tracing::Dispatch, &tracing::span::Id) -> String,\r\n}\r\n\r\nimpl WithContext {\r\n    fn get_span_name(&self, s: &tracing::Dispatch, id: &tracing::span::Id) -> String {\r\n        (self.get_span_name)(s, id)\r\n    }\r\n}\r\n\r\nimpl<S> tracing_subscriber::Layer<S> for MyLayer<S>\r\nwhere\r\n    S: tracing::Subscriber,\r\n    S: for<'lookup> tracing_subscriber::registry::LookupSpan<'lookup>,\r\n{\r\n    unsafe fn downcast_raw(&self, id: std::any::TypeId) -> Option<*const ()> {\r\n        match id {\r\n            id if id == std::any::TypeId::of::<Self>() => Some(self as *const _ as *const ()),\r\n            id if id == std::any::TypeId::of::<WithContext>() => {\r\n                Some(&self.with_context as *const _ as *const ())\r\n            }\r\n            _ => None,\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n### Desired output\r\n\r\n```\r\nRunning unfiltered test:\r\nUnfiltered: Some(\"hey\")\r\n\r\nRunning filtered test:\r\nFiltered: Some(\"hey\")\r\n```\r\n\r\n### Actual output\r\n\r\n```\r\nRunning unfiltered test:\r\nUnfiltered: Some(\"hey\")\r\n\r\nRunning filtered test:\r\nFiltered: None\r\n```\r\n\r\n",
    "tokio-rs__tracing-1523": "Subscriber/layer tree\n## Feature Request\r\n\r\nMaybe more of an idea than a feature request\u2026\r\n\r\nInstead of stack of layers with registry on the bottom, use a tree with registry in the root.\r\n\r\n### Crates\r\n\r\nPossibly to `tracing-subscriber`.\r\n\r\n### Motivation\r\n\r\nThe motivation is two-fold.\r\n\r\nFirst, I find the model where the Registry that enriches data sits on the bottom of a linear stack hard to grasp, as the information travels bidirectionally.\r\n\r\nSecond, when trying to implement both some metric extraction and logging at the same time, I find it hard to compose them together. The new proposals, like #508, that seems to address the immediate concern, but it seems to lose some part of flexibility and has two kinds of filters. What I have in mind works uniformly and can filter arbitrary sub-tree of the subscribers.\r\n\r\n### Proposal\r\n\r\nA subscriber seems to be doing two things:\r\n* Assigning IDs and keeping track of things.\r\n* Processing events and spans and exporting that data outside of the application in some way.\r\n\r\nIt seems it's possible to use the `Registry` for the first and then implement a `Layer` for the second.\r\n\r\nWhat I'm thinking about is putting the registry at a top of all the thing. It would assign IDs, provide context, etc. Then it would call into a consumer (I probably don't want to call it a layer). The consumer would then be able to either process it, or filter it and call another consumer. Or, it could contain multiple parallel consumers that are independent on each other, allowing a kind of branching.\r\n\r\nThat way, one could combine branching & filtering in arbitrary way to have multiple log destinations, metrics, etc, without influencing each other, but also placing a filter directly below the registry to disable it for the whole tree.\r\n\r\nInformation would be flowing only from registry to the leaves of the tree, with the exception of the `register_callsite` that would be aggregated from bottom to the top (and would allow the registry to disable processing in itself too, as needed).\r\n\r\nI also wonder if it would be possible to create an adapter that would somehow wrap a full-featured subscriber into a leaf of this tree in some way (with mapping of IDs, probably).\r\n\r\nI wonder if this has been considered and turned down for some reason, or if it would be worth trying out. I'm willing to draft some code and then show it to discuss if it makes sense to integrate (either as part/replacement of tracing-subscriber, or something else).\r\n",
    "tokio-rs__tracing-1297": "tracing-attributes 0.1.14 causes variables to be out of scope when they're in scope\n## Bug Report\r\n<!--\r\nThank you for reporting an issue.\r\n\r\nPlease fill in as much of the template below as you're able.\r\n-->\r\n\r\n### Version\r\n\r\n```\r\n\u2502   \u2502   \u2514\u2500\u2500 tracing v0.1.25\r\n\u2502   \u2502       \u251c\u2500\u2500 tracing-attributes v0.1.14 (proc-macro)\r\n\u2502   \u2502       \u2514\u2500\u2500 tracing-core v0.1.17\r\n\u2502   \u251c\u2500\u2500 tracing v0.1.25 (*)\r\n\u2502   \u2514\u2500\u2500 tracing v0.1.25 (*)\r\n\u2502   \u2514\u2500\u2500 tracing v0.1.25 (*)\r\n\u251c\u2500\u2500 tracing v0.1.25 (*)\r\n\u251c\u2500\u2500 tracing-core v0.1.17 (*)\r\n\u251c\u2500\u2500 tracing-futures v0.2.5\r\n\u2502   \u2514\u2500\u2500 tracing v0.1.25 (*)\r\n\u251c\u2500\u2500 tracing-log v0.1.2\r\n\u2502   \u2514\u2500\u2500 tracing-core v0.1.17 (*)\r\n\u251c\u2500\u2500 tracing-subscriber v0.2.16\r\n\u2502   \u251c\u2500\u2500 tracing v0.1.25 (*)\r\n\u2502   \u251c\u2500\u2500 tracing-core v0.1.17 (*)\r\n\u2502   \u251c\u2500\u2500 tracing-log v0.1.2 (*)\r\n\u2502   \u2514\u2500\u2500 tracing-serde v0.1.2\r\n\u2502       \u2514\u2500\u2500 tracing-core v0.1.17 (*)\r\n```\r\n\r\n### Platform\r\n\r\n<!---\r\nOutput of `uname -a` (UNIX), or version and 32 or 64-bit (Windows)\r\n-->\r\n\r\nDarwin Kernel Version 20.3.0 (AMR64)\r\n\r\n### Crates\r\n\r\ntracing-attributes\r\n\r\n### Description\r\n\r\nUpgrading to tracing-attributes 0.1.14 appears to be placing variables out of scope.\r\n\r\nI don't exactly have a minimal reproduction, but here's roughly the code that causes it:\r\n\r\n```rust\r\n#[instrument(skip(self, req), fields(app_id))]\r\nfn call(&mut self, req: (Req, IpAddr)) -> Self::Future {\r\n    // ...\r\n    let metrics = self.metrics.clone();\r\n    // ...\r\n    Box::pin(async move {\r\n        // ...\r\n        metrics // cannot find value `metrics` in this scope\r\n    })\r\n}\r\n```\r\n\r\nRemoving `#[instrument(...)]` fixes the issue.",
    "tokio-rs__tracing-1291": "#[instrument] - Future-proofing async-trait support in tracing-attributes\nNot a bug **yet**, but `async-trait` is working towards changing the way they wrap an async function in a trait impl (see https://github.com/dtolnay/async-trait/pull/143 for more details).\r\nMore specifically, they are moving away from a design where they were wrapping the insides of async function into an async function nested inside a \"classical\" function, and returning the async function, boxing it along the way. Because some code is probably much clearer than anything I can say, this means that the impl of the following code will be translated from:\r\n```rust\r\n#[async_trait]\r\npub trait FakeTrait {\r\n    async fn foo(&mut self);\r\n}\r\n\r\nstruct Impl;\r\n\r\n#[async_trait]\r\nimpl FakeTrait for Impl {\r\n    async fn foo(&mut self) {\r\n    }\r\n}\r\n```\r\nto something like:\r\n```rust\r\nimpl FakeTrait for Impl {\r\n    fn foo(&mut self) -> Box<Pin<dyn Future<Output = ()>>> {\r\n      async fn _foo(_self: &mut Self) {}\r\n      Box::pin(_foo(self))\r\n    }\r\n}\r\n```\r\nIf it can help to demangle my shoddy explanations above, the support for accepting this kind of expressions was added in #711.\r\n\r\nThe new version would (from what I understand, please correct me if I'm mistaken !) translate the previous code as:\r\n```rust\r\nimpl FakeTrait for Impl {\r\n    fn foo(&mut self) -> Box<Pin<dyn Future<Output = ()>>> {\r\n      Box::pin(async move {})\r\n    }\r\n}\r\n```\r\n\r\nWhile we could support this code in the same fashion as we support the current version of async-trait, I fear this might lead to some confusion if a user deliberately want to instrument a function returning a future and end up instrumented the future instead. Not quite sure what to do here. Maybe we have to consider adding an argument to the `#[instrument]` macro that would  opt-in to instrument the returned closure ?\r\nIt could be something like:\r\n```rust\r\n#[async_trait]\r\nimpl FakeTrait for Impl {\r\n   #[instrument] // instrument the outer function (foo)\r\n    async fn foo(&mut self) {\r\n    }\r\n}\r\n\r\n#[async_trait]\r\nimpl FakeTrait for Impl {\r\n   #[instrument(instrument_return_future)] // instrument the return (async move {}) instead of foo (the wrapper)\r\n    async fn foo(&mut self) {\r\n    }\r\n}\r\n```\r\n\r\nBut that's just some thoughts in the wind :)\r\nAny opinion ?",
    "tokio-rs__tracing-1252": "trace: Non-contextual span enter/leave\nI am currently instrumenting [`tokio-tower`](https://github.com/tower-rs/tokio-tower), and am running into a use-case that I don't think `tokio-trace` really supports. I want to trace the full path of a given request through the system, so the request is given its own `Span`. That `Span` should be entered once when the request is first issued, and not be left again until the request eventually resolves, potentially much later and in some other context.\r\n\r\nMore concretely, the flow looks a little like this:\r\n\r\n - User wants to issue a request, and passes it to the client library.\r\n - The library creates a `oneshot` channel tx/rx pair and a `Span`.\r\n - The library enters the `Span`.\r\n - The library sends all these three over a channel to a spawned worker.\r\n - The worker does a bunch of asynchronous work, including handling other requests.\r\n   As part of doing so, it also emits events related to each request's `Span` (if any).\r\n - Eventually, the request finishes, and a response is sent on the `oneshot` channel.\r\n - The library emits a final event for the request's `Span` marking its completion, and then leaves the `Span`.\r\n\r\n#1109 is need to allow the worker to explicitly log events as part of a request's `Span`, since it is not executing \"in the context of\" any given `Span`. Beyond that however, there is no way to have the `Span::enter` and `Span::leave` as disjoint as this flow requires. `Span::in_scope` immediately leaves the span's scope, and `Span::enter` returns a guard that is tied to the lifetime of the `Span`.\r\n\r\nThere are a couple of options here as far as I can see:\r\n\r\n - Make `Span::enter` return an owned guard that increments the ref count of the `Span`. This has the upside of leaving the API simple, but increases the cost of `Span::enter` for everyone, even when it is not necessary.\r\n - Add `Span::enter_owned` (under some other name probably) alongside `Span::enter`, and have that return an owned guard which increments the ref count. This still ensures that the `Span` is entered and left correctly and isolates the cost to when it is needed, but complicates the API.\r\n - Add `Span::emit_enter` and `Span::emit_leave` which emit the `Span`'s \"enter\" and \"leave\" events without returning a guard. This API can be mis-used so that multiple enter/leaves are emitted, but would be more efficient than incrementing the ref count for a guard.\r\n - Add `Span::guard` which consumes the `Span` and returns an owned guard. This is probably the nicest API, as it cannot be mis-used, doesn't increment the ref count, and adds only a single API method.",
    "tokio-rs__tracing-1236": "impl Trait not allowed after updating tracing-attributes:0.1.12\n## Bug Report\r\n\r\nHey :wave: thanks for taking the time to look at the following issue :blush: \r\n\r\n### Version\r\n\r\nThe versions are:\r\n`tracing = 0.1.23`\r\n`tracing-attributes = 0.1.12`\r\n`tracing-core = 0.1.17`\r\n\r\nHere's the [`Cargo.lock`](https://github.com/radicle-dev/tracing-bug/blob/master/Cargo.lock) of the reproducible.\r\n\r\n### Platform\r\n\r\n`Linux haptop 5.10.0-rc6 #1-NixOS SMP Sun Nov 29 23:50:50 UTC 2020 x86_64 GNU/Linux`\r\n\r\n### Description\r\n\r\nWe're using a combination of `tracing::instrument` while also returning a trait object, i.e. `impl`. When this combined with `Result` and using `err` in `tracing::instrument` then we get the following compiler error:\r\n```\r\nerror[E0562]: `impl Trait` not allowed outside of function and inherent method return types\r\n  --> src/main.rs:22:30\r\n   |\r\n22 |     fn test(&self) -> Result<impl Iterator<Item = u32>, Error> {\r\n   |                              ^^^^^^^^^^^^^^^^^^^^^^^^^\r\n```\r\n\r\nThis was working before and it seems that an update of `tracing-attributes` caused the code not to compile. It's probably worth noting that this isn't an issue without the `Result` and `err` pragma.\r\n\r\nHere's a minimal example of a project not compiling https://github.com/radicle-dev/tracing-bug. If you switch to the `works` branch, https://github.com/radicle-dev/tracing-bug/tree/works, then you can see that using `tracing-attributes = \"=0.1.11\"` allows the code to compile again. \r\n\r\nIf there's any more detail that would be helpful, please let me know :v: Thanks again!\r\n",
    "tokio-rs__tracing-1233": "impl Trait not allowed after updating tracing-attributes:0.1.12\n## Bug Report\r\n\r\nHey :wave: thanks for taking the time to look at the following issue :blush: \r\n\r\n### Version\r\n\r\nThe versions are:\r\n`tracing = 0.1.23`\r\n`tracing-attributes = 0.1.12`\r\n`tracing-core = 0.1.17`\r\n\r\nHere's the [`Cargo.lock`](https://github.com/radicle-dev/tracing-bug/blob/master/Cargo.lock) of the reproducible.\r\n\r\n### Platform\r\n\r\n`Linux haptop 5.10.0-rc6 #1-NixOS SMP Sun Nov 29 23:50:50 UTC 2020 x86_64 GNU/Linux`\r\n\r\n### Description\r\n\r\nWe're using a combination of `tracing::instrument` while also returning a trait object, i.e. `impl`. When this combined with `Result` and using `err` in `tracing::instrument` then we get the following compiler error:\r\n```\r\nerror[E0562]: `impl Trait` not allowed outside of function and inherent method return types\r\n  --> src/main.rs:22:30\r\n   |\r\n22 |     fn test(&self) -> Result<impl Iterator<Item = u32>, Error> {\r\n   |                              ^^^^^^^^^^^^^^^^^^^^^^^^^\r\n```\r\n\r\nThis was working before and it seems that an update of `tracing-attributes` caused the code not to compile. It's probably worth noting that this isn't an issue without the `Result` and `err` pragma.\r\n\r\nHere's a minimal example of a project not compiling https://github.com/radicle-dev/tracing-bug. If you switch to the `works` branch, https://github.com/radicle-dev/tracing-bug/tree/works, then you can see that using `tracing-attributes = \"=0.1.11\"` allows the code to compile again. \r\n\r\nIf there's any more detail that would be helpful, please let me know :v: Thanks again!\r\n",
    "tokio-rs__tracing-1228": "#[instrument] - Future-proofing async-trait support in tracing-attributes\nNot a bug **yet**, but `async-trait` is working towards changing the way they wrap an async function in a trait impl (see https://github.com/dtolnay/async-trait/pull/143 for more details).\r\nMore specifically, they are moving away from a design where they were wrapping the insides of async function into an async function nested inside a \"classical\" function, and returning the async function, boxing it along the way. Because some code is probably much clearer than anything I can say, this means that the impl of the following code will be translated from:\r\n```rust\r\n#[async_trait]\r\npub trait FakeTrait {\r\n    async fn foo(&mut self);\r\n}\r\n\r\nstruct Impl;\r\n\r\n#[async_trait]\r\nimpl FakeTrait for Impl {\r\n    async fn foo(&mut self) {\r\n    }\r\n}\r\n```\r\nto something like:\r\n```rust\r\nimpl FakeTrait for Impl {\r\n    fn foo(&mut self) -> Box<Pin<dyn Future<Output = ()>>> {\r\n      async fn _foo(_self: &mut Self) {}\r\n      Box::pin(_foo(self))\r\n    }\r\n}\r\n```\r\nIf it can help to demangle my shoddy explanations above, the support for accepting this kind of expressions was added in #711.\r\n\r\nThe new version would (from what I understand, please correct me if I'm mistaken !) translate the previous code as:\r\n```rust\r\nimpl FakeTrait for Impl {\r\n    fn foo(&mut self) -> Box<Pin<dyn Future<Output = ()>>> {\r\n      Box::pin(async move {})\r\n    }\r\n}\r\n```\r\n\r\nWhile we could support this code in the same fashion as we support the current version of async-trait, I fear this might lead to some confusion if a user deliberately want to instrument a function returning a future and end up instrumented the future instead. Not quite sure what to do here. Maybe we have to consider adding an argument to the `#[instrument]` macro that would  opt-in to instrument the returned closure ?\r\nIt could be something like:\r\n```rust\r\n#[async_trait]\r\nimpl FakeTrait for Impl {\r\n   #[instrument] // instrument the outer function (foo)\r\n    async fn foo(&mut self) {\r\n    }\r\n}\r\n\r\n#[async_trait]\r\nimpl FakeTrait for Impl {\r\n   #[instrument(instrument_return_future)] // instrument the return (async move {}) instead of foo (the wrapper)\r\n    async fn foo(&mut self) {\r\n    }\r\n}\r\n```\r\n\r\nBut that's just some thoughts in the wind :)\r\nAny opinion ?",
    "tokio-rs__tracing-1045": "Consistency between various *default methods\n## Feature Request\r\n\r\n- `tracing::dispatcher::set_default` takes `&Dispatch`\r\n- `tracing::dispatcher::set_global_default` takes `Dispatch`\r\n- `tracing::dispatcher::with_default` takes `&Dispatch`\r\n\r\nThese should all take one or the other. `&Dispatch` is definitely more ergonomic (and we clone internally), `Dispatch` saves us a clone in certain cases. Either way, we should stick with one.",
    "tokio-rs__tracing-1017": "core: avoid scoped dispatch overhead when scoped dispatchers are not in use\n\r\nCurrently, the global default dispatcher is essentially implemented as a layer on top of the scoped default dispatcher. This means that using the global default dispatcher still pays some of the overhead of the scoped default dispatcher. In particular:\r\n\r\n - Atomic reference counting. The global default dispatcher will never be dropped, as it lives for the entire lifetime of the program. However, we still `Arc` it, since the scoped default dispatcher requires `Arc`ing. This means we have to bump a reference count to clone it that will never be 0. We could potentially change the internal representation to an enum of either `Arc<dyn Subscriber + ...>` (when scoped) _or_ `&'static dyn Subscriber + ...` when global. That way, cloning the global dispatch is essentially free. This also means we could feature flag the `Arc` use, moving us one step closer to working on `no_std` targets _without_ liballoc.\r\n\r\n- Currently, we always check the thread-local storage for the scoped dispatcher _before_ checking the global default. This is because a scoped default takes priority over a global default. However, this _also_ means that getting the dispatch always involves a TLS hit, even when the TLS dispatcher is not being used. As I suggested here:\r\n  > [...] or because `tracing` requires an additional thread-local storage hit to check if there is a scoped dispatcher. A potentially worthwhile optimization is having a flag indicating whether scoped thread local dispatchers are in use, and skipping the TLS hit if it's unset...\r\n  >\r\n  > _Originally posted by @hawkw in https://github.com/tokio-rs/tracing/issues/859#issuecomment-665825591_\r\nwe could add a flag tracking whether any scoped default dispatchers exist, and skip checking TLS if it's unset. The easiest approach is _just_ to have an `AtomicBool` flag that's set once a scoped dispatcher is created, and never unset --- this way, we would avoid checking TLS in programs that only use `set_global_default` (which is a fairly common case!). However, if we wanted to be fancier, we could also track a _count_ of scoped default dispatchers. That would let us avoid checking TLS if scoped defaults are used briefly and then no longer used.\r\n\r\n The additional complexity of this should, of course, be benchmarked.",
    "tokio-rs__tracing-1015": "Rename `tracing_subscriber::layer::Layer` to something closer to `Subscriber`.\n## Feature Request\r\n\r\n### Crates\r\n\r\n- `tracing-subscriber`\r\n\r\n### Motivation\r\n\r\n\"Layer\" is a somewhat abstract name for describing what it is actually: a _composable_ subscriber. Given the centrality of the `Subscriber` trait and our direction to end-customers to use the `Layer` trait as much as possible, I think we should attempt to communicate the \"subscriber\"-ness of `Layer` to end-users as much as possible. It would also align the `Layer` trait closer to the crate's name, `tracing-subscriber`.\r\n\r\n### Proposal\r\n\r\n(The process for renaming is _relatively_ simple, so most of this proposal will focus on non-`tracing-core` breaking changes.) Here are a few options: \r\n\r\n- Re-export `tracing_core::Subscriber` as `CoreSubscriber` in `tracing`; rename `Layer` to `Subscriber`. Optionally, at some later point, break `tracing_core` and rename `Subscriber` to `CoreSubscriber`. In documentation, emphasize that `CoreSubscriber` is low-level trait and that `tracing_subscriber::Subscriber` should be preferred whenever possible.\r\n- Rename `Layer` to `ComposableSubscriber`. I'm not a fan of this option; `ComposableSubscriber` is a bit of a mouthful.\r\n\r\n### Alternatives\r\n\r\n- Don't do this.\r\n"
}